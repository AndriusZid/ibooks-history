!function(e){function t(t){for(var r,i,s=t[0],c=t[1],l=t[2],u=0,p=[];u<s.length;u++)i=s[u],o[i]&&p.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(d&&d(t);p.length;)p.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/js/";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;a.push([200,1]),n()}([function(e,t,n){var r=n(121),o=n(237)();r.fn.extend({sanitizeHtml:function(e,t){return o.sanitize(e,t)},safeHtml:function(e,t){return null==e?this.html():this.html(this.sanitizeHtml(e,t))},safeAppend:function(e,t){return null==e?this.append(null):this.append(this.sanitizeHtml(e,t))},safeAttr:function(e,t){var n=this.get(0).tagName;return o.isValidAttribute(n,e,t)?this.attr(e,t):this},isSafeURLForNavigation:function(e){return o.isValidAttribute("a","href",e)}}),e.exports=r},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n(236).default;e.exports=function(e,t){var n={},a=t.Deferred();function i(e){return function e(n,o){if("string"==typeof n)return n.replace(/\$RESOURCEDIR/g,o);if(t.isArray(n)){for(var a=[],i=0;i<n.length;++i)a.push(e(n[i],o));return a}if("object"===r(n)){var s={};for(var c in n)n.hasOwnProperty(c)&&(s[c]=e(n[c],o));return s}return n}(e,(n="",0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?n=window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets":"widgets-eu.bookwidgets.com"===window.location.host&&(n="//widget-assets-eu.bookwidgets.com"),n));var n}return o().then(function(o){var s=function(e){var n=function e(n){if("string"==typeof n)return function(e){for(var t="",n=0;n<e.length;++n)2*n<e.length?t+=e.charAt(2*n):t+=e.charAt(2*(e.length-n)-1);return t}(n);if(t.isArray(n)){for(var o=[],a=0;a<n.length;++a)o.push(e(n[a]));return o}if("object"===r(n)){var i={};for(var s in n)n.hasOwnProperty(s)&&(i[s]=e(n[s]));return i}return n}(e);return n=i(n)}(o);for(var c in s)n[c]=s[c];e(n),a.resolve(n)}),{fixResourcePaths:i,getConfig:function(){return a},getConfigSync:function(){return n}}}(n(241),n(0))},function(e,t,n){e.exports=function(e){function t(){var e=window.navigator.userAgent,t=e.indexOf("OS ");return(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&t>-1?window.Number(e.substr(t+3,3).replace("_",".")):0}function n(){return window.BW_PLATFORM_HACK?window.BW_PLATFORM_HACK:"iPad"===navigator.platform||"iPhone"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-ipad-ibooks-epub":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-ipad-safari":-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-ipad-bookwidgets":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-ipad-ibooks":"ibw-platform-ipad":"MacIntel"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-osx-ibooks-epub":-1!==navigator.userAgent.indexOf("PhantomJS")?"ibw-platform-osx-phantomjs":-1!==navigator.userAgent.indexOf("HeadlessChrome")?"ibw-platform-osx-headlesschrome":-1!==navigator.userAgent.indexOf("ibookwidgets")?"ibw-platform-osx-preview":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-osx-chrome":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-osx-safari":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-osx-firefox":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-osx-ibooks":"ibw-platform-osx":"Win32"===navigator.platform?-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-win32-preview":"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Trident")||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Edge")?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-win32-chrome":"Microsoft Internet Explorer"===navigator.appName?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-win32-firefox":"ibw-platform-win32":"iPad Simulator"===navigator.platform||"iPhone Simulator"===navigator.platform?"ibw-platform-ipad-bookwidgets":-1!==navigator.userAgent.indexOf("Android")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-android-chrome":"ibw-platform-android":-1!==navigator.userAgent.indexOf("CrOS")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-chromebook-chrome":"ibw-platform-chromebook":"ibw-platform-unknown"}return{getPlatform:n,supportsAppFeature:function(e){var t=/BookWidgets\/([0-9]+)\.([0-9]+)\.([0-9]+)/g.exec(navigator.userAgent),n=t&&4===t.length?1e4*parseInt(t[1])+100*parseInt(t[2])+parseInt(t[3]):0;return console.log(e+" "+n),"audiorecording"===e&&n>=20800},isToolPreview:function(){return-1!==this.getPlatform().indexOf("preview")},isWebPreview:function(){return"1"===e.getUrlParams(window.location.href).preview},isPreview:function(){return this.isToolPreview()||this.isWebPreview()},isTopLevelPlay:function(){return"1"===e.getUrlParams(window.location.href).toplevel},usesCredentialProxy:function(){return-1!==window.location.search.substring(1).indexOf("bwds-secure-proxy")},isAndroidIosDevice:function(){var e=n();return 0===e.indexOf("ibw-platform-ipad")||0===e.indexOf("ibw-platform-android")},isTouchDevice:function(){return this.isAndroidIosDevice()||(t=" -webkit- -moz- -o- -ms- ".split(" "),"ontouchstart"in window||(e=["(",t.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(e).matches));var e,t},isIOS:function(){return"iPad"===navigator.platform||"iPhone"===navigator.platform},isInternetExplorer:function(){return-1!==window.navigator.userAgent.indexOf("MSIE ")||/rv:11.0/i.test(window.navigator.userAgent)},getIOSIBooksRestartInfo:function(){return t()>=7?'To close iBooks:<ol style="text-align: left;"><li>Double-click the Home button.</li><li>Swipe left or right until you have located iBooks.</li><li>Swipe the app\'s preview up to close it.</li></ol>':t()>=5?"To close iBooks:<ol style=\"text-align: left;\"><li>Double-click the Home button.</li><li>Touch-and-hold the iBooks icon to put it into 'jiggly mode'.</li><li>Tap the red minus-sign icon that appears at the top left corner of iBooks.</li><li>Click the Home button to exit 'jiggly mode'.</li></ol>":""},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}}}}(n(11))},function(e,t,n){var r,o,a,i,s;e.exports=(r=n(1),o=n(2),a=n(0),i=n(75),s={},window.BWMATH=s,s.disabled=!1,s.nextUniqueId=1,s.queue=[],s.customCssClasses=[],s.initialized=!1,s.initialize=function(){if(!1===this.initialized&&-1!==o.getPlatform().indexOf("chrome")){var e=a(document.createElement("div")).attr("id","chromemathjaxhack").css({position:"absolute","pointer-events":"none"}).prependTo(a("body")),t=a(document.createElement("canvas")).attr({width:300,height:300}).appendTo(e)[0];t.getContext("2d").clearRect(0,0,t.width,t.height),this.initialized=!0}},s.prepare=function(e){if(this.disabled)return e;var t="",n=0,r=e.indexOf("$$"),o=0;for(r>=0&&this.initialize();r>=0&&!(++o>1e4);){t+=e.substring(n,r);var a=e.indexOf("$$",r+2);if(a<0){n=r;break}t+='<span class="bwmathquill" style="direction:ltr; visibility: hidden">\\('+e.substring(r+2,a)+"\\)</span>",n=a+2,r=e.indexOf("$$",n)}return t+=e.substring(n)},s._createCssClass=function(e,t){var n=document.createElement("style");n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n),(n.sheet||{}).insertRule?n.sheet.insertRule("."+e+"{"+t+"}",0):(n.styleSheet||n.sheet).addRule(e,t),s.customCssClasses.push(e)},s._copyColorToStrokeAndFill=function(e){var t=e.css("color");e.find("g[stroke]").attr("stroke",null).attr("fill",null);var n="bw-math-jax-expression-"+s.nextUniqueId++,r="stroke: "+t+"; fill: "+t+";";s._createCssClass(n,r),e.addClass(n)},s.schedule=function(e){void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")?window.MathJax.Hub.Queue(e):s.queue.push({cb:e})},s.findMathElems=function(e){return e.find(".bwmathquill")},s.allMathElems=function(){return a(".bwmathquill")},s.processMathElems=function(e){this.process(this.findMathElems(e))},s.redrawMathElems=function(e){this.redraw(this.findMathElems(e))},s.processAll=function(){this.process(this.allMathElems())},s.redrawAll=function(){this.redraw(this.allMathElems())},s.process=function(e){this.disabled||e.each(function(){if(void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")){var e=this;window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,e],function(){s._copyColorToStrokeAndFill(a(e)),a(e).css("visibility","")})}else s.queue.push({obj:a(this)})})},s.processqueue=function(){for(;s.queue.length>0;){var e=s.queue.shift();e.obj&&s.process(e.obj),e.cb&&s.schedule(e.cb)}},window.MathJax={showMathMenu:!1,skipStartupTypeset:!0},"ibw-platform-win32-preview"==o.getPlatform()&&(window.MathJax.SVG={scale:200}),s.loadMathJax=function(){var e=document.createElement("script");e.type="text/javascript",e.src="external/MathJax24/MathJax.js?config=TeX-AMS-MML_SVG",e.onload=s.processqueue,document.getElementsByTagName("head")[0].appendChild(e)},r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("MathJax24")?s.loadMathJax():s.disabled=!0}),s.redraw=function(e){},i.CssUpdateCallbacks&&i.CssUpdateCallbacks.push(function(){var e=s.customCssClasses;s.customCssClasses=[];for(var t=0;t<e.length;++t){var n=e[t],r=a("."+n);r.removeClass(n),s._copyColorToStrokeAndFill(r)}}),s.isOnlyMath=function(e){var t=e.trim();return t.startsWith("$$")&&t.endsWith("$$")&&-1===t.substring(2,e.length-4).indexOf("$$")},s)},function(e,t,n){var r,o,a;n(327),e.exports=(r=n(1),o=n(0),a={},window.BWAUDIO=a,a.loaded=!1,a.queue=[],a.elementqueue=[],a.process=function(e){!0===a.loaded?0===e.find(".mejs-container.mejs-audio").length&&e.mediaelementplayer({enableKeyboard:!1}):a.queue.push(e)},a.createElement=function(e){var t={play:function(e){if(void 0===this.element)return!1;var t;try{return e&&(t=this.element,this.element.addEventListener("playing",function n(){t.removeEventListener("playing",n),e()})),this.element.play(),!0}catch(e){return!1}},pause:function(){if(void 0===this.element)return!1;try{return this.element.pause(),!0}catch(e){return!1}},paused:function(){return void 0!==this.element&&this.element.paused},toggle:function(){void 0!==this.paused()&&!0===this.paused()?this.play():this.pause()},rewind:function(){if(void 0===this.element)return!1;try{return this.element.setCurrentTime(0),!0}catch(e){return!1}},setVolume:function(e){if(void 0===this.element)return!1;try{return this.element.setVolume(e),!0}catch(e){return!1}},on:function(e,t){if(void 0===this.element)return!1;try{return this.element.addEventListener(e,t),!0}catch(e){return!1}},onLoaded:function(e){this.element?e():this.onLoadedCB=e}};return t.obj=e,!0===a.loaded?t.element=new window.MediaElement(e,{startVolume:1}):a.elementqueue.push(t),t},a.createPlayer=function(e,t){if(t){var n=o(document.createElement("div")).addClass("audiowrapper");return o(document.createElement("div")).addClass("audio-placeholder").attr("data-src",e).appendTo(n),n}n=o(document.createElement("div")).addClass("audiowrapper").safeHtml("&nbsp;");var r=o(document.createElement("audio")).attr("controls","").append(o(document.createElement("source")).attr("src",e)).appendTo(n);return a.process(r),n},a.replaceAudioByPlaceholder=function(e){var t=this;o(e).find(":not(.audiowrapper) > audio:not(.no-audio-wrap)").each(function(){var e=o(this),n=e.find("source").attr("src");e.replaceWith(t.createPlayer(n,!0))})},a.processAudioTags=function(e){e instanceof o?a.process(e.find(":not(.mejs-mediaelement) > audio:not(.no-audio-wrap)")):a.process(o(e+" audio"))},a.replacePlaceholders=function(e){o(e).find("div.audio-placeholder").each(function(){var e=o(document.createElement("audio")).attr("controls","").append(o(document.createElement("source")).attr("src",o(this).attr("data-src"))).insertAfter(o(this));a.process(e)})},a.removeAudioElements=function(){o("audio:not(.no-audio-wrap), .mejs-container.mejs-audio").remove()},a.processqueue=function(){for(a.loaded=!0;a.queue.length>0;){var e=a.queue.shift();a.process(e)}for(;a.elementqueue.length>0;){var t=a.elementqueue.shift();t.element=new window.MediaElement(t.obj,{startVolume:1}),t.onLoadedCB&&t.onLoadedCB(t)}},a.loadMediaElement=function(){var e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("type","text/css"),e.setAttribute("href","external/mediaelement/css/mediaelementplayer.min.css"),document.getElementsByTagName("head")[0].appendChild(e);var t=document.createElement("script");t.type="text/javascript",t.src="external/mediaelement/js/mediaelement-and-player.min.js",t.onload=a.processqueue,document.getElementsByTagName("head")[0].appendChild(t)},a.addElement=function(e,t){var n=o(document.createElement("audio")).append(o(document.createElement("source")).attr("src",e)).appendTo(t);return a.createElement(n[0])},r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("bwaudio")&&a.loadMediaElement()}),a)},function(e,t,n){"use strict";n.r(t),n.d(t,"toFloat",function(){return y}),n.d(t,"getWrongAnswerWeight",function(){return T}),n.d(t,"scoreForValidPolicyAndWeight",function(){return O}),n.d(t,"removeDiacritics",function(){return F}),n.d(t,"prepareForCompare",function(){return U}),n.d(t,"matchesOneOfAnswers",function(){return H}),n.d(t,"processFillInText",function(){return J}),n.d(t,"isLegacyFITStyle",function(){return Y}),n.d(t,"getFITText",function(){return $}),n.d(t,"processDragWordsInSentence",function(){return G}),n.d(t,"cleanGroupElemPaths",function(){return X}),n.d(t,"processMarkSentence",function(){return ne}),n.d(t,"pictureId",function(){return re}),n.d(t,"wordId",function(){return oe}),n.d(t,"audioId",function(){return ae}),n.d(t,"allCorrect",function(){return ie}),n.d(t,"getMatrixDimensions",function(){return pe}),n.d(t,"canonicalMatrix",function(){return he}),n.d(t,"createNumericQuestionAnswer",function(){return ge}),n.d(t,"processCorrectSentence",function(){return me}),n.d(t,"check",function(){return ve}),n.d(t,"linkifyLinks",function(){return we}),n.d(t,"isNotAutoCorrectingQuestionType",function(){return be});var r=n(84),o=n.n(r),a=n(124),i=n.n(a),s=n(197),c=n.n(s),l=n(198),d=n.n(l),u=n(27),p=n.n(u),f=n(13),h=n.n(f),g=n(122),m=n.n(g),v=n(16),w=n(199),b=n.n(w);function y(e){return e?parseFloat(e.replace(",",".")):e}function C(e){for(var t=0;t<e.length;++t)e[t]=e[t].trim();return e}function k(e,t){return null==t?e:e instanceof Array?function(e,t,n){for(var r=Math.max(e.length,t.length),o=[],a=0;a<r;a++)o[a]=n(e[a],t[a]);return o}(e,t,function(e,t){return null!=t?t:e}):t}function T(e){var t=y(e["scoring-weight"]);if(!e.hasOwnProperty("scoring-wrong-answer-weight")||""===e["scoring-wrong-answer-weight"])return t;var n=y(e["scoring-wrong-answer-weight"]);return isNaN(n)?t:n}function x(e,t,n){r=null===t?-1:parseInt(t)===parseInt(e.Valid)?1:0;var r,o=y(e["scoring-weight"]),a=r;return{correctness:r=k(a,n),autoCorrectness:a,score:1===r?o:0,outof:o}}function _(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}function S(e,t){for(var n=0,r=0;r<e.length;++r)e[r]===t&&++n;return n}function E(e,t,n){return"each"===t?S(e,1)*n:S(e,1)===e.length?n:0}function I(e,t,n){return"each"===t?e.length*n:n}function O(e,t,n,r,o){if("each"===n){for(var a=0,i=0,s=0;s<e.length;++s)e[s]&&1===t[s]?++a:e[s]||0!==t[s]||++i;return Math.max(a*r-i*o,0)}return"eachcorrect"===n?S(t,1)*r:S(t,1)===t.length?r:0}function A(e,t,n,r){return"each"===n?S(e,!0)*r:"eachcorrect"===n?e.length*r:r}function q(e,t,n){for(var r,o=e.policy,a=e.Answers||[],i=_(t=t||p()(Array(a.length),!1),!0)||"eachcorrect"===o,s=e.hasOwnProperty("Valid")?(r=e.Valid,r.replace(/\D/g," ")).split(" "):"",c=[],l=0;l<s.length;++l)c.push(parseInt(s[l],10));var d=[];for(l=0;l<t.length;++l)d.push(_(s,l+1+""));var u=[];for(l=0;l<t.length;++l)i?!_(s,l+1+"")^!t[l]?u.push(0):u.push(1):u.push(-1);var f=y(e["scoring-weight"]),h=u;return{correctness:u=k(h,n),autoCorrectness:h,correctAnswers:c,score:O(d,u,o,f,T(e)),outof:A(d,0,o,f)}}var P=x,D=q;function N(e){return e.replace(/[\u2018\u2019]/g,"'")}for(var R=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹÐ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],L={},M=0;M<R.length;M++)for(var B=R[M].letters,W=0;W<B.length;W++)L[B[W]]=R[M].base;function F(e){return e.replace(/[\u0301\u0060]/gi,"").replace(/[^\u0000-\u007E]/g,function(e){return L[e]||e})}function U(e,t){if(!e)return"";if(e.normalize&&(e=e.normalize("NFKC")),t){if("no"===t)return e.toLowerCase();if("no_ignore_accents"===t)return F(e.toLowerCase());if("yes_ignore_accents"===t)return F(e)}return e}function z(e){return e.replace(/[\x00-\x09\x0B-\x0C\x0E-\x1F\x7F-\x9F\u200B]/g,"")}function H(e,t,n){e=U(e,n),t=U(t,n),e=N(e);for(var r=(t=N(t)).split(/\|\||##/),o=0;o<r.length;++o)if(z(e.trim())===z(r[o].trim()))return!0;return!1}function j(e){var t,n,r=C(e.split(":"));r.length>=2?0===(t=r[0]).indexOf("text")||0===t.indexOf("select")?(r.shift(),n=r.join(":")):(t="text",n=e):r.length<2&&(t="text",n=e);var o=t.match(/(.+)\((.*)\)/),a=[],i=[];if(o&&3===o.length){t=o[1].trim(),a=C(o[2].split(";")).map(function(e,t){return C(e.split("="))});for(var s=0;s<a.length;++s){var c=a[s];"width"===c[0]?i.push(c.join(":")):console.error("FIT: Ignoring unsupported parameter "+c[0])}}return{type:t,typeconfig:n,style:i}}function Q(e,t,n){for(var r,o=0,a=e.indexOf("&lt;&lt;"),i="",s=0;a>=0;){var c=e.substring(o,a),l=e.indexOf("&gt;&gt;",a);if(l<0){o=e.length;break}i+=null!=(r=t(c,n(e.substring(a+8,l)),s))?c+r:e.substring(o,l+8),o=l+8,a=e.indexOf("&lt;&lt;",l),s+=1}return i+=null!=(r=t(e.substring(o),null,s))?r:e.substring(o)}function J(e,t){return Q(e,t,j)}function V(e){return"undefined"!=typeof window&&window.$?window.$(document.createElement("div")).html(e).text():n(169).default(e)}function Y(e){return!e.hasOwnProperty("Sentence")||null==e.Sentence||""===e.Sentence.trim()}function $(e){return Y(e)?e.Question||"":e.Sentence||""}function K(e){return e}function G(e,t){return Q(e,t,K)}function X(e){var t=d()(e);return"Image"===e.Type?(delete t.image.sources,delete t.image.alttext):"Audio"===e.Type&&(t.audio=function(e){var t=e.lastIndexOf("/");if(-1===t)return e;var n=e.lastIndexOf("/",t-1);return-1===n?e.substr(t):e.substr(n)}(e.audio)),t}function Z(e){return JSON.stringify(h()(e,function(e){return m()(X(e))}).sort())}function ee(e,t,n){for(var r="",o=0;o<e.length;++o){var a=e.charAt(o);/[\s]/.test(a)||/[~`!#$%\^&*+=\-\[\]\\;,.\/{}()|\\":<>\?]/.test(a)?(r.length>0&&(t(r),r=""),n(a)):r+=a}r.length>0&&t(r)}function te(e,t,n){for(var r=0,o=e.indexOf("<<");o>=0;){t(e.substring(r,o));var a=e.indexOf(">>",o);if(a<0){r=e.length;break}n(e.substring(o+2,a)),r=a+2,o=e.indexOf("<<",a)}t(e.substring(r))}function ne(e,t,n,r){te(e,function(e){ee(e,n,t)},function(e){r(function(e){var t=C(e.split(":"));return{type:""!==t[0]?t[0]:"???",word:t.length>1?t[1]:"???"}}(e))})}function re(e){var t=e.hasOwnProperty("filename")?e.filename:e;return e.hasOwnProperty("origbase")?e.origbase:t}function oe(e){return e}function ae(e,t){return null==e||""===e?"":t+""}function ie(e){return S(e.correctness,1)===e.correctness.length}function se(e){return""===e}function ce(e,t,n,r,o){t=t||[];for(var a=[],i=e.pairs?e.pairs:[],s=0;s<i.length;++s){var c=i[s],l=n(c.source,s);if(!se(l)){for(var d=r(c.target),u=!1,p=0;p<t.length;++p)if(t[p].source===l){t[p].target===d?a.push(1):a.push(0),u=!0;break}u||(se(d)?a.push(2):a.push(-1))}}var f=S(a,1)>0||S(a,0)>0?1:-1;for(s=0;s<a.length;++s)2===a[s]&&(a[s]=f);var h=y(e["scoring-weight"]),g=a;return{correctness:a=k(g,o),autoCorrectness:g,score:S(a,1)*h,outof:a.length*h}}function le(e,t,n,r){t=t||[];for(var o=y(e["scoring-weight"]),a=[],i=e.Boxes?e.Boxes:[],s=0;s<i.length;++s){var c=i[s],l=V(c.name);if(c.Items)for(var d=0;d<c.Items.length;++d){var u=n(c.Items[d]);a.push({pair:[u,l],correct:!1,answer:null})}}var p=[];for(s=0;s<t.length;++s)p.push({pair:t[s],used:!1});for(s=0;s<a.length;++s){var f=a[s];for(d=0;d<p.length;++d){if(!(h=p[d]).used&&(f.pair[0]===h.pair[0]&&f.pair[1]===h.pair[1])){f.correct=!0,f.answer=h.pair[1],h.used=!0;break}}}for(s=0;s<a.length;++s){if(!(f=a[s]).correct)for(d=0;d<p.length;++d){var h;if(!(h=p[d]).used&&f.pair[0]===h.pair[0]){f.answer=h.pair[1],h.used=!0;break}}}var g=!1;for(s=0;s<a.length;++s){if(null!==(f=a[s]).answer){g=!0;break}}if(g)for(s=0;s<a.length;++s){null===(f=a[s]).answer&&""===f.pair[1]&&(f.correct=!0,f.answer="")}var m=[];for(s=0;s<a.length;++s){(f=a[s]).correct?m.push(1):null===f.answer?m.push(-1):m.push(0)}var v=e.policy,w=(o=y(e["scoring-weight"]),m);return{correctness:m=k(w,r),autoCorrectness:w,items:a,score:E(m,v,o),outof:I(m,v,o)}}function de(e,t,n){var r=y(e["scoring-weight"]),o=t?-2:-1;return{correctness:k(o,n),autoCorrectness:o,score:0,outof:r}}function ue(e){var t,n=/^ *(-?[0-9.,]+) *(E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a)?([^\d]+) *$/.exec(e);if(null===n)return null;switch(n[2]){case void 0:t=0;break;case"E":t=18;break;case"P":t=15;break;case"T":t=12;break;case"G":t=9;break;case"M":t=6;break;case"k":t=3;break;case"h":t=2;break;case"da":t=1;break;case"d":t=-1;break;case"c":t=-2;break;case"m":t=-3;break;case"u":t=-6;break;case"n":t=-9;break;case"p":t=-12;break;case"f":t=-15;break;case"a":t=-18}return{value:n[1],prefix:n[2],scale:t,unit:null!=n[3]&&n[3].normalize?n[3].normalize("NFKC"):n[3]}}function pe(e){if(null==e)return null;for(var t=e.length,n=1,r=0;r<t;++r){var o=e[r].split(" ");n=Math.max(n,o.length)}return{rows:t,columns:n}}function fe(e,t){for(var n=[],r=0;r<e.length;++r){for(var o=0;o<e[r].length;++o){var a=e[r][o];null==a||""===a.trim()?n.push("{}"):n.push(a.trim()),o!==e[r].length-1&&n.push("&")}r!==e.length-1&&n.push("\\\\")}return"$$\\leftLEFT \\begin{array} {cc} VALUES \\end{array} \\rightRIGHT$$".replace("LEFT","parentheses"===t?"(":"[").replace("RIGHT","parentheses"===t?")":"]").replace("VALUES",n.join(" "))}function he(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"parentheses",n=pe(e.matrix);if(null==n)return null;for(var r=[],o=0;o<n.rows;++o){for(var a=[],i=e.matrix[o].split(" "),s=0;s<n.columns;++s)a.push(i[s]);r.push(a)}return fe(r,t)}function ge(e,t,n){var r,o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"parentheses",i=n.answer_style;if("Single"===i)r=t?"":e.single,o="$$"+(n.unit&&""!==n.unit?n.single_number+n.unit:n.single_number)+"$$";else if("Fraction"===i)r=t?"":"$$\\frac {"+e.numerator+"}{"+e.denominator+"}$$",o="$$\\frac{"+n.numerator+"}{"+n.denominator+"}$$";else if("Mixed"===i)r=t?"":"$$"+e.wholenumber+" \\frac {"+e.numerator+"}{"+e.denominator+"}$$",o="$$"+n.whole_number+" \\frac {"+n.numerator+"}{"+n.denominator+"}$$";else if("Exponential"===i)r=t?"":"$$ {"+e.base+"} ^ {"+e.exponent+"}$$",o="$$ {"+n.base+"} ^ {"+n.exponent+"}$$";else if("Matrix"===i){var s=[],c=pe(n.matrix);if(null!=c){for(var l=0;l<c.rows;++l){for(var d=[],u=0;u<c.columns;++u)d.push(e["c_"+l+"_"+u]);s.push(d)}r=t?"":fe(s,a),o=he(n,a)}}return{answer:r,canonicalAnswer:o}}function me(e,t,n,r,o){function a(e){t?o(e,e):r(e,e)}te(function(e){for(var t=[],n=e.split("<br>"),r=0;r<n.length;++r)t.push(V(n[r]));return t.join("\n")}(e),function(e){return ee(e,a,n)},function(e){var t=e.split("/");2===t.length?o(t[0],t[1]):o(e,e)})}var ve={TextDescription:function(e,t){return null},TextMultpleChoice:x,RatedMultipleChoice:function(e,t){for(var n=0,r=e.Answers?e.Answers:[],o=0;o<r.length;++o)y(r[o].value)>n&&(n=y(r[o].value));if(null===t)return{correctness:-1,autoCorrectness:-1,score:0,outof:n};var a=y(r[t].value);return{correctness:0===a?0:1,autoCorrectness:0===a?0:1,score:a,outof:n}},TextMultiSelect:q,QuestionTable:function(e,t,n){var r=e.rows||[];function o(e,t){var n=e.rows[t].split(/\|\||##/);return n.length>1?n[1].trim():null}function a(e,t){var n=e.rows[t].split(/\|\||##/);return n.length>1?n[0]:n}t=t||p()(Array(r.length),!1);for(var i={},s=e.columns?e.columns:[],c=0;c<s.length;++c)i[s[c].trim()]=c;for(var l=[],d=[],u=[],f=0;f<t.length;++f){var h=parseInt(t[f]),g=o(e,f);u.push(a(e,f)),null!=i[g]?d.push(i[g]):d.push(null),isNaN(h)?l.push(-1):null!==g&&i.hasOwnProperty(g)?i[g]===h?l.push(1):l.push(0):l.push(-2)}var m=y(e["scoring-weight"]),v=l;return{correctness:l=k(v,n),autoCorrectness:v,score:S(l,1)*m,outof:l.length*m,correctAnswers:d,questions:u}},MultiSelectQuestionTable:function(e,t,n){var r=e.rows||[];t=t||p()(Array(r.length),!1);for(var a={},s=e.columns?e.columns:[],c=0;c<s.length;++c)a[s[c].trim()]=c;var l=[],d=[],u=[];o()(t,function(t,n){var r=function(e,t){for(var n=function(e,t){return e.rows[t].split(/\|\||##/)}(e,t),r=p()(Array(s.length),!1),o=1;o<n.length;++o){var i=n[o].trim();a.hasOwnProperty(i)&&(r[a[i]]=!0)}return r}(e,n);u.push(function(e,t){var n=e.rows[t].split(/\|\||##/);return n.length>1?n[0]:n}(e,n)),d.push(r),l.push(h()(t,function(e,t){return 1===e===r[t]?1:0}))});var f=y(e["scoring-weight"]),g=0,m=0;if("each"===e.policy){var v=T(e),w=i()(d),b=i()(l),C=0,x=0;o()(w,function(e,t){e&&(m+=f),e&&1===b[t]?C+=1:e||0!==b[t]||(x+=1)}),g=Math.max(0,C*f-x*v)}else o()(l,function(e,t){S(e,1)===e.length&&(g+=f)}),m=l.length*f;var _=l;return{correctness:l=k(_,n),autoCorrectness:_,score:g,outof:m,correctAnswers:d,questions:u}},PictureMultpleChoice:P,PictureMultiSelect:D,MultiLine:function(e,t,n){var r=y(e["scoring-weight"]);if(t=t||"",!e.hasOwnProperty("Keywords")||0===e.Keywords.length)return{correctness:s=k(i=""===t?-1:-2,n),autoCorrectness:i,score:1===s?r:0,outof:r,keywords:[]};var o=e.Keywords,a=e["case-sensitive"];t=N(t=U(t,a));for(var i,s,c=0,l=0,d=0,u=0,p=[],f=0;f<o.length;++f){for(var h=C(o[f].split(/\|\||##/)),g=[],m=h.length>1&&!1===isNaN(h[h.length-1]),v=0;v<(m?h.length-1:h.length);++v)g[v]=U(h[v],a);var w,b=function(e,t,n,r){for(var o=0;o<r;++o)if(-1!==e.indexOf(N(n[o])))return t[o];return null};m?(++c,null!=(w=b(t,h,g,h.length-1))?(l+=y(h[h.length-1]),++u,p.push({keyword:w,match:!0,points:h[h.length-1]})):p.push({keyword:h[0],match:!1})):(++d,null!=(w=b(t,h,g,h.length))?(++u,p.push({keyword:w,match:!0})):p.push({keyword:h[0],match:!1}))}return c>0&&d>0&&console.error("Info: multiline question with keywords with and without points, keywords without points don't contribute to score."),""===t?{correctness:s=k(i=-1,n),autoCorrectness:i,score:0,outof:r,keywords:p}:c>0?l>=r?{correctness:s=k(i=1,n),autoCorrectness:i,score:r,outof:r,keywords:p}:{correctness:s=k(i=0,n),autoCorrectness:i,score:l,outof:r,keywords:p}:u===o.length?{correctness:s=k(i=1,n),autoCorrectness:i,score:r,outof:r,keywords:p}:{correctness:s=k(i=0,n),autoCorrectness:i,score:l,outof:r,keywords:p}},RichText:function(e,t,n){var r=y(e["scoring-weight"]),o=""!==t?-2:-1;return{correctness:k(o,n),autoCorrectness:o,score:0,outof:r}},ExtraMultiLine:function(e,t,n){return null},ExtraCheckbox:function(e,t,n){return null},FillInText:function(e,t,n){t=t||[];var r=e["case-sensitive"];function o(e,t){return"text"===e.type?function(e,t){if(""===t)return-1;var n=V(e.typeconfig);return""===n?-2:H(t,n,r)?1:0}(e,t):"select"===e.type?function(e,t){return null==t||"-"===t?-1:""!==t||function(e){for(var t=e.split(/\|\||##/,1),n=0;n<t.length;++n)if(""===t[n])return!0;return!1}(e.typeconfig)?t===V((n=e.typeconfig,(r=n.split(/\|\||##/,1)).length>0?r[0].trim():""))?1:0:-1;var n,r}(e,t):null}var a=0,i=[];J($(e),function(e,n){if(null!==n)if(a<t.length){var r=o(n,t[a++].trim());null!==r&&i.push(r)}else console.error("Error: FIT has more input fields than answers"),i.push(-1)});var s=y(e["scoring-weight"]),c=i;return{correctness:i=k(c,n),autoCorrectness:c,score:S(i,1)*s,outof:i.length*s}},FillInTable:function(e,t,n){function r(e,n){for(var r=0;r<t.length;++r){var o=t[r];if(o.row===e&&o.column===n)return o.value.trim()}return null}t=t||[];for(var o=e["case-sensitive"],a=e.tabledata,i=[],s=[],c=a&&a.values?a.values:[],l=0;l<c.length;++l)for(var d=c[l],u=0;u<d.length;++u){var p=d[u];if(p.hasOwnProperty("CellRole"))if("input"===p.CellRole)null===(f=r(l,u))||""===f?(i.push(-1),s.push({row:l,column:u,answer:"",correctness:-1})):(i.push(-2),s.push({row:l,column:u,answer:f,correctness:-2}));else if("checked"===p.CellRole){var f=r(l,u),h=p.value;if(""===f&&""===h){i.push(1),s.push({row:l,column:u,answer:"",correctness:1});continue}if(null===f||""===f){i.push(-1);var g={row:l,column:u,answer:"",correctness:-1};""!==h&&(g.correct=h),s.push(g);continue}if(""===p.value){i.push(-2),s.push({row:l,column:u,answer:f,correctness:-2});continue}H(f,p.value,o)?(i.push(1),s.push({row:l,column:u,answer:f,correct:h,correctness:1})):(i.push(0),s.push({row:l,column:u,answer:f,correct:h,correctness:0}))}}var m=y(e["scoring-weight"]),v=i;return{correctness:i=k(v,n),autoCorrectness:v,correctioninfo:s,score:S(i,1)*m,outof:i.length*m}},AnnotatePicture:function(e,t,n){t=t||[];for(var r=[],o=e["case-sensitive"],a=e.EditFields?e.EditFields:[],i=0;i<a.length;++i){var s=a[i],c=i<t.length?t[i].trim():"";""===c?r.push(-1):s.Valid&&""!==s.Valid?H(c,s.Valid,o)?r.push(1):r.push(0):r.push(-2)}var l=y(e["scoring-weight"]),d=r;return{correctness:r=k(d,n),autoCorrectness:d,score:S(r,1)*l,outof:r.length*l}},SingleLine:function(e,t,n){t=(t=t||"").trim();var r,o=y(e["scoring-weight"]);if(""===t)r=-1;else{var a=e.Valid;r=""===a?-2:H(t,a,e["case-sensitive"])?1:0}var i=k(r,n);return{correctness:i,autoCorrectness:r,score:1===i?o:0,outof:o}},PictureOrdering:function(e,t,n){var r=e.Pictures||[];t=t||p()(Array(r.length),null);for(var o=y(e["scoring-weight"]),a=[],i=0;i<t.length;++i)null===t[i]?a.push(-1):t[i]===re(r[i])?a.push(1):a.push(0);var s=a,c=(a=k(s,n),e.policy);return{correctness:a,autoCorrectness:s,score:E(a,c,o),outof:I(a,c,o)}},WordOrdering:function(e,t,n){var r=e.Words||[],o=y(e["scoring-weight"]);if("each"===e.policy){for(var a=[],i=0;i<r.length;++i)null===t?a.push(-1):t[i]===r[i]?a.push(1):a.push(0);return{correctness:a=k(s=a,n),autoCorrectness:s,score:S(a,1)*o,outof:a.length*o}}if(null===t)return{correctness:a=k(s=-1,n),autoCorrectness:s,score:0,outof:o};var s,c="Sentences"===e.order_type?"\n":" ",l=r.join(c),d=t.join(c),u=!1;if(d===l)u=!0;else if(e.AlternateAnswers){var p=e.AlternateAnswers;for(i=0;i<p.length;++i)d.replace(/ /g,"")===p[i].replace(/ /g,"")&&(u=!0)}return{correctness:a=k(s=a=u?1:0,n),autoCorrectness:s,score:a*o,outof:o}},Match:ce,WordMatch:function(e,t,n){return ce(e,t,oe,oe,n)},WordPictureMatch:function(e,t,n){return ce(e,t,oe,re,n)},AudioWordMatch:function(e,t,n){return ce(e,t,ae,oe,n)},AudioPictureMatch:function(e,t,n){return ce(e,t,ae,re,n)},PicturePictureMatch:function(e,t,n){return ce(e,t,re,re,n)},DragDrop:le,TextDragDrop:function(e,t,n){return le(e,t,oe,n)},PictureDragDrop:function(e,t,n){return le(e,t,re,n)},Whiteboard:de,Photo:de,AudioRecording:de,Numeric:function(e,t,n){var r=e.answer_style;if("Single"===r){var o=(t=t||{single:""}).single;if(""===o)v=-1;else if(null!=(m=e.single_number)&&(m=m.trim()),""===m)v=-2;else if(isNaN(m)&&isNaN(m.replace(",",".")))v=function(e,t,n){try{if(void 0!==n&&""!==n){var r=ue("0"+n);if(null!==r){if(null===(o=ue(t)))return!1;if(o.unit!==r.unit)return!1;t=o.value*Math.pow(10,o.scale-r.scale)}}else{var o;if(null!==(o=ue(t)))return!1}return e=(e=(e=(e=e.replace(/NOT/g,"!")).replace(/AND/g,"&&")).replace(/OR/g,"||")).replace(/X/g,t),!0===b()({},e)}catch(n){return console.log("Problem calculating expression, returning false",e,t),!1}}(m,o.replace(",","."),e.unit)?1:0;else if(void 0===e.unit||""===e.unit)v=null===(a=ue(o))&&y(o)===y(m)?1:0;else{var a=ue(o),i=ue("0"+e.unit);v=null===a||null===i||a.unit!==i.unit||y(o)*Math.pow(10,a.scale-i.scale)!==y(m)?0:1}}else{var s=[],c=[];if("Fraction"===r)t=t||{numeragor:"",denominator:""},s.push(t.numerator),s.push(t.denominator),c.push(e.numerator),c.push(e.denominator);else if("Mixed"===r)t=t||{wholenumber:"",numeragor:"",denominator:""},s.push(t.wholenumber),s.push(t.numerator),s.push(t.denominator),c.push(e.whole_number),c.push(e.numerator),c.push(e.denominator);else if("Exponential"===r)t=t||{base:"",exponent:""},s.push(t.base),s.push(t.exponent),c.push(e.base),c.push(e.exponent);else{if("Matrix"!==r)return console.error("Wrong type for Numeric question type: ",r),null;t=t||{};var l=pe(e.matrix);if(null!=l)for(var d=0;d<l.rows;++d)for(var u=e.matrix[d].trim().split(" "),p=0;p<l.columns;++p)s.push(t["c_"+d+"_"+p]),c.push(u[p])}var f=!0,h=!0,g=!1;for(d=0;d<s.length;++d){var m;""!==s[d]&&(f=!1),null!=(m=c[d])&&(m=m.trim()),""===m&&(g=!0),m!==s[d]&&(h=!1)}v=f?-1:g?-2:h?1:0}var v,w=y(e["scoring-weight"]),C=v;return{correctness:v=k(C,n),autoCorrectness:C,score:1===v?w:0,outof:w}},BalanceChemicalEquation:function(e,t,n){t=t||("type3"===e.SubType?[]:{balanced:"",reactantsTable:[],productsTable:[]});var r=[];function o(e,t){for(var n=0;n<e.length;++n){var o=e[n];""===o?r.push(-1):r.push(parseInt(o.value)===t[o.row].qty?1:0)}}var a=e.Equation||"";switch(e.SubType){case"type1":case"type2":""===t.balanced?r.push(-1):v.isBalanced(a)===("yes"===t.balanced)?r.push(1):r.push(0);var i=v.parseEquation(a),s=v.reduceReactantsAndProducts(i);o(t.reactantsTable,s.reactants),o(t.productsTable,s.products);break;case"type3":for(var c=(i=v.parseEquation(a)).reactants.concat(i.products),l=0;l<c.length;++l)l<t.length?r.push(c[l].qty===parseInt(t[l])?1:0):r.push(-1)}var d=y(e["scoring-weight"]),u=r;return{correctness:r=k(u,n),autoCorrectness:u,score:S(r,1)*d,outof:r.length*d}},IonicCompoundBuilder:function(e,t,n){t=t||{posIons:[],negIons:[]};var r=v.parseFormula(e.Valid||""),o=t.posIons.concat(t.negIons),a=v.joinIonsToFormula(o),i=v.totalCharge(o);s=0===a.length?-1:0!==i?0:v.equalFormulas(a,r)?1:0;var s,c=y(e["scoring-weight"]),l=s;return{correctness:s=k(l,n),autoCorrectness:l,score:1===s?c:0,outof:c}},CorrectSentence:function(e,t,n){t=t||[];var r=[],o=[],a=[],i=e["case-sensitive"],s="each"===e.policy,c=0;me(e.Sentence||"","yes"===e["all-words-editable"],function(){},function(){},function(e,n){var l=c<t.length?t[c++]:"";s?H(l,n,i)?(o.push(1),r.push(l),a.push(1)):l===e?(o.push(-1),r.push(l),a.push(1)):(o.push(0),r.push(l),a.push(1)):H(l,n,i)?n!==e?(a.push(1),o.push(1),r.push(l)):(a.push(-1),o.push(1),r.push(l)):l===e?(a.push(1),o.push(-1),r.push(l)):e!==n?(o.push(0),r.push(l),a.push(1)):(o.push(0),r.push(l),a.push(-1))});var l=y(e["scoring-weight"]),d=T(e),u=o,p=(o=k(u,n),S(a,1)),f=0,h=0;for(c=0;c<a.length;++c)1===a[c]?1===o[c]&&++f:1!==o[c]&&++h;var g=Math.max(f*l-h*d,0);return{correctness:o,autoCorrectness:u,score:g,answers:r,outof:p*l}},DragWordsInSentence:function(e,t,n){t=t||[];var r=0,o=[];G(e.Sentence||"",function(e,n){if(null!==n)if(r<t.length){var a=function(e,t){return""===t?-1:t.trim()===e.trim()?1:0}(n,t[r++].trim());null!==a&&o.push(a)}else o.push(-1),console.error("Error: DWIS has more input fields than answers")});var a=y(e["scoring-weight"]),i=o;return{correctness:o=k(i,n),autoCorrectness:i,score:S(o,1)*a,outof:o.length*a}},Group:function(e,t,n){t=t||[];var r=[],o=[],a=e.groups||[];if(Math.max.apply(0,h()(t,function(e){return e.length}))<=1)r=p()(Array(a.length),-1),o=p()(Array(t.length),-1);else{var i=h()(a,function(e){return Z(e.elements||[])}),s=h()(t,function(e){return Z(e)});r=h()(i,function(e){return-1===s.indexOf(e)?0:1}),o=h()(s,function(e){return-1===i.indexOf(e)?0:1})}var c=k(r,n),l=y(e["scoring-weight"]);return{correctness:c,autoCorrectness:r,score:S(c,1)*l,outof:c.length*l,answerCorrectness:o}},MarkSentence:function(e,t,n){var r=[],o=0,a=S(t=t||[],"")===t.length;ne(e.Sentence||"",function(){},function(){a?r.push(-1):""===t[o]?r.push(1):r.push(0),++o},function(e){a?r.push(-1):t[o]===e.type?r.push(1):r.push(0),++o});var i=r;r=k(i,n);var s=0,c=0,l=0,d=null;o=0,ne(e.Sentence||"",function(){},function(){0===r[o]&&d!==t[o]?(++s,d=t[o]):d="",++o},function(e){++l,1===r[o]?(++c,d=""):0===r[o]&&(d=t[o]),++o});var u=y(e["scoring-weight"]),p=T(e);return{correctness:r,autoCorrectness:i,score:Math.max(0,c*u-s*p),outof:u*l}}};function we(e){return e.replace(/\b(?:https?):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a href="$&" target="_blank" class="weblink">$&</a>')}function be(e){return-1!==c()(["RichText","Photo","Whiteboard","AudioRecording"],e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"adjustRichTextVideoSize",function(){return s}),n.d(t,"process",function(){return c});var r=n(55),o=n(83),a=n(0),i=n.n(a);n(326);function s(e){"0px"===e.css("width")&&null===e.css("float")||"none"===e.css("float")?e.css({width:"640px",height:"400px","max-width":"90%"}):e.css({width:"320px",height:"240px"})}function c(e){e.addClass("bw-richtext"),r.processRichTextImages(e),o.processRichTextWidgetPlayLinks(e,!0),function(e){e.find("video").each(function(){s(i()(this))})}(e),function(e){e.find("a.rtlink").attr("target","_top")}(e)}},function(e,t,n){e.exports=(n(1),function(e){try{return window.bwlocalizationmap&&window.bwlocalizationmap[e]&&""!==window.bwlocalizationmap[e]?window.bwlocalizationmap[e]:e}catch(t){return e}})},,function(e,t,n){e.exports=function(e,t){function n(n,r,o,a,i){i=i||i+" custom_alert",o=o||e("Ok"),r=r||"Alert",n=n||"No Message to Display";var s=t(document.createElement("div")),c={};return c[o]=function(){t(this).dialog("close"),t(this).remove(),a&&a()},s.safeHtml(n).dialog({title:r,dialogClass:"bw-dialog no-close "+i,resizable:!1,modal:!0,width:"auto",buttons:c}),s}return{showAlert:n,navigateAlert:function(e,r,o,a){var i=n(e,r,o,function(){});return i.parent().find("button").replaceWith(t(document.createElement("a")).safeHtml(o).attr({href:a,target:"_top"}).addClass("ui-button")),i},showCriticalAlert:function(e,r){var o={message:e,title:r};function a(){n(o.message,o.title)}0===t("#critical-alert-button").length&&t(document.createElement("div")).attr("id","critical-alert-button").addClass("bw-toolbutton").append(t(document.createElement("div")).addClass("bw-icon bw-icon-critical-error")).prependTo(t("#title-toolbar")).click(a),a()},showFatalAlert:function(e,n){t(document.createElement("div")).safeHtml(e).dialog({title:n,dialogClass:"bw-dialog no-close",resizable:!1,modal:!0,width:"auto"})},showConfirmationDialog:function(e,n,r,o,a,i){n||(n="Please confirm"),e||(e=""),a||(a="OK"),i||(i="Cancel"),t("#BwConfirmationDalog").remove();var s=t(document.createElement("div")).attr("id","BwConfirmationDialog"),c={};return c[a]=function(){t(this).dialog("close"),t(this).remove(),r&&r()},c[i]=function(){t(this).dialog("close"),t(this).remove(),o&&o()},s.safeHtml(e).dialog({title:n,dialogClass:"bw-dialog BwConfirmationDialog no-close",resizable:!1,modal:!0,width:500,buttons:c}),s},showInfoMessage:function(e){console.log("ShowInfoMessage");var n=t(document.createElement("div"));function r(){n.removeClass("bw-dialog-animate-in").addClass("bw-dialog-animate-out"),setTimeout(function(){n.remove()},500)}n.safeHtml(e).addClass("bw-dialog bw-info-dialog bw-dialog-animate-in").click(function(e){e.stopPropagation(),r()}).appendTo(t("body")),setTimeout(r,1e4)}}}(n(7),n(0))},,function(e,t){e.exports=function(){var e=["context_id","course_id","hide_account","lfq","lti","login_hint","no_logout","q","sso","smartschool_platform","student_class_id","submit_url","teacher_email","teacher_id"];function t(e){var t=[];if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;++n){var r=e[n];r.length>1?t.push(encodeURIComponent(r[0])+"="+encodeURIComponent(r[1])):t.push(encodeURIComponent(r[0]))}else for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}function n(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(!(o<0)){var a=[n[r].substr(0,o),n[r].substr(o+1)],i=decodeURIComponent(a[0]);if(void 0===t[i])t[i]=decodeURIComponent(a[1]);else if("string"==typeof t[i]){var s=[t[i],decodeURIComponent(a[1])];t[i]=s}else t[i].push(decodeURIComponent(a[1]))}}return t}function r(e){for(var t=[],n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(o<0)t.push([n[r]]);else{var a=[n[r].substr(0,o),n[r].substr(o+1)];t.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])])}}return t}function o(e){return!e||e.length<1||"?"!==e[0]?{}:n(e.substr(1))}function a(e){return!e||e.length<1||"?"!==e[0]?[]:r(e.substr(1))}function i(e,t){return e.split("&").filter(function(e){return decodeURIComponent(e.split("=")[0])!==t}).join("&")}function s(e){return(e=e||window.location.href).indexOf("#")>=0?"#"+(e.split("#")[1]||""):""}!function(){var n=a(window.location.search),o=[],i=s();if(i.length>=1&&"#"===i[0])for(var c=r(i.substr(1)),l=0;l<c.length;++l){var d=c[l];e.indexOf(d[0])>=0?n.push(d):o.push(d)}var u=window.location.pathname;n.length>0&&(u+="?"+t(n)),o.length>0&&(u+="#"+t(o)),"undefined"!=typeof history&&history.replaceState("",document.title,u)}();var c=s(),l=window.location.search;return{split:n,splitList:r,getUrlParams:function(e){return-1===e.indexOf("?")?{}:n(e.replace(/[^\?]*\?/,"").replace(/#.*/,""))},getQueryParams:o,getParameters:function(){var e=o(l),t=function(e){return!e||e.length<1||"#"!==e[0]?{}:n(e.substr(1))}(c);for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},removeQueryStringParameter:function(e,t){return e.length>0&&("?"===e[0]||"#"===e[0])?e[0]+i(e.substring(1),t):i(e,t)},updateWindowQueryParameter:function(e,n){for(var r=a(window.location.search),o=!1,i=0;i<r.length;++i)if(r[i][0]===e){r[i].length>1?r[i][1]=n:r[i].push(n),o=!0;break}o||r.push([e,n]),history.replaceState("",document.title,window.location.pathname+"?"+t(r)+s())},urlencode:t,getHash:s,LEGACY_HASH_PARAMETERS:e}}()},,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"parseCharge",function(){return d}),n.d(t,"parseFormula",function(){return u}),n.d(t,"parseEquation",function(){return f}),n.d(t,"formatFormula",function(){return h}),n.d(t,"formatIon",function(){return g}),n.d(t,"formatEquation",function(){return v}),n.d(t,"matchOrder",function(){return C}),n.d(t,"reduceReactantsAndProducts",function(){return k}),n.d(t,"isBalanced",function(){return T}),n.d(t,"matchIon",function(){return x}),n.d(t,"splitFormulaInIons",function(){return _}),n.d(t,"reduceIons",function(){return S}),n.d(t,"joinIonsToFormula",function(){return E}),n.d(t,"totalCharge",function(){return I}),n.d(t,"equalFormulas",function(){return O});var r=n(8),o=n.n(r),a=function(e){return!isNaN(1*e)},i=function(e){var t=e.charCodeAt(0);return t>=65&&t<=90||t>=97&&t<=122},s=function(e){return i(e)&&e===e.toUpperCase()},c=function(e){return i(e)&&e===e.toLowerCase()},l=function(e,t,n,r,a){var i;if(t)if(""===n&&(n=1),o()(t)&&"1"===n)for(var s=0;s<t.length;++s)i={atom:t[s].atom,qty:parseInt(t[s].qty)},s===t.length-1&&(0!==r&&(i.charge=r),""!==a&&(i.phase=a)),e.push(i);else i={atom:t,qty:parseInt(n)},0!==r&&(i.charge=r),""!==a&&(i.phase=a),e.push(i)},d=function(e){for(var t="",n=0,r=0;r<e.length;++r){var o=e.charAt(r);if(a(o))t+=o;else if("+"===o){if(n=1,r!==e.length-1)return 0}else{if("-"!==o)return 0;if(n=-1,r!==e.length-1)return 0}}return parseInt(t)*n},u=function e(t){var n=[],r="",o="",i=0,u="";if(-1!==t.indexOf("!")||-1!==t.indexOf("@")||-1!==t.indexOf("#")||-1!==t.indexOf("$"))return[];var p=t+"H";p=p.replace(/\(s\)/g,"!").replace(/\(aq\)/g,"@").replace(/\(g\)/g,"#").replace(/\(l\)/g,"$");for(var f=0;f<p.length;++f){var h=p.charAt(f);if(s(h))l(n,r,o,i,u),r=h,o="",u="",i=0;else if(c(h)){if(!r)return[];r+=h}else if(a(h)){if(!r)return[];o+=h}else if("("===h){for(var g=!1,m=f+1;m<p.length;++m)if(")"===p.charAt(m)){g=!0;break}if(!g)return[];if(!a(p.charAt(m+1)))return[];if(l(n,r,o,i,u),(r=e(p.substring(f+1,m)))===[])return[];o="",u="",i=0,f=m}else if("{"===h){for(g=!1,m=f+1;m<p.length;++m)if("}"===p.charAt(m)){g=!0;break}if(!g)return[];var v=p.substring(f+1,m);i=d(v),f=m}else if("!"===h){if(""!==u)return[];u="s"}else if("@"===h){if(""!==u)return[];u="aq"}else if("#"===h){if(""!==u)return[];u="g"}else{if("$"!==h)return[];if(""!==u)return[];u="l"}}return n},p=function(e,t){for(var n="",r=0;r<e.length;++r){var o=e.charAt(r);if(!a(o)){n=""===n?1:parseInt(n);var i=u(e.substring(r));return i!==[]&&(t.push({formula:i,qty:n}),!0)}n+=o}return console.error("Chemistryparser parseTerm: This should never happen"),!1},f=function(e){var t=e.replace(/ /g,"").split("=");if(2!==t.length)return{reactants:[],products:[]};for(var n=t[0].replace(/\+\}/g,"*}").split("+"),r=t[1].replace(/\+\}/g,"*}").split("+"),o=[],a=[],i=0;i<n.length;++i){var s=n[i].replace(/\*\}/g,"+}");if(!p(s,o))return{reactants:[],products:[]}}for(i=0;i<r.length;++i){s=r[i].replace(/\*\}/g,"+}");if(!p(s,a))return{reactants:[],products:[]}}return{reactants:o,products:a}},h=function e(t){for(var n="",r=0;r<t.length;++r){var a=t[r];o()(a.atom)?a.qty>1?n=n+"("+e(a.atom)+")":n+=e(a.atom):n+=a.atom,a.qty>1&&(n=n+"_{"+a.qty+"}"),a.phase&&(n=n+"("+a.phase+")")}return n},g=function(e){var t=h(u(e.ion))+"^{";return 1===e.charge?t+="+":-1===e.charge?t+="-":e.charge>0?t+=e.charge+"+":t+=-e.charge+"-",t+="}"},m=function(e,t){for(var n=[],r=0;r<e.length;++r){var o=e[r],a="";t||1===o.qty||(a=o.qty+" \\, "),a+=h(o.formula),t?n.push({formula:a,qty:o.qty}):n.push(a)}return n},v=function(e,t){return{reactants:m(e.reactants,t),products:m(e.products,t)}},w=function(e){for(var t=[],n=0;n<e.length;++n)for(var r=e[n].formula,a=e[n].qty,i=0;i<r.length;++i){var s=r[i];if(o()(s.atom))for(var c=0;c<s.atom.length;++c)t.push({atom:s.atom[c].atom,qty:s.atom[c].qty*s.qty*a});else t.push({atom:s.atom,qty:s.qty*a})}return t},b=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,a=0;a<t.length;++a){var i=t[a];if(r.atom===i.atom){i.qty=i.qty+r.qty,o=!0;break}}o||t.push(r)}return t},y=function(e,t){for(var n=0;n<e.length;++n)if(e[n].atom===t)return n;return-1},C=function(e,t){for(var n=0,r=0;r<e.length;++r){var o=y(t,e[r].atom);if(o===n)++n;else if(o>=n){var a=t.splice(o,1)[0];t.splice(n,0,a),++n}}},k=function(e){var t=w(e.reactants),n=w(e.products);return t=b(t),n=b(n),C(t,n),{reactants:t,products:n}},T=function(e){var t=f(e),n=k(t);if(0===n.reactants.length)return!1;if(n.reactants.length!==n.products.length)return!1;for(var r=0;r<n.reactants.length;++r){var o=n.reactants[r],a=n.products[r];if(a.atom!==o.atom||a.qty!==o.qty)return!1}return!0},x=function(e,t){var n=1;if(o()(e[0].atom)){if(n=e[0].qty,e=e[0].atom,t.pattern.length!==e.length)return 0}else if(t.pattern.length>e.length)return 0;for(var r=0;r<t.pattern.length;++r){var a=t.pattern[r],i=e[r];if(a.atom!==i.atom)return 0;if(1===t.pattern.length)n=i.qty;else if(a.qty!==i.qty)return 0}return n},_=function(e,t){for(var n=[],r=u(e);r.length>0;){for(var o={ion:{pattern:[]}},a=0;a<t.length;++a){var i=t[a],s=x(r,i);s>0&&i.pattern.length>o.ion.pattern.length&&(o={ion:i,qty:s})}if(!(o.ion.pattern.length>0))return console.error("Error: formula contains unknown ions!"),console.error("Partial match: "),console.error(n),console.error("Head of parsedFormula:"),console.error(r),[];n.push({ion:o.ion.ion,charge:o.ion.charge,qty:o.qty}),o.qty>1?r.splice(0,1):r.splice(0,o.ion.pattern.length)}return n},S=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,a=0;a<t.length;++a){var i=t[a];if(r.ion===i.ion.ion&&r.charge===i.ion.charge){i.qty++,o=!0;break}}o||t.push({ion:r,qty:1})}return t},E=function(e){e=S(e);for(var t=[],n=0;n<e.length;++n){var r=e[n];1===r.ion.pattern.length?t.push({atom:r.ion.pattern[0].atom,qty:r.qty}):t.push({atom:r.ion.pattern,qty:r.qty})}return function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];if(o()(r.atom))if(1===r.qty)for(var a=0;a<r.atom.length;++a)t.push({atom:r.atom[a].atom,qty:r.atom[a].qty});else t.push(r);else t.push(r)}return t}(t)},I=function(e){for(var t=0,n=0;n<e.length;++n)t+=e[n].charge;return t},O=function e(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;++r){if(t[r].qty!==n[r].qty)return!1;if(o()(t[r].atom)){if(!o()(n[r].atom))return!1;if(!e(t[r].atom,n[r].atom))return!1}else if(t[r].atom!==n[r].atom)return!1}return!0}},,function(e,t,n){var r=function(e,t,r,o){var a,i,s,c,l,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(1),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(49).o,p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(114).o,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n(192).o,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:n(430),g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:n(112),m={},v="",w=!1,b=t.getParameters(),y=b.hasOwnProperty("teacher_id")?b.teacher_id:"",C=b.hasOwnProperty("school_id")?b.school_id:"",k=b.hasOwnProperty("course_id")?b.course_id:"",T=b.hasOwnProperty("class_id")?b.class_id:"";m.WIDGET_ANONYMOUS=0,m.WIDGET_OFFLINE=1,m.WIDGET_ONLINE=2;var x=null,_=-1,S=!1;function E(){_!==m.WIDGET_ONLINE||S||x.moveImageOnlineIfRequired().done(function(e){e&&E()})}function I(){var t=g("body"),n=e.Deferred();return h.start(),x.loadAll(function(e){h.end(),t.close(),a(e),E(),n.resolve()}),n}m.stateChanged=function(t,n){if(t===_&&n===S)return console.log("Warning: setting identical storage state, ignoring"),e.when();if(_===m.WIDGET_OFFLINE&&t===m.WIDGET_ONLINE&&!0===n)return _=t,S=n,e.when();var r="no"!==d.getConfigSync().save_answers;switch(t){case m.WIDGET_ANONYMOUS:console.log("Using anonymous storage"),x=p.createWidgetStorage(s,i,l,w,"",v,r);break;case m.WIDGET_ONLINE:if(!1===n){console.log("Using online storage"),x=f.createWidgetStorage(s,i,c,l,w,u.getUserId(),v,y,C,k,null==T||""===T?u.getUserClassName()?u.getUserClassName():"":T);break}case m.WIDGET_OFFLINE:console.log("Using offline storage"),x=p.createWidgetStorage(s,i,l,w,u.getUserId(),v,r)}var o,g=_,b=S;return _=t,S=n,function(e,t){return-1!=e&&e+t<3}(g,t)?I():g===m.WIDGET_OFFLINE&&t===m.WIDGET_ONLINE?(o=e.Deferred(),h.start(),x.goneOnlineSync(function(e){h.end(),"CONFLICT"==e.status&&a(e.data),E(),o.resolve()}),o):g===m.WIDGET_ONLINE&&t===m.WIDGET_OFFLINE||b!==S?function(){var t=e.Deferred();x.loadAll(function(e){t.resolve()})}():e.when()},m.init=function(e){var t=this;a=e.updateCallback,i=e.type,s=e.group,c=e.name,l=e.id,w=e.singleKey,v=e.extension,h.init(),u.initialized().then(function(){t.stateChanged(u.getState(),u.getForceOfflineStorage()),I(),u.registerStateChangeCallback(t.stateChanged.bind(t))},function(){t.stateChanged(u.ANONYMOUS,!0),I()});var n=!!e.hide_account;u.isStudentAccountsSupported()&&!n&&r.init()};var O,A=!1,q=!1;return m.write=function(t){null!==x&&(A?function(e){q?O=w?e:function(e,t){var n=e||{};for(var r in t)n[r]=t[r];return n}(O,e):(O=e,q=!0)}(t):o.pushAsyncFunc(function(){return function t(n){var r=e.Deferred();return A=!0,h.start(),x.write(n,function(e){h.end(),e&&"CONFLICT"==e.status&&a(e.data),A=!1,q?(q=!1,t(O).done(function(){r.resolve()})):r.resolve()}),r}(t)}))},m.registerImage=function(t){var n=e.Deferred(),r=(new Date).getTime()+function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(5);return x.writeImage(r,t).done(function(){n.resolve("bwimg:"+r)}).fail(function(){n.reject()}),n},m.clearImage=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var r=t.substring(6);x.clearImage(r).done(function(){n.resolve()}).fail(function(){console.log("Could not clear image"),n.reject()})}else n.reject();return n},m.getImageUrl=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var r=t.substring(6);x.readImage(r).done(function(e){n.resolve(e)}).fail(function(){n.reject("")})}else n.resolve(t);return n},m.sync=function(e){o.pushSyncFunc(e)},m.clear=function(){},m.createThrottler=function(e){return{cb:e,maxdelay:arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,timeout:null,trigger:function(){var e=this;null!=this.cb&&null==this.timeout&&(h.start(),this.timeout=setTimeout(function(){e.timeout=null,h.end(),e.cb()},this.maxdelay))}}},m}.bind(null,n(0),n(11),n(431),n(113));e.exports={f:r,o:r()}},,,,,function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return"string"==typeof(t=e)||"object"===n(t)&&t.constructor===String?0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("//")?e.replace(/\(/g,"_").replace(/\)/g,"_").replace(/'/g,"%27"):encodeURIComponent(e).replace(/%2F/g,"/").replace(/'/g,"%27"):"";var t}},,function(e,t,n){e.exports=function(e,t){return{createLabeledCheckbox:function(t,n,r){var o=e(document.createElement("table")).addClass("bw-checkbox").appendTo(t),a=e(document.createElement("tr")).appendTo(o),i=e(document.createElement("td")).addClass("bw-checkbox-cell").appendTo(a);return e(document.createElement("div")).addClass("bw-checkbox-checkbox bw-icon bw-icon-accept").appendTo(i),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(a),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"checkbox"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),r&&r.call(t[0],!1)):(t.trigger("check"),r&&r.call(t[0],!0)))}),o.trigger("clear"),o},createProgressBar:function(t,n){var r={};r.parent=t,r.max=n,e(document.createElement("div")).addClass("bw-progress-bar").css("left","-100%").appendTo(e(t));var o=100/n;return e(document.createElement("div")).addClass("bw-progress-bar-marker").css({left:"-100%",width:o+"%"}).appendTo(e(t)),r.setProgress=function(n,r,o){r=r||400;var a=100*-(this.max-parseFloat(n))/this.max,i=e(this.parent+"> .bw-progress-bar"),s=e(t).width(),c=-(this.max-parseFloat(n))*s/this.max;i.css("left",i.css("left")),i.animate({left:c},r,"swing",function(){i.css("left",a+"%"),o&&o()})},r.setPosition=function(n,r){r=r||400;var o=e(this.parent+"> .bw-progress-bar-marker"),a=100*parseFloat(n)/this.max,i=e(t).width()*n/this.max;o.css("left",o.css("left")),o.animate({left:i},r,"swing",function(){o.css("left",a+"%")})},r.clear=function(){e(this.parent+" .bw-progress-bar").css("left","-100%"),e(this.parent+" .bw-progress-bar-marker").css("left","-100%")},r},createSimpleCheckbox:function(t,n,r){var o=e(document.createElement("div")).addClass("bw-simple-checkbox bw-icon bw-icon-accept").appendTo(e(t)),a={role:"checkbox"};return r&&(a.labelledby=r),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton(a).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),o.trigger("clear"),o},createNumberButtons:function(n,r,o,a,i){function s(t){if(e(".buttonslot").removeClass("selected"),r<=9)e("#BS_"+t).addClass("selected");else if(t<5){e("#BS_1").removeClass("hide_number"),e("#BS_7").addClass("hide_number");for(var n=1;n<8;++n)e("#BS_"+n).find(".number-button").safeHtml(n+1);e("#BS_"+t).addClass("selected")}else if(r-t<6){e("#BS_1").addClass("hide_number"),e("#BS_7").removeClass("hide_number");for(var o=2;o<8;++o)e("#BS_"+o).find(".number-button").safeHtml(r-8+o);e("#BS_"+(9-(r-t))).addClass("selected")}else{e("#BS_1").addClass("hide_number"),e("#BS_7").addClass("hide_number");for(var s=1;s<8;++s)e("#BS_"+s).find(".number-button").safeHtml(s+t-3);e("#BS_4").addClass("selected")}0===t?e(a).addClass("hidden"):e(a).removeClass("hidden"),t===r-1?e(i).addClass("hidden"):e(i).removeClass("hidden")}for(var c=0,l=Math.min(r,9),d=e(n),u=0;u<l;++u)e(document.createElement("div")).addClass("buttonslot").attr("id","BS_"+u).append(e(document.createElement("div")).addClass("number-button bw-button").text(u+1)).appendTo(d).find(".number-button").makeButton().tapOrClick(function(){s(c=parseInt(e(this).safeHtml())-1),o(c)});function p(){--c<0&&(c=0),s(c),o(c)}function f(){++c>=r&&(c=r-1),s(c),o(c)}return r>9&&(e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_1")),e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_7")),e("#BS_7").addClass("hide_number"),e("#BS_7").find(".number-button").safeHtml(r-1),e("#BS_8").find(".number-button").safeHtml(r)),e("#BS_0").addClass("selected"),e(a).addClass("hidden"),e(a).makeButton(t("previous")).tapOrClick(p),e(i).makeButton(t("next")).tapOrClick(f),{updateButtons:s,next:f,prev:p}},createSimpleRadiobutton:function(t,n,r){var o=e(document.createElement("div")).addClass("bw-simple-radiobutton bw-icon").appendTo(e(t));o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})});var a={role:"radio"};return r&&(a.labelledby=r),o.makeButton(a).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),o.trigger("clear"),o},createLabeledRadiobutton:function(t,n,r){var o=e(document.createElement("table")).addClass("bw-radiobutton").appendTo(t),a=e(document.createElement("tr")).appendTo(o),i=e(document.createElement("td")).addClass("bw-radiobutton-cell").appendTo(a);return e(document.createElement("div")).addClass("bw-radiobutton-radiobutton bw-icon bw-icon-largedot").appendTo(i),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(a),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"radio"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),r&&r.call(t[0],!1)):(t.trigger("check"),r&&r.call(t[0],!0)))}),o.trigger("clear"),o},createProgressCircle:function(t,n,r){var o={},a=30,i=40,s=40;o.id=n,o.progress=Array(r);var c=e(document.createElement("div")).addClass("bw-progress-circle bw-centering-container").attr("id",n).appendTo(e(t));e(document.createElement("div")).addClass("bw-progress-circle-text bw-centered").appendTo(c);var l=[];function d(e,t){if(-1===e)return"";var n=2*Math.PI*e/r,o=2*Math.PI*(e+1)/r,a=i+Math.sin(n)*t,c=s-Math.cos(n)*t,l=i+Math.sin(o)*t,d=s-Math.cos(o)*t;return"M X1 Y1 A R R 0 0 1 X2 Y2".replace("X1",a).replace("Y1",c).replace("X2",l).replace("Y2",d).replace("D",n).replace("R",t).replace("R",t)}function u(e){return'<path d="'+d(e,a)+'"/>'}for(var p=0;p<r;++p)l.push(u(p));return e('<svg class="bw-progress-circle-drawing" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 80 80">'+l.join("")+'<path class="the marker"/></svg>').appendTo(c),o.setProgress=function(t,n){e("#"+this.id+" path:nth-child("+(t+1)+")").attr("class",n)},o.setTextAndPosition=function(t,n){var r=e("#"+this.id+" .bw-progress-circle-text");r.animate({opacity:0},200,"swing",function(){r.empty().append(t).animate({opacity:1},200)});var o=e("#"+this.id+" path.the.marker");o.animate({opacity:0},200,"swing",function(){o.attr("d",d(n,a)).animate({opacity:1},200)})},o}}}(n(0),n(7))},function(e,t){e.exports=function(){var e={0:"debug",1:"info",2:"error"};function t(t,n,r){return n>=r?function(){!function(t,n,r){var o=Array.prototype.slice.call(r);o.unshift(t+" ("+e[n]+"):"),console.log.apply(console,o)}(t,n,arguments)}:function(){}}return{DEBUG:0,INFO:1,ERROR:2,createLogger:function(e,n){return void 0===n&&(n=1),{debug:t(e,0,n),info:t(e,1,n),error:t(e,2,n)}}}}()},,,,,,function(e,t){function n(e){return e.sort(function(){return.5-Math.random()})}var r={};e.exports={shuffleArray:n,randomIndexList:function(e){for(var t=[],r=0;r<e;++r)t.push(r);return n(t)},randomId:function(e){for(;;){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-",o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*n.length));if(!r.hasOwnProperty(t))return r[t]=!0,t}}}},,,,,,,function(e,t,n){e.exports=function(e,t,n,r){function o(e,t){return r('<svg class="'+e+'" xmlns="http://www.w3.org/2000/svg" version="1.1">'+t+"</svg>")}function a(e,t,n,r){return'<line x1="'+e+'" y1="'+t+'" x2="'+n+'" y2="'+r+'" />'}function i(n){var i=r(document.createElement("div")).addClass("bw-popup-zoomable-image"),s=r(document.createElement("div")).addClass("bw-zoomable-image").css({background:"black url("+n.replace(/ /g,"%20")+") no-repeat center center","background-size":"contain"}).appendTo(i);r(document.createElement("div")).addClass("bw-button bw-popup-closebutton").append(r(document.createElement("div")).addClass("bw-icon-small bw-icon-close")).makeButton(t("close")).click(function(e){setTimeout(i.remove.bind(i),0)}).appendTo(i);var c=o("bw-zoomable-image-zoomin",a(14.5,4,14.5,26)+a(4,14.5,26,14.5)).appendTo(i),l=o("bw-zoomable-image-zoomout",a(4,14.5,26,14.5)).appendTo(i);e.bwMakeDragAndResizable(s,c,l),i.appendTo(r("body"))}return{create:function(e){var t,o,a=e.hasOwnProperty("img")?e.img:e,s=a.sources&&a.sources.length>0?n(a.sources[0].src):"",c=s;e.type&&"img"!==e.type?t=r(document.createElement("div")).attr("role","image").css({background:(e.background||"")+" url("+s.replace(/ /g,"%20")+") no-repeat center center","background-size":(o=e.resize_policy,o?"Contain entire picture, keep aspect ratio"===o?"contain":"Cover entire area, keep aspect ratio"===o?"cover":"No resize"===o?"":"Cover entire area with entire picture"===o?"100% 100%":"contain":"contain")}):(t=r(document.createElement("img")),e.loadcb&&t.on("load",e.loadcb),t.attr("src",s));var l=a.alttext||e.alttext;return null!=l&&""!==l&&t.attr("alt",l),t.on("zoom",function(){i(c)}),e.disable_click||t.tapOrClick(function(){i(c)}),e.disable_press||t.hammer().on("press",function(){i(c)}),t},showPopup:i}}(n(329),n(7),n(23),n(0))},function(module,exports,__webpack_require__){var _require=__webpack_require__(107),valueOrCacheValue=_require.valueOrCacheValue;module.exports=function(platform,qs,cssUpdater,printer,dialog,tr,$,uiComponents,uriEncodeImage,bwTool,adaptToPageProtocol,bwTouchHelpers){function getNakedURL(e){if(-1===e.indexOf("?"))return e;var t=/^([^\?]*)\?/.exec(e);if(t&&2===t.length)return t[1];throw Error("Shoudln't happen")}function setQueryParameters(e,t){if(t==={})return e;var n=getNakedURL(e),r=[];return $.each(t,function(e,t){r.push(e+"="+t)}),n+"?"+r.join("&")}function ShowBacklinkIfRequired(){var e=qs.getUrlParams(window.location.href);if(e.hasOwnProperty("backlink")){var t=valueOrCacheValue(e.backlink);(e.hasOwnProperty("backbutton")?$(document.createElement("div")).addClass("widget-backlink widget-backlink-text").safeHtml("&#9664; ").text(valueOrCacheValue(e.backbutton)).appendTo($("body")):$(document.createElement("div")).addClass("widget-backlink widget-backlink-icon").appendTo($("body"))).click(function(){var e=platform.getPlatform();if("ibw-platform-osx-preview"===e||"ibw-platform-win32-preview"===e)console.log("Moving back by using history.back()"),window.history.back();else{var n=window.location.origin;t.startsWith(n)&&(t=t.substr(n.length)),console.log("Moving back by setting window.location to: "+t),window.location=t}})}}var block_recurse_guard=!1;function centerWidgetTitle(e){if(!block_recurse_guard){var t=$("#top-container"),n=t.height(),r=t.width(),o=$(".closebutton-container"),a=$("#top-container .bw-toolbar");o.css("min-width",""),a.css("min-width","");var i=o.width(),s=a.width();if(a.css("min-width",i),o.css("min-width",s),$(".title-container").css("max-width",r-2*Math.max(i,s)),!0!==e&&$("#top-container").height()!==n){block_recurse_guard=!0;try{window.onresize&&window.onresize()}catch(e){console.error("Error when calling onResize during centerWidgetTitle"),console.error(e)}block_recurse_guard=!1}}}function hidePopupMenu(){$("#top-container").removeClass("bw-show-popup-menu"),$("#title-toolbar").appendTo($("#top-container .bw-toolbar")),$(".bw-menu-overlay").remove()}function createPopupToolbarIfRequired(){if(!($("#menubutton").length>0)){var e=$("#top-container .bw-toolbar");if(e.children(":not(.outside-popup)").length>1){e.removeClass("bw-toolbar");var t=$(document.createElement("div")).addClass("bw-toolbar").appendTo($(".titlebar-layout"));e.find(".outside-popup").each(function(){$(this).appendTo(t)}),e.appendTo(t).addClass("bw-button-group"),$(document.createElement("div")).attr("id","menubutton").addClass("bw-toolbutton").append($(document.createElement("div")).addClass("bw-icon bw-icon-menu")).makeButton(tr("Menu")).tapOrClick(function(){$("#top-container").hasClass("bw-show-popup-menu")?hidePopupMenu():setTimeout(function(){$("#top-container").addClass("bw-show-popup-menu");var e=$(document.createElement("div")).addClass("bw-menu-overlay").appendTo("#container");setTimeout(function(){e.on("click touchend",function(){setTimeout(hidePopupMenu,500)})},350),$("#title-toolbar").appendTo(e)},100)}).appendTo(t)}}}function createTitleLayout(e,t,n){var r=$(e),o=$(document.createElement("div")).attr("id","container").prependTo(r).addClass("top-bottom-layout"),a=$(document.createElement("div")).attr("id","top-container").appendTo(o).addClass("top-container"),i=$(document.createElement("div")).appendTo(a).addClass("titlebar-layout");return $(document.createElement("div")).addClass("closebutton-container").appendTo(i),$(document.createElement("div")).addClass("title-container").append($(document.createElement("span")).attr("id","title")).appendTo(i),n?$(n).addClass("bw-toolbar").appendTo(i):$(document.createElement("div")).attr("id","title-toolbar").addClass("bw-toolbar").appendTo(i),createPopupToolbarIfRequired(),$(t).appendTo(o).addClass("bottom-container"),centerWidgetTitle(),o}function prependToTitleToolbar(e){var t=$("#title-toolbar");e.prependTo(t),createPopupToolbarIfRequired(),centerWidgetTitle()}function openDebugWindow(){var debugwindow=$(document.createElement("div")).addClass("bw-debug-window bw-row-container").appendTo("body"),debugoutput=$(document.createElement("div")).addClass("bw-debug-output bw-row-resizing").appendTo(debugwindow);function appendOutput(e){e.appendTo(debugoutput),debugoutput[0].scrollTop=debugoutput[0].scrollHeight-debugoutput[0].getBoundingClientRect().height}function argsToString(e){for(var t=[],n=0;n<e.length;++n)t.push(JSON.stringify(e[n]));return t.join(" ")}$(document.createElement("div")).addClass("bw-debug-close").text("X").tapOrClick(function(){debugwindow.remove(),localStorage.removeItem("bw-debug-enabled")}).appendTo(debugwindow),console.log=function(){appendOutput($(document.createElement("p")).safeHtml(argsToString(arguments)))},console.error=function(e,t){appendOutput($(document.createElement("p")).css("color","red").safeHtml(argsToString(arguments)))},window.onerror=function(e,t,n){return appendOutput($(document.createElement("p")).attr("style","color: red").safeHtml(e+" ("+t+":"+n+")")),!0},console.log(platform.getPlatform(),navigator.platform,navigator.userAgent,window.innerWidth,window.innerHeight);var debuginput=$(document.createElement("input")).addClass("bw-debug-input bw-row-fixed").appendTo(debugwindow),commandlist=[],index=0;function exec(str){var goodstr=str.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"');console.log(eval(goodstr)),commandlist.push(goodstr),index=commandlist.length}debuginput.keypress(function(e){13===(e.keyCode?e.keyCode:e.which)&&(exec(debuginput.val()),debuginput.val(""))}),debuginput.keydown(function(e){var t=e.keyCode?e.keyCode:e.which;38===t?index>0&&(--index,debuginput.val(commandlist[index])):40===t&&index<commandlist.length&&(++index===commandlist.length?debuginput.val(""):debuginput.val(commandlist[index]))});try{debugwindow.draggable()}catch(e){console.error("No drag support")}}function showDebugDialog(){if(!($(".bw-debug-window").length>0)){var e=$(document.createElement("div")).addClass("bw-debug-wrapper").appendTo("body"),t=$(document.createElement("div")).addClass("bw-debug-dialog").appendTo(e);$(document.createElement("p")).text("Enter your support key:").appendTo(t);var n=$(document.createElement("input")).attr("placeholder","key").appendTo(t);$(document.createElement("br")).appendTo(t),$(document.createElement("button")).attr("type","button").text("Cancel").tapOrClick(function(){e.remove()}).appendTo(t),$(document.createElement("button")).attr("type","button").text("OK").tapOrClick(function(){"bw-magic"===n.val()&&(openDebugWindow(),e.remove(),localStorage.setItem("bw-debug-enabled","true"))}).appendTo(t)}}function initializeDebugSupport(e){var t=0;e.clickOrHold(function(){t=0},function(){3==++t&&(showDebugDialog(),t=0)},2e3);try{"true"===localStorage.getItem("bw-debug-enabled")&&openDebugWindow()}catch(e){}}function enableOsxIbooksHack(){if("ibw-platform-osx-ibooks"===platform.getPlatform()){var e=["html.ibw-platform-osx-ibooks, .ibw-platform-osx-ibooks .bw-popup-zoomable-image {","width: "+window.innerWidth+"px;","height: "+window.innerHeight+"px;","}"],t=document.createElement("style");t.id="osx_ibooks_workaround",t.type="text/css",t.appendChild(document.createTextNode(e.join("\n"))),document.head.appendChild(t)}}function makeWidget(e){e=e||{},enableOsxIbooksHack();var t=$("body");t.addClass("bw"),e.hasOwnProperty("no-user-select")&&!0===e["no-user-select"]&&t.addClass("no-user-select");var n,r=e.layout||"";if("title_layout"===r?(n=createTitleLayout("body","#bottom-container")).find(".top-container").addClass("title-only"):"title_overlay_layout"===r?((n=createTitleLayout("body","#bottom-container")).addClass("title-overlay"),n.find(".top-container").addClass("title-only")):n="title_toolbar_layout"===r?createTitleLayout("body","#bottom-container","#title-toolbar"):$("#container"),e.hasOwnProperty("title")&&""!==e.title){var o=n.find("#title");o.safeHtml(e.title),initializeDebugSupport(o)}else{var a=n.find(".top-container");a.addClass("title-empty"),initializeDebugSupport(a)}"ibw-platform-ipad-ibooks-epub"===platform.getPlatform()&&(e.hasOwnProperty("epubBlockTouchEndCheck")||(e.epubBlockTouchEndCheck=function(e){return e.srcElement instanceof SVGElement||$(e.srcElement).hasClass("epub-block")}),document.addEventListener("touchend",function(t){var n=$(window).width();(t.layerX<50||n-t.layerX<50||e.epubBlockTouchEndCheck(t))&&t.preventDefault()},!1),e.hasOwnProperty("epubBlockTouchStartCheck")&&document.addEventListener("touchstart",function(t){e.epubBlockTouchStartCheck(t)&&t.preventDefault()},!1)),ShowBacklinkIfRequired()}function getRoot(){return platform.isWebPreview()?window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/",window.location.pathname.lastIndexOf("/")-1)):""}return $(function(){var e=platform.getPlatform(),t=$("html");t.hasClass("ibw-platform-custom")||t.addClass(e)}),window.custom_alert=dialog.showAlert,window.criticalAlert=dialog.showCriticalAlert,window.bw_confirmation_dialog=dialog.showConfirmationDialog,window.tr=tr,window.getUrlParams=qs.getUrlParams,window.getNakedURL=getNakedURL,window.setQueryParameters=setQueryParameters,window.createLabeledCheckbox=uiComponents.createLabeledCheckbox,window.createProgressBar=uiComponents.createProgressBar,window.createSimpleCheckbox=uiComponents.createSimpleCheckbox,window.createNumberButtons=uiComponents.createNumberButtons,window.createSimpleRadiobutton=uiComponents.createSimpleRadiobutton,window.createLabeledRadiobutton=uiComponents.createLabeledRadiobutton,window.createProgressCircle=uiComponents.createProgressCircle,window.URIEncodeImage=uriEncodeImage,window.BWAdaptToPageProtocol=adaptToPageProtocol,window.updateConfigCSS=bwTool.updateConfigCSS,{makeWidget:makeWidget,getNakedURL:getNakedURL,setQueryParameters:setQueryParameters,prependToTitleToolbar:prependToTitleToolbar,centerTitle:centerWidgetTitle,ShowBacklinkIfRequired:ShowBacklinkIfRequired,getRoot:getRoot}}(__webpack_require__(2),__webpack_require__(11),__webpack_require__(384),__webpack_require__(385),__webpack_require__(9),__webpack_require__(7),__webpack_require__(0),__webpack_require__(25),__webpack_require__(23),__webpack_require__(75),__webpack_require__(108),__webpack_require__(386))},,,,,,,,,function(e,t,n){var r=n(107).valueOrCacheValue,o=function(e,t,o,a,i,s,c,l,d,u,p){var f=arguments.length>11&&void 0!==arguments[11]?arguments[11]:n(1),h=arguments.length>12&&void 0!==arguments[12]?arguments[12]:n(380)(),g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:n(383),m=arguments.length>14&&void 0!==arguments[14]?arguments[14]:n(112),v={INIT:-1,ANONYMOUS:0,OFFLINE:1,ONLINE:2},w=t.Deferred(),b=t.Deferred();return v.initialized=function(){return w.resolve(),b},f.getConfig().then(function(n){var i=l.getParameters(),c=u.isLTI(),f=i.sso,y=i.login_hint,C=l.getQueryParams(window.location.search).toplevel,k=c&&!C||i.no_logout,T=v.INIT,x=!1;v.stateChangeCallbacks=[],v.registerStateChangeCallback=function(e){this.stateChangeCallbacks.push(e)},v.triggerStateChangeCallbacks=function(){for(var e=[],n=0;n<this.stateChangeCallbacks.length;++n)e.push(this.stateChangeCallbacks[n](T,x));return t.when.apply(null,e)},v.onlinecheck_enabled=!1;var _=null,S=2;function E(){return"no"!==n.support_student_account||u.isLTI()||f}function I(e){return e.firstName&&""!=e.firstName&&e.lastName&&""!=e.lastName?e.firstName+" "+e.lastName:e.firstName&&""!=e.firstName?e.firstName:e.lastName&&""!=e.lastName?e.lastName:e.providerHumanID&&""!=e.providerHumanID&&e.providerHumanID!==e.providerID?e.providerHumanID:e.email&&""!=e.email?e.email.substring(0,e.email.indexOf("@")):e.providerID}v.isStudentAccountsSupported=E,v.setCredentials=function(e,t){var n={username:I(e),userid:e.id,email:e.email,providerid:e.providerID,providerhumanid:e.providerHumanID,provider:e.provider,school:t,className:e.className,token:e.token,sid:null,coaccount:e.isCoAccount};d.setCredentials(n),h.setCredentials(d.credentials())},v.clearCredentials=function(){d.clear(),h.setCredentials(d.credentials())},v.loadCredentials=function(){return t.Deferred(function(e){h.getCredentials().done(function(t){null!==t?d.setCredentials(t):d.clear(),e.resolve(d.credentials())}).fail(function(){console.log("credentials load failure"),d.clear(),e.resolve(d.credentials())})}).promise()},v.getStudentInfo=function(e,r){var o=null,a=null;return null!=e&&""!==e?a={Authorization:"BWWAAuthToken "+e}:null!=r&&""!==r&&(o={sid:r}),t.ajax({type:"GET",dataType:"json",data:o,url:n.student_account_server+"/student/GetInfo",headers:a,timeout:1e4})},v.checkIfOnline=function(){if(!this.onlinecheck_enabled)return t.when();var e=t.Deferred(),n=d.getUserToken();return this.getStudentInfo(n,null).done(function(t){console.log("Got back online !"),v.goOnline(),e.resolve()}).fail(function(){e.reject()}),e},v.goOffline=function(t){console.log("goOffline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOffline"),n.setState(v.OFFLINE)})},v.goOnline=function(t){console.log("goOnline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOnline"),n.setState(v.ONLINE)})},v.scheduleOnlineCheck=function(){var e=this;S=Math.min(2*S,20),this.onlinecheck_enabled&&(_=setTimeout(function(){e.checkIfOnline().always(function(){e.scheduleOnlineCheck()})},1e3*S))},v.startOnlineCheck=function(){this.onlinecheck_enabled=!0,S=2,this.scheduleOnlineCheck()},v.stopOnlineCheck=function(){this.onlinecheck_enabled=!1,null!==_&&clearTimeout(_)},v.setState=function(e){return e===T?(console.log("Warning: setting identical storage state, ignoring"),t.when()):(T===v.OFFLINE&&this.stopOnlineCheck(),e===v.OFFLINE&&this.startOnlineCheck(),T=e,this.triggerStateChangeCallbacks())},v.setForceOfflineStorage=function(){return!1===x&&(x=!0),this.triggerStateChangeCallbacks()},v.setUserInfo=function(e,t){console.log("Log in successfull"),this.setCredentials(e,t),this.setState(this.ONLINE)},v.waitForExternalLogin=function(e,r){return r=r||2e3,t.Deferred(function(o){var i=null,s=null;var c=g.createPollingUI(function(){i&&clearTimeout(i),s&&s.abort(),l(),o.reject()});function l(){c.close()}!function c(){i=null;var d={sid:e.sid};console.log("Poll",e.sid),s=t.ajax({type:"GET",dataType:"json",data:d,url:n.student_account_server+"/student/GetInfo",timeout:1e4,success:function(e){s=null,l(),o.resolve(e)},error:function(e,t,n){if(s=null,"abort"!==t)if(401===e.status||0===e.status)try{0===e.status||"authenticating"===JSON.parse(e.responseText).auth.status?i=setTimeout(c,r):(l(),o.reject({msg:a("Authentication error.")}))}catch(e){l(),o.reject({msg:a("Server error when signing in.")})}else l(),o.reject({msg:a("Received error trying to sign in")+" ("+e.status+")"})}})}()}).promise()},v.serverLogin=function(e,r,o){return t.Deferred(function(i){var s={schoolCode:e,username:r,password:o};return t.ajax({type:"POST",data:s,url:n.student_account_server+"/student/Login",timeout:1e4}).done(function(e){i.resolve(e)}).fail(function(e){401==e.status?i.reject({msg:a("Wrong username or password, please try again.")}):i.reject({msg:a("Received error trying to sign in")+" ("+e.status+")"})})}).promise()},v.login=function(e,n,r){var o=this;return t.Deferred(function(t){"oauth"===n||"signup"===r.action?o.waitForExternalLogin(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):"login"===r.action?o.serverLogin(r.school,r.username,r.password).done(function(e){t.resolve(e,r.school)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login action"})}).promise()},v.getLoginCredentials=function(e,n){return t.Deferred(function(t){"oauth"===n?t.resolve(e,n):"bw"===n?g.queryBWCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):"school"===n?g.querySchoolCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login type: "+n})}).promise()},v.hasSchool=function(){return n.hasOwnProperty("student_account_school")&&n.student_account_school.hasOwnProperty("code")&&null!==n.student_account_school.code&&""!==n.student_account_school.code&&"null"!==n.student_account_school.code},v.selectLoginType=function(e){var n=this;return t.Deferred(function(t){if(e.oauth_links.length>0||!n.hasSchool()){if(f)for(var r=0;r<e.oauth_links.length;++r){var i=e.oauth_links[r];if(i.provider===f)return void o.navigateAlert(a("You need to be signed in to use this widget."),a("Please sign in"),a("OK"),i.url)}g.queryLoginMethod(e).done(function(n){t.resolve(e,n)}).fail(function(e){t.reject(e)})}else t.resolve(e,"school")}).promise()},v.getLoginInfo=function(){var e=i.lfq?l.split(i.lfq):{};e.schoolCode=this.hasSchool()?n.student_account_school.code:"",f?e.providers=f:n.student_account_authrestrict&&"yes"===n.student_account_authrestrict&&(e.providers=(n.student_account_authproviders||[]).join(",")),e.source=function(e){var t=s.getPlatform();return"ibw-platform-ipad-ibooks"===t||"ibw-platform-ipad-ibooks-epub"===t?"ibooks-ios":"ibw-platform-ipad-bookwidgets"===t?s.isPreview()?"bwapp-preview":"bwapp":"ibw-platform-osx-ibooks"===t||"ibw-platform-osx-ibooks-epub"===t?"ibooks-osx":"ibw-platform-osx-preview"===t||"ibw-platform-win32-preview"===t?"bw-preview":"ibw-platform-android-chrome"!==t||e?s.isPreview()?"create-preview":s.isTopLevelPlay()?"play":"embed":"embed"}(!!f),n.kmuserid&&""!=n.kmuserid&&(e.creator=n.kmuserid),"undefined"!=typeof bwshortcode&&(e.widget=bwshortcode),s.isIOS()&&(e.ios="1"),e.q=r(i.q);var o=m("body");return t.Deferred(function(r){t.ajax({type:"GET",dataType:"json",data:e,url:n.student_account_server+"/student/GetLoginForm",timeout:1e4}).done(function(e){o.close(),r.resolve(e)}).fail(function(e){o.close(),400==e.status?r.reject({msg:a("Widget configuration error: school doesn't exist.")}):r.reject({msg:a("Could not connect to server, check your internet connection.")})})}).promise()},v.reportFailure=function(e){return e&&e.hasOwnProperty("msg")?g.showMessage(e.msg,a("Sign in failed")):t.when(!0)},v.requestSignin=function(){var e=this;return t.Deferred(function(t){e.getLoginInfo().then(e.selectLoginType.bind(e)).then(e.getLoginCredentials.bind(e)).then(e.login.bind(e)).then(e.setUserInfo.bind(e)).then(function(){t.resolve(!1)}).fail(function(n){e.reportFailure(n).done(function(e){t.resolve(!e)})})}).promise()},v.showLoginStateInfo=function(){return T===v.OFFLINE?g.queryLogout(a("Offline"),a("You're currently offline and logged in as user:"),this.getUserName(),k):T===v.ONLINE?g.queryLogout(a("Online"),a("You're currently online and logged in as user:"),this.getUserName(),k):t.when()},v.loopLoginUntilOnline=function(e){var t=this;this.requestSignin().done(function(n){T===t.ONLINE?e.resolve():n?t.loopLoginUntilOnline(e):g.showMessage(a("You need to be signed in to use this widget."),a("Please sign in")).done(function(){t.loopLoginUntilOnline(e)})})},v.forceLogin=function(){var e=t.Deferred();return this.loopLoginUntilOnline(e),e},v.setAnonymousOrForceLogin=function(){u.isEmbeddedLTI()?this.loginLTI():"optional"===n.support_student_account?(this.setState(this.ANONYMOUS),b.resolve()):this.forceLogin().done(function(){b.resolve()})},v.initializeWithStoredCredentials=function(e){var t=this,r=e.token,o=e.sid,a=null!=r&&""!==r;if(!1===a&&!1===(null!=o&&""!==o)||E()&&this.hasSchool()&&n.student_account_school.code!==e.school)this.setAnonymousOrForceLogin();else{var i=m("body");t.getStudentInfo(r,o).done(function(n){if(i.close(),f&&!o&&(n.provider!==f||!y||0==y.length||n.providerID!==y&&n.providerHumanID!==y))return console.log("Logged in with incompatible credentials. Re-login."),void t.setAnonymousOrForceLogin();t.setCredentials(n,e.school),t.setState(v.ONLINE),b.resolve()}).fail(function(e){i.close(),console.log("Error getting student info -> either invalid token or wrong connection"),a&&401!==e.status?(t.setState(v.OFFLINE),b.resolve()):t.setAnonymousOrForceLogin()})}},v.loginLTI=function(){var e=m("body"),r=this;t.ajax({type:"POST",data:{lti:l.urlencode(l.getParameters()),url:window.location.protocol+"//"+window.location.host+window.location.pathname,wa:n.WA,id:n.uuid2},headers:p.getAJAXHeaders(),url:n.student_account_server+"/student/Login",timeout:1e4}).then(function(t){e.close(),u.setEmbeddedLTIAuthenticated(),r.setCredentials(t,null),r.setState(v.ONLINE),b.resolve()},function(t){e.close();try{var n=JSON.parse(t.responseText);if("noLTILicense"==n.code)return r.setState(r.ANONYMOUS),void b.reject();if(null!=n.message&&n.message.length>0)return void o.showFatalAlert(n.message,a("Error"))}catch(e){}0===t.readyState?o.showFatalAlert(a("You need an internet connection to access this widget."),a("Error")):o.showFatalAlert(a("Error signing in."),a("Error"))})},v.initialize=function(){var e=this;t(function(){if(!E())return e.setState(e.ANONYMOUS),void b.resolve();var t=i.sid;return t?(console.log("Got SID from params"),history.replaceState("",document.title,window.location.pathname+window.location.search+l.removeQueryStringParameter(l.getHash(),"sid")),void e.initializeWithStoredCredentials({sid:t})):!u.isEmbeddedLTI()||u.isEmbeddedLTIAuthenticated()?!c&&s.isPreview()?(e.setState(e.ANONYMOUS),void b.resolve()):void e.loadCredentials().done(e.initializeWithStoredCredentials.bind(e)):void e.loginLTI()})},w.then(function(){v.initialize()}),v.logout=function(){return this.clearCredentials(),"optional"===n.support_student_account?this.setState(v.ANONYMOUS):(m("body"),window.location.reload(!1)),t.when().promise()},v.requestSignout=function(){return this.showLoginStateInfo().done(this.logout.bind(this))},v.getUserToken=function(){return d.getUserToken()},v.getUserSid=function(){return d.getUserSid()},v.getUserName=function(){return d.getUserName()},v.getUserClassName=function(){return d.getUserClassName()},v.getUserId=function(){return d.getUserId()},v.getEmail=function(){return d.getEmail()},v.getProviderId=function(){return d.getProviderId()},v.getProviderHumanId=function(){return d.getProviderHumanId()},v.isCoAccount=function(){return d.isCoAccount()},v.getState=function(){return T},v.getForceOfflineStorage=function(){return x},v.hasProperty=function(e){return"user_id"===e},v.getProperty=function(e){if("user_id"==e)return this.getUserId()}}),v}.bind(null,n(113),n(0),n(9),n(7),n(77),n(2),n(40),n(11),n(167),n(74),n(387));e.exports={f:o,o:o()}},,,,,function(e,t){e.exports={BWDS_ERROR_INTERNAL:0,BWDS_ERROR_UNKNOWN:1,BWDS_ERROR_UNAVAILABLE:2,BWDS_ERROR_WRONG_ATTRIB:3,BWDS_ERROR_FULL:4,BWDS_ERROR_SECURITY:5}},function(e,t,n){e.exports=function(e){return{getImageSize:function(e,t){var n=new Image;n.onload=function(){var e=this.width,n=this.height;t(e,n)},n.onerror=function(){t()},n.src=e},processRichTextImages:function(t){t.find("img").attr({height:"",draggable:"false"}).css("max-width","100%").each(function(){var t=e(this),n=t.css("float");"left"===n?t.css({"margin-right":"10px","margin-bottom":"10px"}):"right"===n&&t.css({"margin-left":"10px","margin-bottom":"10px"})})},calculateScaleAndOffset:function(e,t,n,r,o){var a,i,s,c,l,d;return"Cover entire area, keep aspect ratio"===e?((l=t/r)<(d=n/o)?(a=d,i=d):(a=l,i=l),s=(t-r*a)/2,c=(n-o*i)/2):"Contain entire picture, keep aspect ratio"===e?((l=t/r)>(d=n/o)?(a=d,i=d):(a=l,i=l),s=(t-r*a)/2,c=(n-o*i)/2):"Cover entire area with entire picture"===e?(s=0,c=0,a=t/r,i=n/o):(a=1,i=1,s=(t-r)/2,c=(n-o)/2),{scale_x:a,scale_y:i,offset_x:s,offset_y:c}}}}(n(0))},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a,i,s,c=n(6).adjustRichTextVideoSize;e.exports=(o=n(2),a=n(0),i=n(108),s={getParameterByNameRaw:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===n?"":n[1].replace(/\+/g," ")},isYoutubeUrl:function(e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/);return!(!t||11!==t[2].length)},getYoutubeId:function(e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/);if(t&&11===t[2].length)return console.log("Youtube id: ",t[2]),t[2];var n=s.getParameterByNameRaw(e,"v");return""!==n?(console.log("Youtube id: ",n),n):(console.log("Youtube id: ",e),e)},timeToSeconds:function(e){var t=e.match(/(([0-9]+)m)?([0-9]+)s/);if(null==t)return 0;var n=parseInt(t[3]);return t[2]&&(n+=60*parseInt(t[2])),n},getYoutubeStart:function(e){var t=s.getParameterByNameRaw(e,"start");if(""!==t)return console.log("Start: ",t),parseInt(t);var n=s.getParameterByNameRaw(e,"t");return""!==n?(console.log("Start: ",s.timeToSeconds(n)),s.timeToSeconds(n)):0},getYoutubeEnd:function(e){var t=s.getParameterByNameRaw(e,"end");return""!==t?(console.log("End: ",t),parseInt(t)):0},getInterval:function(e){var t="",n=s.getYoutubeStart(e);0!==n&&(t="?start="+n);var r=s.getYoutubeEnd(e);return 0!==r&&(t+=""===t?"?":"&",t+="end="+r),console.log("Interval: ",t),t},addPlayerIFrame:function(e,t){var n=a(e);if("ibw-platform-win32-preview"===o.getPlatform()||"ibw-platform-osx-preview"===o.getPlatform())return n.safeHtml("<br>Youtube videos are not supported in preview mode."),void n.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"});var r=i("http://www.youtube.com/embed/")+s.getYoutubeId(t)+s.getInterval(t);console.log("iframe url: ",r),a(document.createElement("iframe")).attr({seamless:"",id:"playeriframe",src:r}).appendTo(n)},youtubeplaceholdercounter:0,resolveYoutubePlaceholdersNew:function(e){e.find(".youtubeplaceholder").each(function(){var e=a(this);if(void 0===e.attr("id")){console.log("prepare movie player");var t="YTP_"+s.youtubeplaceholdercounter++;e.attr("id",t);var n=e.attr("src");s.addPlayerIFrame("#"+t,n)}})},YouTubeLoading:!1,YouTubeVideos:[],loadYouTubePlayer:function(e,t,n){var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",i("http://www.youtube.com/player_api")),document.getElementsByTagName("body")[0].appendChild(r)},pollStartVideos:function(){if(console.log("pollStartVideos()"),void 0!==window.YT&&void 0!==window.YT.Player){console.log("YT player ready, really playing");for(var e=0;e<s.YouTubeVideos.length;++e)s.YouTubeVideos[e]()}else setTimeout(s.pollStartVideos,100)},playYouTube:function(e,t){var n=s.getYoutubeId(t),i=s.getYoutubeStart(t),c=s.getYoutubeEnd(t);if("ibw-platform-win32-preview"===o.getPlatform()||"ibw-platform-osx-preview"===o.getPlatform()){var l=a(e);return l.safeHtml("<br>Youtube videos are not supported in preview mode."),void l.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"})}function d(){console.log("createYouTubeVideo() "+e+" "+n+" "+i+" "+c);var t=a(e),o={rel:0};0!==i&&(o.start=i),0!==c&&(o.end=c),console.log(r(window.YT.Player)),new window.YT.Player(e.substring(1),{height:t.height(),width:t.width(),videoId:n,playerVars:o})}void 0!==window.YT&&void 0!==window.YT.Player?d():(s.YouTubeVideos.push(d),s.YouTubeLoading||(s.YouTubeLoading="true",s.loadYouTubePlayer(),setTimeout(s.pollStartVideos,100)))},createHtml5VideoPlayer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"video/mp4",o=a(document.createElement("video")).attr({controls:"",preload:"auto",poster:""});return null!=t&&o.attr("width",t),null!=n&&o.attr("height",n),a(document.createElement("source")).attr({src:e,type:r}).appendTo(o),o},resolveYoutubePlaceholders:function(e){function t(e,t){var n=t.width(),r=t.height(),o=a(document.createElement("div")).addClass("videodiv").css({width:n,height:r}).appendTo(t);return a(document.createElement("iframe")).attr({frameborder:"0",webkitAllowFullScreen:"",mozallowfullscreen:"",allowFullScreen:""}).css({width:n,height:r}).appendTo(o).attr("src",e),o}e.find(".youtubeplaceholder").each(function(){var e=a(this);if(void 0===e.attr("id")){console.log("prepare movie player");var n="YTP_"+s.youtubeplaceholdercounter++;e.attr("id",n);var r=e.attr("src");c(e),!function(e){return-1!==e.toLowerCase().indexOf("youtu")}(r)?function(e){return-1!==e.toLowerCase().indexOf("vimeo")}(r)?function(e,n){t(i("http://player.vimeo.com/video")+"/"+function(e){var t=e.match(/.*\/(.+)\??.*/);return t?t[1]:e}(e),n).addClass("bw-vimeo-wrapper")}(r,a("#"+n)):function(e){return-1!==e.toLowerCase().indexOf("giphy")}(r)?function(e,n){t(i("http://giphy.com/embed")+"/"+function(e){var t=e.match(/.*\/(.+)\??.*/);return t?t[1]:e}(e),n).addClass("bw-giphy-wrapper")}(r,a("#"+n)):console.error("Unsupported video URL: "+r):s.playYouTube("#"+n,r)}})}})},,,,,,,,,,,,,,,,,,function(e,t,n){var r,o,a;e.exports=(r=n(11),o=r.getParameters(),a=!!o.lti_authenticated,{isLTI:function(){return!!o.lti||!!o.lti_version},isEmbeddedLTI:function(){return!!o.lti_version},isEmbeddedLTIAuthenticated:function(){return a},setEmbeddedLTIAuthenticated:function(){a=!0,r.updateWindowQueryParameter("lti_authenticated","1")}})},function(e,t){e.exports=function(){var e=[];function t(){for(var t=0;t<e.length;++t)e[t]()}return{executeCssUpdateCallbacks:t,CssUpdateCallbacks:e,updateConfigCSS:function(e){for(var n=document.getElementsByTagName("link"),r=0,o=n.length;r<o;r++){var a=n[r],i=a.rel;if("string"!=typeof i||0===i.length||"stylesheet"===i){var s=a.getAttribute("href");0===s.indexOf("config")&&-1!==s.indexOf(".css")&&(a.setAttribute("href","config"+e+".css"),setTimeout(t,100))}}},addAllDesignInfo:function(){void 0!==window.addAllDesignInfo&&window.addAllDesignInfo()},addCSSUpdateCallback:function(t){e.push(t)}}}()},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a,i;e.exports=(o=n(26).createLogger("CallbackBridge"),a=1,(i=function(){this.id=a++,this.listening=!1,this.nextCallbackID=1,this.callbacks={},this.handleMessage=this._handleMessage.bind(this)}).prototype.getMessagePrefix=function(){return"bw-CBBridge-"+this.id+"-"},i.prototype.startListening=function(){window.addEventListener("message",this.handleMessage)},i.prototype.stopListening=function(){window.removeEventListener("message",this.handleMessage)},i.prototype._handleMessage=function(e){var t=this.getMessagePrefix();"object"===r(e.data)&&"string"==typeof e.data.command&&e.data.command.substr(0,t.length)===t&&(e.data.hasOwnProperty("err")?this.processCallback(e.data.command,e.data.err,e.data.data):this.processCallback(e.data.command,e.data.arg))},i.prototype.registerCallbacks=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={ok:e,error:t},{ok:this.getMessagePrefix()+n+"-ok",error:this.getMessagePrefix()+n+"-error"}},i.prototype.registerCallback=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={cb:e,singleshot:!t},this.getMessagePrefix()+n+"-cb"},i.prototype.processCallback=function(e,t,n){try{var r=e.match(/bw-CBBridge-.*-(.*)-(ok|error|cb)$/);if(r){var a,i=r[1],s=this.callbacks[i];return s?"cb"===r[2]?((a=s.cb)(t,n),void(s.singleshot&&delete this.callbacks[i])):(a="ok"===r[2]?s.ok:s.error,delete this.callbacks[i],void a(t)):void o.error("Cannot find callback with ID "+i+" Bridge "+this.id+this.callbacks)}o.error("Malformed callback: "+e)}catch(e){o.error(e)}},i)},function(e,t,n){var r;e.exports=(r=n(0),function(e,t,n,o){var a=o&&""!==o?"onclick=\"setTimeout(function() { parent.postMessage({ msg:'"+o+"'}, '*');}, 1000);\" ":"",i=document.createElement("iframe");i.className="bwexternallink";var s='<body style="margin: 0px"><a style="display: block; width: 100%; height: 100%; background:red;" '+a+'href="'+t+'" target="_blank">&nbsp;</a></body>';e.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.write(s),i.contentWindow.document.close(),r(i).css({position:"absolute",left:0,top:0,width:"100%",height:"100%"})})},,,,,,function(e,t,n){var r=n(107),o=r.valueOrCacheValue,a=r.replaceParamsBySessionLink,i=n(22);e.exports=function(e,t,n,r,s){function c(r,c){var l=e.getParameters();delete l.design,delete l.content,delete l.translation,s.isEmbeddedLTIAuthenticated()&&(l.lti_authenticated=1);var d=n.getProviderId(),u=window.location.protocol+"//"+window.location.host+window.location.pathname+a(window.location.search);if(null==l.login_hint&&d&&""!==d&&(window.location.search.length>1?u+="&":u+="?",u+="login_hint="+encodeURIComponent(d)),u+=e.getHash(),""===r||"?"===r.charAt(0))return t.showAlert("The widget is not included.","Broken link"),r;function p(e){return-1===e.indexOf("?")?"?":"&"}if(c&&(r+=p(r)+"backlink="+encodeURIComponent(u),window.bwbackbuttonlabel&&(r+="&backbutton="+encodeURIComponent(window.bwbackbuttonlabel))),r.indexOf("/play/")>=0)l.q&&""!==l.q&&(r+=p(r)+function(e,t){if(null==e)return"";var n=i.isArray(t)?t:[t];return i.filter(e.split("&"),function(e){for(var t=0;t<n.length;++t)if(e.startsWith(n[t]+"="))return!1;return!0}).join("&")}(o(l.q),["context_id","backlink","backbutton"])),null!=l.toplevel&&(r+=p(r)+"toplevel="+encodeURIComponent(l.toplevel)),d&&""!==d&&(r+=p(r)+"login_hint="+encodeURIComponent(d));else{var f={},h={};for(var g in l)"sid"!==g&&l.hasOwnProperty(g)&&(e.LEGACY_HASH_PARAMETERS.indexOf(g)>=0?f[g]=l[g]:h[g]=l[g]);d&&""!==d&&(f.login_hint=d),Object.keys(h).length>0&&(r+=p(r)+e.urlencode(h)),Object.keys(f).length>0&&(r+="#"+e.urlencode(f))}return r}function l(e,t,n){if(console.log("Widget link: "+e),e=c(e,t),n){var o=r(n.target),a=0===o.length?{left:0,top:0}:o.offset(),i=o.clone();r("body").append(i),i.css({position:"absolute",left:a.left+"px",top:a.top+"px",width:o.width()+"px",height:o.height()+"px","border-left":o.css("border-left"),"border-right":o.css("border-right"),"border-top":o.css("border-top"),"border-bottom":o.css("border-bottom"),"border-top-left-radius":o.css("border-top-left-radius"),"border-top-right-radius":o.css("border-top-right-radius"),"border-bottom-left-radius":o.css("border-bottom-left-radius"),"border-bottom-right-radius":o.css("border-bottom-right-radius"),"-webkit-border-top-left-radius":o.css("-webkit-border-top-left-radius"),"-webkit-border-top-right-radius":o.css("-webkit-border-top-right-radius"),"-webkit-border-bottom-left-radius":o.css("-webkit-border-bottom-left-radius"),"-webkit-border-bottom-right-radius":o.css("-webkit-border-bottom-right-radius"),"box-shadow":o.css("box-shadow"),"-webkit-box-shadow":o.css("-webkit-box-shadow")});i.css({"-webkit-transition":"all .5s linear","-moz-transition":"all .5s linear","-o-transition":"all .5s linear",transition:"all .5s linear","box-sizing":"border-box"});var s=r(document).width(),l=r(document).height(),d=s/o.width(),u=l/o.height(),p=d>u?u:d,f="translate("+(s/2-a.left-o.width()/2)+"px, "+(l/2-a.top-o.height()/2)+"px) scale("+p+")";i.css({"-webkit-transform":f,"-moz-transform":f,"-o-transform":f,transform:f,opacity:.1}),setTimeout(function(){window.location=e},500),o.closest("span[onclick]").attr("onclick","")}else window.location=e}function d(e){return null!=e&&-1!==e.indexOf("bookwidgets.com/play/")}return{isWidgetPlayLink:d,openLinkOrWidgetLink:function(e,t){if(d(e)){var n=-1===e.indexOf("?")?"?":"&";l(e+=n+"noiframe=1",t)}else r().isSafeURLForNavigation(e)&&(console.log("open link"),top.location.href=e)},processRichTextWidgetPlayLinks:function(e,t){e.find("a").filter(function(){return d(r(this).attr("href"))}).each(function(){var e=r(this),n=e.attr("href");console.log("make link widget play link",n);var o=-1===n.indexOf("?")?"?":"&";n+=o+"noiframe=1",e.before(r(document.createElement("div")).css("display","inline-block").tapOrClick(function(){return l(n,t),!1}).safeHtml(e.html())),e.after("&nbsp;"),e.hide()})},openWidget:l,addLinkIcon:function(e){r(document.createElement("div")).addClass("link-icon").css({width:"24px",height:"24px",position:"absolute",top:"10px",right:"10px",opacity:"0.6",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA+JJREFUeAHlm8tLIzEcx2Nb67M3wZsXb7uw91UPHv0f/AdEEEEEUUQQRBBE0a4PfKJWEV+IiIgUEfHmraxXBa/e3NvCbjbf2oiPTZv5zWRm0gn8GoyTmXw+ySTttGHsc/oqiqZF3Il4FsEtDzCABUxgU6ak+E9axB8RtkOr2g82MIL1XUJBVoSqYrmVg/WdhB8RgpediZHAKkTgvsiJiImIUvorYL/FxcuQiO9RIi+wovN/4wUz5JdCYdSyOwjAMpGKGnmB9xcEYFKIbEpQyJubm1ljY6NW1YoKOKYnav1cLseenzG4Sye5LGjnTU1N/P7+noc5tbW1afGQlr7Hx0fW3t7OHh4eSusN+REkAWAqFwlkAeUiwZWAcpDgWoDtEjwRYLMEzwTYKsFTATZK8FyAbRKMCLBJgjEBtkgwKsAGCcYFhF2CLwLeSnh6esKfxpP4pKp1Dd8EoDUdHR2soaFBq2F+HeSbgK6uLra4uMioDzhMCfFFQHd3N5ufnw8dPKQaF9DT08Pm5uZCCW9cQG9vL5udnTU1ej07r9azM3E1R8f19fUF+siwtbVVt73OwHRE9Pf3BwqPiwcmYGBgIHD4wAQMDg6GAj4QAcPDw6GB913AyMiI5/C3t7dcfO9APq9vc8Do6Ci5kaqKNzc3PJVKcTffQPkiYGxsTMVALr++vub19fWvSxhVgnEB4+PjZEhVxaurK15XV/cKL5dcigSjAiYmJlQM5PLLy0teW1v7CZ4qwZiAyclJMqSqYjabLQpPkdDS0qKUKc9XyPXfCU5NTakYyOUXFxe8pqZGt7HaE6PnAmZmZsiQqorn5+e8urpaG172nM6c4KmAdDqtYiCXn52d8aqqKsfwuhI8ESCe3nDxWZ4Mqap4enrqCl5HgmsBgBePsFQM5PKTkxOeTCbJPS/hZa66HVwJAPzS0hIZUlXx+PjYU/hiElwJ6OzsVDGQy4+OjnhlZaVnPS/hZf5xJLgS4PXwPzg44IlEwhj8/yS4EoATQsLy8jK5x2XFvb09X+A/SnAtQEpYXV2VLI7z3d1dHo/Hjfe8hJc5bgfxY07d6xZ/JxiLxfj6+rpj+O3t7UDgpQQHeXEBOBEkbG5uakvY2tqyBR6jpLQAKSGTyZSUsLGxkReme94QHKcnAA3F/byzs6OUsLa2Zhu8/giQPQUJmNw+ppWVlfzKIY+zKHe+NxBr+v7+/qsDvGvEsmkRtGxr/vf02DIjC7RzSDg8POQLCwu2woP1p4j8jkpt8LeyIMHSnpe809jOEeltcxgBSJHdOPmC/7KNNNJbZyECe2kxEiK5eRoCZMKcEJnt8/8AtqIJGXRoCukAAAAASUVORK5CYII=)","background-size":"cover"}).appendTo(e)},widgetCoverImage:function(e){return e?e.replace("/play/","/cover/"):null}}}(n(11),n(9),n(167),n(0),n(74))},,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"spellCheckAttribs",function(){return l}),n.d(t,"spellCheckAttribString",function(){return d});var r=n(196),o=n.n(r),a=n(13),i=n.n(a),s={spellcheck:"true",autocomplete:"new-password",autocapitalize:"none"},c={spellcheck:"false",autocorrect:"off",autocomplete:"new-password",autocapitalize:"none"};function l(e){return o()({name:Date.now()+Math.random()},e?s:c)}function d(e){var t=l(e);return i()(t,function(e,t){return t+'="'+e+'"'}).join(" ")}},,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"replaceParamsBySessionLink",function(){return i}),n.d(t,"valueOrCacheValue",function(){return s});var r=n(13),o=n.n(r),a=["backbutton","backlink","q"];function i(e){if(""===e)return e;if("undefined"==typeof sessionStorage)return e;var t=e.substring(1).split("&"),n="cache_"+(new Date).getTime()+"_";return"?"+o()(t,function(e){for(var t=0;t<a.length;++t)if(e.startsWith(a[t]+"=")&&!e.startsWith(a[t]+"=cache_")){var r=n+t;return sessionStorage.setItem(r,decodeURIComponent(e.substring(a[t].length+1))),a[t]+"="+r}return e}).join("&")}function s(e){return null==e?e:e.startsWith("cache_")?sessionStorage.getItem(e):e}},function(e,t){e.exports=function(e){var t="file:";window&&window.location&&window.location.protocol&&(t=window.location.protocol);var n="";return 0===e.indexOf("http://")?n="http://":0===e.indexOf("https://")?n="https://":0===e.indexOf("//")&&(n="//"),""!==n?"file:"===t?"//"===n?"http:"+e:e:"http:"===t?"//"===n?"http:"+e:e:"https:"===t&&"http://"===n?e.replace("http://","https://"):"//"===n?"https:"+e:e:e}},,,function(e,t,n){var r=n(22).map;e.exports={url:function(e,t){var n="js2objc://"+e;return t&&(n+="?"+r(t,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")),n}}},function(e,t,n){e.exports=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e(document.createElement("div")).addClass("bw-throbber-wrapper bw-centering-container").appendTo(t),a=e(document.createElement("canvas")).addClass("bw-throbber bw-centered").attr({width:n,height:n}).appendTo(o),i=a[0].getContext("2d");i.translate(n/2,n/2);for(var s=30*n/100,c=0;c<s;++c){i.rotate(2*-Math.PI/s);var l=r?0:255;i.strokeStyle="rgba("+l+","+l+","+l+","+(1/s).toFixed(2)+")",i.lineWidth=3,i.moveTo(n/5,0),i.lineTo(2*n/5,0),i.stroke()}var d=null,u=!1;return window.requestAnimationFrame(function e(t){if(d||(d=t),!u){var n="rotate("+360*Math.floor(t/1e3*s)/s+"deg)";a.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n}),window.requestAnimationFrame(e)}}),{close:function(){o.remove(),u=!0}}}}(n(0))},function(e,t,n){e.exports=function(e){var t={},n=null,r=[];function o(){0!=r.length?(n=r.shift())():n=null}return t.pushAsyncFunc=function(t){var a=e.Deferred();return r.push(function(){t().always(function(){a.resolve(),o()})}),null===n&&o(),a},t.pushSyncFunc=function(t){this.pushAsyncFunc(function(){return t(),e.when()})},t}(n(0))},function(e,t,n){var r=function(e,t,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(176),i=!1;function s(t){var n=r.Deferred();return a.remove(t,function(t){return null===t||t.code==e.BWDS_ERROR_UNKNOWN?n.resolve():(console.log("Remove failed: "+JSON.stringify(t)),n.reject()),n}),n}function c(n,s,c){var l=r.Deferred();return a.write(n,s,function(n){if(null===n)l.resolve();else{if(c&&!1===i){if(n.code==e.BWDS_ERROR_SECURITY){var r=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===r||"ibw-platform-ipad-ibooks"===r?o.showCriticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+r.getIOSIBooksRestartInfo(),"Storage error"):o.showCriticalAlert("Storing answers not supported on this platform.","Storage error")}else o.showCriticalAlert("Could not save your answer.","Storage problem");i=!0}console.log("Save failed"),l.reject()}}),l}function l(n,s){var c=r.Deferred();return a.read(n,function(n,r){if(null===n)r?c.resolve(r):(console.log("How did this happen?  No saved data on read!"),c.reject({}));else{if(s&&!1===i)if(n.code==e.BWDS_ERROR_SECURITY){var a=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===a||"ibw-platform-ipad-ibooks"===a?o.showCriticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+a.getIOSIBooksRestartInfo(),"Storage error"):o.showCriticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0}else n.code!=e.BWDS_ERROR_UNKNOWN&&(console.log("Error "+n.code+" occurred while loading data: "+n.message),o.showCriticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0);c.reject({})}}),c}function d(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}return{createWidgetStorage:function(e,t,n,o,i,u,p){var f={},h=""==i?"":i+"/";function g(){return h+"books/"+e+"/"+t+"/"+n}var m={};function v(e){return g()+"/img/"+e}return f.loadAll=function(e){var t,n;o?l(g()+u,p).done(e).fail(function(){e(null)}):""!==i?l(g(),p).always(function(t){try{var n=JSON.parse(t);m=n,e(JSON.parse(t))}catch(t){console.log("Can't parse bwds user data"),console.log(t),e(m)}}):(t=g(),n=r.Deferred(),a.dir(t,function(e,t){null===e?n.resolve(t):n.reject(e)}),n).done(function(t){var n={},o=[];function i(e,t,r){a.read(e+"/"+t,function(e,o){null===e?n[t]=o:console.log("Received error reading: "+t),r.resolve()})}for(var s=0;s<t.length;++s){var c=r.Deferred();o.push(c),i(g(),t[s],c)}r.when.apply(null,o).done(function(){e(n)})}).fail(function(t){e({})})},f.write=function(e,t){if(o)null===e?s(g()+u).always(t):c(g()+u,e,p).always(t);else if(""!==i)m=d(m,e),c(g(),JSON.stringify(m),p).always(t);else{var n=[];for(var a in e){var l=e[a];null===l?n.push(s(g()+"/"+a)):n.push(c(g()+"/"+a,l,p))}r.when.apply(null,n).always(t)}},f.overwriteAndSetVersion=function(e,t){var n=r.Deferred();if(o)null===e?s(g()+u).always(function(){n.resolve()}):c(g()+u,e,p).always(function(){f.setVersion(t).always(function(){n.resolve()})});else if(""!==i){var a=JSON.stringify(e);m=JSON.parse(a),c(g(),a,p).always(function(){f.setVersion(t).always(function(){n.resolve()})})}else console.error("bwds_storage_if.overwriteAndSetVersion not implemented for this storage mode... only intended for local caching"),n.reject();return n},f.setVersion=function(e){var t=r.Deferred(),n=g();return o&&(n+=u),a.stat(n,function(r,o,i){null===r?a.setStat(n,{backup_date:o.modified,backup_version:e},function(e){null===e?t.resolve():(console.log("Problem writing stat: "+JSON.stringify(e)),t.reject())}):(console.log("Got error reading stat for "+n+": means offline mode won't work"),t.reject())}),t},f.getVersion=function(e){var t=g();o&&(t+=u),a.stat(t,function(t,n,r){null===t?e({version:n.backup_version,offlinedata:n.backup_date!=n.modified,hasdata:!0}):(console.log("Error reading stat... assume there is no data"),e({version:0,offlinedata:!1,hasdata:!1}))})},f.writeImage=function(e,t){return c(v(e),t,p)},f.clearImage=function(e){return s(v(e))},f.isImageBackedUp=function(e){var t=r.Deferred();return a.stat(v(e),function(e,n,r){null===e?t.resolve(n.backup_date==n.modified):t.reject()}),t},f.listImagesAndBackupStatus=function(){var e=r.Deferred();return a.stat(g()+"/img",function(t,n,r){if(null===t){for(var o=[],a=0;a<r.length;++a){var i=r[a].name;o.push({id:i.substring(i.lastIndexOf("/")+1),backed_up:r[a].backup_date===r[a].modified})}e.resolve(o)}else e.resolve([])}),e},f.setImageBackedUp=function(e){var t=r.Deferred();return a.stat(v(e),function(n,r,o){null===n?a.setStat(v(e),{backup_date:r.modified},function(e){null===e?t.resolve():t.reject()}):t.reject()}),t},f.readImage=function(e){return l(v(e),p)},f.sync=function(e){a.executeSync(e)},f},createInfoStorage:function(e,t,n){var r={},o={},a={};function i(e){return(""==t?"":t+"/")+"info/"+e}return l(i("BWCommon"),n).always(function(e){try{o=JSON.parse(e)}catch(e){o={}}}),l(i(e),n).always(function(e){try{a=JSON.parse(e)}catch(e){a={}}}),r.getCommonProperties=function(e){e(o)},r.getGroupProperties=function(e){e(a)},r.setCommonProperties=function(e){o=d(o,e),c(i("BWCommon"),JSON.stringify(o),n)},r.setGroupProperties=function(t){a=d(a,t),c(i(e),JSON.stringify(a),n)},r}}}.bind(null,n(54),n(2),n(0),n(9));e.exports={f:r,o:r()}},,,,,,,function(e,t){e.exports=window.$},,function(e,t,n){(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(r,o){"use strict";"function"==typeof bwdefine?bwdefine("bw/whiteboard_drawing",["bw/color-maps"],o):"object"===t(e)&&e.exports&&(e.exports=o(n(195)))}(0,function(e){"use strict";function t(e){return e.substr(2)}function n(t){return"background"===t?"background":e&&e.light.hasOwnProperty(t)?e.light[t]:t}function r(e){return"C,"+n(e)}return{transformToRgbColors:function(e){var n=[];try{for(var o=e.split("\n"),a=0;a<o.length;++a){var i=o[a];if("C"===i[0]){var s=t(i);n.push(r(s))}else n.push(i)}}catch(e){console.log("Exception ransforming drawing to rgb"),console.log(e)}return n.join("\n")},create:function(){var e=[],r=0;function o(){r<e.length-1&&e.splice(r+1,e.length-1-r),e[r].objectpointer<e[r].objects.length&&e[r].objects.splice(e[r].objectpointer,e[r].objects.length-e[r].objectpointer)}function a(t){return o(),e[r].objects.push(t),++e[r].objectpointer,t}function i(e,t,n){return a({type:"line",points:e,color:t,linewidth:n})}function s(e,t,n,r,o){return a({type:"text",x:e,y:t,text:n,color:r,fontsize:o})}function c(e,t,n,r,o,i,s){return a({type:"photo",img:e,imgsrc:t,dx:n,dy:r,w:o,h:i,rad:s})}function l(e){return parseInt(e.substr(2))}function d(e){return parseInt(e.substr(2))}function u(e,t,n){for(var r=e.split(","),o=[],a=1;a<r.length;++a){var s=r[a].split(":");2!==s.length?console.log("Invalid point when reading whiteboard line: "+r[a]):o.push({x:parseInt(s[0]),y:parseInt(s[1])})}i(o,t,n)}function p(e,t,n){var r=e.split(",");r.shift(),s(parseInt(r.shift()),parseInt(r.shift()),r.join(","),t,n)}function f(e,t,n){var r=e.split(",");r.shift();var o=parseInt(r.shift()),a=parseInt(r.shift()),i=parseInt(r.shift()),s=parseInt(r.shift()),l=parseFloat(r.shift()),d=new Image;d.onload=function(){n()},d.error=function(){n(!0)};var u=r.join(",");t(u,function(e){"data:"!==e.substr(0,5)&&(d.crossOrigin="Anonymous"),d.src=e}),c(d,u,o,a,i,s,l)}function h(e){return"C,"+e}function g(e){return"W,"+e}function m(e){return"S,"+e}function v(e){var t=[];t.push("L");for(var n=0;n<e.points.length;++n)t.push(e.points[n].x+":"+e.points[n].y);return t.join(",")}function w(e){return"T,"+e.x+","+e.y+","+e.text}function b(e){return"P,"+e.dx+","+e.dy+","+e.w+","+e.h+","+e.rad+","+e.imgsrc}function y(e,t,r,o){e.beginPath(),e.fillStyle=n(r),e.arc(t.x,t.y,o/2,Math.PI/180*0,Math.PI/180*360,!1),e.fill()}function C(e,t,r){!function(e,t,r,o,a){if(e.save(),"background"!==r){y(e,t[0],r,o),e.beginPath(),e.strokeStyle=n(r),e.lineWidth=o,e.moveTo(t[0].x,t[0].y);var i=0;for(i=1;i<t.length-2;i++){var s=(t[i].x+t[i+1].x)/2,c=(t[i].y+t[i+1].y)/2;e.quadraticCurveTo(t[i].x,t[i].y,s,c)}t.length>2?e.quadraticCurveTo(t[i].x,t[i].y,t[i+1].x,t[i+1].y):e.lineTo(t[i].x,t[i].y),e.stroke(),y(e,t[t.length-1],r,o)}else for(i=0;i<t.length;i++)a(e,t[i].x,t[i].y);e.restore()}(t,e.points,e.color,e.linewidth,r)}function k(e,t){t.font=e.fontsize+"px Arial",t.fillStyle=n(e.color),t.fillText(e.text,e.x,e.y)}function T(e,t){if(t.save(),t.translate(e.dx,e.dy),t.rotate(e.rad),!0===e.img.complete)try{t.drawImage(e.img,-e.w/2,-e.h/2,e.w,e.h)}catch(e){console.log("Can't draw image... no clue why..."+e)}else t.fillStyle="#E0E0E0",t.fillRect(-e.w/2,-e.h/2,e.w,e.h),t.strokeStyle="black",t.strokeRect(-e.w/2,-e.h/2,e.w,e.h),t.font="16px Arial",t.fillStyle="black",t.textAlign="center",t.textBaseline="middle",t.fillText("Can't load image",0,0);t.restore()}function x(e,t){return{x1:Math.min(e.x1,t.x1),x2:Math.max(e.x2,t.x2),y1:Math.min(e.y1,t.y1),y2:Math.max(e.y2,t.y2)}}function _(e){for(var t={x1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y1:Number.MAX_VALUE,y2:-Number.MAX_VALUE},n=0;n<e.points.length;++n){var r=e.points[n];if(isNaN(r.x)||isNaN(r.y))throw Object();t.x1=Math.min(t.x1,r.x),t.x2=Math.max(t.x2,r.x),t.y1=Math.min(t.y1,r.y),t.y2=Math.max(t.y2,r.y)}return t}function S(e,t){t.save(),t.font=e.fontsize+"px Arial";var n=t.measureText(e.text);return t.restore(),{x1:e.x,x2:e.x+n.width,y1:e.y-e.fontsize,y2:e.y}}return e.push({objects:[],objectpointer:0}),{clearPage:function(){o(),e.push({objects:[],objectpointer:0}),++r},isEmpty:function(){return 0===e[r].objectpointer},addLine:i,addText:s,addPhoto:c,load:function(e,n,r){try{for(var o="",a=0,i=0,s=e.split("\n"),c=0;c<s.length;++c){var h=s[c];"C"===h[0]?o=t(h):"W"===h[0]?a=l(h):"S"===h[0]?i=d(h):"L"===h[0]?u(h,o,a):"T"===h[0]?p(h,o,i):"P"===h[0]?f(h,n,r):(console.log("Invalid line when reading whiteboard data"),console.log(h))}}catch(e){console.log("Error loading whiteboard data"),console.log(e)}},save:function(){for(var t=[],n="",o=0,a=0,i=0;i<e[r].objectpointer;++i){var s=e[r].objects[i];"line"===s.type?(s.color!==n&&(n=s.color,t.push(h(n))),s.linewidth!==a&&(a=s.linewidth,t.push(g(a))),t.push(v(s))):"text"===s.type?(s.color!==n&&(n=s.color,t.push(h(n))),s.fontsize!==o&&(o=s.fontsize,t.push(m(o))),t.push(w(s))):"photo"===s.type&&t.push(b(s))}return t.join("\n")},undo:function(){e[r].objectpointer>0?--e[r].objectpointer:r>0&&--r},redo:function(){e[r].objectpointer<e[r].objects.length?++e[r].objectpointer:r<e.length-1&&++r},drawToContext:function(t,n){n=n||function(e,t,n){e.clearRect(t,n,20,20)};for(var o=0;o<e[r].objectpointer;++o){var a=e[r].objects[o];"line"===a.type?C(a,t,n):"text"===a.type?k(a,t):"photo"===a.type&&T(a,t)}},bounds:function(t){if(0===e[r].objectpointer)return{x1:0,x2:0,y1:0,y2:0};for(var n,o,a={x1:Number.MAX_VALUE,x2:-Number.MAX_VALUE,y1:Number.MAX_VALUE,y2:-Number.MAX_VALUE},i=0;i<e[r].objectpointer;++i){var s=e[r].objects[i];if("line"===s.type){if(s.points.length>0)try{a=x(a,_(s))}catch(e){console.log("Ignoring bounds for invalid line"),console.log(s)}}else"text"===s.type?a=x(a,S(s,t)):"photo"===s.type&&(a=x(a,(n=s,o=void 0,o=Math.sqrt(n.w*n.w+n.h*n.h)/2,{x1:n.dx-o,x2:n.dx+o,y1:n.dy-o,y2:n.dy+o})))}return a}}}}})}).call(this,n(14)(e))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){var n;e.exports={_creds:n={username:null,userid:null,email:null,providerid:null,providerhumanid:null,provider:null,school:null,token:null,sid:null,coaccount:null},credentials:function(){return this._creds},clear:function(){this._creds=n},setCredentials:function(e){this._creds=e},getUserToken:function(){return this._creds.token},getUserSid:function(){return this._creds.sid},getUserName:function(){return this._creds.username},getUserClassName:function(){return this._creds.className},getUserId:function(){return this._creds.userid},getEmail:function(){return this._creds.email},getProviderId:function(){return this._creds.providerid},getProviderHumanId:function(){return this._creds.providerhumanid},isCoAccount:function(){return this._creds.coaccount}}},function(e,t){e.exports=window.Hammer},function(e,t,n){"use strict";n.r(t),t.default=function(e){return"undefined"==typeof window||window.navigator&&window.navigator.userAgent&&(window.navigator.userAgent.indexOf("PhantomJS")>=0||window.navigator.userAgent.indexOf("ibookwidgets")>=0)?e:(new window.DOMParser).parseFromString("<html>"+e+"</html>","text/html").documentElement.textContent}},,,,function(e,t){e.exports={GetItem:function(e){return localStorage.getItem(e)},RemoveItem:function(e){localStorage.removeItem(e)},SetItem:function(e,t){localStorage.setItem(e,t)},Clear:function(){localStorage.clear()}}},function(e,t,n){var r=n(111);e.exports=function(e,t){var o=n(26).createLogger("NativeSQLAsyncKeyStore"),a=new e;a.startListening();return function(e){e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var t={};function n(e){var t=String.fromCharCode(29);return(e=e.map(function(e){return e.replace(new RegExp(",","g"),t)})).join()}return t.resultForCallback=function(e,t){a.processCallback(e,t)},t.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t.callObjC=function(n,o,i,s){var c=r.url(n,o),l=a.registerCallbacks(i,s),d="'"+l.ok+"'",u="'"+l.error+"'",p="BWKSNativeSQL.resultForCallback";t.runningInIframe()&&(p="function BWKSNativeSQL_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; BWKSNativeSQL_callback_wrapper"),e(c+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+p)},t.getItemsAsync=function(e,r,a){if(0==e.length)return o.error("NativeSQL Error: getItemsAsync without names"),void a({message:"NativeSQL Error: getItemsAsync without names"});t.callObjC("getItemsAsync",{names:n(e)},r,a)},t.getDirAttribs=function(e,n,r){t.callObjC("getDirAttribsAsync",{dirname:e},n,r)},t.setItemsAsync=function(e,n,r){if(0==e.length)return o.error("NativeSQL Error: setItemsAsync without names"),void r({message:"setItemsAsync without names"});if(e.length>1)return o.error("NativeSQL Error: setItemsAsync can only handle 1 item"),void r({message:"setItemsAsync can only handle 1 item"});var a=e[0];t.callObjC("setItemAsync",{keyname:a.key,value:a.value,attribs:a.attribs},n,r)},t.removeItemsAsync=function(e,r,a){if(0==e.length)return o.error("NativeSQL Error: removeItemsAsync without names"),void a({message:"NativeSQL Error: removeItemsAsync without names"});t.callObjC("removeItemsAsync",{names:n(e)},r,a)},t}}(n(76))},function(e,t,n){var r,o;e.exports=(r=n(381),n(11),(o=function(e,t,n,o){this.sender=new r(e,"*"),this.useSessionStorage=o,this.token=n}).prototype.postMessage=function(e,t,n){this.token&&(e.token=this.token),this.useSessionStorage&&(e.useSessionStorage=!0),this.sender.send(e,function(e,r){return e?n(e):t(r)})},o.prototype.getItemsAsync=function(e,t,n){this.postMessage({command:"getItems",names:e},t,n)},o.prototype.setItemsAsync=function(e,t,n){this.postMessage({command:"setItems",items:e},t,n)},o.prototype.removeItemsAsync=function(e,t,n){this.postMessage({command:"removeItems",names:e},t,n)},o.prototype.clearAllAsync=function(e,t){this.postMessage({command:"clear"},e,t)},o.prototype.getDirAttribs=function(e,t,n){this.postMessage({command:"getDirAttribs",name:e},t,n)},o)},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f,h,g,m,v,w;e.exports=(r=n(2),o=n(177).o,a=n(388),i=n(389),s=n(174),c=n(175),n(54),l=n(426),u=new(n(427))(o),p=new a,f=new l(p),h=new i,g=new l(h),m=new s,v=new l(m),w=r.getPlatform(),-1!==window.location.search.substring(1).indexOf("bwds-proxy")?(d=new l(new c("_storage")),console.log("BWDS: Proxy")):"ibw-platform-ipad-bookwidgets"===w?(d=v,window.BWKSNativeSQL=m,console.log("BWDS: Native")):"ibw-platform-ipad-ibooks"===w?(console.log("BWDS: IndexedDB"),d=g):"ibw-platform-osx-chrome"!==w&&"ibw-platform-osx-preview"!==w&&"ibw-platform-win32-preview"!==w&&"ibw-platform-win32-chrome"!==w&&"ibw-platform-chromebook-chrome"!==w&&"ibw-platform-android-chrome"!==w||!window.openDatabase?(d=u,console.log("BWDS: Local")):(console.log("BWDS: WebSQL"),d=f),d.test={BWKSIDB:h,BWKSWebSQL:p,BWDSLocal:u,BWDSWebSQL:f},-1!==navigator.userAgent.indexOf("ibookwidgets")&&(window.BWDS=d),d)},function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(173);function r(e){return"iBookWidgets/"+e}var o=e.createLogger("BWKSLocal");return{getItem:function(e){return o.debug("getItem "+r(e)),t.GetItem(r(e))},setItem:function(e,n){o.debug("setItem "+r(e));try{return t.SetItem(r(e),n),!0}catch(e){return!1}},removeItem:function(e){o.debug("removeItem "+r(e)),t.RemoveItem(r(e))},clear:function(){o.debug("clear"),t.Clear()}}}.bind(null,n(26));e.exports={f:r,o:r()}},,,,,,,,,,,,,,function(e,t,n){e.exports=function(e){var t={},n=function(e){return e<10?"0"+e:""+e};function r(e){var t=Array.prototype.slice.call(arguments,1);try{e&&e.apply(null,t)}catch(e){console.log("Received error when executing callback: "+e)}}return t.getDateTime=function(){var e=new Date;return n(e.getFullYear())+"-"+n(1+e.getMonth())+"-"+n(e.getDate())+" "+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())},t.error=function(e,t){return{code:e,message:t}},t.trimLeadingSlash=function(e){return e.length>0&&"/"==e[0]?e.substr(1):e},t.newCallbackQueue=function(){var e={executeList:[],executing:!1,executeNext:function(){e.executeList.length>0?(e.executing=!0,e.executeList.shift().cb(e.executeNext)):e.executing=!1},executeSequential:function(t,n){if(null!=n&&!1!==n&&null!=n&&e.executeList.length>0)for(var r=0;r<e.executeList.length;++r)e.executeList[r].tag==n&&e.executeList.splice(r,1);e.executeList.push({cb:t,tag:n}),e.executing||e.executeNext()}};return e},t.callSafe=r,t.handleException=function(n,o,a){18==n.code?r(o,t.error(e.BWDS_ERROR_SECURITY,"AsyncBWDS Security Error: problem when accessing: "+JSON.stringify(n))):r(o,t.error(e.BWDS_ERROR_INTERNAL,"AsyncBWDS Error: problem when accessing: "+JSON.stringify(n))),a&&a()},t}(n(54))},function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(49).o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(428).o,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(114).o;return{createWidgetStorage:function(n,a,i,s,c,l,d,u,p,f,h){var g={};return g.os=r.createWidgetStorage(a,i,s,c,u,p,f,h),g.bs=o.createWidgetStorage(n,a,s,c,t.getUserId(),d,!1),g.loadAll=function(t){var n=e.Deferred(),r=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){r.resolve(e)});var o=this;e.when(n,r).done(function(e,n){var r=e[0],a=e[1];-1==a?(console.log("error accessing online data, return local data or null"),n.hasdata?o.bs.loadAll(t):t(c?null:{})):!1===n.offlinedata||n.version<a?o.bs.overwriteAndSetVersion(r,a).always(function(){t(r)}):o.bs.loadAll(function(e){o.os.overwrite(e,function(n){o.bs.setVersion(n.version).always(function(){t(e)})})})})},g.goneOnlineSync=function(t){var n=e.Deferred(),r=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){r.resolve(e)});var o=this;e.when(n,r).done(function(e,n){var r=e[0],a=e[1];-1==a?console.log("goneOnlineSync: Can't find online version"):n.version<a?(console.log("goneOnlineSync: local version out of date, need to use online version"),o.bs.overwriteAndSetVersion(r,a).always(function(){t({status:"CONFLICT",data:r})})):!0===n.offlinedata?(console.log("goneOnlineSync: latest version is local, pushing state online"),o.bs.loadAll(function(e){o.os.overwrite(e,function(e){o.bs.setVersion(e.version).always(function(){t({status:"OK"})})})})):t({status:"OK"})})},g.write=function(e,t){var n=this;n.bs.write(e,function(){n.os.write(e,function(e){void 0!==e&&e.hasOwnProperty("data")?n.bs.overwriteAndSetVersion(e.data,e.version).always(function(){t(e)}):t(e)})})},g.writeImage=function(t,n){var r=e.Deferred(),o=this;return o.bs.writeImage(t,n).done(function(){r.resolve(),o.os.writeImage(t,n).done(function(){o.bs.setImageBackedUp(t)}).fail(function(){})}).fail(function(){o.os.writeImage(t,n).done(function(){r.resolve()}).fail(function(){r.reject()})}),r},g.clearImage=function(t){var n=e.Deferred();return e.when(this.bs.clearImage(t),this.os.clearImage(t)).done(function(){n.resolve()}).fail(function(){n.reject()}),n},g.readImage=function(t){var n=e.Deferred(),r=this;return r.bs.readImage(t).done(function(e){n.resolve(e)}).fail(function(){r.os.readImage(t).done(function(e){n.resolve(e)}).fail(function(){n.reject()})}),n},g.moveImageOnline=function(t){var n=e.Deferred(),r=this;return r.bs.readImage(t).done(function(e){r.os.writeImage(t,e).done(function(){r.bs.setImageBackedUp(t),n.resolve()}).fail(function(){n.reject()})}).fail(function(){n.reject()}),n},g.moveImageOnlineIfRequired=function(){var t=e.Deferred(),n=this;return n.bs.listImagesAndBackupStatus().done(function(e){for(var r=0;r<e.length;++r)if(!1===e[r].backed_up)return void n.moveImageOnline(e[r].id).done(function(){t.resolve(!0)}).fail(function(){t.reject()});t.resolve(!1)}),t},g},createInfoStorage:function(e,n,r){var a={};return a.bs=o.createInfoStorage(e,t.getUserId(),!1),a.getCommonProperties=function(e){this.bs.getCommonProperties(function(t){e(t)})},a.getGroupProperties=function(e){this.bs.getGroupProperties(function(t){e(t)})},a.setCommonProperties=function(e){this.bs.setCommonProperties(e)},a.setGroupProperties=function(e){this.bs.setGroupProperties(e)},a}}}.bind(null,n(0));e.exports={f:r,o:r()}},function(e,t,n){e.exports=function(e,t,n){return function(n){var r=n.tablediv,o=n.tabledata,a=n.hasOwnProperty("calculate")?n.calculate:function(){},i=!!n.hasOwnProperty("support_correction_colors")&&n.support_correction_colors;function s(e){if(0===e.length)throw new Error("too little params");var t=e[0];return e.shift(),t}function c(e){if(0===e.length)throw new Error("too little params");if(isNaN(e[0]))throw new Error("wrong param type, not int");var t=parseInt(e[0]);return e.shift(),t}function l(e,t){return e.length>0&&e[0]===t&&(e.shift(),!0)}function d(e,t,n){if(""===e)return"";var r=function(e,t){var n=Math.pow(10,t||0);return String(Math.round(e*n)/n)}(e,t);return n&&(r=String(r).split("").reverse().join("").replace(/(\d{3}\B)/g,"$1,").split("").reverse().join("")),r}function u(e,t){if(isNaN(e))return e;var n,r,o,a,i=e,u=t.split(", ");try{if("number"===(n=s(u)))i=d(e,r=c(u),o=l(u,"ts"));else if("percentage"===n)i=d(100*e,r=c(u),o=l(u,"ts")),i+="%";else if("currency"===n){r=c(u),o=l(u,"ts"),a=s(u);var p=l(u,"post");i=d(e,r,o),p?i+=a:i=a+i}}catch(e){console.log("Error parsing format: "+e)}return i}t(document.createElement("div")).addClass("styledtablehidden").css("display","none").appendTo(t(r).parent());var p=null,f=null;function h(e,t,n){for(var r=0;r<e.length;++r){var o=e[r];if(o.row===t&&o.column===n)return o}return null}for(var g=function(n,a,s,c,l,d,g){var m=t(a),v={},w=o.values[s][c];w.hasOwnProperty("CellFormat")&&(d=u(d,w.CellFormat),m.find(".bw-table-cell-contents").safeHtml(d));for(var b=["font-family","font-weight","font-style","font-variant","font-size"],y=0;y<b.length;++y){var C=b[y];w.hasOwnProperty(C)&&(v[C]=w[C])}if(w.hasOwnProperty("font-size")&&(v["line-height"]=Math.max(parseInt(w["font-size"]),21)+"px"),i&&w.hasOwnProperty("CellRole")&&("checked"===w.CellRole||"input"===w.CellRole)){if(p){var k=h(p.correctioninfo,s,c);if(k&&k.answer!==d&&(k=h((p=f()).correctioninfo,s,c)),k)if(1===k.correctness)m.addClass("cell_correct").removeClass("cell_wrong"),m.find(".bw-table-cell-contents").append(" &#x2713;");else if(-2!==k.correctness&&k.correct){var T=k.correct.split(/\|\||##/),x=1===T.length?k.correct:T.join(" / ");m.addClass("cell_wrong").removeClass("cell_correct").find(".bw-table-cell-contents").append(t(document.createElement("span")).addClass("cell_right_value").safeHtml(" ("+x+")")),0===k.correctness&&m.find(".cell_right_value").append(" &#x2718;")}else m.addClass("cell_open")}}else w.hasOwnProperty("BackgroundColor")&&(v.background=w.BackgroundColor,v["background-clip"]="padding-box"),w.hasOwnProperty("TextColor")&&(v.color=w.TextColor);if(w.hasOwnProperty("HAlign")&&(v["text-align"]=w.HAlign),w.hasOwnProperty("VAlign")&&(v["vertical-align"]=w.VAlign),w.hasOwnProperty("BorderLeft")&&(v["border-left"]=w.BorderLeft),w.hasOwnProperty("BorderRight")&&(v["border-right"]=w.BorderRight),w.hasOwnProperty("BorderTop")&&(v["border-top"]=w.BorderTop),w.hasOwnProperty("BorderBottom")&&(v["border-bottom"]=w.BorderBottom),o.hasOwnProperty("layout")&&o.layout.hasOwnProperty("rows")&&(v.height=o.layout.rows[s].height+"px"),m.css(v),w.hasmath){var _=t(r).parent().find("#cell_"+s+"_"+c).clone();_.removeAttr("id"),m.empty().append(_),e.processMathElems(m)}},m=o&&o.values?o.values:[],v=function(n){for(var o=[],a=n||[],i=0;i<a.length;++i){for(var s=a[i],c=[],l=0;l<s.length;++l){var d=s[l];if(!d.hasOwnProperty("CellRole")||"calculated"!==d.CellRole&&"checked"!==d.CellRole)if(d.hasOwnProperty("CellRole")&&"readonly"===d.CellRole){var u=e.prepare(d.value);u!==d.value?(t(document.createElement("span")).attr("id","cell_"+i+"_"+l).safeHtml(u).appendTo(t(r).parent().find(".styledtablehidden")),d.hasmath=!0,c.push(u)):c.push(d.value)}else c.push(d.value);else c.push("")}o.push(c)}return o}(m),w=t.extend(!0,[],v),b=0,y=o&&o.layout&&o.layout.columns?o.layout.columns:[],C=0;C<y.length;++C)b+=y[C].width;for(C=0;C<m.length;++C)for(var k=m[C],T=0,x=0,_=0;_<k.length;++_){if((A=k[_]).hasOwnProperty("BorderTop")){var S=parseInt(A.BorderTop);S>T&&(T=S)}if(A.hasOwnProperty("BorderBottom")){var E=parseInt(A.BorderBottom);E>x&&(x=E)}}for(_=0;_<y.length;++_){var I=0,O=0;for(C=0;C<m.length;++C){var A;if((A=o.values[C][_]).hasOwnProperty("BorderLeft")){var q=parseInt(A.BorderLeft);q>I&&(I=q)}if(A.hasOwnProperty("BorderRight")){var P=parseInt(A.BorderRight);P>O&&(O=P)}}b+=I+O}var D={};D.data=v,D.table_change_callbacks=[],D.setChangeCallBack=function(e){this.table_change_callbacks.push(e)},D.callChangeCallbacks=function(){for(var e=0;e<this.table_change_callbacks.length;++e)this.table_change_callbacks[e]()};var N={data:v,asyncRendering:!1,stretchH:"none",onChange:function(e,n){a(),t(r).bwtable("render"),D.callChangeCallbacks()},maxColumns:o&&o.layout&&o.layout.colums?o.layout.columns.length:0,cells:function(e,t,n){var r={renderer:g};return!o.values[e][t].hasOwnProperty("CellRole")||"readonly"!==o.values[e][t].CellRole&&"calculated"!==o.values[e][t].CellRole||(r.readOnly=!0),r},width:b,spellcheck:n.spellcheck};if(o&&o.layout&&o.layout.columns){var R=[];for(y=o.layout.columns,C=0;C<y.length;++C)R.push(y[C].width);N.colWidths=R}return t(r).bwtable(N),D.setData=function(e){for(var n=o&&o.values?o.values:[],i=0;i<e.length;++i){var s=e[i];if(n[s.row]&&n[s.row][s.column]){var c=n[s.row][s.column];c.hasOwnProperty("CellRole")&&"checked"!==c.CellRole&&"input"!==c.CellRole||(v[s.row][s.column]=s.value)}}a(),t(r).bwtable("render")},D.getData=function(){for(var e=[],t=o&&o.values?o.values:[],n=0;n<t.length;++n)for(var r=t[n],a=0;a<r.length;++a){var i=r[a];i.hasOwnProperty("CellRole")&&"input"!==i.CellRole&&"checked"!==i.CellRole||(i.hasOwnProperty("CellRole")||v[n][a]!==w[n][a])&&e.push({row:n,column:a,value:v[n][a]})}return e},D.getProgress=function(){for(var e=0,t=0,n=o&&o.values?o.values:[],r=0;r<n.length;++r)for(var a=n[r],i=0;i<a.length;++i){var s=a[i];"input"!==s.CellRole&&"checked"!==s.CellRole||(++e,v[r][i]!==w[r][i]&&++t)}return{inputCellCount:e,changedCellCount:t}},D.clear=function(){for(var e=o&&o.values?o.values:[],n=0;n<e.length;++n)for(var i=e[n],s=0;s<i.length;++s){var c=i[s];c.hasOwnProperty("CellRole")&&"checked"!==c.CellRole&&"input"!==c.CellRole||(v[n][s]="checked"!==c.CellRole?c.value:"")}a(),t(r).bwtable("render"),this.callChangeCallbacks()},D.loadCorrect=function(e){for(var n=0;n<e.values.length;++n)for(var o=e.values[n],a=0;a<o.length;++a){var i=o[a];i.hasOwnProperty("CellRole")&&"checked"===i.CellRole&&(v[n][a]=i.value)}t(r).bwtable("render")},D.render=function(){t(r).bwtable("render")},D.setReadOnly=function(e){t(r).bwtable("updateSettings",{readOnly:e})},D.setCorrectionCallback=function(e){p=(f=e)?f():null,t(r).bwtable("render")},D.getCheckInput=function(){for(var e=[],t=o&&o.values?o.values:[],n=0;n<t.length;++n)for(var r=t[n],a=0;a<r.length;++a){var i=r[a];!i.hasOwnProperty("CellRole")||"input"!==i.CellRole&&"checked"!==i.CellRole||e.push({row:n,column:a,value:v[n][a]})}return e},D.getFormattedValueForCell=function(e,t){var n=o.values[e][t];return n.hasOwnProperty("CellFormat")?u(v[e][t],n.CellFormat):v[e][t]},D.getEmailTable=function(e,t){for(var n='<table border="1" style="border-collapse:collapse">',r=o&&o.values?o.values:[],a=0;a<r.length;++a){n+="<tr>";for(var i=r[a],s=0;s<i.length;++s){var c,l=i[s];if(l.hasOwnProperty("CellRole"))if("checked"===l.CellRole||"input"===l.CellRole){var d=t?h(t.correctioninfo,a,s):null;l.hasOwnProperty("CellFormat")?(c=u(v[a][s],l.CellFormat),e&&d&&(0===d.correctness||-1===d.correctness&&d.hasOwnProperty("correct"))&&(c+=" ("+u(d.correct,l.CellFormat)+")")):(c=v[a][s],e&&d&&(0===d.correctness||-1===d.correctness&&d.hasOwnProperty("correct"))&&(c+=" ("+d.correct+")"))}else c="calculated"===l.CellRole?l.hasOwnProperty("CellFormat")?u(v[a][s],l.CellFormat):v[a][s]:l.value;else c=l.hasOwnProperty("CellFormat")?u(v[a][s],l.CellFormat):v[a][s];var p="padding: 5px;";if(e&&l.hasOwnProperty("CellRole")&&("checked"===l.CellRole||"input"===l.CellRole)){var f=t?h(t.correctioninfo,a,s):null,g=f&&-2===f.correctness,m=f&&1===f.correctness;g?(p+="color:black;",p+="background: #FAAE3C;"):m?(p+="color:green;",p+="background: #C0FFC0;"):(p+="color:red;",p+="background:#FFC0C0;")}else l.hasOwnProperty("BackgroundColor")&&(p+="background:"+l.BackgroundColor+";"),l.hasOwnProperty("TextColor")&&(p+="color:"+l.TextColor+";");l.hasOwnProperty("HAlign")&&(p+="text-align:"+l.HAlign+";"),l.hasOwnProperty("VAlign")&&(p+="vertical-align:"+l.VAlign+";"),l.hasOwnProperty("BorderLeft")&&(p+="border-left:"+l.BorderLeft+";"),l.hasOwnProperty("BorderRight")&&(p+="border-right:"+l.BorderRight+";"),l.hasOwnProperty("BorderTop")&&(p+="border-top:"+l.BorderTop+";"),l.hasOwnProperty("BorderBottom")&&(p+="border-bottom:"+l.BorderBottom+";"),n+='<td style="'+p+'">'+c+"</td>"}n+="</tr>"}return n+="</table>"},D}}(n(3),n(0),n(443))},function(e,t,n){e.exports=function(e){var t=[];function n(e){for(var r=0;r<t.length;++r){0===(a=t[r]).starttime&&(a.starttime=e);var o=e-a.starttime;if(o>=a.duration){a.obj.setTranslate(a.to_x,a.to_y);var a=t.splice(r,1);--r,null!=a[0].callback&&a[0].callback()}else{var i=o/a.duration,s=a.easingfunc(i,o,0,1,a.duration);a.obj.setTranslate(a.from_x+a.delta_x*s,a.from_y+a.delta_y*s)}}t.length>0&&requestAnimationFrame(n)}e.fn.extend({setTranslate:function(e,t){var n="translate("+e+"px ,"+t+"px)";this.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n})},getTranslate:function(){var e=this.css("transform");if(!(e||(e=this.css("-webkit-transform"))||(e=this.css("-ms-transform"))||(e=this.css("-moz-transform"))))return{x:0,y:0};var t=e.indexOf("matrix(");if(-1===t)return{x:0,y:0};var n=e.indexOf(")",t+1);if(-1===n)return{x:0,y:0};var r=e.substring(t+7,n).split(",");return{x:parseInt(r[4]),y:parseInt(r[5])}},animateTranslate:function(r,o,a,i,s){var c=this.getTranslate();t.push({obj:this,duration:a,starttime:0,from_x:c.x,from_y:c.y,to_x:r,to_y:o,delta_x:r-c.x,delta_y:o-c.y,easingfunc:e.easing[i],callback:s}),1===t.length&&requestAnimationFrame(n)}})}(n(0))},function(e,t){e.exports={light:{white:"#FFFFFF",black:"#010539",red:"#D34400",orange:"#F39C12",yellow:"#F1C40F",green:"#13A04E","#00de00":"#13A04E",blue:"#3498DB",purple:"#9B59B6","#bc00de":"#9B59B6",brown:"#A56D47"},dark:{white:"#FFFFFF",black:"#010539",red:"#C0392B",orange:"#E67E22",yellow:"#F39C12",green:"#118C44","#00de00":"#118C44",blue:"#2980B9",purple:"#8E44AD","#bc00de":"#8E44AD",brown:"#8C6239"}}},,,,,function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f;n(201),e.exports=(r=n(1),o=n(242),a=n(243),i=n(330),s=n(4),c=n(0),l=n(25),d=n(7),u=n(484),p=n(40),n(501),f=n(2),void c(function(){r.getConfig().then(function(e){var t,n=c,r=a(o),h=i(e,o,r);function g(){return e.questions?e.questions.length:0}var m,v=0;function w(){C(1)}function b(e,n){if("true"===(n=n||c("#QC"+(e+1))).attr("noquestion"))t.setProgress(e,"done");else{var r=m(n);!0===r.answered?t.setProgress(e,"done"):!1===r.allunanswered?t.setProgress(e,"half"):t.setProgress(e,"")}}function y(){return r.hasSubmitCheckPage()?g()+1:g()}function C(o,a){if(f.isPreview()&&localStorage.setItem("QuizPreviewPage."+e.uuid2,o),c(".active").stop(!0,!0),c("#question-content")[0].scrollTop=0,v!==o){if(v>0&&v<=g()&&b(v-1),o>0&&o<=g()){var i=c("#QC"+o),l=i.attr("cindex"),d=e.questions[l],u=r.getNumbering(d,i.attr("numbering"));"true"!==d.noquestion||"yes"===e.info_numbering?t.setTextAndPosition(c(document.createElement("span")).safeHtml(u),o-1):t.setTextAndPosition(c(document.createElement("div")).addClass("bw-info").text("i"),o-1)}else t.setTextAndPosition(c(document.createElement("div")).addClass("bw-info").text("i"),parseInt(-1));var p=1*v<1*o?900:-900,h="QC"+o,m=n("#"+h);m.css({top:p}).addClass("active"),r.questionIf.hasOwnProperty(h)&&r.questionIf[h].repaint&&r.questionIf[h].repaint(),m.animate({top:0},function(){if(v=o,s.removeAudioElements(),s.replacePlaceholders(".active"),r.questionIf.hasOwnProperty(h)&&r.questionIf[h].repaint&&r.questionIf[h].repaint(),"yes"===e.auto_play_audio){var t=c("#QC"+o+" audio");t.length>0&&t[0].play()}}),n(".quizwidget .question-content").css("overflow-y","hidden"),n("#QC"+v).animate({top:-p},function(){n(this).removeClass("active"),n(this).css("top","0"),n(".quizwidget .question-content").css("overflow-y","auto")}),a&&c(".active").stop(!0,!0),1===o?n(".prevarrow").addClass("bw-icon-hidden"):n(".prevarrow").removeClass("bw-icon-hidden"),o===y()?n(".nextarrow").addClass("bw-icon-hidden"):n(".nextarrow").removeClass("bw-icon-hidden")}}function k(){c("#questions").removeClass("questions_shown").css("left",0).animate({left:c("#questions").width()},function(){c("#questions").safeHtml("").css("left","100%")})}function T(e){C(this.getAttribute("index"),!0),k()}function x(){n("#question-content .content").each(function(){!function(e){var t,n=e.attr("id");try{t=parseInt(n.substring(2))-1}catch(e){console.error("error...")}for(b(t,e);t>0&&"true"===c("#question-content .content[cindex='"+--t+"']").attr("noquestion");)b(t,e)}(c(this))})}window.onresize=function(){c(".quizwidget").trigger("resized")};var _={getWidgetType:function(){return d("Quiz")},questionCount:g,preLoadInit:function(){t=l.createProgressCircle(".progress-container","progress",g()),"right-to-left"===e.direction&&c(".right-container .progress-container").prependTo(".left-container"),p.centerTitle()},getPreSubmitText:function(){return"yes"===e.submit_answers?d("Click the button to submit or go back to review your answers."):"yes"===e.show_answers?d("Click the button to see the correct answers or go back to review your answers."):d("Click the button to see your score or go back to review your answers.")},finishQuestions:function(){if(r.hasSubmitCheckPage()){var t=c(".post-submit"),n=c(document.createElement("div")).addClass("feedbackwrapper bw-centering-container").appendTo(t);c(document.createElement("div")).addClass("bw-centered feedback").append(c(document.createElement("div")).addClass("textdescriptiontitle").safeHtml(d("All done !"))).appendTo(n);var o=c(document.createElement("div")).addClass("textbutton bw-button bw-centered").tapOrClick(function(e){e.preventDefault(),e.stopPropagation(),w()}).appendTo(n);c(document.createElement("span")).css({position:"relative",left:"10px"}).addClass("bw-icon-small bw-icon-angle-left").appendTo(o),c(document.createElement("span")).css({position:"relative",left:"-10px"}).addClass("bw-icon-small bw-icon-angle-left").appendTo(o)}var a=1;if(f.isPreview()){var i=localStorage.getItem("QuizPreviewPage."+e.uuid2);i&&(a=parseInt(i),g()<a?a=1:console.log("Preview starts on page",a))}C(a),setTimeout(function(){c(".quizwidget .question-index .margin").css({"overflow-x":"hidden","overflow-y":"auto"})},100)},postCreateInit:function(){function t(){1!==v&&C(1*v-1)}function o(){v!==y()&&C(1*v+1)}n(".quizwidget .question-content").css("overflow-y","auto"),c(".bw-progress-circle").addClass("bw-button"),c(".bw-progress-circle").makeButton(d("Show question list")).tapOrClick(function(){c("#questions").hasClass("questions_shown")?k():function(){var t,n,o=c("#questions");for(n=0;n<g();++n){var a=c("#QC"+(n+1)),i=a.attr("cindex");if("true"===a.attr("noquestion"))"yes"==e.info_numbering?(""===(t=r.getNumbering(e.questions[i],a.attr("numbering")))&&(t="&nbsp;"),c(document.createElement("div")).addClass("question-button bw-button").attr("index",n+1+"").safeHtml(t).appendTo(o)):c(document.createElement("div")).addClass("question-button bw-button bw-info").attr("index",n+1+"").safeHtml("i").appendTo(o);else{""===(t=r.getNumbering(e.questions[i],a.attr("numbering")))&&(t="&nbsp;");var s=c(document.createElement("div")).addClass("question-button bw-button").attr("index",n+1).safeHtml(t).appendTo(o),l=m(a);!0===r.checkMode&&"yes"===e.show_answers?!0===l.manual?s.addClass("manual"):!0===l.correct?s.addClass("correct"):!0!==l.allunanswered&&s.addClass("wrong"):!0===l.answered&&s.addClass("answered")}}r.hasSubmitCheckPage()&&c(document.createElement("div")).addClass("question-button bw-button bw-info").attr("index",n+1+"").safeHtml("i").appendTo(o),o.addClass("questions_shown").css("left",o.width()).animate({left:0}),c(".question-button").makeButton().tapOrClick(T)}()}),x(),n(".prevarrow").makeButton(d("Previous question")).tapOrClick(function(){n(this).hasClass("bw-icon-hidden")||t()}),n(".nextarrow").makeButton(d("Next question")).tapOrClick(function(){n(this).hasClass("bw-icon-hidden")||o()}),document.onkeydown=function(e){e=e||window.event,c(e.target).is("input, textarea")||("37"==e.keyCode?t():"39"==e.keyCode&&o())},"yes"===e.allow_text_selection&&c("body").addClass("allow_text_selection")},moveToStart:w,moveToSubmitSection:function(){C(g()+1)},setGetQuestionState:function(e){m=e},questionsReset:x};return u(_,r,h),_})}))},function(e,t,n){"use strict";n.r(t);n(202),n(227),n(229),n(233),n(235)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(11),a=n(238),i=a.loadJS,s=a.loadCSS,c=!1,l=!1,d=new RegExp("https://www.bookwidgets.com/create/api/widgets/[0-9]+/preview/config.(css||js)?");function u(e){return 0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets"+e:window.location.host.startsWith("widgets-eu.")?0===e.search(d)?e:window.location.host.replace("widgets-eu.","//widget-assets-eu.")+e:e}t.default=function(){var e=o.split(window.location.search.substring(1));e.dbg5&&n(239)({apiKey:e.dbg5,autoCaptureSessions:!1,notifyReleaseStages:["production"],releaseStage:"production"});var t=r.Deferred();if(!1===l&&!1===c){c=!0;var a=u(e.content)||"config.js",d=u(e.design)||"config.css";r.when(i(a),s(d)).fail(function(){t.reject(new Error("Unable to load config file"))}).always(function(){c=!1,l=!1;var e=window.widgetconfig;t.resolve(e),-1===navigator.userAgent.indexOf("ibookwidgets")&&(window.widgetconfig=void 0)})}return t}},,function(e,t,n){var r=n(0);e.exports={loadJS:function(e,t,n){var o=r.Deferred(),a=document.createElement("script");if(a.setAttribute("type","text/javascript"),n){var i=!0,s=!1,c=void 0;try{for(var l,d=n[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var u=l.value;a.setAttribute(u,n[u])}}catch(e){s=!0,c=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw c}}}return a.onload=function(){o.resolve()},a.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),o.reject()},a.setAttribute("src",e),document.getElementsByTagName(t||"head")[0].appendChild(a),o},loadCSS:function(e,t){var n=r.Deferred(),o=document.createElement("link");return o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.onload=function(){n.resolve()},o.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),n.reject()},o.setAttribute("href",e),document.getElementsByTagName(t||"head")[0].appendChild(o),n}}},,,function(e,t,n){e.exports=function(e){var t=[];window.activateDesignInfoTooltips=function(){console.log("activateDesignInfoTooltips");var n=!0;e.each(t,function(t,r){var o=e(r[0]),a="n";o.height()>700?a=o.offset()&&o.offset().left>800?"e":"w":o.offset()&&o.offset().top>700&&(a="s"),o.attr("data-tipsy",r[1]).tipsy({html:!0,title:"data-tipsy",gravity:a}),e(r[0]).click(function(e){void 0!==window.previewsidebar&&n&&(window.previewsidebar.setSelectedItem(r[1]),n=!1,setTimeout(function(){n=!0},100))})})};var n=[],r=!1;var o=!1;window.BwNotifyWidgetLoaded=function(){o||(o=!0,window.parent.postMessage("BwWidgetLoaded","*"),window.clientApp&&window.clientApp.widgetLoaded&&window.clientApp.widgetLoaded())};var a=!0;function i(){for(;n.length>0;){n.shift()()}a&&window.BwNotifyWidgetLoaded()}return window.BwUseManualWidgetLoadedNotification=function(){a=!1},function(o){if("bwshortcode"in o&&(window.bwshortcode=o.bwshortcode),"pre"in o&&(console.log("Preview"),"designinfo"in o)){console.log("With design info");for(var a=0;a<o.designinfo.length;++a)s=o.designinfo[a].s,c=o.designinfo[a].d,t.push([s,c]);"undefined"!=typeof previewsidebar&&(console.log("Previewsidebar is defined, immediately set design config"),e(function(){var e;e=function(){window.CssUpdateCounter&&(console.log("has CssUpdateCounter -> updating configCss"),window.updateConfigCSS(window.CssUpdateCounter)),console.log("Activating tooltips"),setTimeout(function(){window.activateDesignInfoTooltips()},3e3)},r?setTimeout(e,0):n.push(e)}))}var s,c;if("bra"in o&&e(function(){"iPad"===navigator.platform&&-1!==navigator.userAgent.indexOf("BookWidgets")||e(document.createElement("div")).addClass("branding").appendTo("body")}),"tri"in o&&e(function(){if("iPad"===navigator.platform||-1===navigator.userAgent.indexOf("BookWidgets")&&-1===navigator.userAgent.indexOf("ibookwidgets")){e(document.createElement("div")).addClass("dialog-sheet").attr("id","preview_alert").css({color:"red","text-shadow":"none"}).append(e(document.createElement("p")).safeHtml("This is a free preview widget, created using a trial version of BookWidgets. <b>This widget may only be used for demonstration and evaluation purposes!</b>")).append(e(document.createElement("p")).text("Please purchase a license key for the BookWidgets tool to remove this message.")).appendTo("body");var t=e(document.createElement("div")).addClass("dialog-sheet-shadow");e(document.body).append(t),window.CreateDialogSheetFor("#preview_alert"),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},2e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},6e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},3e4),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},34e3)}}),void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),window.getWidgetUrl=function(){return window.location.href},window.bwbackbuttonlabel=null,"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var l=Date.now();window.performance.timing&&window.performance.timing.navigationStart&&(l=window.performance.timing.navigationStart),window.performance.now=function(){return Date.now()-l}}return o.hasOwnProperty("backbutton_label")&&""!==o.backbutton_label&&(window.bwbackbuttonlabel=o.backbutton_label),"Vertical"===o.widget_orientation?e("html").addClass("vertical"):e("html").addClass("horizontal"),null!=o.widget_language&&""!==o.widget_language&&e("html").attr("lang",o.widget_language),o.hasOwnProperty("LocalizationMap")&&(window.bwlocalizationmap=o.LocalizationMap),setTimeout(i,0),null}}(n(0))},function(e,t,n){e.exports=function(e,t,n){var r={matchImage:function(t,r,o,a){return t=n(t),"None"===r?e(document.createElement("div")).append(e(document.createElement("img")).attr("src",t).css("max-width","300px")):e(document.createElement("div")).append(e(document.createElement("img")).attr("src",t))},getQuestionImageDivs:function(t,n,r,o){var a={};return o||(o="After"),r&&r.sources&&r.sources.length>0?(o.startsWith("Before")&&(a.imgdiv=e(document.createElement("div")).appendTo(t)),a.questdiv=e(document.createElement("div")).appendTo(t),a.audiodiv=e(document.createElement("div")).appendTo(t),o.startsWith("Between")&&(a.imgdiv=e(document.createElement("div")).appendTo(t)),a.answerdiv=e(document.createElement("div")).appendTo(t),a.hintdiv=e(document.createElement("div")).appendTo(t),a.rationalediv=e(document.createElement("div")).addClass("rationale").appendTo(t),o.startsWith("After")&&(a.imgdiv=e(document.createElement("div")).appendTo(t)),a.videodiv=e(document.createElement("div")).addClass("videowrapper").appendTo(t)):(a.questdiv=e(document.createElement("div")).appendTo(t),a.audiodiv=e(document.createElement("div")).appendTo(t),a.answerdiv=e(document.createElement("div")).appendTo(t),a.hintdiv=e(document.createElement("div")).appendTo(t),a.rationalediv=e(document.createElement("div")).addClass("rationale").appendTo(t),a.videodiv=e(document.createElement("div")).addClass("videowrapper").appendTo(t)),a.titlediv=a.questdiv,a.textdiv=a.answerdiv,a},getIndexPrefix:function(n){return""===n?"":e(document.createElement("div")).addClass("questionnumber").safeHtml(t("QUESTION")+" "+n)},getMailIndexPrefix:function(e){return e+". "},mH:"h3",MH:"h1",getConnectionType:function(){return"Straight"},getWidgetType:function(){return"quiz"},JspRtlOffset:function(){return 0},getScrollObject:function(){return e(".question-content")}};return r}(n(0),n(7),n(23))},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f=n(92),h=f.spellCheckAttribs,g=f.spellCheckAttribString;e.exports=(r=n(1),o=n(6),a=n(3),i=n(4),s=n(56),c=n(0),l=n(328),d=n(55),u=n(83),n(23),p=n(39),function(e){var t=r.getConfigSync(),n={};function f(e){return t.LocalizationMap[e]&&""!=t.LocalizationMap[e]?t.LocalizationMap[e]:e}return n.translate=f,n.localize=function(e,t,n){n=n||"",c(e).safeHtml(f(t)+n)},n.createRationale=function(t,r,s){if(null!=t.Rationale&&""!=t.Rationale||null!=t.rationale_img&&t.rationale_img.sources&&t.rationale_img.sources.length>0||void 0!==s){if(r.hasClass("rationale")||(r=r.find(".rationale").length>0?r.find(".rationale"):c(document.createElement("div")).addClass("rationale").appendTo(r)),r.empty(),void 0!==s&&r.append(s),void 0!==t.Rationale){var l=c(document.createElement("div")).addClass("the-rationale").safeHtml(a.prepare(t.Rationale)).appendTo(r);o.process(l),"quiz"===e.getWidgetType()&&i.replaceAudioByPlaceholder(r)}n.addOptionalImage(t.rationale_img,t.rationale_imgsize,l),r.hide()}else""===r.safeHtml()&&r.hasClass("rationale")&&r.hide()},n.showRationales=function(t){t.find(".rationale").each(function(){var e=c(this);""!==e.safeHtml()&&(e.show(),a.processMathElems(e),s.resolveYoutubePlaceholders(e),i.processAudioTags(e))}),"quiz"===e.getWidgetType()&&i.replacePlaceholders(".active")},n.hideRationales=function(e){e.find(".rationale").hide()},n.createHint=function(e,t,n){if(null!=e.hint&&""!=e.hint){c(document.createElement("div")).addClass("hint").safeHtml(a.prepare(e.hint)).appendTo(t).click(function(){c(this).hide(),c(this).parent().parent().find(".hintbutton").show()}).hide(),d.processRichTextImages(t),u.processRichTextWidgetPlayLinks(t,!0);var r=c(document.createElement("div")).appendTo(t);c(document.createElement("div")).addClass("hintbutton").safeHtml(f("Show hint")).appendTo(r).makeButton().click(function(){c(this).parent().parent().find(".hint").show(),c(this).hide(),n&&n()})}},n.getNumbering=function(e,n){return"yes"===t.auto_numbering?n:e.number},n.createQuestionDiv=function(t,n){return c(document.createElement(e.MH)).addClass("the-question").append(e.getIndexPrefix(t)).safeAppend(a.prepare(n))},n.spellcheckattrib=function(){return g("yes"===t.spellcheck)},n.addSpellCheckAttrib=function(e){e.attr(h("yes"===t.spellcheck))},n.inputModeAttrib=function(e){return"Numerical"!==e?"":'inputmode="numeric" pattern="[0-9]*" '},n.addInputModeAttrib=function(e,t){"Numerical"===t&&e.attr({pattern:"[0-9]*",inputmode:"numeric"})},n.replaceBadQuotes=function(e){return e.replace(/[\u2018\u2019]/g,"'")},n.compareVal=function(e,t,n){return(e=this.replaceBadQuotes(e))===(t=this.replaceBadQuotes(t))},n.matchesOneOfAnswers=function(e,t,n){n&&(e=e.toLowerCase(),t=t.toLowerCase()),e=this.replaceBadQuotes(e);for(var r=(t=this.replaceBadQuotes(t)).split(/\|\||##/),o=0;o<r.length;++o)if(e===r[o].trim())return!0;return!1},n.processEmbeddedElements=function(t){a.processMathElems(t),s.resolveYoutubePlaceholders(t),"quiz"===e.getWidgetType()&&i.replaceAudioByPlaceholder(t),i.processAudioTags(t)},n.imageLoadedCallbacks=[],n.triggerImageLoaded=function(){for(var e=0;e<this.imageLoadedCallbacks.length;++e)n.imageLoadedCallbacks[e]()},n.addImageLoadedCallback=function(e){this.imageLoadedCallbacks.push(e)},n.createTextOrPictureAnswer=l.createTextOrPictureAnswer,n.createPairAnswer=l.createPairAnswer,n.createWordListAnswer=l.createWordListAnswer,n.createMultiSelectAnswerCollector=function(e,t,n){return{_score:"each"==e?0:t,max:"each"==e?0:t,correctness:[],answers:[],add:function(r,o,a){"each"===e?r?(this.max+=t,n?o?(this.answers.push(a),this.correctness.push(1),this._score+=t):(this.answers.push(""),this.correctness.push(0)):(this.answers.push(""),this.correctness.push(-1))):n?o?(this.answers.push(a),this.correctness.push(0),this._score-=t):(this.answers.push(""),this.correctness.push(1)):(this.answers.push(""),this.correctness.push(-1)):n?r?o?(this.answers.push(a),this.correctness.push(1)):(this.answers.push(""),this.correctness.push(0),this._score=0):o?(this.answers.push(a),this.correctness.push(0),this._score=0):(this.answers.push(""),this.correctness.push(1)):(this.answers.push(""),this.correctness.push(-1),this._score=0)},score:function(){return"each"==e&&this._score<0?0:this._score}}},n.needToSyncTags=function(){return this.checkMode||"yes"===t.color_correct_answers},n.data=function(e,t,n){return void 0===n?e.data(t):e.data(t,n)},n.hasData=function(e,t){return void 0!==e.data(t)},n.findByData=function(e,t,n,r){for(var o=e.find(t),a=0;a<o.length;++a){var i=c(o[a]);if(this.data(i,n)===r)return i}return console.log("not found ",n,r),c()},n.addClass=function(e,t){var n=e.attr("class"),r=n?n.split(" "):[];-1===r.indexOf(t)&&(r.push(t),e.attr("class",r.join(" ")))},n.removeClass=function(e,t){var n=e.attr("class"),r=n?n.split(" "):[],o=r.indexOf(t);-1!==o&&(r.splice(o,1),e.attr("class",r.join(" ")))},n.setTag=function(e,t){var n=this;e.each(function(){var e=c(this);n.addClass(e,"bw-tagged");var r=n.data(e,"tags")||{};r[t]=!0,n.data(e,"tags",r),n.needToSyncTags()&&n.addClass(e,t)})},n.clearTag=function(e,t){var n=this;e.each(function(){var e=c(this);n.addClass(e,"bw-tagged");var r=n.data(e,"tags")||{};r[t]=!1,n.data(e,"tags",r),n.needToSyncTags()&&n.removeClass(e,t)})},n.findTag=function(e,t){var n=this;return e.find(".bw-tagged").filter(function(){return!0===n.data(c(this),"tags")[t]})},n.hasTag=function(e,t){return!!e.is(".bw-tagged")&&!0===this.data(e,"tags")[t]},n.syncDomWithTags=function(e){var t=this;function n(e){var n=t.data(e,"tags");for(var r in n)n.hasOwnProperty(r)&&(n[r]?t.addClass(e,r):t.removeClass(e,r))}e.is(".bw-tagged")&&n(e),e.find(".bw-tagged").each(function(){n(c(this))})},n.clearDomTagInfo=function(e){var t=this;function n(e){var n=t.data(e,"tags");for(var r in n)n.hasOwnProperty(r)&&t.removeClass(e,r)}e.is(".bw-tagged")&&n(e),e.find(".bw-tagged").each(function(){n(c(this))})},n.syncDomWithTagsIfRequired=function(e){this.needToSyncTags()&&this.syncDomWithTags(e)},n.addNarrowScreenPadding=function(e){c(document.createElement("div")).addClass("narrow-screen-padding").appendTo(e)},n.addOptionalImage=function(e,t,n,r){if(e&&e.sources&&0!=e.sources.length){var o=t?t.toLowerCase():"big",a=c(document.createElement("figure")).addClass("picture").append(p.create({img:e,loadcb:r}).addClass(o)).appendTo(n);e.hasOwnProperty("caption")&&""!==e.caption&&(a.addClass("with-caption"),c(document.createElement("figcaption")).text(e.caption).appendTo(a))}},n.createOptionalImage=function(e,t,n){this.addOptionalImage(e.img,e.imgsize,t,n)},n.tabIndex=0,n.checkMode=!1,n.questionIf={},n.wrapTypeConstructor=function(e,t){function r(e){var t=c(e).attr("id");return n.questionIf[t]}return{save:function(e){return r(e).save()},load:function(e,t){return r(e).load(t)},clear:function(e){return r(e).clear()},render:function(o,a,i,s){var c=e(o,a,i,t,s);return n.questionIf["QC"+a]=c,c.hasOwnProperty("preprocessLoadData")&&(this.preprocessLoadData=function(e,t,n){return r(e).preprocessLoadData(t,n)}),c.hasOwnProperty("preprocessSaveData")&&(this.preprocessSaveData=function(e,t,n){return r(e).preprocessSaveData(t,n)}),c.hasOwnProperty("freeResources")&&(this.freeResources=function(e,t){return r(e).freeResources(t)}),c.hasOwnProperty("fetchAsset")&&(this.fetchAsset=function(e){return r(e).fetchAsset()}),c.hasOwnProperty("assetUploadCompleteCB")&&(this.assetUploadCompleteCB=function(e,t){return r(t).assetUploadCompleteCB(e)}),c.render()},prepareCorrection:function(e,t){return r(e).prepareCorrection(t)},getAnswer:function(e,t,n,o){return r(e).getAnswer(t,n,o)}}},n.QuestionTypeBase=function(e,t,n,r){return{data:e,pindex:t,changeCB:n,qc:r,save:function(){return null},load:function(){return!1},clear:function(){return!1},render:function(){return!1},prepareCorrection:function(){return null},getAnswer:function(){return null},setReadOnly:function(){return!1},loadCorrect:function(){return!1}}},n.QuestionTypeBasic=function(e,t,r,o,a){var s=n.QuestionTypeBase(e,t,r,o);return s.render=function(){this.questionid="QC"+t,this.question=a||c("#"+this.questionid),this.qindex=this.question.attr("qindex"),this.divs=this.qc.getQuestionImageDivs(this.question,this.data.imgsize,this.data.img,this.data.imgpos),n.addNarrowScreenPadding(this.question),this.numbering=n.getNumbering(this.data,this.qindex),this.question.attr("numbering",this.numbering),n.createQuestionDiv(this.numbering,this.data.Question).appendTo(this.divs.questdiv),d.processRichTextImages(this.divs.questdiv),u.processRichTextWidgetPlayLinks(this.divs.questdiv,!0),this.data.audio&&""!=this.data.audio&&i.createPlayer(this.data.audio,"quiz"===this.qc.getWidgetType()).appendTo(this.divs.audiodiv),this.renderTypeSpecificPart(),n.createHint(this.data,this.divs.hintdiv),this.divs.rationalediv.addClass("rationalediv"),n.createOptionalImage(e,this.divs.imgdiv),n.processEmbeddedElements(this.question)},s.renderTypeSpecificPart=function(){},s.prepareCorrection=function(e){return n.createRationale(e,this.divs.rationalediv),null},s},n.createCorrectWrongMarker=function(e){e=e||{};var t=c(document.createElement(e.hasOwnProperty("elementType")?e.elementType:"span")).addClass("cr-marker");return c(document.createElement("span")).addClass(e.hasOwnProperty("correctClass")?"cr-correct "+e.correctClass:"cr-correct").safeHtml("&#x2713;").appendTo(t),c(document.createElement("span")).addClass(e.hasOwnProperty("wrongClass")?"cr-wrong "+e.wrongClass:"cr-wrong").safeHtml("&#x2718;").appendTo(t),t},n.getStateFromAnswer=function(e){var t,n,r,o,a,i=0,s=0;if(e){if(e.correctness.constructor===Array){n=!0,o=!1,t=!0,a=!0;for(var c=0;c<e.correctness.length;++c)-2===e.correctness[c]&&(o=!0),1!==e.correctness[c]&&(n=!1),-1===e.correctness[c]?t=!1:a=!1;r=!1===n&&!1===o&&!1===a}else t=-1!==e.correctness,a=-1===e.correctness,n=1===e.correctness,o=-2===e.correctness,r=0===e.correctness;i=e.score,s=e.outof}return{answered:t,correct:n,wrong:r,manual:o,allunanswered:a,score:i,outof:s}},n.widgetSupportsCorrection=function(){return"yes"===t.show_answers||"yes"===t.color_correct_answers},n.hasSubmitCheckPage=function(){return"yes"===t.submit_answers||"yes"===t.show_answers||"Score only"==t.show_score||"Score vs maximum"==t.show_score},n.isQuiz=function(){return"quiz"===e.getWidgetType()},n})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t){e.exports=function(){function e(e){return window.location.origin+window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/")+1)+e}return{createTextOrPictureAnswer:function(t,n){return"undefined"==typeof bwshortcode?t:{type:"Image",url:e(n),name:t}},createPairAnswer:function(t,n,r,o){return"undefined"==typeof bwshortcode?""!==r?t+" - "+r:t+" -":""===r?void 0===n||""===n?{type:"WordPair",name1:t,name2:""}:{type:"ImageWordPair",url1:e(n),name1:t,name2:""}:void 0===n||""===n?void 0===o||""===o?{type:"WordPair",name1:t,name2:r}:{type:"WordImagePair",name1:t,name2:r,url2:e(o)}:void 0===o||""===o?{type:"ImageWordPair",name1:t,url1:e(n),name2:r}:{type:"ImagePair",name1:t,url1:e(n),name2:r,url2:e(o)}},createWordListAnswer:function(t,n){if("undefined"==typeof bwshortcode){for(var r=[],o=0;o<n.length;++o)r.push(n[o].name);return t+" - "+r.join(" ")}for(var a={name:t,list:[],type:"WordImageListPair"},i=0;i<n.length;++i)void 0!==n[i].pic&&""!==n[i].pic?a.list.push({name:n[i].name,url:e(n[i].pic)}):(a.list.push({name:n[i].name}),a.type="WordWordListPair");return a}}}()},function(e,t,n){var r,o,a;e.exports=(r=n(0),o=n(168),a=n(2),{bwMakeDragAndResizable:function(e,t,n,i,s){var c=-1!==a.getPlatform().indexOf("ibooks"),l=new o.Manager(e.get(0));l.add(new o.Pan({threshold:0,pointers:0})),c||l.add(new o.Pinch({threshold:0})).recognizeWith([l.get("pan")]);var d=null;function u(t){null===d&&(d={pos:e.offset(),width:e.width(),height:e.height(),center:{x:e.offset().left,y:e.offset().top}}),t&&!d.hasOwnProperty("last_rotation")&&(d.center=t.center)}function p(t){var n=t.scale;e.offset({top:d.pos.top+t.deltaY+(d.center.y-d.pos.top)*(1-n),left:d.pos.left+t.deltaX+(d.center.x-d.pos.left)*(1-n)}),c||(e.width(d.width*n),e.height(d.height*n))}function f(t){var n=e.width(),o=e.height(),a=e.position(),i=r(window).width(),c=r(window).height();e.width(n*t),e.height(o*t),e.css("left",(a.left-i/2)*t+i/2),e.css("top",(a.top-c/2)*t+c/2),s&&s()}l.on("hammer.input",function(e){e.isFinal&&(d=null)}),l.on("panstart panmove",function(e){"panstart"===e.type?u():(p(e),i&&i())}),c||(l.on("pinchstart pinchmove",function(e){"pinchstart"===e.type?u(e):(p(e),s&&s())}),l.on("pinchend pinchcancel",function(){d&&(d=null,u())})),t.tapOrClick(function(){f(1.25)}),n.tapOrClick(function(){f(.8)})}})},function(e,t,n){var r;e.exports=(r=n(331),function(e,t,n){for(var o=[],a=e.questions||[],i=0;i<a.length;++i){for(var s=a[i].Type,c=r[s],l=!0,d=0;d<o.length;++d)if(o[d][0]==c[0]){l=!1;break}l&&o.push(c)}for(var u={},p=0;p<o.length;++p){var f=o[p][1](t,n);for(var h in f)u[h]=f[h]}return{questionTypes:u}})},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f,h,g,m,v,w,b,y;e.exports=(r=n(332),o=n(335),a=n(375),i=n(376),s=n(377),c=n(378),l=n(379),d=n(432),u=n(438),p=n(439),f=n(440),h=n(442),g=n(444),m=n(445),v=n(447),w=n(448),b=n(449),y=n(452),{TextDescription:["qt_textdescription",r],TextMultpleChoice:["qt_multiplechoice",o],RatedMultipleChoice:["qt_multiplechoice",o],TextMultiSelect:["qt_multiselect",a],QuestionTable:["qt_questiontable",i],MultiSelectQuestionTable:["qt_multiselect_questiontable",s],PictureMultpleChoice:["qt_picturemultiplechoice",c],PictureMultiSelect:["qt_picturemultiplechoice",c],MultiLine:["qt_multiline",l],RichText:["qt_richtext",d],ExtraMultiLine:["qt_extramultiline",u],ExtraCheckbox:["qt_extracheckbox",p],FillInText:["qt_fillintext",f],FillInTable:["qt_fillintable",h],AnnotatePicture:["qt_annotatepicture",g],SingleLine:["qt_singleline",m],PictureOrdering:["qt_pictureordering",v],WordOrdering:["qt_wordordering",w],WordMatch:["qt_match",b],WordPictureMatch:["qt_match",b],PicturePictureMatch:["qt_match",b],AudioWordMatch:["qt_match",b],AudioPictureMatch:["qt_match",b],TextDragDrop:["qt_dragdrop",y],PictureDragDrop:["qt_dragdrop",y],Whiteboard:["qt_whiteboard",n(453)],Photo:["qt_photo",n(458)],Numeric:["qt_numeric",n(461)],BalanceChemicalEquation:["qt_balancechemicalequation",n(462)],IonicCompoundBuilder:["qt_ioniccompoundbuilder",n(463)],CorrectSentence:["qt_correct_sentence",n(465)],MarkSentence:["qt_marksentence",n(467)],DragWordsInSentence:["qt_dragwordsinsentence",n(469)],Group:["qt_group",n(471)],AudioRecording:["qt_audiorecording",n(473)]})},function(e,t,n){var r,o,a,i,s,c,l,d=n(333).processEmbeddedIframes,u=n(169).default,p=n(334).default;e.exports=(r=n(1),o=n(6),a=n(3),i=n(4),s=n(0),c=n(108),l=n(56),function(e,t){var n=r.getConfigSync(),f={};function h(){}return f.TextDescription={save:h,load:h,clear:h,render:function(r,f,h){var g="QC"+f,m=s("#"+g),v=m.attr("qindex"),w=e.getQuestionImageDivs(m,r.imgsize,r.img,r.imgpos),b="yes"==n.info_numbering?t.getNumbering(r,v):"";m.attr("numbering",b);var y=s(document.createElement(e.MH)).addClass("textdescriptiontitle").append(e.getIndexPrefix(b)).safeAppend(a.prepare(r.Title)).appendTo(w.titlediv);o.process(y);var C=s(document.createElement("div")).addClass("textdescription").safeHtml(a.prepare(r.Text)).appendTo(w.textdiv);if(o.process(C),r.audio&&""!=r.audio&&i.createPlayer(r.audio,"quiz"==e.getWidgetType()).appendTo(w.audiodiv),t.createHint(r,w.hintdiv),w.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,w.imgdiv),""!==r.videoid){var k=s(document.createElement("div")).addClass("videodiv").appendTo(w.videodiv);if(l.isYoutubeUrl(r.videoid)){var T=g+"_video";s(document.createElement("div")).attr("id",T).appendTo(k),l.playYouTube("#"+T,r.videoid)}else l.createHtml5VideoPlayer(r.videoid).appendTo(k)}else if(""!=r.url&&"I have a URL"===r.linktype||""!=r.iframe_embed_code&&"I have an iframe embed code"===r.linktype){var x;T=g+"_video",x="I have a URL"===r.linktype?r.url:p(u(r.iframe_embed_code));var _={};""!==r.width&&(_.width=r.width),""!==r.height&&(_.height=r.height);var S=s(document.createElement("iframe")).attr(_).safeAttr("src",c(x)).appendTo(w.videodiv);d(S)}t.processEmbeddedElements(m)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t){return{question:s(t).find(e.MH).html(),answer:"",correctness:1,score:0,outof:0}}},f})},function(e,t,n){"use strict";n.r(t),n.d(t,"processEmbeddedIframes",function(){return i});var r=n(56),o=n(0);function a(e){e.attr("src").toLowerCase().endsWith("mp4")?function(e){e.replaceWith(r.createHtml5VideoPlayer(e.attr("src")))}(e):function(e){var t=["allow-forms","allow-modals","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts"];null!=document.hasStorageAccess&&t.push("allow-storage-access-by-user-activation");try{e.attr({allow:"microphone",sandbox:t.join(" ")})}catch(e){console.log()}}(e)}function i(e){e.each(function(){a(o(this))})}},function(e,t,n){"use strict";n.r(t),t.default=function(e){if("undefined"==typeof window||window.navigator&&window.navigator.userAgent&&(window.navigator.userAgent.indexOf("PhantomJS")>=0||window.navigator.userAgent.indexOf("ibookwidgets")>=0))return null;var t=(new window.DOMParser).parseFromString("<html>"+e+"</html>","text/html").getElementsByTagName("iframe");return t.length>0?t[0].src:null}},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(n(1),r=n(6),o=n(3),a=n(4),i=n(2),s=n(0),c=n(25),l=n(32),d=n(5),function(e,t){var n={};function u(e,t){s(e).find(".bw-radiobutton").each(function(){s(this).attr("answer")===t?s(this).trigger("check"):s(this).trigger("clear")})}function p(e){s(e).find(".bw-radiobutton").trigger("clear")}function f(e){return s(e).find("[checked='checked']").attr("answer")}return n.TextMultpleChoice={name:"TextMultpleChoice",save:f,load:u,clear:p,render:function(n,d,u,p){var f="QC"+d,h=(p=p||s("#"+f)).attr("qindex"),g={};t.questionIf[f]=g,g.setReadOnly=function(e){-1==i.getPlatform().indexOf("ipad")&&p.find(".bw-radiobutton").prop("disabled",e)},g.loadCorrect=function(e){p.find(".bw-radiobutton").trigger("clear"),p.find(".tmc-row[value="+e.Valid+"]").trigger("check")};var m=e.getQuestionImageDivs(p,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(p);var v=t.getNumbering(n,h);p.attr("numbering",v);var w=t.createQuestionDiv(v,n.Question).appendTo(m.questdiv);r.process(w),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(m.audiodiv);var b=s(document.createElement("div")).addClass("tmc-cover").appendTo(m.answerdiv);if(n.Answers)for(var y=l.randomIndexList(n.Answers.length),C=0;C<n.Answers.length;++C){var k="yes"===n["random-answer-order"]?y[C]:C,T=o.prepare(n.Answers[k].trim());t.tabIndex+=1;var x=c.createLabeledRadiobutton(b,T,function(){t.checkMode||(s(this).parent().find(".bw-radiobutton").trigger("clear"),s(this).trigger("check"),null!==u&&u())});x.find(".bw-button-label").append(t.createCorrectWrongMarker()),x.attr("answer",n.Answers[k]).attr("value",k+1).addClass("tmc-row"),"yes"===n["multi-column"]&&x.addClass("tmc-multi-column")}return t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv),t.processEmbeddedElements(p),p},prepareCorrection:function(e,n){var r=e.find(".tmc-row[value="+n.Valid+"]");r.length>0&&t.setTag(r,"tmc-answer"),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){var o=s(t),a=o.find(e.MH).html(),i=o.find("[checked='checked']");if(n){var c=i.length?i.attr("value"):null,l=d.check.TextMultpleChoice(r,c),u=null;try{u=r.Answers[parseInt(r.Valid)-1]}catch(e){}return{question:a,answer:-1===l.correctness?"":i.attr("answer"),check_input:c,correctness:l.correctness,score:l.score,outof:l.outof,canonicalAnswer:u}}return{question:a,answer:i.length>0?i.attr("answer"):""}}},n.RatedMultipleChoice={name:"RatedMultpleChoice",save:f,load:u,clear:p,render:function(n,l,d,u){var p="QC"+l,f=(u=u||s("#"+p)).attr("qindex"),h={};t.questionIf[p]=h,h.setReadOnly=function(e){-1==i.getPlatform().indexOf("ipad")&&u.find(".bw-radiobutton").prop("disabled",e)};var g=e.getQuestionImageDivs(u,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(u);var m=t.getNumbering(n,f);u.attr("numbering",m);var v=t.createQuestionDiv(m,n.Question).appendTo(g.questdiv);r.process(v),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(g.audiodiv);for(var w=s(document.createElement("div")).addClass("rmc-cover").appendTo(g.answerdiv),b=n.Answers?n.Answers:[],y=0;y<b.length;++y){var C=o.prepare(b[y].answer.trim());t.tabIndex+=1;var k=c.createLabeledRadiobutton(w,C,function(){t.checkMode||(s(this).parent().find(".bw-radiobutton").trigger("clear"),s(this).trigger("check"),null!==d&&d())});k.attr("answer",b[y].answer).attr("value",y).addClass("tmc-row"),"yes"==n["multi-column"]&&k.addClass("tmc-multi-column")}t.createHint(n,g.hintdiv),g.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,g.imgdiv),t.processEmbeddedElements(u)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){var o=s(t).find(e.MH).html(),a=s(t).find("[checked='checked']"),i=a.length?a.attr("value"):null,c=d.check.RatedMultipleChoice(r,i);return{question:o,answer:a.attr("answer")||"",check_input:i,correctness:c.correctness,score:c.score,outof:c.outof}}},n})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(n(1),r=n(6),o=n(3),a=n(4),i=n(2),s=n(0),c=n(25),l=n(32),d=n(5),function(e,t){var n={};function u(e){return e.replace(/\D/g," ")}function p(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}return n.TextMultiSelect={Name:"TextMultiSelect",save:function(e){for(var t=s(e),n=[],r=t.find(".bw-checkbox").length,o=0;o<r;++o)"checked"===t.find(".bw-checkbox[value="+o+"]").attr("checked")?n.push(1):n.push(0);return JSON.stringify(n)},load:function(e,t){var n=JSON.parse(t);s(e).find(".bw-checkbox").each(function(e){var t=s(this);1===n[parseInt(t.attr("value"))]?t.trigger("check"):t.trigger("clear")})},clear:function(e){s(e).find(".bw-checkbox").trigger("clear")},render:function(n,d,f,h){var g="QC"+d,m=(h=h||s("#"+g)).attr("qindex"),v={};t.questionIf[g]=v,v.setReadOnly=function(e){-1===i.getPlatform().indexOf("ipad")&&h.find(".bw-checkbox").prop("disabled",e)},v.loadCorrect=function(e){var t=u(e.Valid).split(" ");h.find(".bw-checkbox").each(function(){var e=s(this);p(t,parseInt(e.attr("value"))+1+"")?e.trigger("check"):e.trigger("clear")})};var w=e.getQuestionImageDivs(h,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(h);var b=t.getNumbering(n,m);h.attr("numbering",b);var y=t.createQuestionDiv(b,n.Question).appendTo(w.questdiv);r.process(y),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"===e.getWidgetType()).appendTo(w.audiodiv);var C=s(document.createElement("div")).addClass("tmc-cover").appendTo(w.answerdiv);if(n.Answers)for(var k=l.randomIndexList(n.Answers.length),T=0;T<n.Answers.length;++T){var x="yes"===n["random-answer-order"]?k[T]:T,_=o.prepare(n.Answers[x].trim());t.tabIndex+=1;var S=c.createLabeledCheckbox(C,_,function(){t.checkMode||null!=f&&f()});S.find(".bw-button-label").append(t.createCorrectWrongMarker()),S.attr("value",x).addClass("tmc-row"),"yes"===n["multi-column"]&&S.addClass("tmc-multi-column")}t.createHint(n,w.hintdiv),w.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,w.imgdiv),t.processEmbeddedElements(h)},prepareCorrection:function(e,n){if(null!=n.Valid){var r=u(n.Valid).split(" ");e.find(".tmc-row").each(function(){var e=s(this);p(r,parseInt(e.attr("value"))+1+"")&&t.setTag(e,"tmc-answer")})}t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){for(var o=s(t),a=o.find(e.MH).html(),i=[],c=[],l=r.Answers?r.Answers:[],u=0;u<l.length;++u){var p="checked"===o.find(".bw-checkbox[value="+u+"]").attr("checked");i.push(p),c.push(p?l[u]:"")}if(n){var f=d.check.TextMultiSelect(r,i);return{question:a,answer:c,check_input:i,correctness:f.correctness,score:f.score,outof:f.outof}}return{question:a,answer:c}}},n})},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(n(1),r=n(6),o=n(3),a=n(4),i=n(2),s=n(0),c=n(9),l=n(25),d=n(5),function(e,t){var n={};return n.QuestionTable={save:function(e){var t={};return s(e).find("tr.question").each(function(){var e=s(this).attr("nr"),n=s(this).find("[checked='checked']").attr("value");t[e]=n}),JSON.stringify(t)},load:function(e,t){var n=s(e);this.clear(e);var r=JSON.parse(t);n.find("tr.question").each(function(){var e=s(this).attr("nr"),t=r[e];if(void 0!==t&&""!==t){var n=s(this).find(".bw-simple-radiobutton[value='"+t+"']");n.trigger("check"),n.parent().addClass("qt-checked")}}),this.check(n)},clear:function(e){var t=s(e);t.find(".qt-checked").removeClass("qt-checked"),t.find(".bw-simple-radiobutton").trigger("clear")},splitRow:function(e,t){return e.rows[t].split(/\|\||##/)},rowQuestion:function(e,t){return this.splitRow(e,t)[0].trim()},rowAnswer:function(e,t){var n=this.splitRow(e,t);return n.length>1?n[1].trim():null},render:function(n,c,d,u){var p="QC"+c,f=(u=u||s("#"+p)).attr("qindex"),h={};t.questionIf[p]=h,h.setReadOnly=function(e){-1==i.getPlatform().indexOf("ipad")&&u.find(".bw-simple-radiobutton").prop("disabled",e)};var g=this;h.loadCorrect=function(e){u.find(".qt-checked").removeClass("qt-checked");for(var t={},n=e.columns?e.columns:[],r=0;r<n.length;++r)t[n[r].trim()]=r;for(var o=u.find("tr.question"),a=e.rows?e.rows:[],i=0;i<a.length;++i){var c=g.rowAnswer(e,i);if(null!==c&&t.hasOwnProperty(c)){var l=s(o[i]),d=s(l.find(".bw-simple-radiobutton")[t[c]]);d.trigger("check"),d.parent().addClass("qt-checked")}}};var m=e.getQuestionImageDivs(u,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(u);var v=t.getNumbering(n,f);u.attr("numbering",v);var w=t.createQuestionDiv(v,n.Question).appendTo(m.questdiv);r.process(w),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(m.audiodiv);var b=s(document.createElement("div")).addClass("qt-cover").appendTo(m.answerdiv),y=s(document.createElement("table")).appendTo(b),C=s(document.createElement("tr")).appendTo(y);function k(e){return p+"_answer_"+e}if(s(document.createElement("th")).appendTo(C),n.columns)for(var T=0;T<n.columns.length;++T){var x=n.columns[T].trim();s(document.createElement("th")).safeHtml(o.prepare(x)).attr("id",k(T)).appendTo(C)}var _=this;if(n.rows)for(var S=0;S<n.rows.length;++S){var E=s(document.createElement("tr")).addClass("question").appendTo(y);E.attr("nr",S);var I=this.rowQuestion(n,S);s(document.createElement("th")).addClass("nocenter").safeHtml(o.prepare(I)).appendTo(E);var O=n.columns?n.columns:[];for(T=0;T<O.length;++T){var A=s(document.createElement("td")).appendTo(E);l.createSimpleRadiobutton(A,function(){if(!t.checkMode){var e=s(this),n=s(this.parentNode.parentNode);n.find(".qt-checked").removeClass("qt-checked"),n.find(".bw-simple-radiobutton").trigger("clear"),e.trigger("check"),e.parent().addClass("qt-checked"),_.check(u),null!=d&&d()}},k(T)).attr("value",T).attr("name","qt_"+c+"_"+S)}E.append(t.createCorrectWrongMarker({elementType:"td"}))}t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv),t.processEmbeddedElements(u)},prepareCorrection:function(e,n){var r=n.columns?n.columns:[],o={rows:n.rows?n.rows:[],columns:r,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(o));var a,i=[];for(a=0;a<r.length;++a)i[r[a].trim()]=!0;for(var l=e.find("tr.question"),d=0;d<l.length;++d){var u=s(l[d]),p=this.rowAnswer(n,d);for(null===p||i.hasOwnProperty(p)||c.showAlert("'"+p+"' is not a valid answer for question <br><br>"+this.rowQuestion(n,d),"Configuration error"),a=0;a<r.length;++a)r[a].trim()===p&&t.setTag(s(u.find("td")[a]),"qt-answer")}this.check(e),t.createRationale(n,e.find(".rationalediv"))},getCheckInput:function(e){var t=[];return e.find("tr.question").each(function(){var e=s(this).find("[checked='checked']");if(e.length>0){var n=e.attr("value");t.push(n)}else t.push(null)}),t},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}for(var r=this.getCheckInput(e),o=d.check.QuestionTable(n,r),a=e.find("tr.question"),i=0;i<a.length;++i){var c=s(a[i]);1===o.correctness[i]?(t.setTag(c,"qt-correct"),t.clearTag(c,"qt-wrong")):0===o.correctness[i]?(t.clearTag(c,"qt-correct"),t.setTag(c,"qt-wrong")):(t.clearTag(c,"qt-correct"),t.clearTag(c,"qt-wrong"))}},getAnswer:function(t,n,r){var o=s(t),a=o.find(e.MH).html(),i=[];o.find("tr.question").each(function(){var e=s(this).find("[checked='checked']");if(e.length>0){var t=e.attr("value"),n=parseInt(t);i.push(isNaN(n)?"":r.columns[n])}else i.push(null)});var c=this.getCheckInput(o);if(n){var l=d.check.QuestionTable(r,c);return{question:a,answer:i,check_input:c,correctness:l.correctness,score:l.score,outof:l.outof}}return{question:a,answer:i}}},n})},function(e,t,n){var r,o,a,i,s,c,l,d,u=n(22).each;e.exports=(n(1),r=n(6),o=n(3),a=n(4),i=n(2),s=n(0),c=n(9),l=n(25),d=n(5),function(e,t){var n={};return n.MultiSelectQuestionTable={getCheckInput:function(e){var t=[];return s(e).find("tr.question").each(function(){var e=[];s(this).find(".bw-simple-checkbox").each(function(){e.push("checked"===s(this).attr("checked")?1:0)}),t.push(e)}),t},save:function(e){return JSON.stringify(this.getCheckInput(e))},load:function(e,t){var n=s(e);this.clear(e);var r=JSON.parse(t);n.find("tr.question").each(function(){var e=s(this).attr("nr"),t=r[e],n=0;s(this).find(".bw-simple-checkbox").each(function(){var e=s(this);t&&n<t.length&&1===t[n++]?(e.trigger("check"),e.parent().parent().addClass("mqt-checked")):e.trigger("clear")})}),this.check(n)},clear:function(e){var t=s(e);t.find(".mqt-checked").removeClass("mqt-checked"),t.find(".bw-simple-checkbox").trigger("clear")},splitRow:function(e,t){return e.rows[t].split(/\|\||##/)},rowQuestion:function(e,t){return this.splitRow(e,t)[0].trim()},rowAnswers:function(e,t){for(var n=this.splitRow(e,t),r=[],o=1;o<n.length;++o)r.push(n[o].trim());return r},render:function(n,c,d,p){var f=this,h="QC"+c,g=(p=p||s("#"+h)).attr("qindex"),m={};t.questionIf[h]=m,m.setReadOnly=function(e){-1==i.getPlatform().indexOf("ipad")&&p.find(".bw-simple-checkbox").prop("disabled",e)};var v=this;m.loadCorrect=function(e){f.clear();for(var t={},n=e.columns?e.columns:[],r=0;r<n.length;++r)t[n[r].trim()]=r;var o=p.find("tr.question");u(o,function(n,r){var o=s(n);v.rowAnswers(e,r).forEach(function(e){if(t.hasOwnProperty(e)){var n=s(o.find(".bw-simple-checkbox")[t[e]]);n.trigger("check"),n.parent().parent().addClass("mqt-checked")}})})};var w=e.getQuestionImageDivs(p,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(p);var b=t.getNumbering(n,g);p.attr("numbering",b);var y=t.createQuestionDiv(b,n.Question).appendTo(w.questdiv);r.process(y),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(w.audiodiv);var C=s(document.createElement("div")).addClass("mqt-cover").appendTo(w.answerdiv),k=s(document.createElement("table")).appendTo(C),T=s(document.createElement("tr")).appendTo(k);function x(e){return h+"_answer_"+e}if(s(document.createElement("th")).appendTo(T),n.columns)for(var _=0;_<n.columns.length;++_){var S=n.columns[_].trim();s(document.createElement("th")).safeHtml(o.prepare(S)).attr("id",x(_)).appendTo(T)}var E=this;if(n.rows)for(var I=0;I<n.rows.length;++I){var O=s(document.createElement("tr")).addClass("question").appendTo(k);O.attr("nr",I);var A=this.rowQuestion(n,I);s(document.createElement("th")).addClass("nocenter").safeHtml(o.prepare(A)).appendTo(O);var q=n.columns?n.columns:[];for(_=0;_<q.length;++_){var P=s(document.createElement("td")).appendTo(O),D=s(document.createElement("div")).addClass("mqt-wrapper").appendTo(P);l.createSimpleCheckbox(D,function(){s(this).parent().parent().toggleClass("mqt-checked"),t.checkMode||(E.check(p),null!=d&&d())},x(_)).attr("value",_).attr("name","qt_"+c+"_"+I),D.append(t.createCorrectWrongMarker({elementType:"span"}))}}t.createHint(n,w.hintdiv),w.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,w.imgdiv),t.processEmbeddedElements(p)},prepareCorrection:function(e,n){var r=this,o=n.columns?n.columns:[],a={rows:n.rows?n.rows:[],columns:o,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(a));var i,l=[];for(i=0;i<o.length;++i)l[o[i].trim()]=!0;var d=e.find("tr.question");u(d,function(e,a){var d=s(e);r.rowAnswers(n,a).forEach(function(e){for(l.hasOwnProperty(e)||c.showAlert("'"+e+"' is not a valid answer for question <br><br>"+r.rowQuestion(n,a),"Configuration error"),i=0;i<o.length;++i)o[i].trim()===e&&t.setTag(s(d.find("td")[i]),"mqt-answer")})}),this.check(e),t.createRationale(n,e.find(".rationalediv"))},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=d.check.MultiSelectQuestionTable(n,r);console.log(o),e.find("tr.question").each(function(e){s(this).find(".bw-simple-checkbox").each(function(n){var r=s(this).parent().parent();1===o.correctness[e][n]?(t.setTag(r,"mqt-correct"),t.clearTag(r,"mqt-wrong")):0===o.correctness[e][n]?(t.clearTag(r,"mqt-correct"),t.setTag(r,"mqt-wrong")):(t.clearTag(r,"mqt-correct"),t.clearTag(r,"mqt-wrong"))})})},getAnswer:function(t,n,r){var o=s(t),a=o.find(e.MH).html(),i=this.getCheckInput(o);if(n){var c=d.check.MultiSelectQuestionTable(r,i);return{question:a,answer:i,check_input:i,correctness:c.correctness,score:c.score,outof:c.outof}}return{question:a,answer:[]}}},n})},function(e,t,n){var r,o,a,i,s;e.exports=(n(1),r=n(6),n(3),o=n(4),a=n(0),n(23),i=n(5),s=n(39),function(e,t){var n={};function c(e){return e.replace(/\D/g," ")}function l(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}return n.PictureMultpleChoice={save:function(e){var n=a(e).find(".selected");return t.data(n,"report-name")},load:function(e,n){a(e).find(".pmc-quiz").each(function(){var e=a(this);t.data(e,"report-name")===n?e.trigger("check"):e.trigger("clear")})},clear:function(e){a(e).find(".pmc-quiz").trigger("clear")},render:function(n,i,c,l){var d="QC"+i,u=(l=l||a("#"+d)).attr("qindex"),p={};t.questionIf[d]=p,p.loadCorrect=function(e){l.find(".pmc-quiz").each(function(){var t=a(this);t.attr("value")+""==e.Valid+""?t.trigger("check"):t.trigger("clear")})};var f=e.getQuestionImageDivs(l,n.imgsize,n.img,n.imgpos),h=t.getNumbering(n,u),g=t.createQuestionDiv(h,n.Question).appendTo(f.questdiv);r.process(g),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(f.audiodiv),l.attr("numbering",h);var m=a(document.createElement("div")).addClass("pmc-cover").appendTo(f.answerdiv);if(n.Answers){for(var v=0;v<n.Answers.length;++v){var w=n.Answers[v].sources[0].src,b=a(document.createElement("div")).addClass("pmc-quiz");s.create({img:n.Answers[v],type:"div",background:"white",disable_click:!0,disable_press:!0}).appendTo(b),b.bind("check",function(){a(this).addClass("selected").attr({"aria-checked":"true"})}),b.bind("clear",function(){a(this).removeClass("selected").attr({"aria-checked":"false"})}),b.trigger("clear"),b.css({position:"relative"}),t.data(b,"report-name",n.Answers[v].origbase),b.attr({value:v+1,pic:w}),a(document.createElement("div")).addClass("right-picture").appendTo(b),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(b),b.appendTo(m),b.makeButton({role:"radio"}).clickOrHold(function(e){var n;t.checkMode||(a(n=this).hasClass("selected")?a(n).trigger("clear"):(a(n.parentNode).find(".pmc-quiz").trigger("clear"),a(n).trigger("check")),null!=c&&c())},function(){a(this).find("[role=image]").trigger("zoom")},1e3)}(v>3||""!=n.img)&&m.css({margin:"auto"})}t.processEmbeddedElements(l),t.createHint(n,f.hintdiv),f.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,f.imgdiv)},prepareCorrection:function(e,n){var r=e.find(".pmc-quiz");r.length>=n.Valid&&t.setTag(a(r[n.Valid-1]),"pmc-answer"),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(n,r,o){var s=a(n),c=s.find(e.MH).html(),l=s.find(".selected"),d=l.length?l.attr("value"):null,u=0===l.length?"":t.createTextOrPictureAnswer(t.data(l,"report-name"),l.attr("pic"));if(r){var p=i.check.PictureMultpleChoice(o,d);return{question:c,answer:u,check_input:d,correctness:p.correctness,score:p.score,outof:p.outof}}return{question:c,answer:u}}},n.PictureMultiSelect={save:function(e){var n=[];return a(e).find(".selected").each(function(){n.push(t.data(a(this),"report-name"))}),JSON.stringify(n)},load:function(e,n){try{var r=JSON.parse(n);a(e).find(".pmc-quiz").each(function(){-1!=r.indexOf(t.data(a(this),"report-name"))&&a(this).trigger("check")})}catch(e){console.error("Error loading PictureMultiSelect data")}},clear:function(e){a(e).find(".pmc-quiz").trigger("clear")},render:function(n,i,d,u){var p="QC"+i,f=(u=u||a("#"+p)).attr("qindex"),h={};t.questionIf[p]=h,h.loadCorrect=function(e){var t=c(e.Valid).split(" "),n=1;u.find(".pmc-quiz").each(function(){l(t,n+++"")?a(this).trigger("check"):a(this).trigger("clear")})};var g=e.getQuestionImageDivs(u,n.imgsize,n.img,n.imgpos),m=t.getNumbering(n,f),v=t.createQuestionDiv(m,n.Question).appendTo(g.questdiv);r.process(v),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(g.audiodiv),u.attr("numbering",m),u.attr("scoring-weight",n["scoring-weight"]),u.attr("policy",n.policy);var w=a(document.createElement("div")).addClass("pmc-cover").appendTo(g.answerdiv);if(n.Answers)for(var b=0;b<n.Answers.length;++b){var y=n.Answers[b].sources[0].src,C=a(document.createElement("div")).addClass("pmc-quiz");s.create({img:n.Answers[b],type:"div",background:"white",disable_click:!0,disable_press:!0}).appendTo(C),C.bind("check",function(){a(this).addClass("selected").attr({"aria-checked":"true"})}),C.bind("clear",function(){a(this).removeClass("selected").attr({"aria-checked":"false"})}),C.trigger("clear"),C.css({position:"relative"}),t.data(C,"report-name",n.Answers[b].origbase),C.attr({pic:y}),a(document.createElement("div")).addClass("right-picture").appendTo(C),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(C),C.appendTo(w),C.makeButton({role:"checkbox"}).clickOrHold(function(e){var n;t.checkMode||(a(n=this).hasClass("selected")?a(n).trigger("clear"):a(n).trigger("check"),null!=d&&d())},function(){a(this).find("[role=image]").trigger("zoom")},1e3)}t.processEmbeddedElements(u),t.createHint(n,g.hintdiv),g.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,g.imgdiv)},prepareCorrection:function(e,n){if(null!=n.Valid)for(var r=c(n.Valid).split(" "),o=e.find(".pmc-quiz"),i=0;i<o.length;++i)l(r,1+i+"")&&t.setTag(a(o[i]),"pmc-answer");t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(n,r,o){var s=a(n),c=s.find(e.MH).html(),l=[],d=[];s.find(".pmc-quiz").each(function(e){var n=a(this).hasClass("selected");l.push(n),d.push(n?t.createTextOrPictureAnswer(t.data(a(this),"report-name"),a(this).attr("pic")):"")});var u=i.check.PictureMultiSelect(o,l);return{question:c,answer:d,check_input:l,correctness:u.correctness,score:u.score,outof:u.outof}}},n})},function(e,t,n){var r,o,a,i,s,c,l=n(18).o;e.exports=(n(1),r=n(6),n(3),o=n(4),a=n(2),i=n(0),s=n(77),c=n(5),function(e,t){var n={};return n.MultiLine={name:"MultiLine",save:function(e){return i(e).find(".edit").val()},load:function(e,t){var n=i(e);n.find(".edit").val(t),this.check(n)},clear:function(e){var t=i(e);t.find(".edit").val(""),t.find(".textareacover").safeHtml(""),this.check(t)},getCheckInput:function(e){return e.find(".edit").val()},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}for(var r=this.getCheckInput(e),o=c.check.MultiLine(n,r),a=!0,i=0;i<o.keywords.length;++i)if(o.keywords[i].match){a=!1;break}var s=e.find(".ml-cover");switch(o.correctness){case 0:a?t.setTag(s,"ml-none"):t.clearTag(s,"ml-none"),t.clearTag(s,"ml-answer");break;case 1:t.clearTag(s,"ml-none"),t.setTag(s,"ml-answer");break;case-2:t.setTag(s,"ml-open");break;case-1:t.clearTag(s,"ml-open"),t.clearTag(s,"ml-none"),t.clearTag(s,"ml-answer")}},render:function(n,d,u,p){var f=this,h="QC"+d,g=(p=p||i("#"+h)).attr("qindex"),m={};t.questionIf[h]=m,m.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&p.find("textarea").prop("disabled",e)},m.loadCorrect=function(e){p.find(".edit").val(e.Keywords.join("\n")),f.check(p)};var v=e.getQuestionImageDivs(p,n.imgsize,n.img,n.imgpos),w=t.getNumbering(n,g);p.attr("numbering",w);var b=t.createQuestionDiv(w,n.Question).appendTo(v.questdiv);r.process(b),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(v.audiodiv);var y=i(document.createElement("div")).addClass("ml-cover hidecover bw-column-container").appendTo(v.answerdiv),C=i(document.createElement("div")).addClass("bw-column-resizing").appendTo(y),k=i(document.createElement("textarea")).addClass("edit").appendTo(C);t.addSpellCheckAttrib(k),t.createCorrectWrongMarker({elementType:"div"}).addClass("bw-column-fixed bw-centering-container").appendTo(y);try{k.xarea(),k.next().attr("aria-hidden","true")}catch(e){}var T=l.createThrottler(u);k.bind("keyup change",function(){T.trigger()});var x="yes"==n["support-links"],_="yes"===n["show-matched-keywords"]&&""!==n.Keywords;if(x||_){x&&p.attr("support-links","yes"),_&&y.addClass("show-keywords");var S=i(document.createElement("div")).addClass("textareacover").prependTo(C),E=function(e){return i(document.createElement("div")).text(e).safeHtml()},I=function(){var e=function(e){for(var t=e.split(/\r\n|\r|\n/),n=0;n<t.length;n++)t[n]=E(t[n]);return t.join("<br>")}(k.val());x&&(e=c.linkifyLinks(e)),_&&(e=function(e){for(var n=e,r=JSON.parse(t.data(p,"questionconfig")||'{"keywords": [], "case-sensitive": "no"}'),o=r["case-sensitive"],a=r.Keywords||[],i=[],s=0;s<a.length;++s)for(var c=a[s].split(/\|\||##/),l=c.length>1&&!1===isNaN(c[c.length-1]),d=0;d<(l?c.length-1:c.length);++d)""!==c[d].trim()&&i.push((c[d]+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1"));if(i.length>0){var u=o&&"no"==o?"gi":"g";n=n.replace(new RegExp("\\b("+i.join("|")+")\\b",u),"<span class='ml-keyword'>$1</span>")}return n}(e)),S.safeHtml(e);for(var n=k.parent();!n.parent().hasClass("ml-cover");)n=n.parent();var r=n.position();S.css({left:r.left,top:r.top,width:k.outerWidth(),height:k.outerHeight()}),S.find(".weblink").each(function(){s(this,i(this).attr("href").replace(/&amp;/g,"&"))})},O=function(){I(),y.addClass("showcover").removeClass("hidecover")};m.repaint=I,k.bind("focusout",function(){O()}),k.bind("focus",function(){y.removeClass("showcover").addClass("hidecover")}),O()}t.createHint(n,v.hintdiv),v.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,v.imgdiv),t.processEmbeddedElements(p)},prepareCorrection:function(e,n){var r={"case-sensitive":n["case-sensitive"],"scoring-weight":n["scoring-weight"]};"Keywords"in n&&n.Keywords.length>0&&(r.Keywords=n.Keywords),t.data(e,"questionconfig",JSON.stringify(r));var o=this;e.find("textarea").bind("keyup change",function(){o.check(e)}),o.check(e),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r,o){var a=i(t),s=a.find(e.MH).safeHtml(),l=this.getCheckInput(a);if(n){var d=c.check.MultiLine(r,l);"yes"==a.attr("support-links")&&(l=c.linkifyLinks(l));var u=[];if(o&&d.hasOwnProperty("keywords"))for(var p=0;p<d.keywords.length;++p){var f=d.keywords[p];f.match?f.hasOwnProperty("points")?u.push("&#9745 "+f.keyword+"("+f.points+")<br>"):u.push("&#9745 "+f.keyword+"<br>"):u.push("&#9744 "+f.keyword+"<br>")}return{question:s,annotatedtable:u.join(""),answer:l,check_input:l,correctness:d.correctness,score:d.score,outof:d.outof}}return{question:s,answer:l}}},n})},function(e,t,n){e.exports=function(e,t,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(2),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(173),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(174),c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n(175);function l(t){this._storage=t,this.setCredentials=function(t){var n=this;return e.Deferred(function(e){n._storage.setItemsAsync([{key:"BwCredentials",value:JSON.stringify(t),attribs:""}],function(){e.resolve()},function(){e.reject()})})},this.getCredentials=function(){var t=this;return e.Deferred(function(e){t._storage.getItemsAsync(["BwCredentials"],function(t){try{var n=JSON.parse(t.BwCredentials.value);e.resolve(n)}catch(t){e.reject()}},function(){e.reject()})})}}var d=r.isLTI()||t.getParameters().sso;return d&&console.log("Using session storage for credentials"),"ibw-platform-ipad-bookwidgets"===a.getPlatform()?new l(new s):a.usesCredentialProxy()?new l(new c("_secureStorage",!0,t.getQueryParams(window.location.search)["bwds-secure-proxy-token"],d)):new function(t){this.setCredentials=function(n){return e.Deferred(function(e){try{t.SetItem("BwCredentials",JSON.stringify(n)),e.resolve()}catch(t){e.reject()}})},this.getCredentials=function(){return e.Deferred(function(e){try{var n=JSON.parse(t.GetItem("BwCredentials"));e.resolve(n)}catch(t){e.reject()}})}}(d?o:i)}.bind(null,n(0),n(11),n(74),n(382))},function(e,t,n){var r,o;e.exports=(r=n(76),(o=function(e,t){this.name=e,this.origin=t,this.callbackBridge=new r,this.callbackBridge.startListening()}).prototype.send=function(e,t,n){e.to=this.name,e.cb=this.callbackBridge.registerCallback(t,n),parent.postMessage(e,this.origin)},o)},function(e,t){e.exports={GetItem:function(e){return sessionStorage.getItem(e)},RemoveItem:function(e){sessionStorage.removeItem(e)},SetItem:function(e,t){sessionStorage.setItem(e,t)},Clear:function(){sessionStorage.clear()}}},function(e,t,n){e.exports=function(e,t,n,r,o,a,i){var s={},c=e.getConfigSync();function l(){var e=a.getPlatform();return!!("ibw-platform-ipad-ibooks"===e||"ibw-platform-ipad-ibooks-epub"===e||"ibw-platform-osx-ibooks"===e||"ibw-platform-osx-ibooks-epub"===e||"ibw-platform-android-chrome"===e||a.isPreview()||"ibw-platform-ipad-bookwidgets"!==e&&!1===a.isTopLevelPlay())}function d(e){for(var t=0;t<e.bw_links.length;++t){var n=e.bw_links[t];if("bw-student"===n.name)return n}return null}function u(){return c.hasOwnProperty("student_account_school")&&c.student_account_school.hasOwnProperty("code")&&null!==c.student_account_school.code&&""!==c.student_account_school.code&&"null"!==c.student_account_school.code}return s.createDialog=function(e,n){var r=t(document.createElement("div")).addClass("bw-login-dialog-wrapper"),a=t(document.createElement("div")).css({position:"absolute",width:"100%",height:"100%",left:"0px",top:"0px"}).appendTo(r),i=t(document.createElement("div")).attr("id","bw-login-dialog").addClass("bw-row-container").appendTo(r);return n&&(r.addClass("bw-centering-container"),i.addClass("bw-centered")),r.appendTo("body"),e&&a.click(function(){r.remove(),e.reject()}),{close:r.remove.bind(r),show:function(e,n){var r;i.empty(),n&&t(document.createElement("div")).addClass("login-dialog-title bw-row-fixed").safeHtml(n).appendTo(i),e.appendTo(i),(r=i).find(".weblink").each(function(){o(t(this).parent()[0],t(this).attr("href"),!0,t(this).attr("message")),t(this).attr("href","")}),r.find(".external-link").each(function(){o(this,t(this).attr("href"),!1,t(this).attr("message")),t(this).attr("href","")})}}},s.queryLoginMethod=function(e){var n=this;return t.Deferred(function(o){var a=n.createDialog(o,!0),i=t(document.createElement("div")).addClass("login-type-selection login-dialog-body");var s,c=d(e),p=null!==c;function f(){removeEventListener("message",h),a.close()}function h(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(f(),o.resolve("oauth"))}e.oauth_links.length>0&&function(n,o){n=e.oauth_links;for(var a=0;a<n.length;++a){var i=n[a],s=l()&&i.toplevel,c=s?" weblink login-type-button":" login-type-button",d=s?"_blank":"_top",u=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";t(document.createElement("div")).addClass("web-link-wrapper"+c).append(t(document.createElement("a")).attr({message:"linkclicked",href:i.url,attr:d,onclick:u}).safeHtml(r("Sign in using")+" "+i.name)).appendTo(o)}}(e.oauth_links,i),p&&(u()||(s=i,t(document.createElement("div")).addClass("login-type-button").safeHtml(r("Sign in using email and password")).tapOrClick(function(){o.resolve("bw"),f()}).appendTo(s)),function(e,n){t(document.createElement("div")).addClass("login-type-button").safeHtml(r("Sign in using school account")).tapOrClick(function(){o.resolve("school"),f()}).appendTo(n)}(0,i)),a.show(i,r("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",h)}).promise()},s.queryBWCredentials=function(e){var n=this;return t.Deferred(function(o){var a=n.createDialog(o,!0),i=d(e),s=t(document.createElement("div")).addClass("login-form login-dialog-body");function c(){removeEventListener("message",u),a.close()}function u(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(c(),o.resolve({action:"signup"}))}!function(e,n){var a=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-email",placeholder:r("Email"),tabindex:"1"}).appendTo(n),i=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-password",type:"password",placeholder:r("Password"),tabindex:"2"}).appendTo(n);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","3").safeHtml(r("Sign in")).tapOrClick(function(){o.resolve({action:"login",school:"",username:a.val(),password:i.val()}),c()}).appendTo(n);var s=l(),d=s?" external-link":"",u=s?"_blank":"_top",p=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";e.hasOwnProperty("resetPasswordURL")&&t(document.createElement("a")).attr({href:e.resetPasswordURL,target:u,onclick:p}).safeHtml(r("Forgot password?")).addClass("bw-reset-password"+d).appendTo(n),e.hasOwnProperty("registerURL")&&(t(document.createElement("hr")).appendTo(n),t(document.createElement("p")).css("position","relative").appendSafe("Don't have an account?").append(t(document.createElement("br"))).append(t(document.createElement("a")).attr({message:"linkclicked",href:e.registerURL,target:u,onclick:p}).addClass("bw-signup"+d).safeHtml(r("Sign up here"))).appendTo(n))}(i,s),a.show(s,r("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",u)}).promise()},s.querySchoolCredentials=function(e){var n=this;return t.Deferred(function(e){var o,a=n.createDialog(e,!0),i=t(document.createElement("div")).addClass("login-form login-dialog-body");u()||(o=t(document.createElement("input")).attr({id:"school-school",placeholder:r("School code"),tabindex:"1"}).addClass("login-dialog-field").appendTo(i));var s=t(document.createElement("input")).attr({id:"school-username",placeholder:r("Username"),tabindex:"2"}).addClass("login-dialog-field").appendTo(i),l=t(document.createElement("input")).attr({id:"school-password",type:"password",placeholder:r("Password"),tabindex:"3"}).addClass("login-dialog-field").appendTo(i);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","4").safeHtml(r("Sign in")).tapOrClick(function(){var t=u()?c.student_account_school.code:o.val();e.resolve({action:"login",school:t,username:s.val(),password:l.val()}),a.close()}).appendTo(i),a.show(i,u()?c.student_account_school.name:r("Sign in")),window.postMessage({msg:"requestlogin"},"*")}).promise()},s.queryLogout=function(e,n,o,a){var i=this;return t.Deferred(function(s){var c=i.createDialog(s),l=t(document.createElement("div")).attr("id","offline-dialog").addClass("login-dialog-body");t(document.createElement("p")).safeHtml(n).appendTo(l),t(document.createElement("div")).attr("id","login-current-user").safeHtml(o||"").appendTo(l),a||t(document.createElement("div")).addClass("login-dialog-button").safeHtml(r("Sign out")).tapOrClick(function(){c.close(),s.resolve()}).appendTo(l),c.show(l,e)}).promise()},s.showMessage=function(e,o){return t.Deferred(function(t){n.showAlert(e,o,r("OK"),function(){t.resolve()})})},s.createPollingUI=function(e){var n=this.createDialog(null,!0),o=t(document.createElement("div")).addClass("login-pollingdialog");return t(document.createElement("p")).safeHtml(r("Waiting for account sign in to complete...")).appendTo(o),t(document.createElement("div")).addClass("login-dialog-button").safeHtml(r("Cancel")).tapOrClick(e).appendTo(o),n.show(o,r("Waiting")),n},s}(n(1),n(0),n(9),n(7),n(77),n(2),n(40))},function(e,t,n){var r=n(75);e.exports=function(e){window.addEventListener("message",function(t){var n=t.data;"set-css"===n.command&&(!function(t){for(var n=document.getElementsByTagName("link"),r=0,o=n.length;r<o;r++){var a=n[r],i=a.rel;if("string"!=typeof i||0===i.length||"stylesheet"===i){var s=a.getAttribute("href");0===s.indexOf("config")&&-1!==s.indexOf(".css")&&(a.disabled=!0)}}e("style[id='designconfig']").remove();var c=document.createElement("style");c.id="designconfig",c.type="text/css",c.appendChild(document.createTextNode(t)),document.head.appendChild(c)}(n.css),r.executeCssUpdateCallbacks())})}(n(0))},function(e,t){e.exports=void window.addEventListener("message",function(e){"print"===e.data.command&&window.print()})},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a,i;e.exports=(o=n(2),a=n(0),-1!==(i=o.getPlatform()).indexOf("android")?a.fn.extend({clickOnDraggable:function(e){return this.each(function(){var t=!1;this.ClickOnDraggableCallback=e,a(this).on("touchstart",function(e){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&1===n.touches.length&&n.changedTouches[1]===n.touches[1]?(t=!0,setTimeout(function(){t&&(console.error("touch takes too long"),t=!1)},100)):t=!1}),a(this).on("touchend",function(e){if(t){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&0===n.touches.length?(t=!1,this.ClickOnDraggableCallback()):t=!1}})})}}):a.fn.extend({clickOnDraggable:function(e){return this.each(function(){a(this).click(e)})}}),-1!==i.indexOf("android")||-1!==i.indexOf("preview")||-1!==i.indexOf("phantomjs")||-1!==i.indexOf("headlesschrome")||-1!==i.indexOf("chrome")||"ibw-platform-osx-safari"===i||"ibw-platform-osx-ibooks"===i||"ibw-platform-osx-ibooks-epub"===i?a.fn.extend({tapOrClick:function(e){return this.each(function(){a(this).click(e);var t=this,n=a(this);n.is("button")||n.is("a")||n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){a(this).unbind("click");var e=a(this);e.is("button")||e.is("a")||e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){a(this).trigger("click",e)})}}):a.fn.extend({tapOrClick:function(e){return this.each(function(){var t=this,n=a(this);n.addClass("epub-block"),n.find("*").each(function(){this instanceof SVGElement||a(this).addClass("epub-block")});var r=!1;n.hammer?"ibw-platform-ipad-bookwidgets"===i||"ibw-platform-ipad-ibooks-epub"===i||"ibw-platform-ipad-ibooks"===i?n.hammer().on("tap",function(o){!1===r&&(e.bind(t)(o),r=!0,setTimeout(function(){r=!1},500)),n.blur(),o.stopImmediatePropagation()}):n.hammer().on("tap",function(r){e.bind(t)(r),n.blur(),r.stopImmediatePropagation()}):n.click(function(r){e.bind(t)(r),n.blur()}),(n.hammer||!n.is("button")&&!n.is("a"))&&n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){var e=a(this);e.hammer?e.hammer().off("tap"):e.unbind("click"),(e.hammer||!e.is("button")&&!e.is("a"))&&e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){var t=a(this);t.hammer?t.hammer().trigger("tap",e):t.trigger("click",e)})}}),a.fn.extend({clickOrHold:function(e,t,n){return n=n||3e3,this.each(function(){var r=!1,o=null;a(this).click(function(t){r||e.bind(this)(t),r=!1}),a(this).on("keydown",function(t){var n=t.which;13!==n&&32!==n||e.bind(this)({prevent:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})}),a(this).on("mousedown touchstart",function(){var e=this;o=setTimeout(function(){o=null,r=!0,t.bind(e)()},n)}),a(this).on("mouseup touchend",function(){null!==o&&(clearTimeout(o),o=null),r&&setTimeout(function(){r=!1},400)})})}}),void a.fn.extend({makeButton:function(e){"string"==typeof(e=e||{})&&(e={label:e}),this.attr({role:e.hasOwnProperty("role")?e.role:"button"});var t=this.attr("tabindex");return"undefined"!==r(t)&&!1!==t||this.attr({tabindex:"0"}),e.hasOwnProperty("label")&&this.attr({"aria-label":e.label}),e.hasOwnProperty("labelledby")&&this.attr({"aria-labelledby":e.labelledby}),this},makeLink:function(e){return this.attr({role:"link",tabindex:"0"}),e&&this.attr({"aria-label":e}),this}}))},function(e,t,n){var r;e.exports=(r=n(1).getConfigSync(),{getAJAXHeaders:function(){return null!=r.widget_language&&r.widget_language.length>0?{"Accept-Language":r.widget_language}:{}}})},function(e,t,n){e.exports=function(e){var t=n(26).createLogger("WebSQLAsyncKeyStore");function r(e,n,r){t.error("WebSQL Error: executeSQL triggered error: "+r.message),null!=e&&e(r)}var o=function(e,t){this.name=e||"BWDS1",this.initialized=!1,this.valid=!1,this.db=null,this.openDatabase=void 0!==t?t:window.openDatabase?window.openDatabase.bind(window):function(){console.error("webSQL not supported")}};return o.prototype._prepareDatabase=function(e,n){var r=this.openDatabase(this.name,"","Offline BW storage",5242880);return""==r.version&&(t.debug("WebSQL: creating db"),r.changeVersion(r.version,"1.0",function(e){t.debug("WebSQL: creating table"),e.executeSql("CREATE TABLE keyvalue (keyname PRIMARY KEY, dir, name, value, attribs)")},n)),r},o.prototype._initializeAndRun=function(e,n){if(this.initialized)this.valid?void 0!==e&&e():(t.debug("WebSQL Error: Database is initialized but not valid, calling error"),void 0!==n&&n(this.error));else if(this.initialized=!0,this.openDatabase){try{t.debug("WebSQL: initializing database"),this.db=this._prepareDatabase(function(e){t.debug("WebSQL Error: Received error while preparing database: "+e.message)}),this.valid=!0}catch(e){switch(e.code){case e.SECURITY_ERR:t.debug("WebSQL Error: Received security error: "+e.message);break;case e.INVALID_STATE_ERR:t.debug("WebSQL Error: Received invalid state error: "+e.message);break;default:t.debug("WebSQL Error: Received error "+e.code+": "+e.message)}return this.valid=!1,this.error=e,void n(e)}e()}else t.debug("WebSQL Error: No WebSQL database available"),this.valid=!1,this.error={code:9999,message:"WebSQL Error: No WebSQL database available"},n(this.error)},o.prototype._initializeAndRunTransaction=function(e,n,r){var o=this;this._initializeAndRun(function(){o.db[e?"readTransaction":"transaction"](function(e){try{n(e)}catch(e){t.error("Error while executing transaction: "+e.code+": "+e.message),null!=r&&r(e)}},function(e){t.error("WebSQL Error: "+e.code+" starting transaction :"+e.message),o.valid=!1,o.initialized=!1,null!=r&&r(e)})},function(e){t.error("WebSQL Error: database not valid"),null!=r&&r(e)})},o.prototype._initializeAndRunReadTransaction=function(e,t){this._initializeAndRunTransaction(!0,e,t)},o.prototype._initializeAndRunReadWriteTransaction=function(e,t){this._initializeAndRunTransaction(!1,e,t)},o.prototype.getItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: getItemsAsync without names"),void o({code:9999,message:"WebSQL Error: getItemsAsync without names"});this._initializeAndRunReadTransaction(function(a){for(var i="",s=0;s<e.length;++s)i+=(""==i?"":", ")+"?";a.executeSql("SELECT keyname, value, attribs FROM keyvalue where keyname IN ("+i+")",e,function(e,r){for(var o={},a=0;a<r.rows.length;++a){var i=r.rows.item(a);o[i.keyname]=i,t.debug("WebSQL: read ("+i.keyname+") = "+i.value)}n(o)},r.bind(null,o))},o)},o.prototype.getDirAttribs=function(e,t,n){this._initializeAndRunReadTransaction(function(o){o.executeSql("SELECT keyname, attribs FROM keyvalue where dir = ?",[e],function(e,n){for(var r={},o=0;o<n.rows.length;++o){var a=n.rows.item(o);r[a.keyname]=a.attribs}t(r)},r.bind(null,n))},n)},o.prototype.setItemsAsync=function(e,n,o){if(0===e.length)return t.error("WebSQL Error: setItemsAsync without names"),void o({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("WebSQL Error: setItemsAsync can only handle 1 item"),void o({code:9999,message:"setItemsAsync can only handle 1 item"});var a=e[0];this._initializeAndRunReadWriteTransaction(function(i){var s,c=a.key,l=c.lastIndexOf("/"),d="";-1!=l&&(d=c.substring(0,l)),s=c.substring(l+1),i.executeSql("INSERT OR REPLACE INTO 'keyvalue' ( 'keyname', 'dir', 'name', 'value', 'attribs' ) VALUES ( ? , ? , ?, ? , ? )",[a.key,d,s,a.value,a.attribs],function(r,i){i.rowsAffected!=e.length?(t.error("WebSQL Error: store error on key "+name),o({code:9999,message:"WebSQL store error: wrong # rows affected"})):null!=n?(t.debug("WebSQL: wrote ("+a.key+")"),n()):t.error("WebSQL Error: setItemsAsync no OK function")},r.bind(null,o))},o)},o.prototype.removeItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: removeItemsAsync without names"),void o({code:9999,message:"WebSQL Error: removeItemsAsync without names"});this._initializeAndRunReadWriteTransaction(function(a){for(var i="",s=0;s<e.length;++s)i+=(""==i?"":", ")+"?";a.executeSql("DELETE FROM keyvalue where keyname IN ("+i+")",e,function(r,o){t.debug("WebSQL: removed "+e.join(", ")),null!=n&&n()},r.bind(null,o))},o)},o.prototype.clearAllAsync=function(e,n){this._initializeAndRunReadWriteTransaction(function(o){o.executeSql("DELETE FROM keyvalue",[],function(n,r){t.debug("WebSQL: Cleared all"),null!=e&&e()},r.bind(null,n))},n)},o}()},function(e,t,n){var r=n(22).each,o=n(390);e.exports=function(e){var t=n(26).createLogger("IndexedDBAsyncKeyStore");var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;this.idbstore=t};return a.prototype.getItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore getItemsAsync"),0===e.length)return t.debug("IndexedDB Error: getItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: getItemsAsync without names"});var a={};e.reduce(function(e,n){return e.then(function(){return function(e){var n=this;return t.debug("readelem ",e),new Promise(function(r,o){n.idbstore.get(e).then(function(n){t.debug("read elem: "+e),null!=n&&(a[e]=n),r()},function(n){t.debug("error accessing elem: "+e),o(n)}).catch(function(e){t.error("Caught idb exception",e),o(e)})})}.bind(o,n)()})},Promise.resolve()).then(function(){n(a)},r)},a.prototype.getDirAttribs=function(e,n,o){t.debug("IndexedDBAsyncKeyStore getDirAttribs"),this.idbstore.direlems(e).then(function(e){var t={};r(e,function(e){t[e.keyname]=e.attribs}),n(t)},o)},a.prototype.setItemsAsync=function(e,n,r){if(t.debug("IndexedDBAsyncKeyStore setItemsAsync"),0===e.length)return t.error("IndexedDB Error: setItemsAsync without names"),void r({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("IndexedDB Error: setItemsAsync can only handle 1 item"),void r({code:9999,message:"setItemsAsync can only handle 1 item"});var o,a,i=e[0];this.idbstore.set(i.key,{keyname:i.key,value:i.value,attribs:i.attribs,dir:(o=i.key,a=o.lastIndexOf("/"),-1!=a?o.substring(0,a):"")}).then(function(){n()},r).catch(r)},a.prototype.removeItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore removeItemsAsync"),0===e.length)return t.debug("IndexedDB Error: removeItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: removeItemsAsync without names"});e.reduce(function(e,t){return e.then(function(){return o.idbstore.del(t)})},Promise.resolve()).then(function(){n()},r)},a.prototype.clearAllAsync=function(e,n){t.debug("IndexedDBAsyncKeyStore clearAllAsync"),this.idbstore.clear().then(e,n)},a}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"Store",function(){return i}),n.d(t,"get",function(){return c}),n.d(t,"set",function(){return l}),n.d(t,"del",function(){return d}),n.d(t,"clear",function(){return u}),n.d(t,"direlems",function(){return p});var o,a=n(391),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bwds-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storeName=n,this._dbp=new a(function(e,r){var o=indexedDB.open(t,1);o.onerror=function(){return r(o.error)},o.onsuccess=function(){return e(o.result)},o.onupgradeneeded=function(){o.result.createObjectStore(n).createIndex("dir_idx","dir")}})}var t,n,o;return t=e,(n=[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then(function(r){return new a(function(o,a){var i=r.transaction(n.storeName,e);i.oncomplete=function(){return o()},i.onabort=i.onerror=function(){return a(i.error)},t(i.objectStore(n.storeName))})})}}])&&r(t.prototype,n),o&&r(t,o),e}();function s(){return o||(o=new i),o}function c(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.get(e)}).then(function(){return t.result})}function l(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:s())._withIDBStore("readwrite",function(n){n.put(t,e)})}function d(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readwrite",function(t){t.delete(e)})}function u(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s())._withIDBStore("readwrite",function(e){e.clear()})}function p(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.index("dir_idx").getAll(e)}).then(function(){return t.result})}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r,o,a;e.exports=(r=n(191),o=n(54),a=n(26).createLogger("AsyncKeyStoreToBWDSAdapter"),function(e){var t={};function n(e,n){t.queue.executeSequential(function(t){try{e(t)}catch(e){console.error("AsyncBWDS: Uncaught error: "+e),r.handleException(e,n,t)}})}return t.async=e,t.queue=r.newCallbackQueue(),t.readNoSync=function(e,n,r){a.debug("readNoSync "+e),t.async.getItemsAsync([e],function(r){if(r.hasOwnProperty(e)){var o=JSON.parse(r[e].attribs);!1===o.removed?n(r[e].value,t.fileStat(e,o)):n(null,t.fileStat(e,o))}else n(null,null)},function(e){r(e)})},t.read=function(e,a){n(function(n){t.readNoSync(e,function(e,t){null==e?r.callSafe(a,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"),null,t):r.callSafe(a,null,e,t),n()},function(e){r.handleException(e,a,n)})},a)},t.writeNoSync=function(e,n,o,i){a.debug("writeNoSync "+e+" "+n);var s=null==n?0:n.length;t.async.getItemsAsync([e],function(a){var c,l=r.getDateTime();a.hasOwnProperty(e)?((c=JSON.parse(a[e].attribs)).updated_at=l,c.filesize=s,c.isdir=null==n,c.removed=!1,c.version=c.version+1,c.offline=!1):c={created_at:l,updated_at:l,filesize:s,isdir:null==n,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1},t.async.setItemsAsync([{key:e,value:null==n?"":n,attribs:JSON.stringify(c)}],function(n){if(""!=e){var r=e.lastIndexOf("/"),a="";-1!=r&&(a=e.substring(0,r)),t.writeNoSync(a,null,o,i)}else o(t.fileStat(e,c))},function(e){i(e)})},function(e){i(e)})},t.write=function(e,o,a){n(function(n){t.writeNoSync(e,null==o?"":o,function(e){r.callSafe(a,null,e),n()},function(e){r.handleException(e,a,n)})},a)},t.removeFiles=function(e,n,o){if(0==e.length)null!=n&&n();else{var i=e.shift(),s=i.attribs,c=r.getDateTime();s.removed=!0,s.offline=!1,s.updated_at=c,t.async.setItemsAsync([{key:i.name,value:"",attribs:JSON.stringify(s)}],function(){t.removeFiles(e,function(){n(s)},o)},function(){a.error("removeFiles, could not write new file attribs to clear, removing including attribs"),t.async.removeItemsAsync([i.name],function(){t.removeFiles(e,function(){n(s)},o)},o)})}},t.removeRecurse=function(e,n,r){if(0==e.length)null!=n&&n();else{var o=e.shift();t.async.getDirAttribs(o,function(o){var a=[];for(var i in o){var s=JSON.parse(o[i]);!1===s.removed&&(!0===s.isdir&&e.push(i),a.push({name:i,attribs:s}))}t.removeFiles(a,function(){t.removeRecurse(e,n,r)},r)},r)}},t.removeNoSync=function(e,n,i){a.debug("removeNoSync "+e),""==e?t.removeRecurse([e],n,function(e){r.handleException(e,i)}):t.async.getItemsAsync([e],function(a){if(a.hasOwnProperty(e)){var s=JSON.parse(a[e].attribs);!1===s.removed?s.isdir?t.removeFiles([{name:e,attribs:s}],function(){t.removeRecurse([e],n,function(e){r.handleException(e,i)})},function(e){r.handleException(e,i)}):t.removeFiles([{name:e,attribs:s}],function(r){n(t.fileStat(e,r))},function(e){r.handleException(e,i)}):i(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))}else i(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))},function(e){r.handleException(e,i)})},t.remove=function(e,o){n(function(n){t.removeNoSync(e,function(){r.callSafe(o,null),n()},function(e){r.callSafe(o,e),n()})},o)},t.dirNoSync=function(e,n,o){a.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(t){var o=[];for(var a in t)!1===JSON.parse(t[a]).removed&&""!=a&&o.push(r.trimLeadingSlash(a.substr(e.length)));o.length>0?n(o):n(null)},function(e){o(e)})},t.dir=function(e,a){n(function(n){t.dirNoSync(e,function(t){null!==t?r.callSafe(a,null,t):""===e?r.callSafe(a,null,[]):r.callSafe(a,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,a,n)})},a)},t.fileStat=function(e,t){return{name:e,size:t.filesize,created:t.created_at,modified:t.updated_at,isdir:t.isdir,removed:t.removed,version:t.version,backup_version:t.backup_version,backup_date:t.hasOwnProperty("backup_date")?t.backup_date:null,offline:!!t.hasOwnProperty("offline")&&t.offline}},t.dirStat=function(e,n,r,o){a.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(e){var o=[];for(var a in e)""!==a&&o.push(t.fileStat(a,JSON.parse(e[a])));r(n,o)},function(e){o(e)})},t.statNoSync=function(e,n,r){a.debug("statNoSync "+e),t.async.getItemsAsync([e],function(o){if(o.hasOwnProperty(e)){var a=JSON.parse(o[e].attribs),i=t.fileStat(e,a);a.isdir?t.dirStat(e,i,n,r):n(i)}else n(null)},function(e){r(e)})},t.stat=function(e,a){n(function(n){t.statNoSync(e,function(e,t){null!==e?void 0===t?r.callSafe(a,null,e):r.callSafe(a,null,e,t):r.callSafe(a,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,a,n)})},a)},t.setStatNoSync=function(e,n,i,s){a.debug("setStatNoSync "+e),t.async.getItemsAsync([e],function(a){if(a.hasOwnProperty(e)){var c=JSON.parse(a[e].attribs);for(var l in n)if("backup_date"==l)c.backup_date=n.backup_date;else{if("backup_version"!=l)return void s(r.error(o.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+l));c.backup_version=n.backup_version}t.async.setItemsAsync([{key:e,value:a[e].value,attribs:JSON.stringify(c)}],function(n){i(t.fileStat(e,c))},function(e){r.handleException(e,s)})}else s(r.error(o.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},function(e){s(e)})},t.setStat=function(e,o,a){n(function(n){t.setStatNoSync(e,o,function(e){r.callSafe(a,null,e),n()},function(e){r.callSafe(a,e),n()})},a)},t.executeSync=function(e,n){t.queue.executeSequential(e,n)},t.removeAll=function(e){var n=[""],r=[],o=null;!function a(){if(r.length>0){var i=r.shift();t.removeNoSync(i,function(){a()},function(){console.log("Could not remove ",i),o="Could not remove file",a()})}else if(0!==n.length){var s=n.shift();t.dirStat(s,null,function(e,t){for(var o=0;o<t.length;++o){var i=t[o];i.removed||(i.isdir?n.push(i.name):r.push(i.name))}a()},function(){console.log("Error getting stat for ",s),o="Error removing files",a()})}else e(o)}()},t.clearAll=function(e){a.debug("clearAll"),t.async.clearAllAsync?t.async.clearAllAsync(function(){a.debug("AsyncBWDS.clearAll OK callback"),r.callSafe(e)},function(t){r.handleException(t,e)}):t.removeAll(e)},t})},function(e,t,n){e.exports=function(e,t,r){var o=n(26).createLogger("SyncKeyStoreToBWDSAdapter");function a(t,n){try{t()}catch(t){o.error("Uncaught error: "+t),e.handleException(t,n)}}return function(n){var r={};function i(n,o,a){return!1!==r.keystore.setItem(n,o)||(e.callSafe(a,e.error(t.BWDS_ERROR_FULL,"KeyStoreBWDS error: storage full"),null),!1)}return r.keystore=n,r.write=function(t,n,s){a(function(){o.debug("write "+t);var a,c,l=n.length,d=t.lastIndexOf(".");if(-1==d?(a=t,c=""):(a=t.substr(0,d),c=t.substr(d+1)),i(a,n,s))if(""!=a){var u,p=a.lastIndexOf("/"),f="";-1!=p&&(f=a.substring(0,p)),u=a.substring(p);var h,g=r.keystore.getItem(f),m=e.getDateTime();null===g?(h={})[u]={type:c,created_at:m,updated_at:m,filesize:l,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1}:(h=JSON.parse(g))[u]?(h[u].type=c,h[u].updated_at=m,h[u].filesize=l,h[u].version=h[u].hasOwnProperty("version")?h[u].version+1:2,h[u].removed=!1,h[u].offline=!1):h[u]={type:c,created_at:m,updated_at:m,filesize:l,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1};var v=r.fileStat(f,u,h[u]);r.write(f+".dir",JSON.stringify(h),function(t){e.callSafe(s,t,v)})}else e.callSafe(s,null,null)},s)},r.read=function(n,i){a(function(){var a,s;o.debug("read "+n);var c=n.lastIndexOf(".");-1==c?(a=n,s=""):(a=n.substr(0,c),s=n.substr(c+1));var l,d=a.lastIndexOf("/"),u="";-1!=d&&(u=a.substring(0,d)),l=a.substring(d);var p=r.keystore.getItem(u);if(null!==p){var f=JSON.parse(p);if(f[l])if(s&&f[l].type!=s)e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null);else if(!0===f[l].removed)e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: removed file"),null,r.fileStat(u,l,f[l]));else{var h=r.keystore.getItem(a);e.callSafe(i,null,h,r.fileStat(u,l,f[l]))}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: unknown file"),null,null)}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null)},i)},r.clearDir=function(e){var t=r.keystore.getItem(e);if(null!=t){var n=JSON.parse(t);for(var a in n)"dir"==n[a].type&&""!=a&&r.clearDir(e+a),o.debug("Clearing: "+e+a),r.keystore.removeItem(e+a);r.keystore.removeItem(e)}},r.clear=function(t,n){a(function(){if(o.debug("clear "+t),t)throw Error("clear(): Unexpected parameter");r.clearDir(""),e.callSafe(n,null)},n)},r.removeDir=function(t,n){o.debug("removeDir("+t+")");var a=r.keystore.getItem(t);if(null!=a){var s=JSON.parse(a),c=e.getDateTime();for(var l in s){var d=s[l];!1===d.removed&&("dir"===d.type?""!==l&&r.removeDir(t+l,n):(o.debug("Clearing: "+t+l),r.keystore.removeItem(t+l)),s[l].version=s[l].hasOwnProperty("version")?s[l].version+1:2,s[l].removed=!0,s[l].updated_at=c)}if(!i(t,JSON.stringify(s),n))return}},r.remove=function(n,i){a(function(){if(o.debug("remove "+n),""==n||null==n||null==n)return r.removeDir("",i),void e.callSafe(i,null);var a,s,c=n.lastIndexOf("."),l=(a=-1==c?n:n.substr(0,c)).lastIndexOf("/"),d="";-1!=l&&(d=a.substring(0,l)),s=a.substring(l);var u=r.keystore.getItem(d);if(null!==u){var p=JSON.parse(u);if(!p[s])return o.error("unknown file"),void e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"));"dir"==p[s].type?r.removeDir(n,i):r.keystore.removeItem(a),p[s].removed=!0,p[s].version=p[s].hasOwnProperty("version")?p[s].version+1:2;var f=e.getDateTime();p[s].updated_at=f;var h=r.fileStat(d,s,p[s]);r.write(d+".dir",JSON.stringify(p),function(t){e.callSafe(i,t,h)})}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},i)},r.dir=function(n,i){a(function(){var a,s;if(o.debug("dir "+n),""!=n){var c,l=n.lastIndexOf("/"),d="";if(-1!=l&&(d=n.substring(0,l)),c=n.substring(l),null===(a=r.keystore.getItem(d)))return void e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"));if(!1===(s=JSON.parse(a)).hasOwnProperty(c)||"dir"!==s[c].type)return void e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"))}a=r.keystore.getItem(n),s=JSON.parse(a);var u=[];for(var p in s)!0!==s[p].removed&&u.push(e.trimLeadingSlash(p)+("dir"==s[p].type?"":"."+s[p].type));e.callSafe(i,null,u)},i)},r.fileStat=function(e,t,n){return{name:e+t+("dir"==n.type?"":"."+n.type),size:n.hasOwnProperty("filesize")?n.filesize:null==r.keystore.getItem(e+t)?0:r.keystore.getItem(e+t).length,created:n.created_at,modified:n.updated_at,isdir:"dir"==n.type,removed:n.hasOwnProperty("removed")&&!0===n.removed,version:n.version,backup_version:n.backup_version,backup_date:n.hasOwnProperty("backup_date")?n.backup_date:null,offline:!!n.hasOwnProperty("offline")&&n.offline}},r.dirStat=function(t,n,o){var a=r.keystore.getItem(t),i=JSON.parse(a),s=[];for(var c in i)s.push(r.fileStat(t,c,i[c]));e.callSafe(n,null,o,s)},r.stat=function(n,i){a(function(){if(o.debug("stat "+n),""!=n){var a,s,c=n.lastIndexOf("."),l=(a=-1==c?n:n.substr(0,c)).lastIndexOf("/"),d="";-1!=l&&(d=a.substring(0,l)),s=a.substring(l);var u=r.keystore.getItem(d);if(null!==u&&""!==u){var p=JSON.parse(u);if(p[s])return"dir"==p[s].type?void r.dirStat(n,i,r.fileStat(d,s,p[s])):void e.callSafe(i,null,r.fileStat(d,s,p[s]));e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(i,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else r.dirStat(n,i,{isdir:!0,name:""})},i)},r.setStat=function(n,s,c){a(function(){if(o.debug("stat "+n),""!=n){var a,l,d=n.lastIndexOf("."),u=(a=-1==d?n:n.substr(0,d)).lastIndexOf("/"),p="";-1!=u&&(p=a.substring(0,u)),l=a.substring(u);var f=r.keystore.getItem(p);if(null!==f){var h=JSON.parse(f);if(h[l]){if("dir"==h[l].type)return void e.callSafe(c,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"));for(var g in s)if("backup_date"==g)h[l].backup_date=s.backup_date;else{if("backup_version"!=g)return void e.callSafe(c,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+g));h[l].backup_version=s.backup_version}if(!i(p,JSON.stringify(h),c))return;e.callSafe(c,null,r.fileStat(p,l,h[l]))}else e.callSafe(c,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(c,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(c,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"))},c)},r.executeSync=function(e,t){e(function(){})},r.clearAll=function(e){a(function(){r.clear("",e)},e)},r}}(n(191),n(54))},function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(1),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(49).o,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(429),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(9),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(7),s=t.getConfigSync();return{createWidgetStorage:function(t,n,c,l,d,u,p,f){var h={},g=null,m=null,v=-1,w=null;return h.loadAll=function(o){var h,b,y,C={"widget-id":c,"widget-type":t,"widget-name":n,"teacher-id":d,"school-id":u,"course-id":p,"class-id":f};"undefined"!=typeof bwshortcode&&(C["widget-shortcode"]=bwshortcode),h=C,b=function(e){g=e.id,m=e.url,v=e.version,w=JSON.parse(e.data),e.isObserved&&a.showInfoMessage(i("Your progress on this activity will be shared with your teacher.")+' <i><a href="https://www.bookwidgets.com/kb/live-activity-widget" target="_blank">'+i("More info")+"</a></i>");try{o(l?w.hasOwnProperty("DATA")?w.DATA:"":w,v)}catch(e){console.error("Error in widget load callback"),console.error(e)}},y=function(e){403===e.status?(console.log("Online  storage nog allowed in this case, use offline storage: ",e.responseText),r.setForceOfflineStorage()):(console.error("Got error reading widget data"),r.goOffline()),o(l?null:{},-1)},e.ajax({type:"GET",dataType:"json",data:h,timeout:3e4,headers:{Authorization:"BWWAAuthToken "+r.getUserToken()},url:s.student_account_server+"/widget-storage/",connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:b,error:y})},h.overwrite=function(t,n){var o=l?{DATA:t}:t;!function(t,n,o,a,i,s){var c={version:o,data:JSON.stringify(a),i:1},l=r.getUserToken();e.ajax({type:"PUT",contentType:"text/plain",data:JSON.stringify(c),url:n,headers:{Authorization:"BWWAAuthToken "+l},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:i,error:s})}(0,m,v,o,function(e){v=e.version,e.hasOwnProperty("url")&&(m=e.url),w=e.hasOwnProperty("data")?JSON.parse(e.data):o,n({status:"OK",data:l?w.hasOwnProperty("DATA")?w.DATA:null:w,version:v})},function(e,t,o){if(console.log("Got error putting widget data"),409==e.status){console.log("Conflict, someone wrote newer data");var a=JSON.parse(e.responseText);v=a.version,w=JSON.parse(a.data),n({status:"CONFLICT",data:l?w.hasOwnProperty("DATA")?w.DATA:null:w,version:v})}else r.goOffline(),n({status:"OFFLINE"})})},h.write=function(e,t){this.overwrite(l?e:function(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}(w,e),t)},h.writeImage=function(t,n){var a=e.Deferred();return function(t,n){var o=r.getUserToken(),a={name:n};return e.ajax({type:"POST",data:a,url:s.student_account_server+"/widget-storage/"+t+"/resources",headers:{Authorization:"BWWAAuthToken "+o},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}}})}(g,t).done(function(t){(function(t,n,r){var a=new FormData,i=new o([r],{type:"image/jpeg"});return a.append("file",i),e.ajax({url:t,data:a,processData:!1,contentType:!1,type:"POST"})})(t.upload_url,0,n).done(function(){a.resolve()}).fail(function(){console.log("upload resource failed"),a.reject()})}).fail(function(){console.log("getting image url failed"),a.reject()}),a},h.clearImage=function(t){return e.Deferred().resolve()},h.readImage=function(t){var n=s.student_account_server+"/widget-storage/"+g+"/resources/"+t,o=r.getUserToken(),a=e.Deferred();return e.ajax({url:n,headers:{Authorization:"BWWAAuthToken "+o},type:"GET"}).done(function(t){e.ajax({url:t.url,type:"GET"}).done(function(e){a.resolve(e)}).fail(function(){a.reject()})}).fail(function(){a.reject()}),a},h.sync=function(e){e()},h}}}.bind(null,n(0));e.exports={f:r,o:r()}},function(e,t){e.exports=window.Blob},function(e,t,n){var r,o,a;e.exports=(r=n(0),(a={}).init=function(){0===r("#storage-busy-marker").length&&r(document.createElement("div")).attr("id","storage-busy-marker").appendTo(".closebutton-container"),o=0},a.start=function(){0==o&&r("#storage-busy-marker").addClass("busy"),++o},a.end=function(){0==--o&&r("#storage-busy-marker").removeClass("busy")},a)},function(e,t,n){var r,o,a,i,s,c,l,d,u;e.exports=(r=n(1),o=n(49).o,a=n(113),i=n(0),s=n(7),c=n(40),l=n(2),d=n(9),u=r.getConfigSync(),{init:function(){function e(){return o.getState()===o.ANONYMOUS?o.requestSignin():o.requestSignout()}function t(){if(l.isPreview()){var t=o.hasSchool()?s("Students need school accounts associated with %(school)s (%(schoolCode)s) in order to sign in.").replace("%(school)s",u.student_account_school.name).replace("%(schoolCode)s",u.student_account_school.code)+"<br><br>":s("Any BookWidgets student account can be used to sign in.")+"<br><br>";d.showAlert(s("Your widget will require students to sign in.")+"<br><br>"+t+s("In widget preview mode sign in is not required / not supported."),s("Sign in not available"))}else a.pushAsyncFunc(e)}function n(e){var t="anonymous",n=s("Not signed in");switch(e){case o.OFFLINE:t="offline",n=s("You're offline");break;case o.ONLINE:t="online";var r=o.getUserName();-1!=r.indexOf("@")&&(r=r.substring(0,r.indexOf("@"))),n=r}var a=i("#loginbutton");if((a.safeHtml()!==n||a.attr("state")!==t)&&(a.safeHtml(n).attr({state:t}),e==o.OFFLINE||e==o.ONLINE)){var l=i(document.createElement("div")).addClass("login-change-wrapper").appendTo("#top-container"),d=a.clone();d.attr("id","login-change-alert").appendTo(l).fadeIn(400,"swing",function(){setTimeout(function(){d.fadeOut(400,"swing",function(){l.remove()})},1e3)}),a.effect&&a.effect("pulsate",{times:4},500)}c.centerTitle()}var r;r=i(document.createElement("div")).addClass("loginbutton bw-tooltext").attr("id","loginbutton"),c.prependToTitleToolbar(r),n(o.ANONYMOUS),r.tapOrClick(t),o.initialized().then(function(){n(o.getState()),o.registerStateChangeCallback(n)},function(){n(o.ANONYMOUS),i("#loginbutton").hide()})}})},function(e,t,n){var r,o,a,i,s,c=n(18).o;e.exports=(n(1),r=n(6),n(3),o=n(4),a=n(433),i=n(0),s=n(5),function(e,t){var n={};return n.RichText={save:function(e){var n=i(e).find(".rteditor").safeHtml(),r=i(e).attr("id");return t.questionIf[r].lastSavedData=n,n},load:function(e,n){var r=i(e).attr("id");t.questionIf[r].lastSavedData=n;var o=i(e).find(".rteditor").safeHtml(n);a.sanitizeEditor(o)},clear:function(e){i(e).find(".rteditor").safeHtml("")},render:function(n,s,l){var d="QC"+s,u=i("#"+d),p=u.attr("qindex"),f=e.getQuestionImageDivs(u,n.imgsize,n.img,n.imgpos),h=t.getNumbering(n,p);u.attr("numbering",h),u.attr("scoring-weight",n["scoring-weight"]);var g=t.createQuestionDiv(h,n.Question).appendTo(f.questdiv);r.process(g),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(f.audiodiv);var m=i(document.createElement("div")).addClass("ml-cover hidecover").appendTo(f.answerdiv),v=a.createEditor(d+"_rteditor",m);t.addSpellCheckAttrib(v);var w={lastSavedData:""};t.questionIf[d]=w,w.setReadOnly=function(e){e?(v.parent().find(".btn-toolbar-wrapper").hide(),v.attr("contenteditable","false")):(v.parent().find(".btn-toolbar-wrapper").show(),v.attr("contenteditable","true"))};var b=c.createThrottler(function(){if(null!=l){var e=v.safeHtml(),n=v.closest(".content").attr("id");t.questionIf[n].lastSavedData!=e&&l()}});null!=l&&v.on("blur keyup paste input",function(){b.trigger()}),t.createHint(n,f.hintdiv),f.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,f.imgdiv),t.processEmbeddedElements(u)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(t,n,r){var o=i(t),a=o.find(e.MH).safeHtml(),c=o.find(".rteditor").safeHtml(),l=s.check.RichText(r,c);return{question:a,answer:c,correctness:l.correctness,score:l.score,outof:l.outof}}},n})},function(e,t,n){n(434);var r=n(435).sanitizeNode;e.exports=function(e,t,o,a){function i(e){r(e[0])}return window.jQuery||(window.jQuery=t),n(436),n(437),{createEditor:function(n,r){var s=t(document.createElement("div")).addClass("rteditor-toolbar-wrapper").appendTo(r),c=t(document.createElement("div")).addClass("bw-toolbar").attr({id:n+"_toolbar","data-role":"editor-toolbar","data-target":"#"+n}).appendTo(s),l=t(document.createElement("div")).addClass("rtwrapper").appendTo(r),d=t(document.createElement("div")).attr("id",n+"").addClass("rteditor").appendTo(l);function u(e,n){var r;n.hasOwnProperty("color")?(r=t(document.createElement("a")).addClass("btn bw-toolbutton btn-color").append(t(document.createElement("div")).addClass("bw-icon bw-icon-fill-drop")).appendTo(e),t(document.createElement("div")).addClass("bw-icon bw-icon-fill-drop-small").appendTo(r).css("color",n.color)):r=t(document.createElement("a")).addClass("btn bw-toolbutton").append(t(document.createElement("div")).addClass(n.iconclass)).appendTo(e),n.hasOwnProperty("id")&&r.attr("id",n.id),n.hasOwnProperty("data-edit")&&r.attr("data-edit",n["data-edit"])}function p(e,n){for(var r=t(document.createElement("div")).addClass("bw-button-group").appendTo(e),o=0;o<n.length;++o)u(r,n[o])}return d.on("paste",function(){setTimeout(function(){i(d)})}),p(c,[{id:"btn-clear",title:"Clear",iconclass:"bw-icon bw-icon-trash"}]),document.queryCommandSupported("undo")&&-1==e.getPlatform().indexOf("ipad")&&p(c,[{"data-edit":"undo",title:"Undo",iconclass:"bw-icon bw-icon-undo"},{"data-edit":"redo",title:"Redo",iconclass:"bw-icon bw-icon-redo"}]),p(c,[{"data-edit":"bold",title:"Bold",iconclass:"bw-icon bw-icon-bold"},{"data-edit":"italic",title:"Italic",iconclass:"bw-icon bw-icon-italic"},{"data-edit":"strikethrough",title:"Strikethrough",iconclass:"bw-icon bw-icon-strikethrough"},{"data-edit":"underline",title:"Underline)",iconclass:"bw-icon bw-icon-underline"}]),p(c,[{"data-edit":"insertunorderedlist",title:"Bullet list",iconclass:"bw-icon bw-icon-list-ul"},{"data-edit":"insertorderedlist",title:"Number list",iconclass:"bw-icon bw-icon-list-ol"},{"data-edit":"outdent",title:"Reduce indent",iconclass:"bw-icon bw-icon-outdent"},{"data-edit":"indent",title:"Indent",iconclass:"bw-icon bw-icon-indent"}]),p(c,[{"data-edit":"justifyleft",title:"Align Left",iconclass:"bw-icon bw-icon-align-left"},{"data-edit":"justifycenter",title:"Center)",iconclass:"bw-icon bw-icon-align-center"},{"data-edit":"justifyright",title:"Align Right)",iconclass:"bw-icon bw-icon-align-right"},{"data-edit":"justifyfull",title:"Justify",iconclass:"bw-icon bw-icon-align-justify"}]),p(c,[{"data-edit":"foreColor black",title:"Color black",color:"black"},{"data-edit":"foreColor red",title:"Color red",color:"red"},{"data-edit":"foreColor blue",title:"Color blue",color:"blue"},{"data-edit":"foreColor green",title:"Color green",color:"green"}]),c.find("#btn-clear").click(function(){a.showConfirmationDialog(o("Clear the text and start over?"),o("Are you sure?"),function(){t("#"+n).safeHtml("")},null,o("Yes, clear"),o("No, keep"))}),t("#"+n).wysiwyg({toolbarSelector:"#"+n+"_toolbar[data-role=editor-toolbar]"}),d},sanitizeEditor:i}}(n(2),n(0),n(7),n(9))},function(e,t,n){},function(e,t){var n=["DIV","SPAN","P","U","I","B","EM","STRONG","STRIKE","UL","LI","OL","FONT","BR","BLOCKQUOTE"],r=["STYLE","SCRIPT","TEXTAREA","NOSCRIPT","INPUT","IMG"],o=["color","font-weight","text-align","font-style","text-decoration"];function a(e){if(1===e.nodeType){var t=e.tagName;return-1===n.indexOf(t)?-1===r.indexOf(t)?2:1:0}return-1}function i(e){if(null==e)return e;for(var t=e.split(";"),n=[],r=0;r<t.length;++r)for(var a=t[r],i=0;i<o.length;++i)if(a.startsWith(o[i])){n.push(a);break}return n.join(";")}e.exports={sanitizeNode:function e(t){for(var n=t.childNodes,r=0;r<n.length;++r){var o=n[r];switch(a(o)){case 0:if(o.hasAttributes())for(var s=o.attributes,c=s.length-1;c>=0;c--){var l=s[c].name;switch(l){case"style":o.setAttribute("style",i(s[c].value));break;case"color":case"align":break;default:o.removeAttribute(l)}}e(o);break;case 1:t.removeChild(o);break;case 2:var d=o.textContent;if(null!=d){var u=document.createElement("span");u.textContent=d,t.replaceChild(u,o)}else t.removeChild(o)}}}}},,function(e,t){!function(e){"use strict";e.fn.cleanHtml=function(){var t=e(this).html();return t&&t.replace(/(<br>|\s|<div><br><\/div>|&nbsp;)*$/,"")},e.fn.wysiwyg=function(t){var n,r,o,a,i=this,s=function(){r.activeToolbarClass&&e(r.toolbarSelector).find(o).each(function(){var t=e(this).data(r.commandRole);t=t.split(" ").shift(),document.queryCommandState(t)?e(this).addClass(r.activeToolbarClass):e(this).removeClass(r.activeToolbarClass)})},c=function(e,t){var n=e.split(" "),r=n.shift(),o=n.join(" ")+(t||"");document.execCommand(r,0,o),s()},l=function(){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)},d=function(){n=l()},u=function(){var e=window.getSelection();if(n){try{e.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}e.addRange(n)}},p=function(t){i.focus(),e.each(t,function(t,n){/^image\//.test(n.type)?e.when(function(t){var n=e.Deferred(),r=new FileReader;return r.onload=function(e){n.resolve(e.target.result)},r.onerror=n.reject,r.onprogress=n.notify,r.readAsDataURL(t),n.promise()}(n)).done(function(e){c("insertimage",e)}).fail(function(e){r.fileUploadError("file-reader",e)}):r.fileUploadError("unsupported-file-type",n.type)})},f=function(e,t){u(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,t||"transparent"),d(),e.data(r.selectionMarker,t)};return r=e.extend({},e.fn.wysiwyg.defaults,t),o="a[data-"+r.commandRole+"],button[data-"+r.commandRole+"],input[type=button][data-"+r.commandRole+"]",a=r.hotKeys,e.each(a,function(e,t){i.keydown(e,function(e){i.attr("contenteditable")&&i.is(":visible")&&(e.preventDefault(),e.stopPropagation(),c(t))}).keyup(e,function(e){i.attr("contenteditable")&&i.is(":visible")&&(e.preventDefault(),e.stopPropagation())})}),""!=e(this).attr("placeholder")&&(""==e(this).html()&&e(this).html(e(this).attr("placeholder")),e(this).html()==e(this).attr("placeholder")&&e(this).addClass("placeholderText"),e(this).bind("focus",function(t){if(""!=e(this).attr("placeholder")&&e(this).text()==e(this).attr("placeholder")){var n=this;setTimeout(function(){e(n).removeClass("placeholderText"),e(n).html("")},10)}}),e(this).bind("blur",function(t){""!=e(this).attr("placeholder")&&""==e(this).text()&&(e(this).addClass("placeholderText"),e(this).html(e(this).attr("placeholder")))})),r.dragAndDropImages&&i.on("dragenter dragover",!1).on("drop",function(e){var t=e.originalEvent.dataTransfer;e.stopPropagation(),e.preventDefault(),t&&t.files&&t.files.length>0&&p(t.files)}),function(t,n){t.find(o).click(function(){u(),i.focus(),c(e(this).data(n.commandRole)),d()}),t.find("[data-toggle=dropdown]").click(u),t.find("input[type=text][data-"+n.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="",u(),t&&(i.focus(),c(e(this).data(n.commandRole),t)),d()}).on("focus",function(){var t=e(this);t.data(n.selectionMarker)||(f(t,n.selectionColor),t.focus())}).on("blur",function(){var t=e(this);t.data(n.selectionMarker)&&f(t,!1)}),t.find("input[type=file][data-"+n.commandRole+"]").change(function(){u(),"file"===this.type&&this.files&&this.files.length>0&&p(this.files),d(),this.value=""})}(e(r.toolbarSelector),r),i.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){d(),s()}),e(window).bind("touchend",function(e){var t=i.is(e.target)||i.has(e.target).length>0,n=l();n&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&!t||(d(),s())}),this},e.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function(e,t){console.log("File upload error",e,t)}}}(window.jQuery)},function(e,t,n){var r,o=n(18).o;e.exports=(n(1),r=n(0),function(e,t){var n={};return n.ExtraMultiLine={save:function(e){return r(e).find(".edit").val()},load:function(e,t){var n=r(e).find(".edit");n.val(t),n.trigger("change")},clear:function(e){r(e).find(".edit").val("")},render:function(e,n,a){var i=r("#QC"+n),s=i.attr("qindex"),c=t.getNumbering(e,s);i.attr("numbering",c);var l=r(document.createElement("div")).addClass("eml-cover").appendTo(i);r(document.createElement("div")).addClass("eml-question").safeHtml(e.label).appendTo(l);var d=r(document.createElement("textarea")).addClass("edit");t.addSpellCheckAttrib(d),d.appendTo(l),d.xarea(),d.next().attr("aria-hidden","true");var u=o.createThrottler(a);d.bind("keyup change",function(){u.trigger()})},getAnswer:function(e){var t=r(e).find(".eml-question").html(),n=r(e).find(".edit").val();return{question:t,answer:n,correctness:""==n?-1:-2,score:0,outof:0}}},n})},function(e,t,n){var r,o;e.exports=(n(1),r=n(0),o=n(25),function(e,t){var n={};return n.ExtraCheckbox={save:function(e){return"checked"==r(e).find(".bw-checkbox").attr("checked")?"yes":"no"},load:function(e,t){var n=r(e).find(".bw-checkbox");"yes"==t?n.trigger("check"):n.trigger("clear")},clear:function(e){r(e).find(".bw-checkbox").trigger("clear")},render:function(e,n,a){var i="QC"+n,s=r("#"+i),c=s.attr("qindex"),l=t.getNumbering(e,c);s.attr("numbering",l);var d=r(document.createElement("div")).addClass("ecb-cover").appendTo(s);if(o.createLabeledCheckbox(d,e.label,function(){null!=a&&a(),d.find(".mandatory-field-reminder").hide()}),r(document.createElement("div")).addClass("mandatory-field-reminder").safeHtml(e.mandatory_reminder).appendTo(d),"yes"==e.mandatory){var u={};t.questionIf[i]=u,u.mandatoryFieldsOK=function(){return"checked"===d.find(".bw-checkbox").attr("checked")},u.showMandatoryFieldReminder=function(){"checked"!==d.find(".bw-checkbox").attr("checked")&&d.find(".mandatory-field-reminder").show()}}},getAnswer:function(e){return{question:r(e).find(".bw-checkbox-label").html(),answer:"checked"===r(e).find(".bw-checkbox").attr("checked")?"yes":"no",correctness:1,score:0,outof:0}}},n})},function(e,t,n){var r,o,a,i,s,c,l=n(18).o;e.exports=(n(1),r=n(6),o=n(3),a=n(4),i=n(2),s=n(0),n(441),c=n(5),function(e,t){var n={};return n.FillInText={name:"FillInText",getData:function(e){var t=[];return s(e).find(".edit").each(function(e){if(s(this).is("input")){var n=s(this).val().trim();t.push(n)}else s(this).is("select")&&(n=s(this).find("option:selected").text(),t.push(n))}),t},save:function(e){return JSON.stringify(this.getData(e))},load:function(e,t){var n=s(e),r=JSON.parse(t),o=0;n.find(".edit").each(function(e){s(this).is("input")?s(this).val(r[o++]).trigger("update"):s(this).is("select")&&s(this).val(r[o++].trim()).attr("selected",!0)}),this.check(n)},clear:function(e){s(e).find(".edit").each(function(e){var t=s(this);t.is("input")?t.val("").trigger("update"):t.is("select")&&(this.selectedIndex=-1,t.trigger("change"))}),this.check(e)},getCheckInput:function(e){return this.getData(e)},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=c.check.FillInText(n,r),a=0;e.find(".edit").each(function(e){var n=o.correctness[a++],r=s(this);if(r.is("input"))switch(n){case-2:t.setTag(r.parent(),"fit-open");break;case-1:t.clearTag(r.parent(),"fit-open"),t.clearTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-wrong");break;case 0:t.clearTag(r.parent(),"fit-answer"),t.setTag(r.parent(),"fit-wrong");break;case 1:t.setTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-wrong")}else if(r.is("select"))switch(n){case-1:t.setTag(r.parent(),"fit-empty"),t.clearTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-wrong");break;case 0:t.clearTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-empty"),t.setTag(r.parent(),"fit-wrong");break;case 1:t.setTag(r.parent(),"fit-answer"),t.clearTag(r.parent(),"fit-empty"),t.clearTag(r.parent(),"fit-wrong")}})},render:function(n,d,u,p){var f=this,h="QC"+d,g=(p=p||s("#"+h)).attr("qindex"),m={};t.questionIf[h]=m,m.setReadOnly=function(e){-1==i.getPlatform().indexOf("ipad")&&p.find("input, select").prop("disabled",e)},m.loadCorrect=function(e){var t=p.find("input"),n=p.find("select"),r=0,o=0;c.processFillInText(c.getFITText(e),function(e,a){if(null!==a)if("text"===a.type)s(t[r++]).val(a.typeconfig);else{var i=a.typeconfig.split("##")[0].trim();s(n[o++]).val(i).attr("selected",!0)}}),f.check(p)},m.repaint=function(){p.find("input").trigger("update")};var v=function(e){var r=0,a="";return c.processFillInText(o.prepare(e),function(e,o){r+=1,a+=e,null!==o&&(a+=function(e,r){var o=e.type,a=e.typeconfig,i=e.style;if("text"===o)return"<span><input type='text' "+t.inputModeAttrib(n.keyboard)+t.spellcheckattrib()+"class='edit' id='"+r+"' style=\""+i.join(";")+'"></input></span>';if("select"===o){for(var c=a.split(/\|\||##/),l=0;l<c.length;++l)c[l]=c[l].trim();if(0===c.length)return"<span>Fill In Blanks: INVALID SELECT<span>";c.sort();var d="<span><select class='edit' id='"+r+"' style=\""+i.join(";")+'">';for(d+='<option value="" data-placeholder="true">-</option>',l=0;l<c.length;++l)d+='<option value="'+c[l]+'">'+c[l]+"</option>";return d+="</select></span>",d+='<span class="print-only-inline">('+s(document.createElement("div")).text(c.join(" / ")).safeHtml()+")</span>"}return"<span>Fill In Blanks: INVALID Type ("<<o<<")<span>"}(o,"FIT_"+d+"_"+r))}),a}(c.getFITText(n)),w=t.getNumbering(n,g);p.addClass("fillintext"),p.attr("numbering",w),p.attr("scoring-weight",n["scoring-weight"]);var b=e.getQuestionImageDivs(p,n.imgsize,n.img,n.imgpos),y=c.isLegacyFITStyle(n)?[v,""]:[o.prepare(n.Question),v],C=t.createQuestionDiv(w,y[0]).appendTo(b.questdiv);r.process(C);var k=s(document.createElement("div")).addClass("fit-sentence").safeHtml(y[1]).appendTo(b.answerdiv);r.process(k),p.find("select").each(function(){t.setTag(s(this).parent(),"fit-empty")}),p.find("input, select").each(function(){t.createCorrectWrongMarker().appendTo(s(this).parent())});try{p.find("input:text").autoGrowInput()}catch(e){console.log(e)}p.find(".fit-empty").each(function(){var e=s(this);e.removeClass("fit-empty"),t.setTag(e,"fit-empty")}),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(b.audiodiv),t.createHint(n,b.hintdiv),b.rationalediv.addClass("rationalediv");var T=l.createThrottler(u);return p.find("input").each(function(e){s(this).bind("keyup change",function(){T.trigger()})}),p.find("select").each(function(e){s(this).bind("change",function(e,t){T.trigger()})}),t.createOptionalImage(n,b.imgdiv),t.processEmbeddedElements(p),p},prepareCorrection:function(e,n){var r={"case-sensitive":n["case-sensitive"],Question:n.Question,Sentence:n.Sentence,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var a,i=this;e.find("input").on("keyup change update",function(){i.check(e)}),i.check(e),e.find("select").on("change",function(){i.check(e)});var s=function(e){var t=!1,n="";return c.processFillInText(o.prepare(e),function(e,r){if(n+=e,null!==r){var o=function(e){var t,n=e.type,r=e.typeconfig;if("text"==n)return(t=r.split(/\|\||##/)).length>0?t.join(" / "):"";if("select"==n){var o=r.split(/\|\||##/);return 0===o.length?"Fill In Blanks: INVALID SELECT":o[0]}return"Fill In Blanks: INVALID Type ("<<n<<")"}(r);""!==o||"select"===r.type?(n+='<span class="answer">'+o+"</span>",t=!0):n+="_____"}}),t?n:null}(c.getFITText(n));return null!==s&&(a="<div class='the-answer bw-richtext' >"+t.translate("The answer:")+"<br><br>"+s+"</div>"),t.createRationale(n,e.find(".rationalediv"),a),{extrarationale:a}},getAnswer:function(e,t,n){var r=s(e),a=function(e){var t="";return c.processFillInText(o.prepare(e),function(e,n){t+=e,null!==n&&(t+="_____")}),t}(n.Question),i=function(e){var t="";return c.processFillInText(o.prepare(e),function(e,n){t+=e,null!==n&&(t+=n.typeconfig.split("##")[0])}),t}(c.getFITText(n)),l=this.getCheckInput(r),d=c.check.FillInText(n,l);return{question:a,"report-question":a,answer:l,check_input:l,correctness:d.correctness,score:d.score,outof:d.outof,canonicalAnswer:i,canonicalAnswerCSS:{"font-size":"20px"}}}},n})},function(e,t,n){var r;e.exports=void((r=n(0)).fn.autoGrowInput=function(e){return e=r.extend({maxWidth:1500,minWidth:0,comfortZone:40},e),this.filter("input:text").each(function(){var t=e.minWidth||r(this).width(),n="",o=r(this),a=r(document.createElement("tester")).css({position:"absolute",top:-9999,left:0,width:"auto",fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),letterSpacing:o.css("letterSpacing"),whiteSpace:"nowrap",opacity:.01}).attr("aria-hidden","true");a.insertAfter(o),r(this).bind("keyup keydown blur update",function(){if(!o.is(":hidden")&&n!==(n=o.val())){var r=(n=o.val()).replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");a.safeHtml(r);var i=a.width(),s=Math.min(Math.max(i+e.comfortZone,t),e.maxWidth);o.width(s)}})}),this})},function(e,t,n){var r,o,a,i,s,c;e.exports=(r=n(1),o=n(6),a=n(193),n(3),i=n(4),s=n(0),c=n(5),function(e,t){var n=r.getConfigSync(),l={};return l.FillInTable={save:function(e){var n=s(e).attr("id");return JSON.stringify(t.questionIf[n].table.getData())},load:function(e,n){var r=s(e).attr("id"),o=JSON.parse(n);t.questionIf[r].table.setData(o)},clear:function(e){var n=s(e).attr("id");t.questionIf[n].table.clear()},render:function(r,c,l,d){var u="QC"+c,p=(d=d||s("#"+u)).attr("qindex"),f=e.getQuestionImageDivs(d,r.imgsize,r.img,r.imgpos),h=t.getNumbering(r,p);d.attr("numbering",h);var g=t.createQuestionDiv(h,r.Question).appendTo(f.questdiv);o.process(g),r.audio&&""!=r.audio&&i.createPlayer(r.audio,"quiz"==e.getWidgetType()).appendTo(f.audiodiv);var m="table_"+c,v=s(document.createElement("div")).addClass("table-cover").attr("id",m).appendTo(f.answerdiv);f.answerdiv.addClass("table-scroll-wrapper");var w=a({tablediv:"#"+m,tabledata:r.tabledata,support_correction_colors:t.widgetSupportsCorrection(),spellcheck:"yes"===n.spellcheck});null!=l&&w.setChangeCallBack(l);var b={};b.table=w,t.questionIf[u]=b,b.repaint=function(){w.render()},b.setReadOnly=function(e){!1===e&&"no"===n.color_correct_answers&&w.setCorrectionCallback(null),w.setReadOnly(e),setTimeout(w.render.bind(w))},b.loadCorrect=function(e){this.table.loadCorrect(e.tabledata)},v.show(),t.createHint(r,f.hintdiv),f.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,f.imgdiv),t.processEmbeddedElements(f.questdiv)},prepareCorrection:function(e,n){var r={"case-sensitive":n["case-sensitive"],tabledata:n.tabledata,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=e.attr("id"),a=t.questionIf[o].table;a.setCorrectionCallback(function(){return c.check.FillInTable(n,a.getCheckInput())}),t.createRationale(n,e.find(".rationalediv"))},getAnswer:function(n,r,o,a){for(var i=s(n),l=i.attr("id"),d=t.questionIf[l].table,u=i.find(e.MH).html(),p=d.getCheckInput(),f=c.check.FillInTable(o,p),h=[],g=0;g<f.correctioninfo.length;++g){var m=f.correctioninfo[g];h.push(d.getFormattedValueForCell(m.row,m.column))}return{question:u,annotatedtable:d.getEmailTable(a,f),answer:h,check_input:p,correctness:f.correctness,score:f.score,outof:f.outof}}},l})},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,a=n(92).spellCheckAttribs;e.exports=void(o=n(0)).fn.extend({bwtable:function(e,t){function n(e,t){var n=e.data("config");if(n){var r=e.find("tr");e.toggleClass("readonly",!0===n.readOnly);for(var a=0;a<r.length;++a)for(var i=o(r[a]),s=n.data[a],c=i.find("td"),l=0;l<c.length;++l){var d=s[l],u=o(c[l]);if(t||d!==u.attr("value")){var p=n.cells(a,l),f=o(document.createElement("div")).addClass("bw-table-cell-contents").safeHtml(d);u.find(".bw-table-cell-contents").replaceWith(f),p.hasOwnProperty("renderer")&&p.renderer(e,u[0],a,l,null,d,p),u.attr("value",d),u.find("textarea").val(d)}}}}function i(e){e.css("height",e.parent().innerHeight())}if("string"==typeof e)return l=this,u=t,void("render"===(d=e)?(n(l,!0),l.find("textarea").each(function(){i(o(this))})):"loaddata"===d?(s=l,c=u,s.data("config").data=c,n(l,!1)):"updateSettings"===d?(function(e,t){var n=e.data("config");for(var r in t)n[r]=t[r]}(l,u),n(l,!0)):console.error("Unknown bwtable command: ",d));var s,c,l,d,u;"object"===r(e)&&function(e,t){e.empty();for(var r=o(document.createElement("table")).addClass("bw-table"),s=o(document.createElement("tbody")).appendTo(r),c=0;c<t.data.length;++c)for(var l=t.data[c],d=o(document.createElement("tr")).appendTo(s),u=0;u<l.length;++u){var p=l[u],f=o(document.createElement("td")).attr("value",p).appendTo(d);t.hasOwnProperty("colWidths")&&f.css({width:t.colWidths[u]});var h=t.cells(c,u);if(o(document.createElement("div")).addClass("bw-table-cell-contents").safeHtml(p).appendTo(f),h.hasOwnProperty("renderer")&&h.renderer(e,f[0],c,u,null,p,h),!0!==h.readOnly){var g=o(document.createElement("textarea")).addClass("bw-table-cell-input").val(p).appendTo(f).attr(a(t.spellcheck)).on("focus",function(){var e=o(this);e.parent().addClass("editing"),i(e)}).on("blur",function(t,r){return function(){var a=o(this),i=a.parent().parent().parent().parent().parent().data("config");a.parent().removeClass("editing");var s=a.val();a.parent().attr("value")!==s&&(i.data[t][r]=s,i.onChange([[t,r]]),n(e))}}(c,u));i(g)}}r.appendTo(e),e.data("config",t)}(this,e)}})},function(e,t,n){var r,o,a,i,s,c,l,d=n(18).o;e.exports=(n(1),r=n(6),n(3),o=n(4),a=n(2),i=n(0),s=n(23),c=n(55),l=n(5),function(e,t){var n={};return n.AnnotatePicture={getData:function(e){var t=[];return i(e).find(".edit").each(function(e){var n=i(this).val().trim();t.push(n)}),t},save:function(e){return JSON.stringify(this.getData(e))},load:function(e,t){var n=JSON.parse(t),r=0;i(e).find(".edit").each(function(e){i(this).val(n[r++])}),this.check(i(e))},clear:function(e){var t=i(e);t.find(".edit").val(""),this.check(t)},getCheckInput:function(e){return this.getData(e)},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=l.check.AnnotatePicture(n,r),a=0,s=e.attr("id");e.find(".edit").each(function(){var e=i("#"+s+"_ap_"+a+", #"+s+"_ap_"+a+"_picwrapper, #"+s+"_ap_"+a+"_tablewrapper");switch(o.correctness[a++]){case-2:t.setTag(e,"ap-open");break;case-1:t.clearTag(e,"ap-open"),t.clearTag(e,"ap-answer"),t.clearTag(e,"ap-wrong");break;case 0:t.clearTag(e,"ap-answer"),t.setTag(e,"ap-wrong");break;case 1:t.setTag(e,"ap-answer"),t.clearTag(e,"ap-wrong")}})},render:function(n,l,u,p){var f=this,h="QC"+l,g=(p=p||i("#"+h)).attr("qindex"),m={};t.questionIf[h]=m,m.setReadOnly=function(e){-1===a.getPlatform().indexOf("ipad")&&p.find("input, textarea").prop("disabled",e)},m.loadCorrect=function(e){var t=0;p.find(".edit").each(function(){var n=e.EditFields[t++];i(this).val(n.Valid.trim())}),f.check(p)};var v=t.getNumbering(n,g);p.attr("numbering",v);var w=t.createQuestionDiv(v,n.Question).appendTo(p);r.process(w),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(p);var b=i(document.createElement("div")).addClass("ap-cover");"yes"===n["cover-fields"]&&b.addClass("cover-fields"),b.appendTo(p),t.createHint(n,p),i(document.createElement("div")).addClass("rationale rationalediv").appendTo(p);var y=i(document.createElement("div")).addClass("ap-picture").appendTo(b);""!=n.background_picture&&y.css("background-image","url("+s(n.background_picture)+")");for(var C=i(document.createElement("div")).addClass("ap-svg-wrapper").css("direction","ltr").appendTo(y),k=0,T=0,x=15,_=d.createThrottler(u),S=n.EditFields?n.EditFields:[],E=0;E<S.length;++E){var I=S[E],O=h+"_ap_"+E,A=h+"_ap_"+E+"_picwrapper",q="Numerical"==n.keyboard?"input":"textarea",P=i(document.createElement("div")).addClass("ap-field").attr("id",A);i(document.createElement("div")).addClass("ap-field-bg").appendTo(P);var D=i(document.createElement(q)).addClass("edit").attr({id:O,nr:E}).css("border-color",n["field-border-color"]).appendTo(P);t.data(D,"name",I.name),t.addSpellCheckAttrib(D),t.addInputModeAttrib(D,n.keyboard),P.appendTo(y),P.css({left:I.position.X+"px",top:I.position.Y+"px",width:I.position.Width+"px",height:I.position.Height+"px","max-width":I.position.Width+"px","max-height":I.position.Height+"px"}),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(P),"Dotted"==n["field-border"]?P.addClass("ap_border_dotted"):"None"==n["field-border"]&&P.addClass("ap_border_none"),"Transparent"==n["field-background"]?P.addClass("ap_background_transparent"):"Semi-transparent"==n["field-background"]&&P.addClass("ap_background_semitransparent");var N=parseInt(I.position.X)+parseInt(I.position.Width),R=parseInt(I.position.Y)+parseInt(I.position.Height);k=Math.max(N,k),T=Math.max(R,T),""!=I.position.MarkerX&&""!=I.position.MarkerY&&(N=parseInt(I.position.MarkerX)+x,R=parseInt(I.position.MarkerY)+x,k=Math.max(N,k),T=Math.max(R,T)),D.bind("keyup change",_.trigger.bind(_))}y.css({height:T+"px"});var L,M,B=i(document.createElement("table")).addClass("ap-table");for(E=0;E<S.length;++E){I=S[E],A=h+"_ap_"+E+"_tablewrapper";var W=i(document.createElement("tr")).attr("id",A).appendTo(B);i(document.createElement("td")).text(E+1).appendTo(W),i(document.createElement("td")).addClass("fieldwrapper").appendTo(W),t.createCorrectWrongMarker({elementType:"td"}).appendTo(W)}function F(){if(L){var e=b.width(),t=parseInt(y.css("margin"));isNaN(t)&&(t=parseInt(y.css("margin-left"))+parseInt(y.css("margin-right"))/2);for(var r=e-2*t,o=1,a=0;a<S.length;++a)if(""!=(d=S[a]).position.MarkerX&&""!=d.position.MarkerY){var s=parseInt(d.position.MarkerX)+x;if(s>0){var c=r/s;o=Math.min(c,o)}}var l=r/L;if(o=Math.min(l,o),r>720){for(b.removeClass("narrow-mode"),a=0;a<S.length;++a){var d=S[a],u=parseInt(d.position.Width),p=parseInt(d.position.X)+u/2;if(p>0){var f=(r-u/2)/p;o=Math.min(f,o)}}var g=i(b.find("textarea, input")[0]),m=parseInt(g.css("padding")||g.css("padding-top")),v=parseInt(g.css("border-top-width"))+parseInt(g.css("border-top-width"))+2*m+1.5*parseInt(g.css("font-size"));for(a=0;a<S.length;++a){var w=i("#"+h+"_ap_"+a),k=h+"_ap_"+a+"_picwrapper",T=i("#"+k);w.parent().attr("id")!==k&&(w.prependTo(T),w.css("border-color",n["field-border-color"])),d=S[a];var _=Math.max(v,parseInt(d.position.Height)),E=(r=parseInt(d.position.Width),(parseInt(d.position.X)+r/2)*o),I=(parseInt(d.position.Y)+_/2)*o;T.css({left:Math.max(0,E-r/2),top:Math.max(0,I-_/2),height:_,"max-height":_})}!function(e,t){for(var r=[],o=0,a=0,i=0;i<S.length;++i){var s=S[i];if(""!=s.position.MarkerX&&""!=s.position.MarkerY){var c,l,d=parseInt(s.position.MarkerX)*e,u=parseInt(s.position.MarkerY)*e,p=Math.max(t,parseInt(s.position.Height)),f=parseInt(s.position.Width),h=(parseInt(s.position.X)+f/2)*e,g=(parseInt(s.position.Y)+p/2)*e;if(p>0&&f>0)if(d<h){if(u<g)if((h-d)/(g-u)>f/p){var m=g-f/2*(g-u)/(h-d);h-=f/2,g=m}else h-=p/2*(h-d)/(g-u),g=m=g-p/2;else u>g?(h-d)/(u-g)>f/p?(m=g-f/2*(g-u)/(h-d),h-=f/2,g=m):(h-=p/2*(h-d)/(u-g),g=m=g+p/2):h-=f/2;var v=Math.atan2(g-u,h-d);c=d+Math.cos(v)*x,l=u+Math.sin(v)*x}else d>h?(u<g?(d-h)/(g-u)>f/p?(m=g-f/2*(g-u)/(d-h),h+=f/2,g=m):(h-=p/2*(h-d)/(g-u),g=m=g-p/2):u>g?(d-h)/(u-g)>f/p?(m=g-f/2*(g-u)/(d-h),h+=f/2,g=m):(h-=p/2*(h-d)/(u-g),g=m=g+p/2):h+=f/2,v=Math.atan2(g-u,h-d),c=d+Math.cos(v)*x,l=u+Math.sin(v)*x):(c=d,u<g?(g-=p/2,l=u+x):u>g&&(g+=p/2,l=u-x));o=Math.max(o,c),o=Math.max(o,h),o=Math.max(o,d+x),a=Math.max(a,l),a=Math.max(a,g),a=Math.max(a,u+x),r.push('<line x1="X1" y1="Y1" x2="X2" y2="Y2" CLASS COLOR/>'.replace("X1",c).replace("X2",h).replace("Y1",l).replace("Y2",g).replace("CLASS","Dotted"==n["field-border"]?'class="line-dashed"':"").replace("COLOR",'style="stroke:'+n["field-marker-color"]+'"'));var w=('<circle cx="X1" cy="Y1" r="'+x+'" COLOR/>').replace("X1",d).replace("Y1",u).replace("COLOR",'style="stroke:'+n["field-marker-color"]+'"');r.push(w)}}r.length?C.safeHtml('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+Math.max(y.width(),o)+'px" height="'+Math.max(y.height(),a)+'px">'+r.join("")+"</svg>"):C.safeHtml("")}(o,v)}else for(b.addClass("narrow-mode"),function(e,t){for(var r=0,o=0,a=[],i=0;i<S.length;++i){var s=S[i],c=(""!=s.position.MarkerX?parseInt(s.position.MarkerX):parseInt(s.position.X)+parseInt(s.position.Width)/2)*e,l=(""!=s.position.MarkerY?parseInt(s.position.MarkerY):parseInt(s.position.Y)+parseInt(s.position.Height)/2)*e;r=Math.max(r,c+x),o=Math.max(o,l+x);var d=('<circle cx="X1" cy="Y1" r="'+x+'" COLOR/>').replace("X1",c).replace("Y1",l).replace("COLOR",'style="stroke:'+n["field-marker-color"]+'"');a.push(d);var u='<text x="X1" y="Y1" class="ap-marker-text" fill="COLOR">NR</text>'.replace("X1",c).replace("Y1",l).replace("NR",i+1).replace("COLOR",n["field-marker-color"]);a.push(u)}a.length?C.safeHtml('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+Math.max(y.width(),r)+'px" height="'+Math.max(y.height(),o)+'px">'+a.join("")+"</svg>"):C.safeHtml("")}(o),a=0;a<S.length;++a){w=i("#"+h+"_ap_"+a);var O=h+"_ap_"+a+"_tablewrapper",A=i("#"+O+" .fieldwrapper");w.parent().parent().attr("id")!==O&&(w.prependTo(A),w.css("border-color",""));var q=i("#"+h+"_ap_"+a+"_picwrapper");d=S[a],_=parseInt(d.position.Height)*o,r=parseInt(d.position.Width)*o,E=parseInt(d.position.X)*o+r/2,I=parseInt(d.position.Y)*o+_/2,q.css({left:Math.max(0,E-r/2),top:Math.max(0,I-_/2),height:_,"max-height":_})}y.css({width:L*o,height:M*o})}}B.appendTo(b),m.repaint=m.onResize=F,c.getImageSize(n.background_picture,function(e,t){L=e,M=t,F()}),t.processEmbeddedElements(p)},prepareCorrection:function(e,n){var r={"case-sensitive":n["case-sensitive"],EditFields:n.EditFields,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=this;e.find("input, textarea").on("keyup change",function(){o.check(e)}),o.check(e);for(var a,i=[],s=n.EditFields?n.EditFields:[],c=0;c<s.length;++c){var l=s[c];if(""!=l.Valid){var d=l.Valid.split(/\|\||##/),u=1===d.length?l.Valid:d.join(" / ");i.push(u)}}return 0!=i.length&&(a="<div class='the-answer' >"+t.translate("The answers:")+'</br><div class="answer">'+i.join(", ")+"</div></div>"),t.createRationale(n,e.find(".rationalediv"),a),{extrarationale:a}},getAnswer:function(t,n,r){for(var o=i(t),a=o.find(e.MH).safeHtml(),s=this.getCheckInput(o),c=l.check.AnnotatePicture(r,s),d=[],u=r.EditFields?r.EditFields:[],p=0;p<u.length;++p){var f=u[p];switch(c.correctness[p]){case-2:d.push(f.name+": "+s[p]);break;case-1:d.push(f.name+": (no answer)");break;case 0:case 1:d.push(f.name+": "+s[p])}}return{question:a,answer:d,check_input:s,correctness:c.correctness,score:c.score,outof:c.outof}}},n})},function(e,t,n){var r,o,a,i,s,c=n(18).o;e.exports=(n(1),r=n(6),n(3),o=n(4),a=n(2),i=n(0),n(446),s=n(5),function(e,t){var n={};return n.SingleLine={name:"SingleLine",save:function(e){return i(e).find(".sl-cover .edit").val()},load:function(e,t){var n=i(e);n.find(".sl-cover .edit").val(t),this.check(n)},clear:function(e){var t=i(e);t.find(".sl-cover .edit").val(""),t.find(".sl-cover").removeClass("sl-open").removeClass("sl-answer")},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=e.find("input").val(),o=s.check.SingleLine(n,r),a=e.find(".sl-cover");switch(o.correctness){case-2:t.setTag(a,"sl-open");break;case-1:t.clearTag(a,"sl-answer"),t.clearTag(a,"sl-wrong");break;case 0:t.clearTag(a,"sl-answer"),t.setTag(a,"sl-wrong");break;case 1:t.setTag(a,"sl-answer"),t.clearTag(a,"sl-wrong")}},render:function(n,s,l,d){var u=this,p="QC"+s,f=(d=d||i("#"+p)).attr("qindex"),h={};t.questionIf[p]=h,h.setReadOnly=function(e){-1==a.getPlatform().indexOf("ipad")&&d.find("input").prop("disabled",e)},h.loadCorrect=function(e){u.load(d[0],e.Valid),u.check(d)};var g=e.getQuestionImageDivs(d,n.imgsize,n.img,n.imgpos),m=t.getNumbering(n,f);d.attr("numbering",m);var v=t.createQuestionDiv(m,n.Question).appendTo(g.questdiv);r.process(v),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(g.audiodiv);var w=i(document.createElement("div")).addClass("sl-cover bw-column-container").append(i(document.createElement("input")).attr("type","text").addClass("edit bw-column-expanding")).appendTo(g.answerdiv),b=w.find("input");t.addInputModeAttrib(b,n.keyboard),t.addSpellCheckAttrib(b),null!=n.placeholder&&""!==n.placeholder&&b.attr("placeholder",n.placeholder),t.createCorrectWrongMarker({elementType:"div"}).addClass("bw-column-fixed bw-centering-container").appendTo(w);var y=c.createThrottler(l);return w.find("input").on("keyup change",function(){y.trigger()}),t.createHint(n,g.hintdiv),g.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,g.imgdiv),t.processEmbeddedElements(d),d},prepareCorrection:function(e,n){var r={Valid:n.hasOwnProperty("Valid")?n.Valid:"","case-sensitive":n["case-sensitive"],"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o,a=this;if(e.find("input").bind("keyup change",function(){a.check(e)}),a.check(e),n.hasOwnProperty("Valid")&&""!=n.Valid.trim()){var i=n.Valid.replace(/</g,"&lt;").split(/\|\||##/);o="<div class='the-answer' >"+t.translate(1==i.length?"The answer:":"Correct answers:")+'<br><br><div class="answer">'+i.join("<br>")+"</div></div>"}return t.createRationale(n,e.find(".rationalediv"),o),{extrarationale:o}},getAnswer:function(t,n,r){var o=i(t),a=o.find(e.MH).html(),c=o.find(".sl-cover .edit").val();if(n){var l=s.check.SingleLine(r,c);return{question:a,answer:c,check_input:c,correctness:l.correctness,score:l.score,outof:l.outof,canonicalAnswer:r.Valid}}return{question:a,answer:c}}},n})},function(e,t){e.exports=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},function(e,t,n){var r,o,a,i,s;e.exports=(n(1),r=n(6),n(3),o=n(4),a=n(0),n(23),i=n(5),s=n(39),function(e,t){var n={};return n.PictureOrdering={save:function(e){var n=[];return a(e).find(".target .target-box").each(function(){var e=a(this).find(".po-pic");e.length?n.push(t.data(e,"report-name")):n.push("")}),JSON.stringify(n)},load:function(e,n){this.clear(e);var r=JSON.parse(n),o=0;a(e).find(".target .target-box").each(function(){var n=this;""!=r[o]&&a(e).find(".display .po-pic").each(function(){t.data(a(this),"report-name")==r[o]&&a(this).appendTo(a(n))}),++o}),a(e).trigger("change")},clear:function(e){var n=a(e),r=[];n.find(".target .po-pic").each(function(){var e=a(this);t.clearTag(e.parent(),"correct"),t.clearTag(e.parent(),"wrong"),r.push(e)});var o=n.find(".po-cover");t.clearTag(o,"all-wrong"),t.clearTag(o,"all-correct"),n.find(".display .po-quiz").each(function(){var e=a(this);0===this.childNodes.length&&r.length>0&&r.pop().appendTo(e)})},getCheckInput:function(e){var n=[];return e.find(".target .target-box").each(function(){var e=a(this).find(".po-pic").get(0);if(e){var r=t.data(a(e),"report-name");n.push(r)}else n.push(null)}),n},check:function(e){try{var n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=i.check.PictureOrdering(n,r),s=0,c=e.find(".po-cover");c.find(".target .target-box").each(function(){var e=a(this);switch(o.correctness[s]){case-1:t.clearTag(e,"wrong"),t.clearTag(e,"correct");break;case 1:t.clearTag(e,"wrong"),t.setTag(e,"correct");break;case 0:t.clearTag(e,"correct"),t.setTag(e,"wrong")}++s}),i.allCorrect(o)?c.removeClass("all-wrong").addClass("all-correct"):c.addClass("all-wrong").removeClass("all-correct")},render:function(n,c,l,d){var u=this,p="QC"+c,f=(d=d||a("#"+p)).attr("qindex"),h=t.getNumbering(n,f),g=t.createQuestionDiv(h,n.Question).appendTo(d);r.process(g),d.attr("numbering",h),d.attr("scoring-weight",n["scoring-weight"]),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(d);var m=a(document.createElement("div")).addClass("po-cover").appendTo(d);t.setTag(m,"all-wrong");var v={};t.questionIf[p]=v,v.loadCorrect=function(e){var n=0;d.find(".target .target-box").each(function(){var r=a(this),o=i.pictureId(e.Pictures[n++]);t.findByData(d,".po-pic","report-name",o).appendTo(r)}),u.check(d)};var w=a(document.createElement("div")).addClass("display").appendTo(m).get(0),b=a(document.createElement("div")).addClass("target").appendTo(m).get(0);if(t.createHint(n,d),a(document.createElement("div")).addClass("rationalediv").appendTo(d),n.Pictures)for(var y=0;y<n.Pictures.length;++y){var C=n.Pictures[y].sources[0].src,k=a(document.createElement("div")).addClass("po-quiz");if(w.childNodes.length){var T=Math.ceil((w.childNodes.length-1)*Math.random());Math.random()<.5?k.insertAfter(w.childNodes[T]):k.insertBefore(w.childNodes[T])}else k.appendTo(w);var x=a(document.createElement("div")).addClass("po-pic").attr("tabindex","-1").append(s.create({img:n.Pictures[y],type:"div",disable_press:!0}));t.data(x,"report-name",i.pictureId(n.Pictures[y])),x.attr({pic:C}),t.createCorrectWrongMarker({elementType:"div"}).addClass("picture-marker").appendTo(x),x.appendTo(k);var _=function(e,t){t.childNodes.length&&a(t.childNodes[0]).insertBefore(e),a(e).appendTo(t),a(e).css({position:"static"}),d.trigger("change"),null!=l&&l()};x.draggable({scope:p,appendTo:m,start:function(e,t){},stop:function(e,t){a(this).animate({top:0,left:0},function(){a(this).css({position:"relative"})})}}),k.droppable({drop:function(e,t){_(t.draggable,this)},tolerance:"intersect",scope:p}),a(document.createElement("div")).addClass("target-box").attr("index",y+"").appendTo(b).droppable({drop:function(e,t){_(t.draggable,this)},tolerance:"intersect",scope:p})}t.processEmbeddedElements(d)},prepareCorrection:function(e,n){var r={Pictures:n.Pictures,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=this;a(e).on("change",function(){o.check(e)}),o.check(e);for(var i=a(document.createElement("div")).addClass("the-answer").safeHtml(t.translate("The answer:")),c=a(document.createElement("div")).addClass("answer-box").appendTo(i),l=n.Pictures?n.Pictures:[],d=0;d<l.length;++d)s.create({img:l[d],background:"white",type:"div"}).addClass("po-quiz").appendTo(c);var u=i.html();return t.createRationale(n,e.find(".rationalediv"),u),{extrarationale:u}},getAnswer:function(n,r,o){var s=a(n),c=s.find(e.MH).html(),l=[];s.find(".target .target-box").each(function(){var e=a(this).find(".po-pic");e.length?l.push(t.createTextOrPictureAnswer(t.data(e,"report-name"),e.attr("pic"))):l.push("")});var d=this.getCheckInput(s),u=i.check.PictureOrdering(o,d);return{question:c,answer:l,check_input:d,correctness:u.correctness,score:u.score,outof:u.outof}}},n})},function(e,t,n){var r,o,a,i,s,c;e.exports=(r=n(1),o=n(6),a=n(3),i=n(4),s=n(0),c=n(5),n(32),function(e,t){var n=r.getConfigSync(),l={};return l.WordOrdering={getData:function(e){var t=[];return e.find(".ms-cover .words .wordwrapper").each(function(){t.push(s(this).attr("word"))}),t},save:function(e){return JSON.stringify(this.getData(s(e)))},load:function(e,t){var n=s(e),r=JSON.parse(t);r.length>0&&n.addClass("answered");var o=[];n.find(".ms-cover .words .wordwrapper").each(function(){o.push(s(this).detach())});for(var a=n.find(".ms-cover .words .cr-marker"),i=0;i<r.length;++i)for(var c=0;c<o.length;++c)if(o[c].attr("word")==r[i]){o[c].insertBefore(a),o.splice(c,1);break}for(c=0;c<o.length;++c)o[c].insertBefore(a);n.trigger("change")},clear:function(e){var n=s(e);n.removeClass("answered");var r=[];n.find(".ms-cover .words .wordwrapper").each(function(){r.push(s(this).detach())});for(var o=n.attr("id"),a=t.questionIf[o].data,i=n.find(".ms-cover .words .cr-marker"),c=0;c<a.Words.length;++c)for(var l=0;l<r.length;++l)if(r[l].attr("word")==a.Words[c]){r[l].insertBefore(i),r.splice(l,1);break}n.trigger("change")},getCheckInput:function(e){return e.hasClass("answered")?this.getData(e):null},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=c.check.WordOrdering(n,r);if("each"===n.policy){var a=0;e.find(".wordwrapper").each(function(){var e=s(this);1===o.correctness[a]?t.setTag(e,"ms-correctword"):t.clearTag(e,"ms-correctword"),++a})}else 1===o.correctness?t.setTag(e.find(".ms-cover"),"ms-answer"):t.clearTag(e.find(".ms-cover"),"ms-answer")},render:function(r,c,l,d){var u="QC"+c,p=(d=d||s("#"+u)).attr("qindex"),f={};f.data=r,t.questionIf[u]=f,f.setReadOnly=function(e){d.find(".wordwrapper").draggable(e?"disable":"enable")},f.loadCorrect=function(e){var t=[];d.find(".ms-cover .words .wordwrapper").each(function(){t.push(s(this).detach())});for(var n=d.find(".ms-cover .words .cr-marker"),r=0;r<e.Words.length;++r)for(var o=0;o<t.length;++o)if(t[o].attr("word")==e.Words[r]){t[o].insertBefore(n),t.splice(o,1);break}d.trigger("change"),d.addClass("answered")};var h=e.getQuestionImageDivs(d,r.imgsize,r.img,r.imgpos),g=t.getNumbering(r,p);d.attr("numbering",g);var m=t.createQuestionDiv(g,r.Question).appendTo(h.questdiv);o.process(m),r.audio&&""!=r.audio&&i.createPlayer(r.audio,"quiz"===e.getWidgetType()).appendTo(h.audiodiv);var v=s(document.createElement("div")).addClass("ms-cover");v.appendTo(h.answerdiv);var w=s(document.createElement("div")).addClass("words");"Sentences"===r.order_type&&w.addClass("sentence"),w.appendTo(v);var b=[];if(r.Words)for(var y=0;y<r.Words.length;++y)b.push({word:r.Words[y],pos:y});for(y=0;y<b.length;++y){var C=s(document.createElement("div")).addClass("wordwrapper").safeHtml(a.prepare(b[y].word)).attr("word",b[y].word);C.appendTo(w),C.draggable({scope:u,helper:"clone",start:function(e,t){var n=s(e.target||e.srcElement);n.addClass("drag_placeholder"),this.clone=n.clone().insertAfter(n),n.hide()},drag:function(e,t){if(s("#"+u).addClass("answered"),"Sentences"!=r.order_type){var o=this.clone[0];(f=t.helper.offset()).right=f.left+s(o).width();var a=null,i="right-to-left"===n.direction,c=!1;if(s("#"+u+" .ms-cover .words .wordwrapper").each(function(){if(!s(this).hasClass("ui-draggable-dragging")&&!c){this!=o&&(a=this);var e=s(this).offset();if(e.right=e.left+s(this).width(),e.bottom=e.top+s(this).height(),e.top<f.top+10&&f.top-10<e.bottom){var t=(f.left+f.right)/2,n=(e.left+e.right)/2;if(t<n&&t>e.left-20){if(c=!0,this!=o)try{return s(o).detach(),void(i?s(o).insertAfter(this):s(o).insertBefore(this))}catch(e){}}else if(t>n&&t<e.right+20&&(c=!0,this!=o))try{return s(o).detach(),void(i?s(o).insertBefore(this):s(o).insertAfter(this))}catch(e){}}}}),!c&null!=a){var l=s(a).offset();l.right=l.left+s(a).width(),l.bottom=l.top+s(a).height();var d=l.top<f.top+10&&f.top-10<l.bottom,p=i?f.right<=l.left:f.left>=l.right;if(d&&p)try{a!=o&&(s(o).detach(),s(o).insertAfter(a))}catch(e){}}}else{var f=t.helper.offset(),h=(a=null,o=this.clone[0],c=!1,!1);s("#"+u+" .ms-cover .words .wordwrapper").each(function(){if(!c&&!s(this).hasClass("ui-draggable-dragging")){var e=s(this).offset();if(f.top<e.top){if(c=!0,s(this).hasClass("drag_placeholder"))return;s(o).detach(),s(o).insertBefore(this)}s(this).hasClass("drag_placeholder")?h=!0:(a=this,h=!1)}}),!1===c&&!1===h&&(s(o).detach(),s(o).insertAfter(a))}},stop:function(e,t){var n=s(this);this.clone.replaceWith(n),n.show().removeClass("drag_placeholder").animate({top:0,left:0},function(){d.trigger("change"),l&&l()})}})}t.createCorrectWrongMarker().appendTo(w),t.createHint(r,h.hintdiv),h.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,h.imgdiv),t.processEmbeddedElements(d)},prepareCorrection:function(e,n){var r={Words:n.Words,AlternateAnswers:n.AlternateAnswers,"scoring-weight":n["scoring-weight"],policy:n.policy,order_type:n.order_type};e.attr("policy",n.policy),t.data(e,"questionconfig",JSON.stringify(r));var o=this;e.bind("change",function(){o.check(e)}),o.check(e);var i="Sentences"===n.order_type?"<br>":" ",s=(n.Words?n.Words:[]).join(i),c="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+a.prepare(s)+"</div></div>";return t.createRationale(n,e.find(".rationalediv"),c),{extrarationale:c}},getAnswer:function(t,n,r){var o=s(t),a=o.find(e.MH).html(),i=this.getCheckInput(o),l=c.check.WordOrdering(r,i),d=[];if(o.find(".ms-cover .words .wordwrapper").each(function(){d.push(s(this).attr("word"))}),"all"===r.policy){var u="Sentences"===r.order_type?"<br>":" ";return{question:a,answer:d.join(u),check_input:i,correctness:l.correctness,score:l.score,outof:l.outof}}return{question:a,answer:d,check_input:i,correctness:l.correctness,score:l.score,outof:l.outof}}},l})},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f=0,h=1,g=2;e.exports=(r=n(1),o=n(6),a=n(3),i=n(4),s=n(0),c=n(450),l=n(5),d=n(39),u=n(32),p=n(7),function(e,t){var n=r.getConfigSync(),m={};function v(e,n){var r=s(e).attr("id"),o=JSON.parse(n);t.questionIf[r].matchConnections.setLoading();for(var a=0;a<o.length;++a)o[a].sourceId=t.findByData(s(e),".connectsource","id",o[a].sourceId).attr("id"),o[a].targetId=t.findByData(s(e),".connecttarget","id",o[a].targetId).attr("id");return t.questionIf[r].setConnections(o)}function w(e){for(var n=s(e).attr("id"),r=t.questionIf[n].matchConnections.getConnections(),o=0;o<r.length;++o)r[o].sourceId=t.data(s(e).find("#"+r[o].sourceId),"id"),r[o].targetId=t.data(s(e).find("#"+r[o].targetId),"id");return JSON.stringify(r)}function b(e){var n=s(e).attr("id");t.questionIf[n].matchConnections.clearConnections()}function y(e,t){return t===h?null==e.sources||0===e.sources.length:""===e}function C(e,t,n){return e===f?t:e===h?l.pictureId(t):e===g?n+"":(console.error("Invalid element type: ",e),0)}function k(e,n,r,o){var a={pairs:n.pairs,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(a));for(var i=[],c=s(e).attr("id"),d=n.pairs?n.pairs:[],u=0;u<d.length;++u)i.push({sourceId:t.findByData(s(e),".connectsource","txt",C(r,d[u].source,u)).attr("id"),targetId:t.findByData(s(e),".connecttarget","txt",l.pictureId(d[u].target)).attr("id")});t.questionIf[c].matchConnections.setCorrectPairs(i);var p=this;e.bind("change",function(){p.check(e)}),t.createRationale(n,e.find(".rationalediv"))}function T(e){for(var n=s(e).attr("id"),r=t.questionIf[n].matchConnections.getConnections(),o=[],a=0;a<r.length;++a){var i=r[a];o.push({source:t.data(e.find("#"+i.sourceId),"txt"),target:t.data(e.find("#"+i.targetId),"txt")})}return o}function x(n,r,o,a,i,c){for(var d=s(n),u=d.find(e.MH).safeHtml(),p=T(d),m=l.check[c](o,p),v=[],w=o.pairs?o.pairs:[],b=0;b<w.length;++b){var y,C,k=w[b],x=k.source;switch(a){case f:y=C=x;break;case h:y=C=k.source.hasOwnProperty("origbase")?k.source.origbase:x;break;case g:y=b+"",C=k.audiodesc}if(""!==C){for(var _=null,S=0;S<p.length;++S){var E=p[S];y===E.source&&(_=E.target)}if(null!==_){for(var I=!1,O=0;O<w.length;++O){var A=w[O],q=A.target,P=A.target.hasOwnProperty("origbase")?A.target.origbase:q;if(_===P){v.push(t.createPairAnswer(C,a===h&&x.sources&&x.sources.length>0?x.sources[0].src:"",P,i===h&&q.sources&&q.sources.length>0?q.sources[0].src:"")),I=!0;break}}I||console.error("Match getAnswer problem... don't find target "+_)}else v.push(t.createPairAnswer(C,a===h?x.sources[0].src:"","",""))}}return{question:u,answer:v,check_input:p,correctness:m.correctness,score:m.score,outof:m.outof}}function _(r,c,m,v,w,b,k){var T="QC"+c,x=(b=b||s("#"+T)).attr("qindex"),_={};t.questionIf[T]=_;var S=k.create("#"+T,e.getScrollObject(),t,e.getConnectionType(),w);function E(){S.repaint(),"right-to-left"===n.direction&&S.fixEndpointPositionsForRtl(e.JspRtlOffset()),S.repaint()}_.matchConnections=S;var I=e.getQuestionImageDivs(b,r.imgsize,r.img,r.imgpos);b.addClass("match");var O=t.getNumbering(r,x);b.attr("numbering",O),b.attr("scoring-weight",r["scoring-weight"]);var A=t.createQuestionDiv(O,r.Question).appendTo(I.questdiv);o.process(A),r.audio&&""!==r.audio&&i.createPlayer(r.audio,"quiz"===e.getWidgetType()).appendTo(I.audiodiv),t.createHint(r,I.hintdiv,E),I.rationalediv.addClass("rationalediv"),_.setConnections=function(e){S.setLoading(!0),S.clearConnections();for(var t=0;t<e.length;++t)S.connect(e[t].sourceId,e[t].targetId);S.setLoading(!1)};var q=r.pairs?r.pairs:[];_.check=function(){for(var e=JSON.parse(t.data(b,"questionconfig")),n=e.pairs?e.pairs:[],r=0;r<n.length;++r)if(!y(n[r].source,m)&&!y(n[r].target,v)){for(var o=t.findByData(b,".connectsource","txt",C(m,n[r].source,r)).attr("id"),a=t.findByData(b,".connecttarget","txt",l.pictureId(n[r].target)).attr("id"),i=-1,s=S.getConnections(),c=0;c<s.length;++c)if(s[c].sourceId===o){i=s[c].targetId;break}i!==a&&S.connect(o,a,!0)}setTimeout(S.repaint.bind(S),0)},_.setReadOnly=function(e){if(!1===e){var t=S.getConnections();this.setConnections(t)}};for(var P=s(document.createElement("table")).addClass("match_table").attr("resize-mode",r.img_resize_mode).appendTo(b),D=0;D<q.length;++D){var N=s(document.createElement("td")).addClass("match_source match_source_"+D),R=s(document.createElement("td")).addClass("match_target match_target_"+D),L=s(document.createElement("tr")).appendTo(P);"right-to-left"===n.direction?L.append(R).append(N):L.append(N).append(R)}function M(e,t,n){e.css({width:"",height:""});var r=function(e){function t(e){return e.outerWidth()-e.width()}return 2*(t(e.parent())+t(e.parent().parent())+t(e.parent().parent().parent())+25)}(e),o=Math.max((n.width-r)/2,40),a=Math.max(n.height/t-20-10,40);e.css({maxWidth:o,maxHeight:a,width:"auto"})}function B(){var e=b.closest(".contentarea");return{width:e.width()||1,height:(e.height()||1)-b.find("h1").outerHeight(!0)-20}}_.repaint=_.onResize=function(){if("Auto"===r.img_resize_mode){var e=B();b.find(".match_table img").each(function(){M(s(this),r.pairs.length,e)})}setTimeout(E,0)},_.loadCorrect=function(e){S.setLoading(!0),S.clearConnections();for(var n=0;n<q.length;++n)if(!y(q[n].source,m)&&!y(q[n].target,v)){var r=t.findByData(b,".connectsource","id",T+"_cs_"+n).attr("id"),o=t.findByData(b,".connecttarget","id",T+"_ct_"+n).attr("id");S.connect(r,o)}S.setLoading(!1)};var W=B(),F=[];for(D=0;D<q.length;++D)F.push(D);function U(e){return s(document.createElement("div")).append(d.create(e))}for(var z,H,j,Q=0,J=0;J<q.length;++J)if(D=F[J],!y((ee=q[D]).source,m)){var V,Y=T+"_cs_"+D;if(m===h){var $=ee.source.sources&&ee.source.sources.length>0?ee.source.sources[0].src:"",K=ee.source.origbase;V=s(document.createElement("div")).addClass("connectwindow connectpicture connectsource").attr("pic",$).attr("id",u.randomId(20)),t.data(V,"id",Y),t.data(V,"txt",K),t.createCorrectWrongMarker().appendTo(V);var G=U(ee.source).addClass("imgwrapper").appendTo(V);s(G).find("img").one("load",function(){"Auto"===r.img_resize_mode&&M(s(this),q.length,W),t.triggerImageLoaded()}).each(function(){this.complete&&s(this).load()})}else m===f?(V=s(document.createElement("div")).addClass("connectwindow connectword connectsource").safeHtml(a.prepare(ee.source)).attr("id",u.randomId(20)),t.data(V,"id",Y),t.data(V,"txt",ee.source),t.createCorrectWrongMarker().prependTo(V)):m===g&&(V=s(document.createElement("div")).addClass("connectwindow connectaudio connectsource").attr("id",u.randomId(20)),z=ee.source,H=V,j=void 0,j=i.addElement(z,"body"),s(document.createElement("div")).addClass("bw-button audiobutton").append(s(document.createElement("div")).addClass("bw-icon-large bw-icon-music-play-2")).makeButton(p("play")).tapOrClick(j.toggle.bind(j)).appendTo(H),t.data(V,"id",Y),t.data(V,"txt",J+""),t.createCorrectWrongMarker().prependTo(V));P.find(".match_source_"+Q).append(V),++Q}var X=u.randomIndexList(q.length),Z=0;for(J=0;J<q.length;++J){var ee,te;if(D=X[J],!y((ee=q[D]).target,v))Y=T+"_ct_"+D,v===h?($=ee.target.sources&&ee.target.sources.length>0?ee.target.sources[0].src:"",K=ee.target.origbase,te=s(document.createElement("div")).addClass("connectwindow connectpicture connecttarget").attr("pic",$).attr("id",u.randomId(20)),t.data(te,"id",Y),t.data(te,"txt",K),G=U(ee.target).addClass("imgwrapper").appendTo(te),s(G).find("img").one("load",function(){"Auto"===r.img_resize_mode&&M(s(this),q.length,W),t.triggerImageLoaded()}).each(function(){this.complete&&s(this).load()}),t.createCorrectWrongMarker().appendTo(te)):(te=s(document.createElement("div")).addClass("connectwindow connectword connecttarget").safeHtml(a.prepare(ee.target)).attr("id",u.randomId(20)),t.data(te,"id",Y),t.data(te,"txt",ee.target),t.createCorrectWrongMarker().appendTo(te)),P.find(".match_target_"+Z).append(te),++Z}for(P.find("tr").each(function(){var e=s(this);e.find(".match_source").is(":empty")&&e.find(".match_target").is(":empty")&&e.remove()}),D=0;D<q.length;++D)y(q[D].source,m)||(Y=T+"_cs_"+D,S.addSource(t.findByData(b,".connectsource","id",Y).attr("id")));for(D=0;D<q.length;++D)y(q[D].target,v)||(Y=T+"_ct_"+D,S.addTarget(t.findByData(b,".connecttarget","id",Y).attr("id")));t.createOptionalImage(r,I.imgdiv,E),t.processEmbeddedElements(b),a.schedule(E)}return m.WordMatch={save:w,load:v,clear:b,MatchConnections:c,render:function(e,t,n,r){return _(e,t,f,f,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return k(e,t,f)},getCheckInput:T,getAnswer:function(e,t,n){return x(e,0,n,f,f,"WordMatch")}},m.WordPictureMatch={save:w,load:v,clear:b,MatchConnections:c,render:function(e,t,n,r){return _(e,t,f,h,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return k(e,t,f)},getCheckInput:T,getAnswer:function(e,t,n){return x(e,0,n,f,h,"WordPictureMatch")}},m.PicturePictureMatch={save:w,load:v,clear:b,MatchConnections:c,render:function(e,t,n,r){return _(e,t,h,h,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return k(e,t,h)},getCheckInput:T,getAnswer:function(e,t,n){return x(e,0,n,h,h,"PicturePictureMatch")}},m.AudioWordMatch={save:w,load:v,clear:b,MatchConnections:c,render:function(e,t,n,r){return _(e,t,g,f,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return k(e,t,g)},getCheckInput:T,getAnswer:function(e,t,n){return x(e,0,n,g,f,"AudioWordMatch")}},m.AudioPictureMatch={save:w,load:v,clear:b,MatchConnections:c,render:function(e,t,n,r){return _(e,t,g,h,n,r,this.MatchConnections)},prepareCorrection:function(e,t){return k(e,t,g)},getCheckInput:T,getAnswer:function(e,t,n){return x(e,0,n,g,h,"AudioPictureMatch")}},m})},function(e,t,n){var r,o;e.exports=(r=n(451),o=n(0),{create:function(e,t,n,a,i){var s,c=r.getInstance();c.setRenderMode(c.SVG),c.importDefaults({DragOptions:{cursor:"pointer",zIndex:2e3},PaintStyle:{strokeStyle:"#666"},EndpointStyle:{width:20,height:16,strokeStyle:"#666"},Endpoint:"Rectangle",Anchors:["TopCenter","TopCenter"]});var l=[],d=!1;function u(t){for(var r=0;r<s.pairs.length;++r){var a=s.pairs[r];if(t.sourceId===a.sourceId)if(t.targetId===a.targetId)if(!0===t.getParameter("correction"))n.setTag(o(t.canvas),"wm-missing-answer");else{n.setTag(o(t.canvas),"wm-correct-answer");var i=o(e).find("#"+t.sourceId),c=o(e).find("#"+t.targetId);n.setTag(i,"wm-correct-answer"),n.setTag(c,"wm-correct-answer"),n.clearTag(i,"wm-wrong-answer"),n.clearTag(c,"wm-wrong-answer")}else n.setTag(o(t.canvas),"wm-wrong-answer"),i=o(e).find("#"+t.sourceId),c=o(e).find("#"+t.targetId),n.clearTag(i,"wm-correct-answer"),n.clearTag(c,"wm-correct-answer"),n.setTag(i,"wm-wrong-answer"),n.setTag(c,"wm-wrong-answer")}}function p(t,r){if(r){for(var a=-1,p=0;p<l.length;p++)if(l[p]===t){a=p;break}-1!==a&&(l.splice(a,1),!1===d&&null!==i&&i());var f=o(e).find("#"+t.sourceId),h=o(e).find("#"+t.targetId);n.clearTag(f,"wm-correct-answer"),n.clearTag(h,"wm-correct-answer"),n.clearTag(f,"wm-wrong-answer"),n.clearTag(h,"wm-wrong-answer")}else l.push(t),s.hasOwnProperty("pairs")&&(u(t),o(t.canvas).attr("source",t.sourceId),o(t.canvas).attr("target",t.targetId)),!1===d&&null!==i&&i();c.repaintEverything()}c.bind("connection",function(e,t){p(e.connection,!1)}),c.bind("connectionDetached",function(e,t){p(e.connection,!0)});var f=[],h={tolerance:"touch",hoverClass:"dropHover",activeClass:"dragActive"},g={endpoint:["Dot",{radius:15}],anchor:[1,.5,1,0],paintStyle:{width:25,height:21},isSource:!0,connectorStyle:{lineWidth:4},connector:a,maxConnections:2,dropOptions:h,detachable:!1,reattach:!1},m={endpoint:["Dot",{radius:15}],anchor:[0,.5,0,0],paintStyle:{opacity:.5},isTarget:!0,dropOptions:h,maxConnections:2,beforeDrop:function(e){return function(e){for(var t=-1,n=0;n<l.length;n++)if(l[n].targetId===e.targetId){t=n;break}-1!==t&&c.detachAllConnections(e.targetId)}(e),function(e){for(var t=-1,n=0;n<l.length;n++)if(l[n].sourceId===e.sourceId){t=n;break}-1!==t&&c.detachAllConnections(l[t].targetId)}(e),!0},detachable:!1,reattach:!1};function v(n){var r=!0,a=null;function i(e){null!=a&&(clearTimeout(a),a=null);var n=t.scrollTop();t.scrollTop(n+e),r||(a=setTimeout(function(){a=null,i(e)},50))}function s(n){r=!0,n<25&&(r=!1,i(-5));var a=t.scrollTop(),s=t.height();n>t.height()-25&&a+s<o(e).height()&&(r=!1,i(5))}n.bind("mousedown",function(e){function t(e){s(e.originalEvent.clientY)}o("html").on("mouseup",function e(){r=!0,o("html").off("mouseup",e),o("html").off("mousemove",t)}),o("html").on("mousemove",t)})}return s={repaint:c.repaintEverything.bind(c),addSource:function(t){f[t]=c.addEndpoint(t,{scope:e,container:o(e)},g),o(f[t].endpoint.svg.parentNode).attr({source:t,"aria-labelledby":t}),v(o(f[t].endpoint.svg.parentNode))},addTarget:function(t){f[t]=c.addEndpoint(t,{scope:e,container:o(e)},m),o(f[t].endpoint.svg.parentNode).attr({target:t,"aria-labelledby":t})},clearConnections:function(){for(;l.length>0;){var e=l[0];c.detachAllConnections(e.sourceId),c.detachAllConnections(e.targetId)}this.repaint()},fixEndpointPositionsForRtl:function(t){o(e).find(" ._jsPlumb_endpoint").each(function(){o(this).css("left",parseInt(o(this).css("left"))-t+"px")})},connect:function(e,t,n){var r=f[e],o=f[t];r&&o&&(n?c.connect({source:r,target:o,parameters:{correction:!0}}):c.connect({source:r,target:o}))},getConnections:function(){for(var e=[],t=0;t<l.length;++t)!0!==l[t].getParameter("correction")&&e.push({sourceId:l[t].sourceId,targetId:l[t].targetId});return e},setCorrectPairs:function(e){this.pairs=e;for(var t=0;t<l.length;++t)u(l[t])},setLoading:function(e){d=e}}}})},function(e,t){e.exports=window.jsPlumb},function(e,t,n){var r,o,a,i,s,c,l,d;e.exports=(n(1),r=n(6),o=n(3),a=n(4),i=n(0),s=n(23),c=n(5),n(194),l=n(39),d=n(32),function(e,t){var n={};function u(e,n){var r=i(e),o=JSON.parse(n),a=[];r.find(".dd-cover .dditem").each(function(){a.push(i(this))});var s={};if(r.find(".dd-cover .ddbox").each(function(){s[t.data(i(this),"name")]=i(this)}),r.hasClass("onlydroponboxes")){for(var c=0;c<o.length;++c)for(var l=o[c],d=0;d<l.words.length;++d)if(null!=(p=s[l.name]))for(var u=0;u<a.length;++u)if(a[u].attr("save")===l.words[d]){a[u].appendTo(p),a.splice(u,1);break}}else for(s.DD_BOXES=r.find(".dd-boxes"),c=0;c<o.length;++c)for(l=o[c],d=0;d<l.words.length;++d){var p;if(null!=(p=s[l.name]))for(u=0;u<a.length;++u)a[u].attr("save")===l.words[d].name&&(a[u].appendTo(p),a[u].css({position:"absolute",left:l.words[d].left,top:l.words[d].top}),a.splice(u,1))}r.trigger("change")}function p(e){var t=i(e);t.find(".dd-cover .dditem").appendTo(t.find(".dd-cover .words")),t.trigger("change")}function f(e){var n=[];if(i(e).hasClass("onlydroponboxes"))i(e).find(".dd-cover .ddbox").each(function(){var e={};e.name=t.data(i(this),"name"),e.words=[],i(this).find(".dditem").each(function(){e.words.push(i(this).attr("save"))}),n.push(e)});else{i(e).find(".dd-cover .ddbox").each(function(){var e=i(this),r={};r.name=t.data(e,"name"),r.words=[],e.find(".dditem").each(function(){var e=i(this),t={};t.name=e.attr("save"),t.left=e.position().left,t.top=e.position().top,r.words.push(t)}),n.push(r)});var r={name:"DD_BOXES",words:[]};i(e).find(".dd-boxes > .dditem").each(function(){var e=i(this),t={};t.name=e.attr("save"),t.left=e.position().left,t.top=e.position().top,r.words.push(t)}),n.push(r)}return JSON.stringify(n)}function h(e){var n=[];return e.find(".dd-cover .ddbox").each(function(){var e=i(this),r=t.data(e,"name");e.find(".dditem").each(function(){var e=i(this).attr("save");n.push([e,r])})}),n}function g(e,n){try{var r=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}for(var o=this.getCheckInput(e),a=(n?c.check.PictureDragDrop(r,o):c.check.TextDragDrop(r,o)).items,s=0;s<a.length;++s)a[s].used=!1;e.find(".dd-cover .ddbox, .dd-cover .words").each(function(){var e=i(this),n=t.data(e,"name")||"";e.find(".dditem").each(function(){for(var e=i(this),r=e.attr("save"),o=!1,s=0;s<a.length;++s){var c=a[s];if(!c.used&&c.pair[0]===r&&c.pair[1]===n){o=!0,c.used=!0;break}}o?(t.setTag(e,"dd-correct"),t.clearTag(e,"dd-wrong")):(t.clearTag(e,"dd-correct"),t.setTag(e,"dd-wrong"))})})}function m(e,n){var r={Boxes:n.Boxes,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o=this;e.bind("change",function(){o.check(e)}),o.check(e),t.createRationale(n,e.find(".rationalediv"))}function v(n,r,o,a){var s=i(n),l=s.find(e.MH).safeHtml(),d=this.getCheckInput(s),u=a?c.check.PictureDragDrop(o,d):c.check.TextDragDrop(o,d),p=[],f={};if(a)for(var h=o.Boxes?o.Boxes:[],g=0;g<h.length;++g){var m=h[g];if(m.Items)for(var v=0;v<m.Items.length;++v)f[c.pictureId(m.Items[v])]=m.Items[v].filename||m.Items[v]}for(g=0;g<u.items.length;++g){var w=u.items[g];w.correct?p.push(t.createPairAnswer(w.pair[0],f[w.pair[0]],w.pair[1])):null!==w.answer?p.push(t.createPairAnswer(w.pair[0],f[w.pair[0]],w.answer+"("+w.pair[1]+")")):p.push(t.createPairAnswer(w.pair[0],f[w.pair[0]],"("+w.pair[1]+")"))}return{question:l,answer:p,check_input:d,correctness:u.correctness,score:u.score,outof:u.outof}}function w(n,c,u,p,f){var h="QC"+c,g=(f=f||i("#"+h)).attr("qindex"),m={};t.questionIf[h]=m,m.loadCorrect=function(e){var n=[];f.find(".dd-cover .dditem").each(function(){n.push(i(this))});for(var r=f.find(".dd-cover .ddbox"),o=e.Boxes?e.Boxes:[],a=0;a<o.length;++a){var s=o[a];if(s.Items)for(var c=0;c<s.Items.length;++c)for(var l=s.Items[c].filename||s.Items[c],d=u&&s.Items[c].origbase||l,p=0;p<n.length;++p)if(d===n[p].attr("save")){n[p].appendTo(i(r[a])),n.splice(p,1);break}}for(r={},f.find(".dd-cover .ddbox").each(function(){r[t.data(i(this),"name")]=i(this)}),a=0;a<n.length;++a)n[a].appendTo(r[t.data(n[a],"boxname")]);f.trigger("change")},m.setReadOnly=function(e){f.find(".dditem").draggable(e?"disable":"enable")};var v=t.getNumbering(n,g);f.attr("numbering",v),f.attr("scoring-weight",n["scoring-weight"]),f.attr("policy",n.policy),"yes"===n["only-drop-on-boxes"]&&f.addClass("onlydroponboxes");var w=t.createQuestionDiv(v,n.Question).appendTo(f);r.process(w),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"===e.getWidgetType()).appendTo(f),t.createHint(n,f),i(document.createElement("div")).addClass("rationalediv").appendTo(f);var b=i(document.createElement("div")).addClass("dd-cover").appendTo(f),y=i(document.createElement("div")).addClass("words").appendTo(b),C=i(document.createElement("div")).addClass("dd-boxes-scrolling-wrapper").css({width:"100%","overflow-x":"auto"}).appendTo(b),k=i(document.createElement("div")).addClass("dd-boxes");function T(e,t){var n=i(e).offset();i(e).appendTo(t),i(e).offset(n),f.trigger("change")}k.appendTo(C),y.droppable({drop:function(e,t){T(t.draggable,this)},tolerance:"intersect",scope:h}),y.addClass("animatedrop");for(var x=[],_=n.Boxes?n.Boxes:[],S=0;S<_.length;++S){var E=_[S];if(E.Items)for(var I=0;I<E.Items.length;++I)x.push(E.Items[I])}x=d.shuffleArray(x);var O,A,q={},P={},D=C[0],N=e.getScrollObject()[0];function R(e){P.down>0&&(N.scrollTop=N.scrollTop+(P.down>>1)),P.up>0&&(N.scrollTop=N.scrollTop-(P.up>>1)),P.left>0&&(D.scrollLeft=D.scrollLeft-(P.left>>1)),P.right>0&&(D.scrollLeft=D.scrollLeft+(P.right>>1)),(P.up>0||P.down>0||P.left>0||P.right>0)&&e()&&setTimeout(R.bind(null,e),100)}function L(e){var t=i(document.createElement("div")).append(l.create({img:e,disable_press:!0}));return"Fixed"===n.img_resize_mode&&t.addClass("fixed-size").css("height",n.img_resize_height),t}function M(e,t,n,r){var o=e.offset(),a=t.top+r,i=t.left+n;return i>=o.left&&a>=o.top&&i<=o.left+e.outerWidth()&&a<=o.top+e.outerHeight()}for(S=0;S<x.length;++S){var B=x[S],W=i(document.createElement("div")).addClass("dditem");if(t.setTag(W,"dd-wrong"),u){var F=x[S].origbase;W.attr({save:F,pic:B.sources[0].src}).addClass("dditem-img"),L(B).addClass("imgwrapper").appendTo(W),t.createCorrectWrongMarker().appendTo(W)}else W.attr("save",x[S]),W.safeHtml(o.prepare(x[S])),t.createCorrectWrongMarker().appendTo(W);"None"===n["item-frame"]&&W.addClass("dditem-noframe"),W.appendTo(y),W.draggable({scope:h,helper:function(e){var t=i(e.currentTarget),n=t.clone().addClass("dragging-clone").appendTo(b);return n.css({position:"absolute",width:t.width(),height:t.height()}),this.offsetX=t.width()/2,this.offsetY=t.height()/2,n.get(0)},appendTo:b,start:function(e,t){i(this).addClass("drag_placeholder"),q={top:i(N).offset().top+50,bottom:i(N).offset().top+i(N).height()-50,left:i(D).offset().left+50,right:i(D).offset().left+i(D).width()-50,scrollTop:N.scrollTop},O=!1,A=!0,this.targetBoxes=b.find(".words, .ddbox")},drag:function(e,t){if("yes"===n["only-drop-on-boxes"]){var r=this.targetBoxes.find(".current-drop-target");if(0===r.length||!M(r,t.offset,this.offsetX,this.offsetY)){this.targetBoxes.removeClass("current-drop-target");for(var o=0;o<this.targetBoxes.length;++o)if(M(r=i(this.targetBoxes[o]),t.offset,this.offsetX,this.offsetY)){r.addClass("current-drop-target");break}}}var a=i(".ui-draggable-dragging");function s(){a.setTranslate(0,N.scrollTop-q.scrollTop)}P.up=q.top-e.clientY,P.down=e.clientY-q.bottom,P.left=q.left-e.clientX,P.right=e.clientX-q.right,(P.up>0||P.down>0||P.left>0||P.right>0)&&!O?(R(function(){return s(),A}),O=!0):(s(),O=!1)},stop:function(e,t){this.targetBoxes.removeClass("current-drop-target"),O=!1,A=!1;var n=i(this);n.removeClass("drag_placeholder"),n.parent().hasClass("animatedrop")?(n.css("position","relative"),n.offset(i(t.helper).offset()),n.animate({top:0,left:0},function(){null!=p&&p()})):(n.css("position","absolute"),n.offset(i(t.helper).offset()),null!=p&&p())}})}if(""!=n.background_picture){k.css({"background-image":"url("+s(n.background_picture)+")","background-repeat":"no-repeat"});var U=new Image;U.onload=function(){var e=this.width,t=this.height;if(console.log(e,t),"yes"!==n["auto-position"])for(var r=n.Boxes?n.Boxes:[],o=0;o<r.length;++o){var a=r[o];if(null!=a.name)try{console.log(a.position);var i=parseFloat(a.position.X)+parseFloat(a.position.Width);isNaN(i)||(e=Math.max(e,i));var s=parseFloat(a.position.Y)+parseFloat(a.position.Height);isNaN(s)||(t=Math.max(t,s))}catch(e){console.log("Wrong dragdrop box position configuration: no number")}}k.css("width",e+"px").css("height",t+"px")},U.src=n.background_picture}var z,H=0,j=0;for("no"===n["only-drop-on-boxes"]&&k.droppable({drop:function(e,t){T(t.draggable,this)},scope:h}),S=0;S<_.length;++S){var Q=_[S];if(""!==Q.name){var J=i(document.createElement("div")).attr("id",h+"ddbox_"+S).addClass("ddbox");if(t.data(J,"name",(z=Q.name,i(document.createElement("div")).safeHtml(z).text())),i(document.createElement("div")).addClass("ddboxbg").appendTo(J),J.droppable({drop:function(e,t){T(t.draggable,this)},tolerance:"intersect",scope:h}),"yes"===n["only-drop-on-boxes"]&&J.addClass("animatedrop"),J.appendTo(k),"yes"!==n["auto-position"]){J.css({left:Q.position.X+"px",top:Q.position.Y+"px",width:Q.position.Width+"px",height:Q.position.Height+"px"});var V=Q.position.X+Q.position.Width,Y=Q.position.Y+Q.position.Height;V>H&&(H=V),Y>j&&(j=Y),J.addClass("positioned")}else""!=Q.position.Width&&J.css("width",Q.position.Width+"px"),""!=Q.position.Height&&J.css("min-height",Q.position.Height+"px");"yes"===n["show-box-header"]&&i(document.createElement("div")).addClass("ddbox_box_header").safeHtml(o.prepare(Q.name)).appendTo(J),"Dotted"===n["box-border"]?J.addClass("ddbox_border_dotted"):"None"===n["box-border"]&&J.addClass("ddbox_border_none"),"Transparent"===n["box-background"]?J.addClass("ddbox_background_transparent"):"Semi-transparent"===n["box-background"]&&J.addClass("ddbox_background_semitransparent"),J.bind("touchend",function(){T(self.dragItem,this)})}}"yes"===n["auto-position"]&&k.addClass("auto-position"),t.processEmbeddedElements(f)}return n.TextDragDrop={save:f,load:u,clear:p,check:function(e){return g.bind(this)(e,!1)},getCheckInput:h,render:function(e,t,n,r){return w.bind(this)(e,t,!1,n,r)},prepareCorrection:m,getAnswer:function(e,t,n){return v.bind(this)(e,t,n,!1)}},n.PictureDragDrop={save:f,load:u,clear:p,check:function(e){return g.bind(this)(e,!0)},getCheckInput:h,render:function(e,t,n,r){return w.bind(this)(e,t,!0,n,r)},prepareCorrection:m,getAnswer:function(e,t,n){return v.bind(this)(e,t,n,!0)}},n})},function(e,t,n){var r,o,a,i,s;e.exports=(n(1),r=n(6),n(123),o=n(454),n(3),a=n(4),i=n(0),s=n(5),function(e,t){var n={};return n.Whiteboard={save:function(e){var n=i(e).attr("id");return t.questionIf[n].whiteboard.saveData()},load:function(e,n){var r=i(e).attr("id");t.questionIf[r].isLoaded=!1,t.questionIf[r].whiteboard.loadData(n,function(){t.questionIf[r].isLoaded=!0})},clear:function(e){var n=i(e).attr("id");return t.questionIf[n].whiteboard.clearPage()},render:function(n,s,c){var l="QC"+s,d=i("#"+l),u=d.attr("qindex"),p=t.getNumbering(n,u);d.attr("numbering",p),d.attr("scoring-weight",n["scoring-weight"]);var f=t.createQuestionDiv(p,n.Question).appendTo(d);r.process(f),n.audio&&""!=n.audio&&a.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(d);var h=i(document.createElement("div")).addClass("w-cover").appendTo(d),g=i(document.createElement("div")).addClass("w-toolbar-wrapper").appendTo(h),m=i(document.createElement("div")).addClass("bw-toolbar").appendTo(g);m.addClass("black"==n.button_color?"white":"black");var v=i(document.createElement("div")).addClass("bw-toolbar hidden").appendTo(g);function w(e,t){i(document.createElement("div")).attr("id",e).addClass("bw-button-group").appendTo(t)}v.addClass("black"==n.button_color?"white":"black"),w("buttons-container",m),w("width-buttons-container",m),w("colors-container",m),w("tool-buttons-container",m),w("photo-buttons-container",v);var b=i(document.createElement("div")).attr("id","drawingareawrapper").appendTo(h),y=i(document.createElement("div")).attr("id","drawingarea").appendTo(b);i(document.createElement("input")).attr({type:"class",id:"textedit",size:"50"}).appendTo(b),i(document.createElement("input")).attr({type:"file",accept:"image/*"}).addClass("take-picture-field hidden").appendTo(h);var C=i(document.createElement("div")).addClass("photo-placer hidden").appendTo(b),k=Math.round(4*(n.Height-100)/3),T=n.Height-100;C.css("height",T+"px"),C.css("width",k+"px"),C.attr("data-start-height",T),C.attr("data-start-width",k),o.addWidthButtons("#"+l+" #width-buttons-container",!0),o.addColorButtons("#"+l+" #colors-container",!0),o.addClearUndoRedoButtons("#"+l+" #buttons-container"),o.addZoomButtons("#"+l+" #buttons-container","yes"===n.enable_pan),o.addDrawToolButtons("#"+l+" #buttons-container","yes"===n.enable_photo,"yes"===n.enable_pan,!0,n.stickers&&n.stickers.length>0),o.addPhotoEditingButtons("#"+l+" #photo-buttons-container");var x={};t.questionIf[l]=x,x.whiteboard=o.createWhiteboard({topselector:"#"+l,canvasselector:" #drawingarea",createCanvas:!0,width:y.width(),height:n.Height,background_image:n.img,background_resize_policy:n["resize-policy"],image_on_top:"yes"===n.image_on_top,maintoolbar:m,phototoolbar:v,enablephoto:"yes"===n.enable_photo,colorsaspopup:"bottom",widthaspopup:"bottom",toolsaspopup:"bottom",allow_pan:"yes"===n.enable_pan,allow_zoom:"yes"===n.enable_pan,stickers:n.stickers}),y.find("canvas").css("height",n.Height),x.repaint=x.onResize=function(){var e=i("#"+l),t=e.find("#drawingarea");e.find("canvas").attr("width",t.width()),this.whiteboard.redrawOnResize()},d.find("img").on("load",function(){t.triggerImageLoaded()}).each(function(){this.complete&&i(this).load()}),x.whiteboard.onChange(function(){null!=c&&c()}),x.setReadOnly=function(e){this.whiteboard.setReadOnly(e)},t.createHint(n,d),h.addClass("rationalediv"),t.processEmbeddedElements(d)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},fetchAsset:function(e){var n=i(e).attr("id"),r=t.questionIf[n].whiteboard.imgData();return r?{data:r,mimetype:"image/png"}:void 0},assetUploadCompleteCB:function(e,n){var r=i(n).attr("id");t.questionIf[r].url=e},getAnswer:function(n,r,o){var a=i(n),c=a.attr("id"),l=a.find(e.MH).html(),d=t.questionIf[c].url,u=s.check.Whiteboard(o,!1===t.questionIf[c].whiteboard.isEmpty());return{question:l,answer:d,correctness:u.correctness,score:u.score,outof:u.outof}}},n})},function(e,t,n){n(455);var r=n(22);e.exports=function(e,t,n,o,a,i,s,c,l){function d(e,t){return o(document.createElement("div")).addClass("bw-toolbutton").attr("id",e).append(o(document.createElement("div")).addClass("bw-icon "+t))}return{addColorButtons:function(e,t){var n=[{datacolor:"white",classname:"bw-color-white"},{datacolor:"black",classname:"bw-color-black"},{datacolor:"red",classname:"bw-color-red"},{datacolor:"orange",classname:"bw-color-orange"},{datacolor:"yellow",classname:"bw-color-yellow"},{datacolor:"#00de00",classname:"bw-color-green"},{datacolor:"blue",classname:"bw-color-blue"},{datacolor:"#bc00de",classname:"bw-color-purple"},{datacolor:"brown",classname:"bw-color-brown"}],r=o(e);if(r.addClass("color-button-bar"),!0===t){o(document.createElement("div")).addClass("bw-toolbutton").attr("id","color_popup").append(o(document.createElement("div")).addClass("bw-icon bw-icon-fill-drop")).append(o(document.createElement("div")).addClass("bw-icon bw-icon-fill-drop-small bw-color-blue")).appendTo(r);for(var a=o(document.createElement("div")).attr("id","colorpopup").appendTo(o("body")),i=0;i<n.length;++i)o(document.createElement("a")).attr({"data-color":n[i].datacolor,href:"#"}).append(o(document.createElement("i")).addClass("bw-icon bw-icon-fill-drop-small "+n[i].classname)).appendTo(a)}else for(i=0;i<n.length;++i)o(document.createElement("div")).addClass("bw-toolbutton colorbutton").attr("data-color",n[i].datacolor).append(o(document.createElement("div")).addClass("bw-icon bw-icon-fill-drop-small "+n[i].classname)).appendTo(r)},addZoomButtons:function(e,t){var r=o(e);r.addClass("tool-button-bar"),!0===t&&!1===n.isTouchDevice()&&(d("zoom_in_drawing","bw-icon-zoom-in").appendTo(r),d("zoom_out_drawing","bw-icon-zoom-out").appendTo(r))},addWidthButtons:function(e,t){var n=[{datasize:2,datafontsize:16,classname:"bw-icon-smalldot"},{datasize:6,datafontsize:20,classname:"bw-icon-mediumdot"},{datasize:14,datafontsize:24,classname:"bw-icon-largedot"}],r=o(e);if(r.addClass("width-button-bar"),!0===t){o(document.createElement("div")).addClass("bw-toolbutton").attr("id","width_popup").append(o(document.createElement("div")).addClass("bw-icon bw-icon-smalldot")).appendTo(r);for(var a=o(document.createElement("div")).attr("id","widthpopup").appendTo(o("body")),i=0;i<n.length;++i)o(document.createElement("a")).attr({"data-size":n[i].datasize+"","data-fontsize":n[i].datafontsize+"",href:"#"}).append(o(document.createElement("i")).addClass("bw-icon "+n[i].classname)).appendTo(a)}else for(i=0;i<n.length;++i)o(document.createElement("div")).addClass("bw-toolbutton").attr({"data-size":n[i].datasize+"","data-fontsize":n[i].datafontsize+""}).append(o(document.createElement("div")).addClass("bw-icon "+n[i].classname)).appendTo(r)},addDrawToolButtons:function(e,t,r,a,i){var s=[{id:"drawtool",classname:"bw-icon-pencil"},{id:"linetool",classname:"bw-icon-line"},{id:"texttool",classname:"bw-icon-text"},{id:"eraser",classname:"bw-icon-eraser"}];r&&s.unshift({id:"pantool",classname:"bw-icon-pan"});var c=o(e);if(c.addClass("tool-button-bar"),!0===a){d("tool_popup","bw-icon-pencil").appendTo(c);for(var l=o(document.createElement("div")).attr("id","toolpopup").appendTo(o("body")),u=0;u<s.length;++u)o(document.createElement("a")).attr({"data-tool":s[u].id,href:"#"}).append(o(document.createElement("i")).addClass("bw-icon "+s[u].classname)).appendTo(l)}else for(u=0;u<s.length;++u){var p=s[u];d(p.id,p.classname).appendTo(c)}!0===t&&("ibw-platform-osx-ibooks"==n.getPlatform()||o.browser.msie&&10===o.browser.version||d("cameratool","bw-icon-camera").appendTo(c)),!0===i&&d("stickertool","bw-icon-sticker").appendTo(c)},addClearUndoRedoButtons:function(e){var t=o(e);d("reset_image","bw-icon-trash").appendTo(t),d("undo","bw-icon-undo").appendTo(t),d("redo","bw-icon-redo").appendTo(t)},addPhotoEditingButtons:function(e){var t=o(e);d("zoom_in","bw-icon-grow").appendTo(t),d("zoom_out","bw-icon-shrink").appendTo(t),d("rotate_left","bw-icon-rotate-left").appendTo(t),d("rotate_right","bw-icon-rotate-right").appendTo(t),d("accept_image","bw-icon-accept").appendTo(t),d("reject_image","bw-icon-reject").appendTo(t)},createWhiteboard:function(d){var u,p,f,h,g,m,v,w=d.topselector,b=d.toolbarselector||d.topselector,y=w+" "+d.canvasselector,C=d.texteditselector||w+" #textedit",k=d.toolbarselector?d.canvasselector+", "+d.toolbarselector:d.topselector,T=e.create(r.pick(d,["background_resize_policy","transparentbackground","background_image","image_on_top"])),x={x:0,y:0},_=1,S=1;!0===d.createCanvas&&o(document.createElement("div")).attr("id","canvasdiv").append(o(document.createElement("canvas")).attr("id","canvas").attr({width:d.width,height:d.height}).text("Your browser does not support the HTML 5 Canvas.")).appendTo(y);var E=o(y+" #canvas")[0],I=E.getContext("2d"),O=!1;function A(e){if(!O||e){var t=E.width,n=E.height;0!==t&&0!==n&&(O=!0,_=T.backgroundImage.scale(t,n),x=T.backgroundImage.origin(t,n,_),S=T.backgroundImage.drawScale())}}T.initializeBackgroundImage().then(function(){A(!0),Pe()});var q=!0===d.image_on_top;function P(){E.width=E.width,T.clearPage(E,I),Pe()}function D(e){i.showConfirmationDialog(a("Are you sure?"),a("Clear the image and start over?"),function(){P(),e&&e(),null!==qe&&qe()},null,a("Yes, clear the image"),a("No, keep my image"))}function N(e){h&&h.removeClass("bw-selected"),(h=o(e)).addClass("bw-selected"),u=o(e).data("color")}function R(){N(this)}function L(e){for(var t=e.split(" "),n=0;n<t.length;++n)if(0===t[n].indexOf("bw-color"))return t[n];return""}function M(e){f=o(e).data("size"),m=o(e).data("fontsize"),v&&v.removeClass("bw-selected"),(v=o(e)).addClass("bw-selected")}function B(){M(this)}o(b+" #reset_image").tapOrClick(function(){D()}),o(b+" #undo").tapOrClick(function(e){T.undo(),null!==qe&&qe(),Pe()}),o(b+" #redo").tapOrClick(function(e){T.redo(),Pe(),null!==qe&&qe()}),null!=d.toolsaspopup&&"no"!=d.toolssaspopup?(o(b+" #tool_popup").on("toolbarItemClick",function(e,t){switch(o(t).attr("data-tool")){case"pantool":fe();break;case"drawtool":ue();break;case"linetool":pe();break;case"texttool":de();break;case"eraser":ye()}o(this).find("div").removeClass().addClass(o(t).find("i").attr("class")),o(this).data("toolbarObj").hide()}),o(b+" #tool_popup").toolbar({content:"#toolpopup",position:d.toolsaspopup,hideOnClick:!0}).on("toolbarShown",function(){o(b).trigger("whiteboardToolbarShown")})):(o(b+" #pantool").tapOrClick(fe),o(b+" #drawtool").tapOrClick(ue),o(b+" #linetool").tapOrClick(pe),o(b+" #texttool").tapOrClick(de),o(b+" #eraser").tapOrClick(ye)),o(b+" #zoom_in_drawing").tapOrClick(function(){_*=1.25;var e=o(y),t=e.width(),n=e.height();x.x=1.25*(x.x-t/2)+t/2,x.y=1.25*(x.y-n/2)+n/2,Pe()}),o(b+" #zoom_out_drawing").tapOrClick(function(){_/=1.25;var e=o(y),t=e.width(),n=e.height();x.x=(x.x-t/2)/1.25+t/2,x.y=(x.y-n/2)/1.25+n/2,Pe()}),o(b+" #cameratool").click(function(){ie(),o("body").is(".ibw-platform-osx-ibooks")||(-1===n.getPlatform().indexOf("preview")?o(this).closest(".w-cover").find(".take-picture-field").click():i.showAlert(a("Accessing the camera and photo library does not work on this platform."),a("Camera not supported")))}),o(b+" #stickertool").click(function(){var e=o(document.createElement("div")).addClass("bw-popup-wrapper bw-centering-container").appendTo("body"),t=o(document.createElement("div")).addClass("stickers bw-centered").appendTo(e);function n(){e.remove()}function r(e){e.preventDefault(),e.stopPropagation();var t=o(this);n(),we(t.attr("src"),!0)}e.click(n);for(var a=0;a<d.stickers.length;++a)o(document.createElement("img")).attr("src",d.stickers[a].sources[0].src).addClass("sticker").tapOrClick(r).appendTo(t)}),o(b+" #textedit").change(se),o(b+" #zoom_in").tapOrClick(function(){var e=o(w+" .w-cover .photo-placer"),t=1.1*e.width(),n=1.1*e.height();e.width(t),e.height(n);var r=(1-1.1)*e.width()/2,a=(1-1.1)*e.height()/2,i=e.offset();e.offset({top:i.top+a,left:i.left+r})}),o(b+" #zoom_out").tapOrClick(function(){var e=o(w+" .w-cover .photo-placer"),t=e.width()*(1/1.1),n=e.height()*(1/1.1);e.width(t),e.height(n);var r=(1-1/1.1)*e.width()/2,a=(1-1/1.1)*e.height()/2,i=e.offset();e.offset({top:i.top+a,left:i.left+r})}),o(b+" #rotate_left").tapOrClick(function(){me-=15,he(o(w+" .w-cover .photo-placer"),me)}),o(b+" #rotate_right").tapOrClick(function(){me+=15,he(o(w+" .w-cover .photo-placer"),me)}),o(b+" #accept_image").tapOrClick(function(){var e=o(w+" .w-cover .photo-placer"),n=e.width(),r=e.height(),s=e.position(),c=e.attr("data-blob"),l="true"===e.find("img").attr("sticker"),d=me*Math.PI/180;he(e,0);var u=e.position();he(e,me);var p=u.left-s.left,f=u.top-s.top,h=o(w+" #drawingareawrapper"),g=o(w+" #drawingarea"),m=parseInt(h.css("padding-left"))+parseInt(g.css("border-left-width")),v=parseInt(h.css("padding-top"))+parseInt(g.css("border-top-width"));function b(e,t){var o=new Image;o.onload=function(){var e=(s.left+n/2+p-m-x.x)/_,a=(s.top+r/2+f-v-x.y)/_;T.addPhoto(o,t,e,a,n/_,r/_,d),null!==qe&&qe(),Pe()},o.onerror=function(e){console.log("Error loading image (1)"),console.log(e)},"data:"!=e.substr(0,5)&&(o.crossOrigin="Anonymous"),o.src=e,ve()}if(l){var y=c.startsWith("http:")||c.startsWith("https:")?c:window.location.protocol+c;console.log("addImage",y),b(y,y)}else{var C=o(document.createElement("img"));C.appendTo(e),C.load(function(){var n=C.width(),r=C.height(),s=e.width(),c=e.height(),l=function(e,t,n){var r,a=document.createElement("canvas"),i=a.getContext("2d");""!=o(e).attr("src")&&(a.width=t,a.height=n,i.drawImage(e,0,0,t,n));try{var s=.9;do{s-=.1,r=a.toDataURL("image/jpeg",s)}while(r.length>25e4&&s>.5)}catch(e){console.log("No image/jpeg supported for toDataURL"),r=a.toDataURL("image/png")}return r}(C[0],Math.min(n,s),Math.min(r,c));C.remove(),t.registerImage(l).done(function(e){b(l,e)}).fail(function(){i.showAlert(a("Could not store picture"),a("Error using picture"))})}),C.error(function(e){console.log("Error loading image (2)"),console.log(e)}),"http:"!==window.location.protocol&&"https:"!==window.location.protocol||(C[0].crossOrigin="Anonymous"),C.attr("src",c)}}),o(b+" #reject_image").tapOrClick(function(){ve()}),o.fn.enterKey=function(e){return this.each(function(){o(this).keypress(function(t){"13"===(t.keyCode?t.keyCode:t.which)&&e.call(this,t)})})},o(C).enterKey(se),p=T.backgroundImage.isDefined()||!0===d.transparentbackground?"background":"white",null!=d.colorsaspopup&&"no"!=d.colorsaspopup?(o(b+" #color_popup").on("toolbarItemClick",function(e,t){N(t);var n=o(this).find(".bw-icon-fill-drop-small");n.removeClass(L(n.attr("class"))).addClass(L(o(t).find("i").attr("class"))),o(this).data("toolbarObj").hide()}),o(b+" #color_popup").toolbar({content:"#colorpopup",position:d.colorsaspopup,hideOnClick:!0}).on("toolbarShown",function(){o(b).trigger("whiteboardToolbarShown")}),u="blue"):(o(b+" .colorbutton").each(function(e,t){o(t).css("color",s.light[o(t).data("color")]),o(t).tapOrClick(R)}),N(o(b+" .colorbutton")[1]),u="black"),null!=d.widthaspopup&&"no"!=d.widthsaspopup?(o(b+" #width_popup").on("toolbarItemClick",function(e,t){M(t),o(this).find("div").removeClass().addClass(o(t).find("i").attr("class")),o(this).data("toolbarObj").hide()}),o(b+" #width_popup").toolbar({content:"#widthpopup",position:d.widthaspopup,hideOnClick:!0}).on("toolbarShown",function(){o(b).trigger("whiteboardToolbarShown")}),f=2,m=16):(o(b+" #width-buttons").children("li").each(function(e,t){o(t).tapOrClick(B)}),M(o(b+" #width-buttons li:first-child")[0])),E.addEventListener("mousedown",function(e){F||(F=!0,le.start({x:e.clientX,y:e.clientY}))},!1),E.addEventListener("mousemove",function(e){F&&le.move({x:e.clientX,y:e.clientY})},!1),E.addEventListener("mouseup",Ce,!1),E.addEventListener("mouseleave",Ce,!1),E.addEventListener("touchstart",function(e){if(e.preventDefault(),!0!==Se){if(!0===_e&&xe(e,Ee)){if(!0!==d.allow_pan)return;return Ie=e.changedTouches[0].identifier,void Oe(e,Ee,Ie)}1===e.changedTouches.length||!0!==d.allow_pan?(Ee=e.changedTouches[0].identifier,function(e,t){_e=!0,Se=!1;var n=Te(e,t);le.start(n)}(e,Ee)):(Ee=e.changedTouches[0].identifier,Ie=e.changedTouches[1].identifier,Oe(e,Ee,Ie))}},!1),E.addEventListener("touchend",Ae,!1),E.addEventListener("touchcancel",Ae,!1),E.addEventListener("touchmove",function(e){if(e.preventDefault(),_e){var t=Te(e,Ee);if(!t)return;le.move(t)}else if(Se){var n=xe(e,Ee),r=xe(e,Ie);if(null===n||null===r)return void(Se=!1);ke.move(n,r)}},!1),T.drawScreen(E,I);var W,F=!1,U=0;function z(e,t,n){var r=o(e).offset();return{x:t-r.left+window.pageXOffset,y:n-r.top+window.pageYOffset}}function H(e,t,n,r){var o,a,i=z(E,e,t);o=i.x,a=i.y,I.beginPath(),"background"!=n?U?(I.strokeStyle=s.light[n],I.lineWidth=r*_,I.moveTo(o,a),I.lineTo(U.x,U.y),I.stroke()):(I.fillStyle=s.light[n],I.arc(o,a,r/2*_,Math.PI/180*0,Math.PI/180*360,!1),I.fill(),I.closePath()):T.erase(I,o,a,x,_),q&&T.drawImageTranslated(I,x,_);var c={};c.x=(o-x.x)/_,c.y=(a-x.y)/_,W.push(c),U={x:o,y:a}}function j(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}var Q=2.5;function J(e,t){var n="background"===e?W:function(e){var t=[];t.push(e[0]);for(var n=0,r=1;r<e.length-1;++r)j(e[n],e[r])>=Q&&(t.push(e[r]),n=r);return t.push(e[e.length-1]),t}(W);return T.addLine(n,e,t),null!==qe&&qe(),n}function V(e,t,n){W=[],U=0,H(e.x,e.y,t,n)}function Y(e,t,n){H(e.x,e.y,t,n)}function $(e,t,n){J(t,n),Pe()}var K,G={start:function(e){V(e,u,f*S)},move:function(e){Y(e,u,f*S)},end:function(e){$(0,u,f*S)}},X={start:function(e){W=[],U=0,H(e.x,e.y,u,f*S),H(e.x,e.y,u,f*S),X.activeLine=T.addLine(W,u,f*S),null!==qe&&qe()},move:function(e){W=[],H(e.x,e.y,u,f*S),X.activeLine.points[1]=W[0],Pe()},end:function(e){j(X.activeLine.points[0],X.activeLine.points[1])<5&&T.undo(),null!==qe&&qe(),Pe()}},Z={start:function(e){},move:function(e){},end:function(e){}},ee={start:function(e){K=e,d.panbackground&&d.panbackground.start&&d.panbackground.start({pageX:e.x,pageY:e.y})},move:function(e){d.panbackground&&!1!==d.panbackground.panDisabled()||(x={x:x.x+e.x-K.x,y:x.y+e.y-K.y},K=e),d.panbackground&&d.panbackground.move&&d.panbackground.move({pageX:e.x,pageY:e.y}),Pe()},end:function(e){d.panbackground&&!1!==d.panbackground.panDisabled()||(x={x:x.x+e.x-K.x,y:x.y+e.y-K.y}),d.panbackground&&d.panbackground.end&&d.panbackground.end({pageX:e.x,pageY:e.y}),Pe()}},te={start:function(e){V(e,p,14)},move:function(e){Y(e,p,14)},end:function(e){$(0,p,14)}},ne=!1;function re(){var e=o(C),t={16:{x:3,y:3},20:{x:3,y:1},24:{x:3,y:-1}};T.addText((parseInt(e.css("left"))-x.x+t[m].x)/_,(parseInt(e.css("top"))-x.y+t[m].y)/_+m*S,e.val(),u,m*S),null!==qe&&qe(),e.val(""),Pe()}var oe={x:-4,y:-13};function ae(e,t,r){var a=o(C);ne&&""!==a.val()&&re(),a.css("left",e+oe.x+"px"),a.css("top",t+oe.y+"px"),a.css("display","block");var i=o(y).width()-e-15,s=i<200?i:200;if(a.css("width",s+"px"),"ibw-platform-ipad-ibooks"===n.getPlatform()&&n.inIframe()){if(!r){var c=a;a=a.clone(),c.replaceWith(a),a.enterKey(se)}}else a.focus();ne=!0}function ie(){o(C).hide(),ne=!1}function se(e){var t=o(C);return""===t.val()?(ie(),ne=!1):(re(),ae(parseInt(t.css("left"))-oe.x,parseInt(t.css("top"))-oe.y+m*_*S,!0)),e.stopPropagation(),!0}var ce={start:function(e){},move:function(e){},end:function(e){var t=z(E,e.x,e.y);ae(t.x,t.y,!1)}},le=G;function de(){g&&g.removeClass("bw-selected"),(g=o(b+" #texttool")).addClass("bw-selected"),le=ce,o(k).attr("selected-tool","text")}function ue(){g&&g.removeClass("bw-selected"),(g=o(b+" #drawtool")).addClass("bw-selected"),ie(),le=G,o(k).attr("selected-tool","draw")}function pe(){g&&g.removeClass("bw-selected"),(g=o(b+" #linetool")).addClass("bw-selected"),ie(),le=X,o(k).attr("selected-tool","line")}function fe(){g&&g.removeClass("bw-selected"),(g=o(b+" #pantool")).addClass("bw-selected"),ie(),le=ee,o(k).attr("selected-tool","pan")}function he(e,t){var n="rotate("+t+"deg)";e.get(0).style.transform=n,e.get(0).style.oTransform=n,e.get(0).style.msTransform=n,e.get(0).style.mozTransform=n,e.get(0).style.webkitTransform=n}ue();var ge,me=0;function ve(){var e=o(w+" .w-cover .photo-placer");e.css({background:"transparent"}),e.addClass("hidden"),he(e,0),e.height(e.attr("data-start-height")),e.width(e.attr("data-start-width")),e.css({left:0,top:0}),d.maintoolbar.removeClass("hidden"),d.phototoolbar.addClass("hidden"),me=0}function we(e,t){var r=o(w).find(".w-cover .photo-placer");r.empty();var a=o(document.createElement("img")).attr("ondragstart","return false;").css({"image-orientation":"0"});"http:"!==window.location.protocol&&"https:"!==window.location.protocol||(a[0].crossOrigin="Anonymous"),a.attr({src:e,sticker:t?"true":"false"}).appendTo(r),r.removeClass("hidden").css({width:"100%",height:"100%",top:0,left:0}),a.load(function(){var o=u=a.width(),i=u/(d=a.height()),s=r.width(),l=r.height();if(u/s>d/l)var d=(u=Math.min(s,u))/i;else var u=(d=Math.min(l,d))*i;r.height(d),r.width(u),a.attr({width:"100%",height:"100%"}),r.css("overflow","hidden"),n.isIOS()&&!1===t?c(event.target.files[0],{width:o,height:0,crop:!1,quality:100,rotate:0,callback:function(e,t,n){r.attr("data-blob",e)}}):r.attr("data-blob",e)}),d.maintoolbar.addClass("hidden"),d.phototoolbar.removeClass("hidden")}function be(e){var t=o(w);1===e.target.files.length&&0===e.target.files[0].type.indexOf("image/")&&(ve(),we(URL.createObjectURL(e.target.files[0])));var n=t.find(".w-cover .take-picture-field");n.replaceWith(o(n[0].outerHTML)),t.find(".w-cover .take-picture-field").on("change",be)}function ye(){g&&g.removeClass("bw-selected"),(g=o(b+" #eraser")).addClass("bw-selected"),ie(),le=te,o(k).attr("selected-tool","eraser")}function Ce(e){F&&(F=!1,le.end({x:e.clientX,y:e.clientY}))}!0===d.enablephoto&&(ge=o(w),!("url"in window)&&"webkitURL"in window&&(window.URL=window.webkitURL),ge.find(".w-cover .take-picture-field").on("change",be)),(!0===d.enablephoto||d.stickers&&d.stickers.length>0)&&function(){var e=o(w).find(".w-cover .photo-placer");e.get(0).addEventListener("touchstart",function(e){e.preventDefault()},!1),e.get(0).addEventListener("touchmove",function(e){e.preventDefault()},!1),e.get(0).addEventListener("touchend",function(e){e.preventDefault()},!1);var t=new l.Manager(e.get(0));t.add(new l.Pan({threshold:0,pointers:0})),t.add(new l.Rotate({threshold:0})).recognizeWith(t.get("pan")),t.add(new l.Pinch({threshold:0})).recognizeWith([t.get("pan"),t.get("rotate")]);var n=null;function r(t){null===n&&(n={pos:e.offset(),width:e.width(),height:e.height(),center:{x:e.offset().left,y:e.offset().top}}),t&&!n.hasOwnProperty("last_rotation")&&(n.last_rotation=me-t.rotation,n.center=t.center)}function a(t){var r=Math.max(.3,t.scale);e.offset({top:n.pos.top+t.deltaY+(n.center.y-n.pos.top)*(1-r),left:n.pos.left+t.deltaX+(n.center.x-n.pos.left)*(1-r)}),e.width(n.width*r),e.height(n.height*r),n.hasOwnProperty("last_rotation")&&(me=n.last_rotation+t.rotation,he(e,me))}t.on("hammer.input",function(e){e.isFinal&&(n=null)}),t.on("panstart panmove",function(e){"panstart"===e.type?r():a(e)}),t.on("rotatestart rotatemove",function(e){"rotatestart"===e.type?r(e):a(e)}),t.on("pinchstart pinchmove",function(e){"pinchstart"===e.type?r(e):a(e)}),t.on("rotateend rotatecancel pinchend pinchcancel",function(){n&&(n=null,r())})}();var ke={getCenter:function(e,t){return z(E,(e.x+t.x)/2,(e.y+t.y)/2)},getDistance:function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},start:function(e,t){this.center=this.getCenter(e,t),this.size=this.getDistance(e,t)},move:function(e,t){var n=this.getCenter(e,t),r=this.getDistance(e,t);!0===d.allow_zoom?(x.x=(x.x-this.center.x)*r/this.size+n.x,x.y=(x.y-this.center.y)*r/this.size+n.y,_=_*r/this.size):(x.x=x.x-this.center.x+n.x,x.y=x.y-this.center.y+n.y),this.center=n,this.size=r,Pe()},end:function(){}};function Te(e,t){for(var n=0;n<e.changedTouches.length;++n)if(e.changedTouches[n].identifier===t){var r=e.changedTouches[n];return{x:r.clientX,y:r.clientY}}return null}function xe(e,t){for(var n=0;n<e.touches.length;++n)if(e.touches[n].identifier===t){var r=e.touches[n];return{x:r.clientX,y:r.clientY}}return null}var _e=!1,Se=!1,Ee=0,Ie=0;function Oe(e,t,n){_e=!1,Se=!0;var r=xe(e,t),o=xe(e,n);ke.start(r,o)}function Ae(e){if(e.preventDefault(),_e){var t=Te(e,Ee);if(!t)return;_e=!1,le.end(t)}else if(Se){var n=Te(e,Ee),r=Te(e,Ie);null===n&&null===r||(ke.end(),Se=!1)}}var qe=null;function Pe(){E.width=E.width;var e=E.getContext("2d");T.draw(E,e,x,_)}return{loadData:function(e){P(),T.load(e,function(e,n){t.getImageUrl(e).always(function(e){n(e)})},Pe),Pe()},saveData:function(){return T.save()},imgData:function(){return T.imgData()},canvas:E,onChange:function(e){qe=e},redraw:Pe,redrawOnResize:function(){A(!d.allow_zoom),Pe()},setReadOnly:function(e){le=e?Z:G,d.maintoolbar&&d.maintoolbar.toggleClass("hidden",e)},isEmpty:function(){return T.isEmpty()},clear:D,clearPage:P,setOrigin:function(e){x=e},selectTool:function(e){"pan"===e?fe():"draw"===e?ue():"text"===e?de():"eraser"===e?ye():console.log("Request to select unknown tool: "+e)}}}}}(n(456),n(18).o,n(2),n(0),n(7),n(9),n(195),n(457),n(168))},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"create",function(){return s});var r=n(123),o=n.n(r),a=n(121),i=n.n(a);function s(e){var t=o.a.create(),n=!0===e.image_on_top,r={image:null,policy:e.background_resize_policy&&""!==e.background_resize_policy?e.background_resize_policy:"No resize",isDefined:function(){return null!==this.image},isNull:function(){return null===this.image||0===this.width()||0===this.height()},width:function(){return this.image.width},height:function(){return this.image.height},scale:function(e,t){if(this.isNull())return 1;var n=e/this.width(),r=t/this.height();switch(this.policy){case"Cover entire area, keep aspect ratio":return Math.max(n,r);case"Contain entire picture, keep aspect ratio":return Math.min(n,r);case"No resize":default:return 1}},origin:function(e,t,n){return this.isNull()||"Cover entire area, keep aspect ratio"!==this.policy&&"Contain entire picture, keep aspect ratio"!==this.policy?{x:0,y:0}:{x:(e-n*this.width())/2,y:(t-n*this.height())/2}},drawScale:function(e,t){return 1/this.scale(1024,650)}};function a(t,n){!0===e.transparentbackground?n.clearRect(0,0,t.width,t.height):(n.fillStyle="white",n.fillRect(0,0,t.width,t.height))}function s(e){r.isNull()||e.drawImage(r.image,0,0)}function c(e,t,n,o,a){o=o||{x:0,y:0},a=a||1;var i=t-10,s=n-10;if(r.isNull())e.clearRect(i,s,20,20);else{e.fillStyle="white",e.fillRect(i,s,20,20),s-=1;var c=((i-=1)-o.x)/a,l=(s-o.y)/a;if(c<r.width()&&l<r.height()){var d=Math.min(r.width()-c,22/a),u=Math.min(r.height()-l,22/a),p=d*a,f=u*a;e.drawImage(r.image,c,l,d,u,i,s,p,f)}}}function l(e){n||s(e),t.drawToContext(e,c),n&&s(e)}return{clearPage:function(e,n){a(e,n),t.clearPage()},drawScreen:a,draw:function(e,t,n,r){a(e,t),t.save(),t.translate(n.x,n.y),t.scale(r,r),l(t),t.restore()},imgData:function(){var e=document.createElement("canvas"),n=e.getContext("2d"),o=t.bounds(n);r.isNull()||(o.x1=Math.min(o.x1,0),o.y1=Math.min(o.y1,0),o.x2=Math.max(o.x2,r.width()),o.y2=Math.max(o.y2,r.height())),e.width=Math.max(100,o.x2-o.x1),e.height=Math.max(100,o.y2-o.y1),a(e,n),n.save(),n.translate(-o.x1,-o.y1),l(n),n.restore();var i=e.toDataURL();return console.log("Image data: "+i.length+" bytes"),i},erase:c,backgroundImage:r,initializeBackgroundImage:function(){var t=i.a.Deferred();return e.background_image&&""!==e.background_image&&(r.image=new Image,r.image.onload=function(){t.resolve()},"http:"!==window.location.protocol&&"https:"!==window.location.protocol||(r.image.crossOrigin="Anonymous"),r.image.src=e.background_image),t},drawImage:s,drawImageTranslated:function(e,t,n){e.save(),e.translate(t.x,t.y),e.scale(n,n),s(e),e.restore()},undo:t.undo.bind(t),redo:t.redo.bind(t),save:t.save.bind(t),load:t.load.bind(t),addLine:t.addLine.bind(t),addText:t.addText.bind(t),addPhoto:t.addPhoto.bind(t),isEmpty:t.isEmpty.bind(t)}}},function(e,t){e.exports=window.canvasResize},function(e,t,n){var r,o,a,i,s,c,l,d,u,p;e.exports=(n(1),r=n(6),n(3),o=n(4),a=n(2),i=n(459),s=n(0),c=n(55),l=n(9),d=n(7),u=n(460),p=n(5),function(e,t){var n={};return n.Photo={save:function(e){var n=s(e).attr("id"),r=t.questionIf[n].image;return r.is("[data-width]")?u(r.get(0),!0,!1):void 0},load:function(e,n){if("BLANK"!=n){var r=s(e).attr("id"),o=t.questionIf[r].image;t.questionIf[r].isLoaded=!1,c.getImageSize(n,function(e,a){o.attr("data-width",e),o.attr("data-height",a),o.attr("src",n),o.load(function(){t.questionIf[r].isLoaded=!0,o.closest(".photo-cover").addClass("photo-set")})})}else this.clear(e)},preprocessSaveData:function(e,t,n){var r=s.Deferred(),o=s(e),a=o.attr("savedresource");return a&&""!==a&&(t.clearImage(a),o.attr("savedresource",null)),"BLANK"===n?r.resolve(null):t.registerImage(n).done(function(e){o.attr("savedresource",e),r.resolve(e)}).fail(function(){l.showAlert(d("Could not store picture"),d("Error using picture"))}),r},preprocessLoadData:function(e,t,n){var r=s.Deferred(),o=n;return t.getImageUrl(n).then(function(t){s(e).attr("savedresource",o),r.resolve(e,t)},function(){console.log("Could not get image url for",n),r.reject()}),r},freeResources:function(e,t){var n=s(e),r=s.Deferred(),o=n.attr("savedresource");return o&&""!==o?(t.clearImage(o).then(function(){console.log("photo deleted"),r.resolve()},function(){r.reject()}),n.attr("savedresource",null)):r.resolve(),r},clear:function(e){var n=s(e).attr("id"),r=t.questionIf[n].image;t.questionIf[n].isLoaded=!1,t.questionIf[n].url="",t.questionIf[n].uploaded=!1;var o=r.closest(".photo-cover");o.removeClass("photo-set"),o.find(".photo-actual img").attr({src:"","data-width":null,"data-height":null})},render:function(n,c,l){var d="QC"+c,u=s("#"+d),p=u.attr("qindex"),f=e.getQuestionImageDivs(u,n.imgsize,n.img,n.imgpos),h=t.getNumbering(n,p);u.attr("numbering",h),u.attr("scoring-weight",n["scoring-weight"]);var g=t.createQuestionDiv(h,n.Question).appendTo(f.questdiv);r.process(g),n.audio&&""!=n.audio&&o.createPlayer(n.audio,"quiz"==e.getWidgetType()).appendTo(f.audiodiv);var m=s(document.createElement("div")).addClass("photo-cover").appendTo(f.answerdiv),v=s(document.createElement("div")).addClass("photo-place-holder").appendTo(m);v.css("height",n.Height+"px"),v.css("width",Math.round(4*n.Height/3)+"px");var w=s(document.createElement("div")).addClass("photo-place-holder-inner").appendTo(v);"ibw-platform-osx-ibooks"===a.getPlatform()?(s(document.createElement("img")).attr("src","img/photo-placeholder-no-camera.png").appendTo(w),s(document.createElement("p")).safeHtml(t.translate("No camera on this device")).appendTo(w)):(s(document.createElement("img")).attr("src","img/photo-placeholder-camera.png").appendTo(w),s(document.createElement("p")).safeHtml(t.translate("Tap to select picture")).appendTo(w));var b=s(document.createElement("div")).addClass("photo-actual").appendTo(m);b.css("height",n.Height+"px"),b.css("width",Math.round(4*n.Height/3)+"px");var y=s(document.createElement("img")).attr({src:"",alt:"Can't load image"}).appendTo(b);s(document.createElement("div")).addClass("photo-delete-button").append(s(document.createElement("div")).addClass("bw-icon bw-icon-trash")).appendTo(b),s(document.createElement("input")).attr({type:"file",accept:"image/*"}).addClass("take-picture-field hidden").appendTo(m),i.createPhotoQuestion(u,function(){null!=l&&l()});var C={};t.questionIf[d]=C,C.image=y,t.createHint(n,f.hintdiv),f.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,f.imgdiv),t.processEmbeddedElements(u)},prepareCorrection:function(e,n){t.createRationale(n,e.find(".rationalediv"))},fetchAsset:function(e){var n=s(e).attr("id"),r=u(t.questionIf[n].image.get(0),!0,!0);return"BLANK"==r?(t.questionIf[n].url="",void(t.questionIf[n].uploaded=!1)):{data:r,mimetype:"image/png"}},assetUploadCompleteCB:function(e,n){var r=s(n).attr("id");t.questionIf[r].url=e,t.questionIf[r].uploaded=!0},getAnswer:function(n,r,o){var a=s(n),i=a.find(e.MH).html(),c=a.attr("id"),l=t.questionIf[c].url,d=p.check.Photo(o,a.find(".photo-cover").hasClass("photo-set"));return{question:i,answer:l,correctness:d.correctness,score:d.score,outof:d.outof}}},n})},function(e,t,n){var r,o,a,i;e.exports=(r=n(2),o=n(0),a=n(9),i=n(7),{createPhotoQuestion:function(e,t){!("url"in window)&&"webkitURL"in window&&(window.URL=window.webkitURL),e.find(".photo-cover .take-picture-field").on("change",function(e){if(1==e.target.files.length&&0==e.target.files[0].type.indexOf("image/")){var n=URL.createObjectURL(e.target.files[0]),r=o(this).parent().find(".photo-actual img");r.off("load"),r.load(function(){r.attr("data-width",r.width()),r.attr("data-height",r.height()),null!==t&&t()}),r.attr("src",n),o(this).parent().addClass("photo-set")}o(this).replaceWith(o(this).clone(!0))}),o("body").is(".ibw-platform-osx-ibooks")||e.find(" .photo-cover .photo-place-holder").click(function(){-1==r.getPlatform().indexOf("preview")?o(this).parent().find(".take-picture-field").click():a.showAlert(i("Accessing the camera and photo library does not work on this platform."),i("Camera not supported"))}),e.find(".photo-cover .photo-delete-button").tapOrClick(function(){var e=o(this).parent().parent();e.find(".photo-actual img").attr("src",""),e.removeClass("photo-set"),null!==t&&t()})}})},function(e,t,n){var r;e.exports=(r=n(0),function(e,t,n){var o,a=document.createElement("canvas"),i=a.getContext("2d");if(""!==r(e).attr("src")){var s=r(e).attr("data-width"),c=r(e).attr("data-height");a.width=s,a.height=c,i.drawImage(e,0,0,s,c)}else if(t)return"BLANK";if(!0===n)o=a.toDataURL("image/png");else try{var l=.9;do{l-=.1,o=a.toDataURL("image/jpeg",l)}while(o.length>25e4&&l>.5)}catch(e){console.log("No image/jpeg supported for toDataURL"),o=a.toDataURL("image/png")}return o})},function(e,t,n){var r,o,a,i,s,c,l=n(18).o,d=n(92).spellCheckAttribs;e.exports=(n(1),r=n(6),o=n(3),a=n(4),i=n(2),s=n(0),c=n(5),function(e,t){var n={};function u(e){return parseInt(1.2*e+1)}return n.Numeric={name:"Numeric",getData:function(e){var t={};return s(e).find(".n-cover .edit").each(function(){var e=s(this),n=s(this).attr("part"),r=e.val();t[n]=r}),t},save:function(e){var t=this.getData(e);return JSON.stringify(t)},load:function(e,t){var n=JSON.parse(t),r=s(e);r.find(".n-cover .edit").each(function(){var e=s(this),t=s(this).attr("part");n.hasOwnProperty(t)?e.val(n[t]):e.val(""),e.attr("size",u(e.val().length))}),this.check(r)},clear:function(e){var t=s(e);t.find(".n-cover .edit").each(function(){var e=s(this);e.val(""),e.attr("size",u(e.val().length))}),this.check(t)},getCheckInput:function(e){return this.getData(e)},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=c.check.Numeric(n,r),a=e.find(".n-cover");switch(o.correctness){case 0:t.clearTag(a,"n-answer");break;case 1:t.setTag(a,"n-answer");break;case-1:t.clearTag(a,"n-answer");break;case-2:t.setTag(a,"n-open")}},createMatrix:function(e,t,n){var r=s(document.createElement("table")).attr("matrix-style",t),o=s(document.createElement("tr")).appendTo(r);s(document.createElement("td")).addClass("matrix-left").appendTo(o);var a=s(document.createElement("td")).addClass("matrix-body").appendTo(o);s(document.createElement("td")).addClass("matrix-right").appendTo(o);for(var i=s(document.createElement("table")).appendTo(a),c=0;c<e.rows;++c)for(var l=s(document.createElement("tr")).appendTo(i),d=0;d<e.columns;++d)s(document.createElement("td")).appendTo(l).append(n(c,d));return r},render:function(n,o,p,f){var h=this,g="QC"+o,m=(f=f||s("#"+g)).attr("qindex"),v={};t.questionIf[g]=v,v.setReadOnly=function(e){-1===i.getPlatform().indexOf("ipad")&&f.find("input").prop("disabled",e)};var w=e.getQuestionImageDivs(f,n.imgsize,n.img,n.imgpos),b=t.getNumbering(n,m);f.attr("numbering",b),f.attr("scoring-weight",n["scoring-weight"]);var y=t.createQuestionDiv(b,n.Question).appendTo(w.questdiv);r.process(y),n.audio&&""!==n.audio&&a.createPlayer(n.audio,"quiz"===e.getWidgetType()).appendTo(w.audiodiv);var C=s(document.createElement("div")).addClass("n-cover bw-column-container").appendTo(w.answerdiv);function k(e,t){var r=d(!1);return r.type="text",null!=n.placeholder&&""!==n.placeholder&&(r.placeholer=n.placeholder),r.part=t,r.size="1",s(document.createElement("input")).attr(r).addClass("edit "+e)}if(C.attr("answer-style",n.answer_style),v.loadCorrect=function(e){f.find("input").each(function(){var t=s(this),n="";switch(t.attr("part")){case"single":n=e.unit&&""!==e.unit?e.single_number+e.unit:e.single_number;break;case"base":n=e.base;break;case"exponent":n=e.exponent;break;case"numerator":n=e.numerator;break;case"denominator":n=e.denominator;break;case"wholenumber":n=e.whole_number;break;default:var r=t.attr("part").split("_");n=function(e,t,n){if(null==e)return null;if(e.length<=t)return null;var r=e[t].split(" ");return r.length<=n?null:r[n]}(e.matrix,r[1],r[2])}t.val(n),t.attr("size",u(t.val().length))}),h.check(f)},"Single"===n.answer_style)k("single","single").appendTo(C);else if("Fraction"===n.answer_style)s('<table class="fraction"><tr><td class="numeratorcell"></td></tr><tr><td class="denominatorcell"></td></tr></table>').appendTo(C),k("fraction","numerator").appendTo(C.find(".numeratorcell")),k("fraction","denominator").appendTo(C.find(".denominatorcell"));else if("Mixed"===n.answer_style)s('<table class="fraction"><tr><td rowspan="2" class="wholenumbercell"></td><td class="numeratorcell"></td></tr><tr><td class="denominatorcell"></td></tr></table>').appendTo(C),k("fraction","wholenumber").appendTo(C.find(".wholenumbercell")),k("fraction","numerator").appendTo(C.find(".numeratorcell")),k("fraction","denominator").appendTo(C.find(".denominatorcell"));else if("Exponential"===n.answer_style)s(document.createElement("div")).addClass("exponential").appendTo(C),k("","base").appendTo(C.find(".exponential")),k("","exponent").appendTo(C.find(".exponential"));else if("Matrix"===n.answer_style){var T=c.getMatrixDimensions(n.matrix);null!=T?this.createMatrix(T,"parentheses",function(e,t){return k("","c_"+e+"_"+t)}).appendTo(C):console.log("Invalid matrix definition")}else console.error("Unsupported numeric question answer style: "+n.answer_style);t.createCorrectWrongMarker().addClass("bw-column-fixed bw-centering-container").appendTo(C);var x=l.createThrottler(p),_=C.find("input");return _.bind("keyup",function(){s(this).attr("size",u(s(this).val().length)),x.trigger()}),_.bind("change",function(){x.trigger()}),t.createHint(n,w.hintdiv),w.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,w.imgdiv),t.processEmbeddedElements(f),f},prepareCorrection:function(e,n){var r={single_number:n.single_number,unit:n.unit,whole_number:n.whole_number,numerator:n.numerator,denominator:n.denominator,base:n.base,exponent:n.exponent,matrix:n.matrix,answer_style:n.answer_style,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var a,i=this;if(e.find("input").on("keyup change",function(){i.check(e)}),i.check(e),"Single"===n.answer_style)""===n.single_number||isNaN(n.single_number)||(a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+n.single_number+"</div></div>");else if("Fraction"===n.answer_style)a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+o.prepare("$$\\frac{"+n.numerator+"}{"+n.denominator+"}$$")+"</div></div>";else if("Mixed"===n.answer_style)a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+o.prepare("$$"+n.whole_number+"\\frac{"+n.numerator+"}{"+n.denominator+"}$$")+"</div></div>";else if("Exponential"===n.answer_style)a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+o.prepare("$$"+n.base+"^{"+n.exponent+"}$$")+"</div></div>";else if("Matrix"===n.answer_style){var s=c.canonicalMatrix(n);null!=s&&(a="<div class='the-answer' >"+t.translate("The answer:")+'<br><br><div class="answer">'+o.prepare(s)+"</div></div>")}return t.createRationale(n,e.find(".rationalediv"),a),{extrarationale:a}},getAnswer:function(t,n,r){var o=s(t),a=o.find(e.MH).html(),i=this.getCheckInput(o),l=c.check.Numeric(r,i),d=c.createNumericQuestionAnswer(i,-1===l.correctness,r),u=d.answer,p=d.canonicalAnswer;return{question:a,answer:u,check_input:i,correctness:l.correctness,score:l.score,outof:l.outof,canonicalAnswer:p}}},n})},function(e,t,n){var r,o,a,i,s,c,l,d,u=n(18).o;e.exports=(r=n(1),o=n(193),a=n(16),i=n(3),s=n(4),c=n(0),l=n(25),d=n(5),function(e,t){var n=r.getConfigSync(),p={};function f(e,t){var n=[];switch(t){case"none":break;case"all":n=function(e,t){for(var n=[],r=e;r<=t;r++)n.push(r);return n}(0,e.length-1);break;case"odd":for(var r=1;r<e.length;r+=2)n.push(r);break;case"even":for(r=0;r<e.length;r+=2)n.push(r)}var o={values:[],layout:{rows:[],columns:[{width:100},{width:100}]},answers:[]};for(r=0;r<e.length;++r){var a="readonly",i=""+e[r].qty;n.length>0&&r===n[0]&&(a="checked",n.shift()),o.values.push([{value:e[r].atom,CellRole:"readonly"},{value:i,CellRole:a}]),o.layout.rows.push({height:30}),o.answers.push(""+e[r].qty)}return o}function h(e,n,r,a,i){c(document.createElement("div")).attr("id",e).appendTo(r);var s=f(n,a),l=o({tablediv:"#"+e,tabledata:s,compare_casesensitive:!1,support_correction_colors:t.widgetSupportsCorrection()});return l.setChangeCallBack(function(){i&&i()}),c("#"+e).find("tr").each(function(e,n){t.data(c(n).find("td:nth-of-type(2)"),"bce-answer",s.answers[e])}),l}function g(e){return"type1"===e||"type2"===e}function m(e){return"type1"===e||"type2"===e}function v(e){return"type1"===e?"none":"odd"}function w(e){return"type1"===e?"all":"even"}function b(e,t,n){for(var r=[],o=0;o<e.length;++o)n?r.push("<span class='nowrap'>_____ $$"+e[o].formula+"$$</span>"):t?r.push("<span class='nowrap bce-field empty'><input type='text' /> $$"+e[o].formula+"$$</span>"):r.push("<span class='nowrap'>$$"+e[o]+"$$</span>");return r}function y(e,t){var n=a.parseEquation(e.Equation),r="type3"===e.SubType,o=a.formatEquation(n,r||t),i="";return i+=b(o.reactants,r,t).join("$$\\, + \\,$$"),i+=" <span class='nowrap'>$$\\: \\rightarrow \\:$$</span> ",i+=b(o.products,r,t).join("$$\\, + \\,$$")}return p.BalanceChemicalEquation={save:function(e){var n=c(e),r=n.attr("id"),o=n.find("[data-subtype]").attr("data-subtype"),a="";g(o)&&(a=n.find("[checked='checked']").attr("answer")||"");var i=[],s=[];m(o)&&(i=t.questionIf[r].reactantsTable.getData(),s=t.questionIf[r].productsTable.getData());var l=[];return"type3"===o&&n.find("input").each(function(e,t){var n=c(t);l.push(n.val())}),JSON.stringify({checkedAnswer:a,enteredReactantsTableValues:i,enteredProductsTableValues:s,enteredCoefficients:l})},load:function(e,n){var r=c(e),o=r.attr("id");n=JSON.parse(n);var a=r.find("[data-subtype]").attr("data-subtype");g(a)&&n.checkedAnswer&&(r.find("[checked='checked']").trigger("clear"),r.find(".bw-radiobutton[answer='"+n.checkedAnswer+"']").trigger("check")),m(a)&&(t.questionIf[o].reactantsTable.setData(n.enteredReactantsTableValues),t.questionIf[o].productsTable.setData(n.enteredProductsTableValues)),"type3"===a&&r.find("input").each(function(e,t){var r=c(t);e<n.enteredCoefficients.length&&r.val(n.enteredCoefficients[e])}),this.check(r)},clear:function(e){var n=c(e),r=n.attr("id"),o=n.find("[data-subtype]").attr("data-subtype");g(o)&&n.find("[checked='checked']").trigger("clear"),m(o)&&(t.questionIf[r].reactantsTable.clear(),t.questionIf[r].productsTable.clear()),"type3"===o&&n.find("input").each(function(){var e=c(this);e.val(""),t.clearTag(e,"wrong")})},render:function(r,o,i,d){var p="QC"+o,m=(d=d||c("#"+p)).attr("qindex"),b=e.getQuestionImageDivs(d,r.imgsize,r.img,r.imgpos);t.addNarrowScreenPadding(d);var C=t.getNumbering(r,m);d.attr("numbering",C),d.attr("scoring-weight",r["scoring-weight"]);var k=r.Question+"<br><br>"+y(r);t.createQuestionDiv(C,k).appendTo(b.questdiv),t.createCorrectWrongMarker().appendTo(b.questdiv.find(".bce-field")),r.audio&&""!==r.audio&&s.createPlayer(r.audio,"quiz"===e.getWidgetType()).appendTo(b.audiodiv);var T=c(document.createElement("div")).addClass("bce-cover").appendTo(b.answerdiv);T.attr("data-subtype",r.SubType);var x={},_=u.createThrottler(i);if("type3"!==r.SubType){var S=c(document.createElement("div")).addClass("tablewrapper").appendTo(T);c(document.createElement("div")).addClass("tabletitle").text(t.translate("Reactants")).appendTo(S);var E=c(document.createElement("div")).addClass("tablewrapper").appendTo(T);c(document.createElement("div")).addClass("tabletitle").text(t.translate("Products")).appendTo(E);var I=a.parseEquation(r.Equation),O=a.reduceReactantsAndProducts(I),A=h("reactantstable_"+o,O.reactants,S,v(r.SubType),_.trigger.bind(_)),q=h("productstable_"+o,O.products,E,w(r.SubType),_.trigger.bind(_));x.reactantsTable=A,x.productsTable=q,t.questionIf[p]=x,x.repaint=function(){A.render(),q.render()},x.setReadOnly=function(e){!1===e&&"no"===n.color_correct_answers&&(A.setCorrectionCallback(null),q.setCorrectionCallback(null)),A.setReadOnly(e),A.render(),q.setReadOnly(e),q.render()},x.formattedEquation=y(r)}if(g(r.SubType)){var P=c(document.createElement("div")).addClass("balanced-or-not-control").appendTo(T),D=t.translate("Yes, this equation is balanced"),N=l.createLabeledRadiobutton(P,D,function(){t.checkMode||(c(this).parent().find(".bw-radiobutton").trigger("clear"),c(this).trigger("check"),_.trigger())});N.attr("answer",D).attr("check_input","yes"),N.find(".bw-button-label").append(t.createCorrectWrongMarker());var R=t.translate("No, this equation is not balanced"),L=l.createLabeledRadiobutton(P,R,function(){t.checkMode||(c(this).parent().find(".bw-radiobutton").trigger("clear"),c(this).trigger("check"),_.trigger())});L.attr("answer",R).attr("check_input","no"),L.find(".bw-button-label").append(t.createCorrectWrongMarker())}t.createHint(r,b.hintdiv),b.rationalediv.addClass("rationalediv"),t.createOptionalImage(r,b.imgdiv),"type3"===r.SubType&&(t.questionIf[p]=x,x.reportQuestion=r.Question+"<br>"+y(r,!0));var M=this;return d.find("input").each(function(e){c(this).bind("keyup change",function(){M.check(d),_.trigger()})}),this.check(d),x.loadCorrect=function(e){switch(e.SubType){case"type1":case"type2":var t=a.parseEquation(e.Equation),n=a.reduceReactantsAndProducts(t),r=f(n.reactants,v(e.SubType)),o=f(n.products,w(e.SubType));A.loadCorrect(r),q.loadCorrect(o),d.find("[checked='checked']").trigger("clear"),a.isBalanced(e.Equation)?d.find(".bw-radiobutton[check_input='yes']").trigger("check"):d.find(".bw-radiobutton[check_input='no']").trigger("check");break;case"type3":var i=(t=a.parseEquation(e.Equation)).reactants.concat(t.products),s=0;d.find("input").each(function(){c(this).val(i[s++].qty)}),M.check(d)}},t.processEmbeddedElements(d),d},getCheckInput:function(e){var n,r=e.attr("id");switch(e.find("[data-subtype]").attr("data-subtype")){case"type1":case"type2":return{balanced:(n=e.find("[checked='checked']"),0===n.length?"":n.attr("check_input")),reactantsTable:t.questionIf[r].reactantsTable.getCheckInput(),productsTable:t.questionIf[r].productsTable.getCheckInput()};case"type3":var o=[];return e.find("input").each(function(e,t){var n=c(t);o.push(n.val()||"1")}),o}return null},check:function(e){if("type3"===e.find("[data-subtype]").attr("data-subtype")){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=d.check.BalanceChemicalEquation(n,r),a=0;e.find("input").each(function(e,n){var r=c(n);1===o.correctness[a++]?t.clearTag(r.parent(),"wrong"):t.setTag(r.parent(),"wrong"),""!==r.val()?t.clearTag(r.parent(),"empty"):t.setTag(r.parent(),"empty")})}},prepareCorrection:function(e,n){var r=e.attr("id"),o={SubType:n.SubType,Equation:n.Equation,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(o));var s,c=t.questionIf[r].reactantsTable,l=t.questionIf[r].productsTable,u=a.parseEquation(n.Equation),p=a.reduceReactantsAndProducts(u);if(c){var h={"case-sensitive":"no",tabledata:f(p.reactants,v(n.SubType)),"scoring-weight":"1"};c.setCorrectionCallback(function(){return d.check.FillInTable(h,c.getCheckInput())})}if(l){var m={"case-sensitive":"no",tabledata:f(p.products,w(n.SubType)),"scoring-weight":"1"};l.setCorrectionCallback(function(){return d.check.FillInTable(m,l.getCheckInput())})}if(g(n.SubType)){var b=a.isBalanced(n.Equation),C=e.find("[check_input=yes]"),k=e.find("[check_input=no]");if(b){var T=t.translate("Yes, this equation is balanced");t.setTag(C,"bce-answer"),t.clearTag(k,"bce-answer"),s=T}else{var x=t.translate("No, this equation is not balanced");t.setTag(k,"bce-answer"),t.clearTag(C,"bce-answer"),s=x}}else s=i.prepare(y({Equation:n.Equation,SubType:"type1"}));var _="<div class='the-answer' >"+t.translate("The answer:")+'</br><div class="answer">'+s+"</div></div>";return t.createRationale(n,e.find(".rationalediv"),_),{extrarationale:_}},getAnswer:function(n,r,o,i){var s=c(n),l=s.attr("id"),u=s.find(e.MH).html(),p=this.getCheckInput(s),h=d.check.BalanceChemicalEquation(o,p),g=[],m="",b={},C="";switch(o.SubType){case"type1":case"type2":var k,T=t.translate("Yes, this equation is balanced"),x=t.translate("No, this equation is not balanced");switch(p.balanced){case"":k=t.translate("(no option chosen)");break;case"no":k=x;break;case"yes":k=T}m=a.isBalanced(o.Equation)?T:x;var _=a.parseEquation(o.Equation),S=a.reduceReactantsAndProducts(_);g.push(k);for(var E=0;E<p.reactantsTable.length;++E)""===(I=p.reactantsTable[E])?g.push(" ("+S.reactants[I.row].qty+")"):g.push(parseInt(I.value)===S.reactants[I.row].qty?I.value:I.value+" ("+S.reactants[I.row].qty+")");for(E=0;E<p.productsTable.length;++E){var I;""===(I=p.productsTable[E])?g.push(" ("+S.products[I.row].qty+")"):g.push(parseInt(I.value)===S.products[I.row].qty?I.value:I.value+" ("+S.products[I.row].qty+")")}var O={"case-sensitive":"no",tabledata:f(S.reactants,v(o.SubType)),"scoring-weight":"1"},A={"case-sensitive":"no",tabledata:f(S.products,w(o.SubType)),"scoring-weight":"1"};C="<br>"+t.questionIf[l].formattedEquation+"<br><br>"+t.translate("Reactants")+": "+t.questionIf[l].reactantsTable.getEmailTable(i,d.check.FillInTable(O,t.questionIf[l].reactantsTable.getCheckInput()))+"<br><br>"+t.translate("Products")+": "+t.questionIf[l].productsTable.getEmailTable(i,d.check.FillInTable(A,t.questionIf[l].productsTable.getCheckInput()))+"<br>"+k;break;case"type3":m=y({Equation:o.Equation,SubType:"type1"}),g=p,b={"font-size":"20px"},u=t.questionIf[l].reportQuestion}var q={question:u,answer:g,annotatedtable:C,check_input:p,correctness:h.correctness,score:h.score,outof:h.outof,canonicalAnswer:m,canonicalAnswerCSS:b};return t.questionIf[l].reportQuestion&&(q["report-question"]=t.questionIf[l].reportQuestion),q}},p})},function(e,t,n){var r,o,a,i,s,c,l=n(22).cloneDeep;e.exports=(n(1),r=n(16),o=n(464),a=n(3),i=n(4),s=n(0),n(194),c=n(5),function(e,t){var n={},d=l(o);function u(e){var t=[];return e.find("li").each(function(e,n){var r=s(n).attr("data-ion-index");t.push(d[r])}),t}function p(e,n,o,i){var s,c,l,d=(s=u(e),c=u(n),l=s.concat(c),{parsedFormula:r.joinIonsToFormula(l),totalCharge:r.totalCharge(l)}),p=r.formatFormula(d.parsedFormula);o.safeHtml(a.prepare("$$"+p+"$$")),a.process(o.children()),t.createCorrectWrongMarker().appendTo(o),p?i.text(t.translate("Sum of charges:")+" "+d.totalCharge):i.text("")}var f,h,g={},m={},v=e.getScrollObject()[0];function w(e,t,n,o,i,c,l){var d=s(document.createElement("li"));d.addClass("wordwrapper"),d.safeHtml(a.prepare("$$"+r.formatIon(e)+"$$")),d.attr("data-ion-index",t),e.charge>0?n.append(d):o.append(d),l&&d.draggable({helper:"clone",scope:e.charge>0?"pos":"neg",revert:"invalid",start:function(e,t){g={top:s(v).offset().top+50,bottom:s(v).offset().top+s(v).height()-50,scrollTop:v.scrollTop},f=!1,h=!0},drag:function(e,t){var n=s(".ui-draggable-dragging");function r(){n.setTranslate(0,v.scrollTop-g.scrollTop)}m.up=g.top-e.clientY,m.down=e.clientY-g.bottom,(m.up>0||m.down>0)&&!f?(function e(t){m.down>0&&(v.scrollTop=v.scrollTop+(m.down>>1)),m.up>0&&(v.scrollTop=v.scrollTop-(m.up>>1)),(m.up>0||m.down>0)&&t()&&setTimeout(e.bind(null,t),100)}(function(){return r(),h}),f=!0):(r(),f=!1,h=!1)},stop:function(e,t){f=!1}})}return n.IonicCompoundBuilder={save:function(e){var t=s(e),n=t.find("#pos-drop-target"),r=t.find("#neg-drop-target"),o=[];return n.find("li").each(function(e,t){var n=s(t).attr("data-ion-index");o.push(n)}),r.find("li").each(function(e,t){var n=s(t).attr("data-ion-index");o.push(n)}),JSON.stringify(o)},load:function(e,t){for(var n=s(e),r=n.find("#pos-drop-target"),o=n.find("#neg-drop-target"),i=JSON.parse(t),c=0;c<i.length;++c){var l=i[c];l<d.length?w(d[l],l,r,o,0,0,!1):console.error("Saved ion doesn't exist anymore: ",l)}a.process(r.find("li").children()),a.process(o.find("li").children()),p(r,o,n.find(".composed-formula"),n.find(".total-charge")),this.check(n)},clear:function(e){var t=s(e),n=t.find("#pos-drop-target"),r=t.find("#neg-drop-target");n.find("li").remove(),r.find("li").remove(),p(n,r,t.find(".composed-formula"),t.find(".total-charge")),this.check(t)},render:function(n,o,c,l){var u="QC"+o,f=(l=l||s("#"+u)).attr("qindex"),h={};t.questionIf[u]=h;var g=this;h.loadCorrect=function(e){var t=l.find("#pos-drop-target"),n=l.find("#neg-drop-target");t.find("li").remove(),n.find("li").remove();for(var o=r.splitFormulaInIons(e.Valid,d),i=0;i<o.length;++i)for(var s=0;s<d.length;++s){var c=d[s];if(c.ion===o[i].ion)for(var u=0;u<o[i].qty;++u)w(c,s,t,n,0,0,!1)}a.process(t.find("li").children()),a.process(n.find("li").children()),p(t,n,l.find(".composed-formula"),l.find(".total-charge"))};var m=e.getQuestionImageDivs(l,n.imgsize,n.img,n.imgpos);t.addNarrowScreenPadding(l);var v=t.getNumbering(n,f);l.attr("numbering",v),l.attr("scoring-weight",n["scoring-weight"]),t.createQuestionDiv(v,n.Question).appendTo(m.questdiv),n.audio&&""!==n.audio&&i.createPlayer(n.audio,"quiz"===e.getWidgetType()).appendTo(m.audiodiv);var b=s(document.createElement("div")).addClass("icb-cover").appendTo(m.answerdiv);t.data(b,"valid-answer",n.Valid);var y=s(document.createElement("div")).addClass("bw-row").appendTo(b),C=s(document.createElement("div")).addClass("bw-col-1-2").appendTo(y),k=s(document.createElement("ul")).addClass("drag-source").appendTo(C),T=s(document.createElement("div")).addClass("bw-col-1-2").appendTo(y),x=s(document.createElement("ul")).addClass("drag-source").appendTo(T),_=s(document.createElement("div")).addClass("bw-row").appendTo(b),S=s(document.createElement("div")).addClass("bw-col-1-2 ddboxwrapper").css("position","relative").appendTo(_),E=s(document.createElement("ul")).addClass("drop-target ddbox").attr("id","pos-drop-target").appendTo(S);s(document.createElement("div")).addClass("ddboxbg").appendTo(E),s(document.createElement("div")).addClass("sign").text("+").appendTo(S);var I=s(document.createElement("div")).addClass("trash-button bw-icon-small bw-icon-trash bw-smalliconbutton").appendTo(S),O=s(document.createElement("div")).addClass("bw-col-1-2 ddboxwrapper").css("position","relative").appendTo(_),A=s(document.createElement("ul")).addClass("drop-target ddbox").attr("id","neg-drop-target").appendTo(O);s(document.createElement("div")).addClass("ddboxbg").appendTo(A),s(document.createElement("div")).addClass("sign").text("-").appendTo(O);var q=s(document.createElement("div")).addClass("trash-button bw-icon-small bw-icon-trash bw-smalliconbutton").appendTo(O);s(document.createElement("div")).css("clear","both").appendTo(b);var P=s(document.createElement("div")).addClass("composed-formula").appendTo(b),D=s(document.createElement("div")).addClass("total-charge").appendTo(b);t.createHint(n,m.hintdiv),m.rationalediv.addClass("rationalediv"),t.createOptionalImage(n,m.imgdiv);for(var N={},R=0;R<n.KnownIons.length;++R)N[n.KnownIons[R]]=!0;var L=[];for(R=0;R<d.length;++R)d[R].ionIndex=R,d[R].ion in N&&L.push(d[R]);for(R=0;R<L.length;++R){var M=L[R];w(M,M.ionIndex,k,x,0,0,!0)}function B(e,t){e.droppable({scope:t,drop:function(e,t){t.draggable.parent()[0]!==this&&t.draggable.clone().appendTo(s(this)),s(this).sortable("refresh"),p(E,A,P,D),g.check(l),c&&c()}})}return E.add(A).sortable({placeholder:"sortable-placeholder",stop:function(){p(E,A,P,D),g.check(l),c&&c()}}),B(E,"pos"),B(A,"neg"),I.add(q).tapOrClick(function(){s(this).parent().find("li").each(function(e,t){s(t).remove()}),p(E,A,P,D),g.check(l),c&&c()}),t.processEmbeddedElements(l),l},getCheckInput:function(e){var t=e.find("#pos-drop-target"),n=e.find("#neg-drop-target");return{posIons:u(t),negIons:u(n)}},check:function(e){var n;try{n=JSON.parse(t.data(e,"questionconfig"))}catch(e){return}var r=this.getCheckInput(e),o=c.check.IonicCompoundBuilder(n,r),a=e.find(".composed-formula");switch(o.correctness){case-1:t.clearTag(a,"wrong"),t.clearTag(a,"correct");break;case 0:t.setTag(a,"wrong"),t.clearTag(a,"correct");break;case 1:t.clearTag(a,"wrong"),t.setTag(a,"correct")}},prepareCorrection:function(e,n){var r={Valid:n.Valid,"scoring-weight":n["scoring-weight"]};t.data(e,"questionconfig",JSON.stringify(r));var o="<div class='the-answer' >"+t.translate("The answer:")+'</br><div class="answer">'+a.prepare("$$"+n.Valid+"$$")+"</div></div>";return t.createRationale(n,e.find(".rationalediv"),o),{extrarationale:o}},getAnswer:function(t,n,o){var a=s(t),i=a.find(e.MH).safeHtml(),l=this.getCheckInput(a),d=c.check.IonicCompoundBuilder(o,l),u=l.posIons.concat(l.negIons),p=r.joinIonsToFormula(u),f=r.parseFormula(o.Valid);return{question:i,answer:"$$"+r.formatFormula(p)+"$$",check_input:l,correctness:d.correctness,score:d.score,outof:d.outof,canonicalAnswer:"$$"+r.formatFormula(f)+"$$"}},allSupportedIons:d},n})},function(e,t){e.exports=[{ion:"H",charge:1,pattern:[{atom:"H",qty:1}]},{ion:"K",charge:1,pattern:[{atom:"K",qty:1}]},{ion:"Cu",charge:1,pattern:[{atom:"Cu",qty:1}]},{ion:"Ag",charge:1,pattern:[{atom:"Ag",qty:1}]},{ion:"Na",charge:1,pattern:[{atom:"Na",qty:1}]},{ion:"NH4",charge:1,pattern:[{atom:"N",qty:1},{atom:"H",qty:4}]},{ion:"Ba",charge:2,pattern:[{atom:"Ba",qty:1}]},{ion:"Mg",charge:2,pattern:[{atom:"Mg",qty:1}]},{ion:"Cu",charge:2,pattern:[{atom:"Cu",qty:1}]},{ion:"Pb",charge:2,pattern:[{atom:"Pb",qty:1}]},{ion:"Fe",charge:2,pattern:[{atom:"Fe",qty:1}]},{ion:"Zn",charge:2,pattern:[{atom:"Zn",qty:1}]},{ion:"Ca",charge:2,pattern:[{atom:"Ca",qty:1}]},{ion:"Al",charge:3,pattern:[{atom:"Al",qty:1}]},{ion:"Fe",charge:3,pattern:[{atom:"Fe",qty:1}]},{ion:"I",charge:-1,pattern:[{atom:"I",qty:1}]},{ion:"Cl",charge:-1,pattern:[{atom:"Cl",qty:1}]},{ion:"F",charge:-1,pattern:[{atom:"F",qty:1}]},{ion:"NO3",charge:-1,pattern:[{atom:"N",qty:1},{atom:"O",qty:3}]},{ion:"OH",charge:-1,pattern:[{atom:"O",qty:1},{atom:"H",qty:1}]},{ion:"HCO3",charge:-1,pattern:[{atom:"H",qty:1},{atom:"C",qty:1},{atom:"O",qty:3}]},{ion:"CH3COO",charge:-1,pattern:[{atom:"C",qty:1},{atom:"H",qty:3},{atom:"C",qty:1},{atom:"O",qty:1},{atom:"O",qty:1}]},{ion:"CO3",charge:-2,pattern:[{atom:"C",qty:1},{atom:"O",qty:3}]},{ion:"SO4",charge:-2,pattern:[{atom:"S",qty:1},{atom:"O",qty:4}]},{ion:"O",charge:-2,pattern:[{atom:"O",qty:1}]},{ion:"S",charge:-2,pattern:[{atom:"S",qty:1}]},{ion:"PO4",charge:-3,pattern:[{atom:"P",qty:1},{atom:"O",qty:4}]}]},function(e,t,n){var r;e.exports=(r=n(466),function(e,t){return{CorrectSentence:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o;e.exports=(r=n(0),o=n(5),function(e){return function(t,n,a,i,s){var c=e.QuestionTypeBasic(t,n,a,i,s);return c.getCheckInput=function(){var e=[];return this.question.find(".cs-input").each(function(){e.push(r(this).val().trim())}),e},c.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),a=o.check.CorrectSentence(t,n),i=this.question.find(".cs-input"),s=0;i.each(function(){var t=r(this).parent(),n=a.correctness[s++];0===n||-1===n?(e.clearTag(t,"cs-correct"),e.setTag(t,"cs-wrong")):1===n&&(e.setTag(t,"cs-correct"),e.clearTag(t,"cs-wrong"))})}},c.processInputSentence=function(t){var n=r(document.createElement("div")).addClass("cs-sentence"),a=this;return o.processCorrectSentence(t,"yes"===a.data["all-words-editable"],function(e){"\n"===e?n.append("<br>"):n.append(e)},function(e){return r(document.createElement("span")).addClass("cs-word").text(e).appendTo(n)},function(t,o){var i=r(document.createElement("span")).append(r(document.createElement("span")).addClass("text").text(t)).addClass("cs-word").attr("original",t).appendTo(n),s=r(document.createElement("input")).attr("tabindex","-1").addClass("cs-input").val(t).appendTo(i);e.addSpellCheckAttrib(s),e.createCorrectWrongMarker().appendTo(i),e.data(i,"cs-correct-val","true"),s.bind("keyup",function(e){13===(void 0!==e?e:event).keyCode&&r(this).blur()}),s.focus(function(){s.parent().addClass("editing")}),s.blur(function(){var e=r(this),t=r(this).parent(),n=e.val().trim();""===n?(t.addClass("empty"),t.find(".text").text(t.attr("original"))):(t.removeClass("empty"),t.find(".text").text(n)),t.addClass("cs-changed"),c.check(),null!==a.changeCB&&a.changeCB(),t.removeClass("editing")})}),n},c.renderTypeSpecificPart=function(){this.processInputSentence(this.data.Sentence).appendTo(this.divs.answerdiv);var t=this;"yes"!==t.data["all-words-editable"]&&this.divs.answerdiv.find(".cs-word").tapOrClick(function(){var n=r(this);e.data(n,"cs-correct-val")||function(e,t,n,o){var a=e.offset();a.top-=30,t.find(".cs-hint").remove();var i=r(document.createElement("div")).addClass("cs-hint").text(n).appendTo(t).offset(a);setTimeout(i.remove.bind(i),o)}(n,t.question,e.translate("This word is correct."),2e3)}),this.check()},c.save=function(){var e=this.divs.answerdiv.find(".cs-input"),t=[];return e.each(function(){var e=r(this);if(e.parent().hasClass("cs-changed")){var n=e.val();t.push(""===n?" ":n)}else t.push("")}),JSON.stringify({answers:t})},c.load=function(e){var t;try{var n=JSON.parse(e);t=n.answers;var o=this.divs.answerdiv.find(".cs-input"),a=0;o.each(function(){var e=r(this),n=e.parent();if(""!==t[a]){var o=n.find(".text");" "===t[a]?(e.val(""),o.text(n.attr("original")),n.addClass("empty")):(e.val(t[a]),o.text(t[a])),n.addClass("cs-changed")}++a}),this.check()}catch(t){return void console.error("Could not load correct sentence question data",e)}},c.loadCorrect=function(e){var t=this.question.find(".cs-input"),n=0;o.processCorrectSentence(e.Sentence,"yes"===e["all-words-editable"],function(){},function(){},function(e,o){var a=r(t[n++]),i=a.parent();a.val(o),""===o?(i.addClass("empty"),i.find(".text").text(e)):(i.removeClass("empty"),i.find(".text").text(o)),i.addClass("cs-changed")})},c.clear=function(){var e=this.question.find(".cs-input"),t=0,n=this.data;o.processCorrectSentence(n.Sentence,"yes"===n["all-words-editable"],function(){},function(){},function(n,o){var a=r(e[t++]),i=a.parent();a.val(n),i.find(".text").text(n),i.removeClass("cs-changed"),i.removeClass("empty")}),this.check()},c.getCorrectAnswerString=function(e){var t=[];return o.processCorrectSentence(e.Sentence,"yes"===e["all-words-editable"],function(e){t.push(e)},function(e){t.push(e)},function(e,n){t.push('<span class="answer">'+n+"</span>")}),t.join("")},c.getAnswerString=function(e,t,n,r){var a=[],i=0,s="yes"===t["all-words-editable"];return o.processCorrectSentence(t.Sentence,s,function(e){a.push(e)},function(e){a.push(e)},function(t,o){var c=n[i],l=r.correctness[i++];e?s&&t===o?c===t?a.push(c):""==c?a.push("<span style='color: red; text-decoration: line-through ; opacity: 0.7'>"+t+"</span>"):a.push("<span style='color: red'>"+c+"</span>"):1===l?""==c?a.push("<span style='color: green; text-decoration: line-through ; opacity: 0.7'>"+t+"</span>"):a.push("<span style='color: green'>"+c+"</span>"):""==c?a.push("<span style='color: red; text-decoration: line-through ; opacity: 0.7'>"+t+"</span>"):a.push("<span style='color: red'>"+c+"</span>"):a.push("<i>"+c+"</i>")}),a.join("")},c.prepareCorrection=function(t){this.questionconfig={Sentence:t.Sentence,policy:t.policy,"all-words-editable":t["all-words-editable"],"scoring-weight":t["scoring-weight"]};var n="<div class='the-answer' >"+e.translate("The answer:")+"<br><br>"+this.getCorrectAnswerString(t)+"</div>";return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n}},c.getAnswer=function(e,t,n){var r=this.question.find(i.MH).html(),a=this.getCheckInput(),s=o.check.CorrectSentence(t,a);return{question:r,annotatedtable:this.getAnswerString(n,t,a,s),answer:s.answers,correctness:s.correctness,check_input:a,score:s.score,outof:s.outof}},c}})},function(e,t,n){var r;e.exports=(r=n(468),function(e,t){return{MarkSentence:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o,a;e.exports=(r=n(0),o=n(5),a=n(7),function(e){return function(t,n,i,s,c){var l=e.QuestionTypeBasic(t,n,i,s,c);return l.getCheckInput=function(){var e=this,t=[];return this.divs.answerdiv.find(".mas-word").each(function(){t.push(e.categories[parseInt(r(this).attr("marker")||"0")].id)}),t},l.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),a=o.check.MarkSentence(t,n),i=0,s=this.divs.answerdiv.find(".mas-word");o.processMarkSentence(t.Sentence,function(){},function(){c(r(s[i]),a.correctness[i],!1),++i},function(){c(r(s[i]),a.correctness[i],!0),++i})}function c(t,r,o){var a=n[i];1===r&&""!==a||0===r||-1===r&&o?0===t.find(".cr-marker").length&&e.createCorrectWrongMarker().appendTo(t):t.find(".cr-marker").remove(),1===r?t.addClass("mas-correct").removeClass("mas-wrong"):-2===r?t.removeClass("mas-correct").removeClass("mas-wrong"):t.removeClass("mas-correct").addClass("mas-wrong")}},l.processInputSentence=function(e){var t=0,n=r(document.createElement("div")).addClass("mas-sentence");return o.processMarkSentence(e,function(e){n.append("\n"===e?"<br>":e)},function(e){return r(document.createElement("span")).attr("nr",++t).addClass("mas-word").text(e).appendTo(n)},function(e){return r(document.createElement("span")).attr("nr",++t).addClass("mas-word").text(e.word).appendTo(n)}),n},l.parseCategories=function(e,t){this.categorymap={},this.categorymap[""]=0,this.categories=[{name:a("CLEAR"),id:""}];var n=0;if(e)for(n=0;n<e.length;++n){var r=e[n].split("##"),i=r[0],s=r.length>1?r[1]:r[0];this.categories.push({name:i,id:s}),this.categorymap[s]=n+1}var c=this;o.processMarkSentence(t,function(){},function(){},function(e){c.categorymap.hasOwnProperty(e.type)||(c.categories.push({name:e.type,id:e.type}),c.categorymap[e.type]=++n)})},l.renderTypeSpecificPart=function(){this.parseCategories(this.data.categories,this.data.Sentence);for(var e=r(document.createElement("div")).addClass("mas-categories").appendTo(this.divs.answerdiv),t=0;t<this.categories.length;++t){var n=r(document.createElement("div")).addClass("mas-category-wrapper").attr("marker",t).appendTo(e);r(document.createElement("div")).addClass("mas-category").text(this.categories[t].name).appendTo(n)}this.processInputSentence(this.data.Sentence).appendTo(this.divs.answerdiv);var o=this;function a(t){e.find(".selected").removeClass("selected"),r(e.find(".mas-category-wrapper")[t]).addClass("selected"),o.question.attr("mas-selected",t)}function i(e,t){if(e>t){var n=e;e=t,t=n}o.divs.answerdiv.find(".mas-word").each(function(){var n=r(this),o=parseInt(n.attr("nr"));r(this).toggleClass("selected",o>=e&&o<=t)})}function s(){o.divs.answerdiv.find(".mas-word").removeClass("selected")}a(1),e.find(".mas-category-wrapper").tapOrClick(function(){a(r(this).attr("marker"))});var c=null;function l(){o.divs.answerdiv.find(".mas-word.selection-start").removeClass("selection-start"),c=null}function d(){s(),l(),r("body").off("mouseup",d)}this.divs.answerdiv.find(".mas-word").on("mousedown",function(){var e=r(this);c=parseInt(e.attr("nr")),e.addClass("selection-start"),i(c,c),r("body").on("mouseup",d)}).on("mouseenter",function(){if(null!==c){var e=r(this);i(c,parseInt(e.attr("nr")))}}).on("mouseleave",function(){null!==c&&s()}).on("mouseup",function(t){if(t.stopPropagation(),null!==c){var n=r(this);!function(e,t,n){if(e>t){var a=e;e=t,t=a}o.divs.answerdiv.find(".mas-word").each(function(){var o=r(this),a=parseInt(o.attr("nr"));a>=e&&a<=t&&r(this).attr("marker",n)}),o.check()}(c,parseInt(n.attr("nr")),parseInt(e.find(".mas-category-wrapper.selected").attr("marker"))),null!==o.changeCB&&o.changeCB(),s(),l()}}),this.check()},l.save=function(){var e=this.getCheckInput();return JSON.stringify({answers:e})},l.load=function(e){this.clear();var t=this.divs.answerdiv.find(".mas-word");try{var n=JSON.parse(e).answers;if(n.length===t.length)for(var o=0;o<n.length;++o)r(t[o]).attr("marker",this.categorymap[n[o]]||0);else console.error("Could not load mark sentence question data, wrong count")}catch(t){console.error("Could not load mark sentence question data",e)}this.check()},l.loadCorrect=function(e){var t=[];o.processMarkSentence(e.Sentence,function(){},function(){t.push("")},function(e){t.push(e.type)}),this.load(JSON.stringify({answers:t}))},l.clear=function(){this.divs.answerdiv.find(".mas-word").attr("marker",null),this.check()},l.getCorrectAnswerString=function(e){var t=r(document.createElement("div")).addClass("mas-sentence"),n=this;return n=this,o.processMarkSentence(e.Sentence,function(e){"\n"===e?t.append("<br>"):t.append(e)},function(e){t.append(e)},function(e){r(document.createElement("span")).addClass("mas-word").text(e.word).attr("marker",n.categorymap[e.type]).appendTo(t)}),t.append("<br><br>"),t.html()},l.prepareCorrection=function(t){this.questionconfig={Sentence:t.Sentence,categories:t.Categories,policy:t.policy,"all-words-editable":t["all-words-editable"],"scoring-weight":t["scoring-weight"]};var n="<div class='the-answer' >"+e.translate("The answer:")+"<br><br>"+this.getCorrectAnswerString(t)+"</div>";return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n}},l.getAnswer=function(e,t,n){var r=this.question.find(s.MH).html();t.sentenceAsString=this.data.Sentence;var a=this.getCheckInput(),i=o.check.MarkSentence(t,a);return{question:r,answer:a,check_input:a,correctness:i.correctness,score:i.score,outof:i.outof}},l}})},function(e,t,n){var r;e.exports=(r=n(470),function(e,t){return{DragWordsInSentence:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o,a,i;e.exports=(r=n(0),o=n(3),a=n(5),i=n(32),function(e){return function(t,n,s,c,l){var d=e.QuestionTypeBasic(t,n,s,c,l);return d.getCheckInput=function(){var e=[];return this.question.find(".dwis-box").each(function(){var t=r(this).find(".dwis-word");e.push(t.length>0?t.attr("save").trim():"")}),e},d.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),o=a.check.DragWordsInSentence(t,n),i=this.question.find(".dwis-box"),s=0;i.each(function(){var t=r(this),n=o.correctness[s++];0===n||-1===n?(e.clearTag(t,"dwis-correct"),e.setTag(t,"dwis-wrong")):1===n?(e.setTag(t,"dwis-correct"),e.clearTag(t,"dwis-wrong")):(e.clearTag(t,"dwis-correct"),e.clearTag(t,"dwis-wrong"))})}},d.createTextDiv=function(t){var n=r(document.createElement("div")).addClass("dwis-text");return a.processDragWordsInSentence(t,function(t,a,i){if(n.append(o.prepare(t)),a&&""!==a){var s=r(document.createElement("div")).addClass("dwis-box").appendTo(n);e.createCorrectWrongMarker().appendTo(s)}}),n},d.getWords=function(e){var t=[];return a.processDragWordsInSentence(e,function(e,n,r){n&&""!==n&&t.push(n)}),t},d.createWordsDiv=function(e,t){var n=this.getWords(e);if(t)for(var a=0;a<t.length;++a)n.push(t[a]);n=i.shuffleArray(n);var s=r(document.createElement("div")).addClass("dwis-words");for(a=0;a<n.length;++a)r(document.createElement("div")).safeHtml(o.prepare(n[a])).attr("save",n[a]).addClass("dwis-word").appendTo(s);return s},d.renderTypeSpecificPart=function(){this.divs.answerdiv.addClass("dwis-cover"),this.createWordsDiv(this.data.Sentence,this.data.distractors).appendTo(this.divs.answerdiv),this.createTextDiv(this.data.Sentence).appendTo(this.divs.answerdiv);var e=this,t=this.question.attr("id");this.divs.answerdiv.find(".dwis-words, .dwis-box").droppable({drop:function(t,n){var o=r(n.draggable),a=r(this);a.find(".dwis-word").appendTo(e.question.find(".dwis-words")),o.prependTo(a),e.check()},tolerance:"intersect",scope:t,hoverClass:"dwis-hover"});var n,o,a={},i={},l=c.getScrollObject()[0],d=c.getScrollObject()[0];this.divs.answerdiv.find(".dwis-word").draggable({scope:t,helper:"clone",appendTo:e.divs.answerdiv,start:function(e,t){r(this).addClass("drag_placeholder"),a={top:r(d).offset().top+50,bottom:r(d).offset().top+r(d).height()-50,left:r(l).offset().left+50,right:r(l).offset().left+r(l).width()-50,scrollTop:d.scrollTop},n=!1,o=!0},drag:function(e,t){var s=r(".ui-draggable-dragging");function c(){s.setTranslate(0,d.scrollTop-a.scrollTop)}i.up=a.top-e.clientY,i.down=e.clientY-a.bottom,i.left=a.left-e.clientX,i.right=e.clientX-a.right,(i.up>0||i.down>0||i.left>0||i.right>0)&&!n?(function e(t){i.down>0&&(d.scrollTop=d.scrollTop+(i.down>>1)),i.up>0&&(d.scrollTop=d.scrollTop-(i.up>>1)),i.left>0&&(l.scrollLeft=l.scrollLeft-(i.left>>1)),i.right>0&&(l.scrollLeft=l.scrollLeft+(i.right>>1)),(i.up>0||i.down>0||i.left>0||i.right>0)&&t()&&setTimeout(e.bind(null,t),100)}(function(){return c(),o}),n=!0):(c(),n=!1)},stop:function(e,t){n=!1,o=!1;var a=r(this);a.removeClass("drag_placeholder"),a.css("position","relative"),a.offset(r(t.helper).offset()),a.animate({top:0,left:0},function(){null!=s&&s()})}})},d.save=function(){var e=this.getCheckInput();return JSON.stringify({answers:e})},d.load=function(e){this.clear();try{var t=JSON.parse(e).answers,n=0,o=this.question.find(".dwis-box"),a=this.divs.answerdiv.find(".dwis-words .dwis-word");o.each(function(){var e=r(this);if(""!==t[n])for(var o=0;o<a.length;++o){var i=r(a[o]);if(i.attr("save").trim()===t[n].trim()){i.prependTo(e),a.splice(o,1);break}}++n})}catch(e){console.error("Could not load drag words in sentence data")}this.check()},d.loadCorrect=function(e){this.load(JSON.stringify({answers:this.getWords(e.Sentence)}))},d.clear=function(){this.divs.answerdiv.find(".dwis-box .dwis-word").appendTo(this.divs.answerdiv.find(".dwis-words")),this.check()},d.getCorrectAnswerString=function(e){var t=[];return a.processDragWordsInSentence(e.Sentence,function(e,n,r){t.push(o.prepare(e)),n&&""!==n&&t.push("<span class='dwis-inserted'>"+o.prepare(n)+"</span>")}),t.join("")},d.setReadOnly=function(e){this.divs.answerdiv.find(".dwis-word").draggable(e?"disable":"enable")},d.prepareCorrection=function(t){this.questionconfig={Sentence:t.Sentence,distractors:t.distractors,policy:t.policy,"scoring-weight":t["scoring-weight"]},this.check();var n="<div class='the-answer' >"+e.translate("The answer:")+"<br><br>"+this.getCorrectAnswerString(t)+"<br><br></div>";return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n}},d.getAnswer=function(e,t,n){var r=this.question.find(c.MH).safeHtml(),o=this.getCheckInput(),i=a.check.DragWordsInSentence(t,o);return{question:r,answer:o,check_input:o,correctness:i.correctness,score:i.score,outof:i.outof}},d}})},function(e,t,n){var r;e.exports=(r=n(472),function(e,t){return{Group:t.wrapTypeConstructor(r(t),e)}})},function(e,t,n){var r,o,a,i,s,c,l=n(22),d=l.map,u=l.each,p=l.filter,f=l.findIndex,h=n(122);e.exports=(r=n(0),o=n(5),a=n(32),i=n(39),s=n(4),c=n(3),function(e){return function(t,n,l,g,m){var v=e.QuestionTypeBasic(t,n,l,g,m);function w(e){return d(e.groups||[],function(e){return e.elements||[]})}function b(e){return[].concat.apply([],w(e))}function y(e){return d(b(e),function(e){return[e]})}function C(e){if("Word"===e.Type)return r(document.createElement("div")).html(c.prepare(e.word));if("Image"===e.Type)return i.create({img:e.image});if("Audio"===e.Type){var t=r(document.createElement("div")).addClass("bw-button audiobutton toolbutton").append(r(document.createElement("div")).addClass("bw-icon-large bw-icon-music-play-2")),n=s.addElement(e.audio,"body");return t.tapOrClick(n.toggle.bind(n))}return r()}return v.getCheckInput=function(){var t=this.divs.answerdiv;return d(t.find(".ge-box"),function(t){return d(r(t).find(".ge-element"),function(t){return JSON.parse(e.data(r(t),"element"))})})},v.check=function(){if(this.hasOwnProperty("questionconfig")){var t=this.questionconfig,n=this.getCheckInput(),a=o.check.Group(t,n),i=this.question.find(".ge-box"),s=0;i.each(function(){var t=r(this),n=a.answerCorrectness[s++];0===n||-1===n?(e.clearTag(t,"ge-correct"),e.setTag(t,"ge-wrong")):1===n?(e.setTag(t,"ge-correct"),e.clearTag(t,"ge-wrong")):(e.clearTag(t,"ge-correct"),e.clearTag(t,"ge-wrong"))})}},v.makeElementsDraggable=function(){var e,t,n=this,o=this.question.attr("id"),a={},i={},s=g.getScrollObject()[0],c=g.getScrollObject()[0],d=this.divs.answerdiv;d.find(".ge-element").draggable({scope:o,helper:"clone",appendTo:n.divs.answerdiv,delay:100,start:function(n,o){r(this).addClass("drag_placeholder"),a={top:r(c).offset().top+50,bottom:r(c).offset().top+r(c).height()-50,left:r(s).offset().left+50,right:r(s).offset().left+r(s).width()-50,scrollTop:c.scrollTop},e=!1,t=!0},drag:function(n,o){var l=r(".ui-draggable-dragging");function d(){l.setTranslate(0,c.scrollTop-a.scrollTop)}i.up=a.top-n.clientY,i.down=n.clientY-a.bottom,i.left=a.left-n.clientX,i.right=n.clientX-a.right,(i.up>0||i.down>0||i.left>0||i.right>0)&&!e?(function e(t){i.down>0&&(c.scrollTop=c.scrollTop+(i.down>>1)),i.up>0&&(c.scrollTop=c.scrollTop-(i.up>>1)),i.left>0&&(s.scrollLeft=s.scrollLeft-(i.left>>1)),i.right>0&&(s.scrollLeft=s.scrollLeft+(i.right>>1)),(i.up>0||i.down>0||i.left>0||i.right>0)&&t()&&setTimeout(e.bind(null,t),100)}(function(){return d(),t}),e=!0):(d(),e=!1)},stop:function(o,a){var i=r(a.helper.context);i.parent().find(".ge-element").length>1&&!a.helper.data("dropped")&&(n.makeBox().append(i).appendTo(d),n.check());var s=r(this);e=!1,t=!1,s.removeClass("drag_placeholder"),s.css("position","relative"),s.offset(r(a.helper).offset()),s.animate({top:0,left:0},function(){null!=l&&l()})}})},v.makeBox=function(){var t=this,n=this.question.attr("id");return r(document.createElement("div")).addClass("ge-box").append(e.createCorrectWrongMarker()).droppable({drop:function(e,n){n.helper.data("dropped",!0);var o=r(n.draggable),a=o.parent(),i=r(this);o.appendTo(i),0===a.find(".ge-element").length&&a.remove(),t.check()},tolerance:"intersect",scope:n,hoverClass:"ge-hover"})},v.setGroups=function(t){var n=this,r=this.divs.answerdiv;r.empty(),u(t,function(t){var a=n.makeBox().appendTo(r);u(t,function(t){var n=C(t).addClass("ge-element").appendTo(a);return e.data(n,"element",JSON.stringify(o.cleanGroupElemPaths(t))),n})}),this.makeElementsDraggable(r),c.processMathElems(r)},v.renderTypeSpecificPart=function(){this.setGroups(a.shuffleArray(y(this.data)))},v.save=function(){var e=this.getCheckInput();return JSON.stringify({answers:e})},v.sanitizeAndMapToConfigurationElements=function(e){var t=d(b(this.data),function(e){return{elem:e,key:h(o.cleanGroupElemPaths(e))}}),n=p(d(e,function(e){return p(d(e,function(e){var n=f(t,{key:h(o.cleanGroupElemPaths(e))});return-1===n?null:t.splice(n,1)[0].elem}),function(e){return null!=e})}),function(e){return e.length>0});return u(t,function(e){n.push([e.elem])}),n},v.load=function(e){this.clear();try{var t=JSON.parse(e).answers;this.setGroups(this.sanitizeAndMapToConfigurationElements(t))}catch(e){console.error("Could not load groups",e)}this.check()},v.loadCorrect=function(e){this.setGroups(w(e))},v.clear=function(){this.setGroups(a.shuffleArray(y(this.data)))},v.setReadOnly=function(e){this.divs.answerdiv.find(".ge-element").draggable(e?"disable":"enable")},v.prepareCorrection=function(t){this.questionconfig={groups:t.groups||[],policy:t.policy,"scoring-weight":t["scoring-weight"]},this.check();var n=r(document.createElement("div")).addClass("the-answer").text(e.translate("The answer:")).append(document.createElement("br")).append(document.createElement("br")).append(function(e){var t=r(document.createElement("div"));return u(w(e),function(e){var n=r(document.createElement("div")).addClass("ge-box").appendTo(t);u(e,function(e){C(e).addClass("ge-element").appendTo(n)})}),t}(t)).append(document.createElement("br")).append(document.createElement("br"));return e.createRationale(t,this.divs.rationalediv,n),{extrarationale:n.html()}},v.getAnswer=function(e,t,n){var r=this.question.find(g.MH).html(),a=this.getCheckInput(),i=o.check.Group(t,a);return{question:r,answer:a,check_input:a,correctness:i.correctness,score:i.score,outof:i.outof}},v}})},function(e,t,n){e.exports=function(e){"use strict";return function(t,n){return{AudioRecording:n.wrapTypeConstructor(e(n),t,!0)}}}(n(474))},function(e,t,n){e.exports=function(e,t,n,r){"use strict";return function(o){return function(a,i,s,c){var l=o.QuestionTypeBasic(a,i,s,c);return l.check=function(){},l.renderTypeSpecificPart=function(){var e=this;this.divs.answerdiv.addClass("audiorecorder"),this.recorder=t(this.divs.answerdiv,function(t){e.recorded=t.uri,e.mimetype=t.mimetype,s&&s()})},l.save=function(){return this.recorded?{url:this.recorded,mimetype:this.mimetype}:null},l.load=function(e){try{this.recorder.setDataURIToLoad(e.url,e.mimetype),this.recorded=e.url,this.mimetype=e.mimetype}catch(t){return console.error("Could not load audiorecording question data",e),void console.error(t)}},l.preprocessSaveData=function(t,o){var a=this,i=e.Deferred(),s=this.question.attr("savedresource");return s&&""!==s&&(t.clearImage(s),this.question.attr("savedresource",null)),t.registerImage(o.url).done(function(e){a.question.attr("savedresource",e);var t={url:e,mimetype:o.mimetype};i.resolve(JSON.stringify(t))}).fail(function(){r.showAlert(n("Could not store picture"),n("Error using picture"))}),i},l.preprocessLoadData=function(t,n){var r=this,o=JSON.parse(n),a=e.Deferred(),i=o.url,s=o.mimetype;return t.getImageUrl(o.url).then(function(e){r.question.attr("savedresource",i),a.resolve(r.question[0],{url:e,mimetype:s})},function(){console.log("Could not get image url for",o),a.reject()}),a},l.freeResources=function(t){var n=e.Deferred(),r=this.question.attr("savedresource");return r&&""!==r?(t.clearImage(r).then(function(){n.resolve()},function(){n.reject()}),this.question.attr("savedresource",null)):n.resolve(),n},l.loadCorrect=function(){this.recorder.clear(),this.recorded=null,this.mimetype=""},l.clear=function(){this.recorder.clear(),this.recorded=null,this.mimetype=""},l.setReadOnly=function(e){this.recorder.setReadOnly(e)},l.fetchAsset=function(){this.url=null;var e=this.recorded,t=this.mimetype;return e?{data:e,mimetype:t}:void 0},l.assetUploadCompleteCB=function(e){this.url=e},l.getAnswer=function(e){var t=this.question.find(c.MH).html(),n=parseFloat(this.data["scoring-weight"]);return{question:t,answer:this.url||"",correctness:this.recorded?-2:-1,score:0,outof:n}},l}}}(n(0),n(475),n(7),n(9))},function(e,t,n){n(476);var r=n(477),o=n(112),a=n(478),i="<circle cx='25' cy='25' r='15' />",s="<line x1='13' y1='13' x2='37' y2='37' /><line x1='13' y1='37' x2='37' y2='13' />",c="<polygon points='10,10 40,25 10,40'/>",l="<rect x='13' y='13' width='24' height='24'/>",d="<rect x='10' y='10' width='11' height='30'/><rect x='29' y='10' width='11' height='30'/>";function u(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" version="1.1">'+e+"</svg>"}e.exports=function(e,t,n,p,f,h,g,m,v){"use strict";var w,b,y=null;return"ibw-platform-ipad-bookwidgets"===n.getPlatform()&&n.supportsAppFeature("audiorecording")?w=!0:(console.log("Using native recording"),w=!1),function(n,C){console.log("Initialising bwAudioRecorder "),w&&null==b&&(console.log("Using audio bridge"),b=p(),console.log("creating bridge"));var k=v(document.createElement("div")).addClass("bw-audio-recorder").attr("state","stopped").appendTo(n),T=v(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-record").append(u(i)).makeButton(t("record")).appendTo(k),x=v(document.createElement("div")).addClass("bw-audio-record-not-supported").append(u(s)).appendTo(T),_=v(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-play").append(u(c)).makeButton(t("play")).appendTo(k),S=v(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-pause").append(u(d)).makeButton(t("pause")).appendTo(k),E=v(document.createElement("div")).addClass("bw-audio-recorder-button bw-audio-stop").append(u(l)).makeButton(t("stop")).appendTo(k),I=v(document.createElement("div")).addClass("bw-audio-recorder-time bw-audio-recorder-playtime").safeHtml("__:__").appendTo(k);v(document.createElement("span")).text(" / ").addClass("bw-audio-recorder-time  bw-audio-recorder-slash").appendTo(k);var O=v(document.createElement("div")).addClass("bw-audio-recorder-time bw-audio-recorder-recordedtime").safeHtml("__:__").appendTo(k);v(document.createElement("div")).addClass("bw-encoding-msg").appendTo(k),x.tapOrClick(function(){var n=t("This environment does not support audio recording. To record use a browser with audio recording support (e.g. Chrome, Firefox)."),r=k.attr("errormsg");r&&(n=t("Could not start audio recording. ")+r),e.showAlert(n,t("Recording not supported"))}),console.log("Creating player");var A=w?g(b.execute.bind(b)):h({parent:n});function q(e,t){A.setAudioData(e,t),e&&k.addClass("play-initialized")}var P=0,D=null,N=null,R="";function L(){var e=P%60,t=parseInt(P/60);(e+="").length<2&&(e="0"+e),(t+="").length<2&&(t="0"+t),O.safeHtml(t+":"+e)}function M(){++P,L()}function B(){D=setInterval(M,1e3)}function W(){clearInterval(D),D=null}var F=0,U=null,z=null;function H(){var e=F%60,t=parseInt(F/60);(e+="").length<2&&(e="0"+e),(t+="").length<2&&(t="0"+t),I.safeHtml(t+":"+e)}function j(){++F,H()}function Q(){U||(U=setInterval(j,1e3))}function J(){clearInterval(U),U=null}T.tapOrClick(function(){var e=k.attr("state");"inactive"!==e&&(k.addClass("active"),"stopped"===e?(null===z&&(z=o("body")),y.start()):"recording_paused"===e&&y.resume())}),S.tapOrClick(function(){var e=k.attr("state");"inactive"!==e&&("recording"===e?y.pause():"playing"===e&&A.pause())}),_.click(function(){var e=k.attr("state");"inactive"!==e&&("stopped"===e&&k.hasClass("play-initialized")?(F=0,H(),A.play()):"playing_paused"===e&&A.resume())}),E.tapOrClick(function(){var e=k.attr("state");"inactive"!==e&&("recording"===e||"recording_paused"===e?y.stop():"playing"!==e&&"playing_paused"!==e||(A.stop(),k.attr("state","stopped"),k.removeClass("active"),J(),F=0,H()))});try{if(!y){var V={monitorGain:0,numberOfChannels:1,bitRate:16e3,encoderSampleRate:48e3,workerDir:m.getRoot()+"/external/web-audio-recorder/WebAudioRecorderMp3.min.js"};w?(console.log("Using bridge recorder"),y=new r(V,b.execute.bind(b))):(console.log("Using normal recorder"),y=f(V))}N&&q(N,R),y.addEventListener("start",function(e){k.hasClass("active")?(P=0,L(),k.attr("state","recording"),a.start("recording"),B(),null!=z&&(z.close(),z=null)):k.attr("state","inactive")}),y.addEventListener("stop",function(e){if(k.hasClass("active")){var t=e.detail;null!=t&&k.find(".bw-encoding-msg").text(t.msg),k.attr("state","encoding"),a.stop("recording"),a.start("encoding"),W()}}),y.addEventListener("pause",function(e){k.hasClass("active")&&(k.attr("state","recording_paused"),W())}),y.addEventListener("resume",function(e){k.hasClass("active")&&(k.attr("state","recording"),B())}),y.addEventListener("streamError",function(e){console.error("Error encountered: "),console.error(e),k.addClass("recording-not-supported"),e&&e.error&&(e.error.message||e.error.name)&&k.attr("errormsg",e.error.message||e.error.name),a.stopAll(),null!=z&&(z.close(),z=null)}),y.addEventListener("dataAvailable",function(e){if("inactive"!==k.attr("state")){console.log("dataAvailable event handler");var t=e.detail;if(a.stop("encoding"),k.attr("state","stopped"),t.hasOwnProperty("blob")){q((window.URL||window.webkitURL).createObjectURL(t.blob),t.mimetype);var n=new FileReader;n.onload=function(){C({uri:n.result,mimetype:t.mimetype})},n.onerror=function(){console.log("An error occured while reading datablob")},C&&n.readAsDataURL(t.blob)}else t.hasOwnProperty("uri")&&(q(t.uri,t.mimetype),C({uri:t.uri,mimetype:t.mimetype}));k.removeClass("active"),setTimeout(function(){y.initStream()})}}),y.addEventListener("streamReady",function(e){console.log("streamReady received"),k.addClass("recorder-initialized"),"inactive"===k.attr("state")&&k.attr("state","stopped")}),y.initStream()}catch(e){console.error("Got error initializing recorder... recording not supported"),console.error(e),k.addClass("recording-not-supported")}return A.addEventListener("play",function(e){k.attr("state","playing"),Q()}),A.addEventListener("durationchange",function(e){"stopped"===k.attr("state")&&(P=A.getDuration(),L())}),A.addEventListener("ended",function(e){k.attr("state","stopped"),J(),F=0,H(),k.removeClass("active")}),A.addEventListener("pause",function(e){k.attr("state","playing_paused"),J()}),A.addEventListener("playing",function(e){k.attr("state","playing"),Q()}),{setDataURIToLoad:function(e,t){console.log("setDataURIToLoad"),e&&(R=t,q(N=e,t))},clear:function(){k.removeClass("play-initialized"),"recording"===k.attr("state")&&y.stop(),A.clear(),O.safeHtml("__:__"),I.safeHtml("__:__")},setReadOnly:function(e){k.toggleClass("readonly")}}}}(n(9),n(7),n(2),n(479),n(480),n(482),n(483),n(40),n(0))},function(e,t,n){},function(e,t,n){(function(n){var r;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(n){"use strict";var o=function(e,t){this.state="inactive",this.eventTarget=n.document.createDocumentFragment(),this.sendBridgeCommand=t,this.config=e=e||{},this.config.command="init"};o.prototype.addEventListener=function(e,t,n){this.eventTarget.addEventListener(e,t,n)},o.prototype.initStream=function(){var e=this;this.sendBridgeCommand("init",function(){e.state="initialized",e.eventTarget.dispatchEvent(new n.Event("streamReady"))},function(t){e.eventTarget.dispatchEvent(new n.ErrorEvent("streamError",{error:t}))})},o.prototype.pause=function(){var e=this;"recording"===this.state&&(this.state="paused",this.sendBridgeCommand("pause",function(){e.eventTarget.dispatchEvent(new n.Event("pause"))}))},o.prototype.removeEventListener=function(e,t,n){this.eventTarget.removeEventListener(e,t,n)},o.prototype.resume=function(){var e=this;"paused"===this.state&&(this.state="recording",this.sendBridgeCommand("resume",function(){e.eventTarget.dispatchEvent(new n.Event("pause"))}))},o.prototype.start=function(){if("initialized"===this.state){var e=this;this.state="recording",this.sendBridgeCommand("start",function(){e.eventTarget.dispatchEvent(new n.Event("start"))},function(t){e.eventTarget.dispatchEvent(new n.Event("streamError"),{error:t})})}},o.prototype.stop=function(){if("inactive"!==this.state&&"encoding"!==this.state){var e=this;this.state="encoding",this.sendBridgeCommand("stop",function(t){e.eventTarget.dispatchEvent(new n.Event("stop"));var r=function(e){for(var t=atob(e),n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new Blob([n],{type:"audio/mp4"})}(getRecordedAudio()),o=new FileReader;o.onload=function(){e.state="inactive",e.eventTarget.dispatchEvent(new n.CustomEvent("dataAvailable",{detail:{uri:o.result,mimetype:"audio/mp4"}}))},o.onerror=function(t){console.log("An error occured while reading datablob"),e.state="inactive",e.eventTarget.dispatchEvent(new n.ErrorEvent("streamError",{error:t}))},o.readAsDataURL(r)})}},n.BridgeRecorder=o,void 0===(r=function(){return o}.apply(t,[]))||(e.exports=r)}("object"===("undefined"==typeof self?"undefined":o(self))&&self.self===self&&self||"object"===(void 0===n?"undefined":o(n))&&n.global===n&&n||this)}).call(this,n(64))},function(e,t,n){"use strict";n.r(t),n.d(t,"start",function(){return o}),n.d(t,"stop",function(){return a}),n.d(t,"stopAll",function(){return i});var r=n(0);function o(e){console.log("start ",e),r("html").addClass("processing-in-progress")}function a(e){console.log("stop ",e),r("html").removeClass("processing-in-progress")}function i(){console.log("stopall"),r("html").removeClass("processing-in-progress")}},function(e,t,n){var r=n(111);e.exports=function(e){"use strict";var t=new(n(76));t.startListening();return function(e){e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t)};var n={resultForCallback:function(e,n){t.processCallback(e,n)},runningInIframe:function(){try{return window.self!==window.top}catch(e){return!0}},callObjC:function(o,a,i,s){var c=r.url(o,a),l=t.registerCallbacks(i,s),d="'"+l.ok+"'",u="'"+l.error+"'",p="AudioBridge.resultForCallback";n.runningInIframe()&&(p="function AudioBridge_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; AudioBridge_callback_wrapper"),e(c+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+p)},execute:function(e,t,r){n.callObjC("audioRecording",{command:e},t,r)},initialize:function(){console.log("Initializing AudioBridge"),this.execute("initBridge",function(){console.log("AudioBridge initialized")},function(){console.log("AudioBridge initialization failed")})}};return n.initialize(),window.AudioBridge=n,n}}()},function(e,t,n){n(481);var r=window.AudioContext||window.webkitAudioContext;e.exports=function(e){return{callbacks:{start:[],stop:[],pause:[],resume:[],streamReady:[],streamError:[],dataAvailable:[],progress:[]},start:function(){var t=this,n=navigator.mediaDevices.getUserMedia({audio:!0,video:!1});if(null==n)return console.error("Usermedia did not return promise"),void this.executeCallbacks("streamError","ERROR");n.then(function(n){t.audioContext=new r,t.audioContext?(t.gumStream=n,t.input=t.audioContext.createMediaStreamSource(t.gumStream),t.recorder=new WebAudioRecorder(t.input,{workerDir:e.workerDir,encoding:"mp3",numChannels:2,onEncoderLoading:function(e,t){console.log("Loading "+t+" encoder...")},onEncoderLoaded:function(e,t){console.log(t+" encoder loaded")}}),t.recorder.onComplete=function(e,n){t.executeCallbacks("dataAvailable",{detail:{blob:n,mimetype:"audio/mpeg"}}),t.state="done",t.audioContext.close&&t.audioContext.close()},t.callbacks.progress.length>0&&(t.recorder.onEncodingProgress=function(e,t){console.log("Progress: ",t),this.executeCallbacks("progress",t)}),t.recorder.setOptions({timeLimit:1200,encodeAfterRecord:!0,mp3:{bitRate:160}}),t.recorder.startRecording(),t.executeCallbacks("start")):t.executeCallbacks("streamError","ERROR")}).catch(function(e){console.error("Could not get input for recording"),console.error(e),t.executeCallbacks("streamError",e)})},resume:function(){this.recorder.resume(),this.executeCallbacks("resume")},pause:function(){this.recorder.pause(),this.executeCallbacks("pause")},stop:function(){this.gumStream.getAudioTracks()[0].stop(),this.recorder&&(this.recorder.pause(),this.recorder.finishRecording()),this.executeCallbacks("stop",{detail:{msg:"Encoding using LAME"}})},initStream:function(){var e=this;"initialized"!==this.state&&(this.state="initialized",null!=r&&null!=navigator.mediaDevices?setTimeout(function(){e.executeCallbacks("streamReady")}):setTimeout(function(){e.executeCallbacks("streamError","ERROR")}))},addEventListener:function(e,t){this.callbacks[e].push(t)},executeCallbacks:function(){for(var e=arguments[0],t=[],n=1;n<arguments.length;++n)t.push(arguments[n]);for(var r=0;r<this.callbacks[e].length;++r)this.callbacks[e][r].apply(null,t)}}}},,function(e,t,n){var r=n(0);e.exports=function(e){var t=r(document.createElement("audio")).addClass("bw-audio-recorder-player no-audio-wrap").attr("controls","false").appendTo(e.parent);return{player:t,setAudioData:function(e,n){e&&t.attr({url:e,type:n,src:null})},pause:function(){t[0].pause()},resume:function(){t[0].play()},play:function(){t.attr("src",t.attr("url")),t[0].play()},stop:function(){t.attr("src",null)},getDuration:function(){return parseInt(t[0].duration)},clear:function(){t.attr({url:"",src:"",type:""})},addEventListener:function(e,n){t[0].addEventListener(e,n)}}}},function(e,t,n){var r=0,o=n(0);e.exports=function(e){var t={play:[],durationchange:[],ended:[],pause:[],playing:[]},n=null,a=0,i=null;function s(){for(var e=arguments[0],n=[],r=1;r<arguments.length;++r)n.push(arguments[r]);for(var o=0;o<t[e].length;++o)t[e][o].apply(null,n)}function c(t,r){var a,i,c=o.Deferred();return a=function(e){null!=r&&s(r),c.resolve(e)},i=function(){console.error("Error player command ",t,n),c.reject()},e("player/"+[t,n].join("/"),a,i),c}function l(){i=null,c("playing",null).then(function(e){"true"!==e.playing?s("ended"):i=setTimeout(l,1e3)})}function d(){i=setTimeout(l,1e3)}function u(){i&&(clearTimeout(i),i=0)}return n=++r+"",{setAudioData:function(e,t){null!=n&&setPlayerData(n,e)},pause:function(){c("pause","pause").then(u)},resume:function(){c("resume","playing").then(d)},play:function(){c("play","play").then(function(e){d(),a=parseInt(e.duration),s("durationChanged")})},stop:function(){c("stop","ended").then(u)},clear:function(){a=0,u(),c("clear")},getDuration:function(){return a},addEventListener:function(e,n){t[e].push(n)}}}},function(e,t,n){var r,o,a,i,s,c,l,d,u,p,f,h,g,m,v,w,b,y,C,k=n(485).mergeSecureConfig;e.exports=(r=n(1),n(176),o=n(18).o,a=n(486),i=n(3),s=n(488),c=n(40),n(489),l=n(0),d=n(9),u=n(7),p=n(75),f=n(11),h=n(77),g=n(83),m=n(56),v=n(4),w=n(490),b=n(491),y=n(492),C=n(2),function(e,t,n){var T=r.getConfigSync();l(function(){function x(){for(var e in t.questionIf)t.questionIf[e].repaint&&t.questionIf[e].repaint()}function _(){x(),l("#textcontainer").trigger("redraw")}function S(e){return Math.round(100*e)/100}function E(){"yes"==T.submit_answers?(l("#sendbutton").show(),l("#checkbutton").remove()):"yes"==T.show_answers?(l("#checkbutton").show(),l("#sendbutton").remove()):"Score only"==T.show_score||"Score vs maximum"==T.show_score?(t.localize("#submit-button","Submit"),l("#checkbutton").show(),l("#sendbutton").remove()):(l("#checkbutton").remove(),l("#sendbutton").remove())}function I(){return"yes"==T.submit_answers&&"yes"==T.examination_mode}l(".quizwidget").on("resized",function(){c.centerTitle(!0),function(){for(var e in t.questionIf)t.questionIf[e].onResize&&t.questionIf[e].onResize()}(),x()}),t.addImageLoadedCallback(x),t.localize("#refresh-button","Clear answers and start over"),t.localize("#wrongpwd","Wrong password..."),t.localize("#start_code_label","Password"),t.localize("#startcode-dialog .ui-btn-text","OK"),E(),"yes"===T.color_correct_answers&&l("#question-content").addClass("color-correct-answers"),"Scientific"===T.provide_calculator&&l("#calcbutton").show();var O=!1;function A(){s.reset(),s.start(),o.write({"start_time.number":s.getStartTime()})}function q(e){l("body").removeClass("pwd-mode"),l("#startcode-dialog").dialog("close"),l("#startcode-dialog").hide(),_(),!1===t.checkMode&&I()&&s.isInitialized()&&(null!=s.getStartTime()?s.start():A()),O=!1}function P(e){if(""==T.startup_password)l("#startcode-dialog").hide();else{if(O=!0,l("body").addClass("pwd-mode"),l("#startcode-dialog").dialog({dialogClass:"bw-dialog no-close start-code-dlg",width:350,title:t.translate("Please enter password"),buttons:[{text:t.translate("OK"),click:function(){l("#startcode-dialog #start_code").val()==T.startup_password?(o.write({"startup_password_entered.text":T.startup_password}),q(l(this))):l("#wrongpwd").show("fast").delay(1e3).hide("fast")}}]}),"Always"==T.require_password)return;console.log("Reading startup pwd");var n="startup_password_entered.text";e.hasOwnProperty(n)&&e[n]==T.startup_password&&(console.log("Startup password value OK"),q(l(this)))}}var D=null,N=null;function R(){return null!=D||T.hasOwnProperty("sec")}function L(){if(null!=N)return N;var e=T.questions,t=null!=D?D:null!=T.sec?T.sec:null;if(t)try{var n=JSON.parse(t);n.hasOwnProperty("questions")&&(e=k(T.questions,n.questions))}catch(e){console.log("Could not parse sec piece"),console.log(e)}return N=e,e}function M(){R()||console.log("Can't set question scores, no correction info available");var e=L(),t=0;l("#question-content .content").each(function(){var r=l(this);if("true"!==r.attr("noquestion")){var o=r.attr("question-type"),a=parseInt(r.attr("cindex")),i=e[a];try{var s=n.questionTypes[o].getAnswer(this,!0,i),c=function(e){if(e.correctness.constructor===Array){for(var t=0;t<e.correctness.length;++t)if(-2===e.correctness[t])return!0;return!1}return-2===e.correctness}(s)?"_":s.score;r.find(".scored-points").text(S(c)),t+=parseFloat(s.score)||0}catch(e){console.error("Could not get answer for question: ",a),console.error(e)}}}),l(".submitpage .question-points .scored-points").text(S(t))}function B(e){var r=L(),o=e.attr("question-type"),a=parseInt(e.attr("cindex")),i=r[a];try{var s=n.questionTypes[o].getAnswer(e,!0,i);return t.getStateFromAnswer(s)}catch(e){return console.error("Could not get answer for question: ",a),console.error(e),{answered:!1,correct:!1,wrong:!1,manual:!1,allunanswered:!1,score:0,outof:0}}}e.setGetQuestionState&&e.setGetQuestionState(B);var W=new function(){var e=w(),n={},r=!1;this.clear=function(){n={},e.restart()},this.init=function(){l("#question-content .content").each(function(){var e=l(this);"true"!==e.attr("noquestion")&&(n[e.attr("cindex")]={state:null,logger:null})})},this.setLoadedAnswersState=function(){var e=this;l("#question-content .content").each(function(){"true"!==l(this).attr("noquestion")&&e.questionChanged(this,!0)}),this.setProgress(!1)},this.disable=function(){r=!1},this.enable=function(){r=!0},this.questionChanged=function(t,o){if(r){var a=l(t),i=a.attr("cindex"),s=B(a);n[i].state=s,s.answered&&!s.manual&&(null===n[i].logger?(n[i].logger=e.registerBinary(i,i,"passFail",s.correct),o||this.setProgress(!1)):(n[i].logger.update(s.correct),o||this.setProgress(!1)))}},this.setFinalQuestionState=function(t){var r=l(t),o=r.attr("cindex");if(null===n[o].state||!n[o].state.answered){n[o].logger=e.registerBinary(o,o,"passFail",!1);var a=B(r);n[o].state=a}};var o=null,a=null,i=null;this.setProgress=function(t){var r=0,o=0;for(var a in n)n.hasOwnProperty(a)&&(++r,n[a].state&&n[a].state.answered&&++o);e.setProgress(t?r:o,r)},this.setScore=function(){var r=0,s=0,c=0,l=0,d=0;for(var p in n)n.hasOwnProperty(p)?(r+=n[p].state.score,s+=n[p].state.outof,n[p].state.correct&&++c,n[p].state.wrong&&++l,n[p].state.allunanswered&&++d):++d;e.registerScore("score",t.translate("Score"),s,r,!0),a?a.update(c):a=e.registerQuantity("correctcount",u("Correct answers"),c),o?o.update(l):o=e.registerQuantity("wrongcount",u("Wrong answers"),l),i?i.update(d):i=e.registerQuantity("unansweredcount",u("Unanswered"),d)},this.setDone=function(e){var t=this;l("#question-content .content").each(function(){"true"!==l(this).attr("noquestion")&&t.setFinalQuestionState(this)}),this.setProgress(!0),e&&this.setScore()}};function F(){for(var e in console.log("switchToEditMode"),t.checkMode=!1,o.write({"mode.quizmode":"entry"}),l("#question-content").removeClass("readonly-mode check-mode").addClass("entry-mode"),t.hideRationales(l("#question-content")),t.questionIf)t.questionIf[e].setReadOnly&&t.questionIf[e].setReadOnly(!1);l("#editbutton").unbind("click").hide(),E(),l("#question-content .content").each(function(){var e=l(this);"true"!==e.attr("noquestion")&&e.find(".scored-points").safeHtml("&nbsp;&nbsp;")}),c.centerTitle(!0)}function U(){if(R())for(var t=L(),r=0;r<e.questionCount();++r){var o=l("#question-content .content[cindex='"+r+"']");if(0!==o.length){var a=o.attr("question-type");if(n.questionTypes[a].prepareCorrection)try{n.questionTypes[a].prepareCorrection(o,t[parseInt(o.attr("cindex"))])}catch(e){console.error("Could not prepare correction for question: ",r),console.error(e)}}else console.error("Could not find question")}else console.log("Can't show correction, no correction info available")}function z(){var e=L(),t=0,r=0;return l("#question-content .content").each(function(){var o=l(this);if("true"!==o.attr("noquestion")){var a=o.attr("question-type"),i=parseInt(o.attr("cindex")),s=e[i];try{var c=n.questionTypes[a].getAnswer(this,!0,s);t+=parseFloat(c.score)||0,r+=parseFloat(c.outof)||0}catch(e){console.error("Could not get answer for question: ",i),console.error(e)}}}),{score:t,max:r}}function H(){return"Score only"===T.show_score||"Score vs maximum"===T.show_score}function j(){return T.feedback&&T.feedback.length>0}function Q(e){if(!j())return null;try{T.feedback.sort(function(e,t){return parseFloat(e.percentage)-parseFloat(t.percentage)});for(var t=100*parseFloat(e.score)/e.max,n=0;n<T.feedback.length;++n)if(t<=parseFloat(T.feedback[n].percentage))return T.feedback[n].text}catch(e){console.error("Problem processing feedback"),console.error(e)}return console.log("no feedback msg",e),null}function J(e){g.processRichTextWidgetPlayLinks(e,!1),e.find(".rtlink").each(function(){l(this).css("position","relative"),h(this,l(this).attr("href").replace(/&amp;/g,"&"))}),m.resolveYoutubePlaceholders(e),v.processAudioTags(e)}function V(){var e=function(){var e=z(),n="",r="";H()&&(r=t.translate("Score"),n='<span class="scoretext">'+t.translate("Your score is")+"</span><br><br>",n+='<span class="score">',n+=S(e.score),"Score vs maximum"===T.show_score&&(n+=" / "+S(e.max)),n+="</span><br>");var o=Q(e);return null!=o&&(r=t.translate("Feedback"),n+="<br><div>"+o+"</div>"),{title:r,message:n}}();J(d.showAlert(e.message,e.title))}function Y(){(H()||j())&&(""!==T.show_password?V():e.moveToSubmitSection&&e.moveToSubmitSection())}function $(){return"yes"===T.color_correct_answers||!(!T.hasOwnProperty("sec")||"ibw-platform-ipad-bookwidgets"!==C.getPlatform())}function K(n){for(var r in l("#question-content").removeClass("entry-mode").addClass("readonly-mode"),t.questionIf)t.questionIf[r].setReadOnly&&t.questionIf[r].setReadOnly(!0);if(t.checkMode=!0,(!0===n||"yes"===T.show_answers||H()||j())&&(!$()&&!0===n||"yes"===T.show_answers)&&U(),!0===n||"yes"===T.show_answers){for(var r in l("#question-content").addClass("check-mode"),t.questionIf)if(t.questionIf[r].check)try{t.questionIf[r].check()}catch(e){console.error("Error checking answer for question: ",r),console.error(e)}t.syncDomWithTags(l("#question-content")),t.showRationales(l("#question-content"))}H()&&M(),(H()||j())&&function(){var e=l(".post-submit").find(".feedback").empty();l(document.createElement("div")).addClass("textdescriptiontitle").text(j()?t.translate("Feedback"):t.translate("Score")).appendTo(e);var n=z();if(H()){var r="Score vs maximum"===T.show_score?S(n.score)+" / "+S(n.max):S(n.score);l(document.createElement("p")).safeHtml(t.translate("Your score is")+": "+r).appendTo(e)}var o=Q(n);if(null!=o){var a=l(document.createElement("p")).safeHtml(o).appendTo(e);console.log(t),t.isQuiz()&&v.replaceAudioByPlaceholder(a),J(a)}}(),e.moveToStart&&e.moveToStart(),"yes"===T.allow_edit_after_check_or_send?l("#editbutton").makeButton(u("Switch to edit mode")).click(F).show():l("#editbutton").remove()}function G(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];I()&&s.stop(),e&&o.write({"saved.bool":"true","mode.quizmode":"check"}),"yes"===T.submit_answers&&""!==T.show_password?(l("body").addClass("pwd-mode"),l("#startcode-dialog #start_code").val(""),l("#startcode-dialog").dialog({dialogClass:"bw-dialog no-close view-results-dlg",width:350,title:t.translate("Please enter password"),buttons:[{text:t.translate("OK"),click:function(){l("#startcode-dialog #start_code").val()===T.show_password?(l("body").removeClass("pwd-mode"),l(this).dialog("close"),_(),K(!1)):l("#wrongpwd").show("fast").delay(1e3).hide("fast")}}]})):K(!1)}function X(){l("#sendbutton, #checkbutton").hide(),c.centerTitle(!0)}function Z(r){for(var o=L(),a=[],i=0,s=0;s<e.questionCount();++s){var c=l("#question-content .content[cindex='"+s+"']");if(0!=c.length){var d="true"!==c.attr("noquestion")||"yes"===T.info_numbering;d&&++i;var u=c.attr("question-type"),p=o[parseInt(c.attr("cindex"))],f=n.questionTypes[u].getAnswer(c,!0,p,r);if(f){f.config=p;var h=t.getNumbering(f.config,i);f.config.number=d?h+"":"";var g=d?h+". ":"";f.hasOwnProperty("report-question")?(f.question=g+f["report-question"],delete f["report-question"]):f.question=g+(f.config.hasOwnProperty("Question")?f.config.Question:f.config.Title),a.push(f)}}else console.log("Could not find question")}return a}function ee(e){var t=a.createStudentWorkSubmitter(T.id,T.book_title,T.uuid2,T.WA);return t.setCompanyInfo(T.company_name,T.company_address,T.company_phone,T.company_website),l("#question-content .content").each(function(){if("true"!==l(this).attr("noquestion")){var e=l(this).attr("question-type");n.questionTypes[e].fetchAsset&&n.questionTypes[e].assetUploadCompleteCB&&t.scheduleAssetUpload(n.questionTypes[e].fetchAsset,n.questionTypes[e].assetUploadCompleteCB,this)}}),t.setAnswersComposer(function(){return Z(e)}),t.on(t.EVT_AFTER_SEND,function(){void 0!==window.checkScrollPosition&&window.checkScrollPosition()}),t}function te(e){"yes"===T.submit_answers&&"yes"===T.submit_only_once&&"true"===e["submitted.bool"]&&(l("#clearbutton").remove(),l("#sendbutton").remove(),l("#big-submit-button").remove())}function ne(e,n){var a=function(){var e=ee("yes"===T.email_should_have_grading),t=f.getParameters().submit_url;return e.setEndpoint(t||T.action),e.setIncludeGrading("yes"===T.email_should_have_grading),e.on(e.EVT_SUBMIT_SUCCEEDED,function(){var t={"submitted.bool":"true"};o.write(t),te(t),window.gPostResponse=e.getLastServerResponse();var n=e.getLastServerData();(D=n&&n.hasOwnProperty("secureconfig")?n.secureconfig:null)&&(D=JSON.stringify(r.fixResourcePaths(JSON.parse(D))),N=null,console.log("secure config received, storing"),o.write({"secureconfig.json":D})),X(),G(),W.setDone(R()),Y()}),e}(),i="";I()&&!0===e&&("no"!==T.exam_mode_submit_dialog_clear&&a.addButtonBeforeDefaultButtons(t.translate("Clear answers and start over"),function(){var e=this;ae(!0).then(function(){l(e).dialog("close")})}),i=t.translate("The time allowed for this test has expired.  You can no longer change your answers."),a.addDialogOptions({dialogClass:"no-close bw-dialog bw-student-work-submitter",closeOnEscape:!1})),a.on(a.EVT_BEFORE_SEND,function(){I()&&(s.stop(),o.write({"start_time.number":0}),a.setElapsedTime(s.elapsedFormatted()))}),a.on(a.EVT_SUBMIT_FAILED,a.afterSubmitFailed.bind(a,t.translate("Quiz results not accepted."),t.translate("Unable to send quiz results. Make sure you're connected to the internet."))),a.showSendDialog(i,n)}function re(){var e=ee(!0===t.checkMode&&"points"===T.download_includes_correction);e.setEndpoint(T.download_action),e.setIncludeGrading(!0===t.checkMode&&"points"===T.download_includes_correction),e.showDownloadDialog(u("Enter your name and click 'Generate' to generate the PDF."))}function oe(r){var a=l.Deferred(),i={"saved.bool":!1};return T.save_answers="no",l("#question-content .content").each(function(){var e=l(this);if("true"!==e.attr("noquestion")){var t=e.attr("question-type");i[e.attr("sindex")+"."+t]=null}}),i["mode.quizmode"]="entry",i["start_time.number"]=null,i["question_order_seed.text"]=null,i["secureconfig.json"]=null,D=null,N=null,o.write(i),o.sync(function(){!function(r){W.disable(),l("#question-content .content").each(function(){var e=l(this).attr("question-type");n.questionTypes[e].clear?n.questionTypes[e].clear(this):console.error("No clear function for question type: ",e)}),W.clear(),W.init(),W.enable(),I()&&(r||t.checkMode)&&(console.log("Restart countdown timer"),A()),t.checkMode&&F(),e.moveToStart&&e.moveToStart(),e.questionsReset&&e.questionsReset()}(r),window.BWINITIALIZED=!0,a.resolve()}),a}function ae(e){var t=l.Deferred();return d.showConfirmationDialog(u("The answers will be permanently deleted and cannot be recovered. Are you sure?"),u("Clear the answers and start over?"),function(){var r;console.log("Clearing answers"),window.BWINITIALIZED=!1,(r=[],l("#question-content .content").each(function(){var e=l(this).attr("question-type");n.questionTypes[e].hasOwnProperty("freeResources")&&r.push(n.questionTypes[e].freeResources(this,o))}),l.when.apply(null,r)).always(function(){oe(e).then(function(){t.resolve()})})},null,u("Yes, clear"),u("No, keep")),t}function ie(e,t){ne(e,t)}function se(){l("#startcode-dialog #start_pwd").val(""),l("#startcode-dialog").dialog({dialogClass:"bw-dialog answer-keys-dlg",width:350,title:t.translate("Answer keys"),buttons:[{text:t.translate("OK"),click:function(){l("#startcode-dialog #start_pwd").val()===T.answer_keys_password?(l(this).dialog("close"),function(){var e=L();for(var n in t.questionIf)if(t.questionIf[n].loadCorrect){var r=e[parseInt(l("#"+n).attr("cindex"))];try{t.questionIf[n].loadCorrect(r)}catch(e){console.error("Could not load correct answer for question:",n),console.error(e)}}}(),K(!0),x(),l("#downloadbutton").makeButton(u("Download")).show().click(re)):l("#wrongpwd").show("fast").delay(1e3).hide("fast")}}]})}function ce(e){ie(!1,e)}function le(){function e(){X(),G(),W.setDone(),Y()}""!==T.show_password?(l("body").addClass("pwd-mode"),l("#startcode-dialog").dialog({dialogClass:"bw-dialog no-close view-results-dlg",width:350,title:t.translate("Please enter password"),buttons:[{text:t.translate("OK"),click:function(){l("#startcode-dialog #start_code").val()===T.show_password?(l("body").removeClass("pwd-mode"),l(this).dialog("close"),_(),e()):l("#wrongpwd").show("fast").delay(1e3).hide("fast")}}]})):"yes"===T.show_answers?d.showConfirmationDialog(u("Are you done and do you want to show the answers?"),u("Show answers"),e,null,u("Yes"),u("No")):d.showConfirmationDialog(u("Are you done and do you want to show your score?"),u("Show score"),e,null,u("Yes"),u("No"))}""===T.id&&(T.id="Quiz"),l(function(){l("#clearbutton").makeButton(u("Clear and restart")),T.answer_keys_password&&""!==T.answers_keys_password?l("#clearbutton").clickOrHold(ae.bind(null,!1),se):l("#clearbutton").tapOrClick(ae.bind(null,!1)),l("#sendbutton").makeButton(u("Send")).tapOrClick(function(){ce()}),l("#checkbutton").makeButton(u("Check answers")).tapOrClick(le)}),"yes"===T.allow_sharing?l("#sharebutton").makeButton("Share").show().click(function(){var e=ee(!1);e.setEndpoint(T.share_action),e.setIncludeGrading(!1),e.on(e.EVT_SUBMIT_FAILED,function(){d.showAlert(t.translate("Unable to send quiz. Make sure you're connected to the internet."),t.translate("Send Failed"))}),e.showShareDialog(t.translate("Share the quiz by email."))}):l("#sharebutton").remove(),"yes"===T.allow_download?l("#downloadbutton").show().makeButton("Download").click(re):l("#downloadbutton").remove(),l(".linkbutton").on("touchstart mousedown",function(){l(this).addClass("pressed")}),l(".linkbutton").on("touchend mouseout mouseup",function(){l(this).removeClass("pressed")});var de=!0;function ue(r){if(de?de=!1:window.location.reload(!1),l("#question-content").safeHtml(""),P(r),I()&&(T.save_answers="yes"),D=null,N=null,r.hasOwnProperty("secureconfig.json")){console.log("secure config was saved, restoring");try{D=r["secureconfig.json"]}catch(e){console.error("Could not parse secure config")}}!function(r,o,a){var i,s=0,c=l("#question-content").get(0),d=0;for(i=0;i<e.questionCount();++i){var p=r[i],f=o[p];if("true"!==f.noquestion&&++s,f){var h="QC"+(i+1);(w=l(document.createElement("div")).addClass("content").attr("id",h).appendTo(c)).attr({cindex:p,qindex:"yes"===T.info_numbering?i+1:s,sindex:"yes"===T.random_order?p:s,"question-type":f.Type}),"true"===f.noquestion&&w.attr("noquestion","true")}if(i+1&1?l("#"+h).addClass("odd"):l("#"+h).addClass("even"),null!=n.questionTypes[f.Type]){if("true"===f.noquestion||"yes"!==T.save_answers)n.questionTypes[f.Type].render(f,i+1,null);else{var g="#"+h;n.questionTypes[f.Type].render(f,i+1,a(g))}if("yes"===T.show_question_points&&"true"!==f.noquestion){var m=T.questions[parseInt(w.attr("cindex"))],v=n.questionTypes[f.Type].getAnswer(w,!0,m);v&&v.hasOwnProperty("outof")&&v.outof>0&&(l(document.createElement("div")).addClass("question-points").append(l(document.createElement("span")).addClass("scored-points").safeHtml("&nbsp;&nbsp;")).safeAppend(" / "+S(v.outof)).prependTo(w),d+=parseFloat(v.outof))}}else console.log("Question type "+f.Type+" unknown.")}if(t.hasSubmitCheckPage()){h="QC"+(e.questionCount()+1);var w=l(document.createElement("div")).addClass("submitpage").attr("id",h).appendTo(c);e.questionCount()+1&1?w.addClass("odd"):w.addClass("even"),"yes"===T.show_question_points&&d>0&&l(document.createElement("div")).addClass("question-points").append(l(document.createElement("span")).addClass("scored-points").safeHtml("&nbsp;&nbsp;")).safeAppend(" / "+S(d)).prependTo(w);var b,y,C=l(document.createElement("div")).addClass("bw-centering-container").appendTo(w),k=l(document.createElement("div")).addClass(" pre-submit bw-centered").appendTo(C);"yes"===T.submit_answers?(y="big-submit-button",b=u("Submit")):"yes"===T.show_answers?(y="big-check-button",b=u("Show answers")):(y="big-check-button",b=u("Show score"));var x=e.getPreSubmitText?e.getPreSubmitText():null;null!=x&&l(document.createElement("p")).text(x).appendTo(k),l(document.createElement("div")).attr("id",y).addClass("textbutton bw-button").text(b).appendTo(k),l(document.createElement("div")).addClass("post-submit").appendTo(w)}}(function(t){function n(t){var n=y(t),r=[],o=[],a=0;function i(e){for(var t=e.length;t;){var r=Math.floor(n()*t),o=e[--t];e[t]=e[r],e[r]=o}return e}for(;a<e.questionCount();)"true"===T.questions[a].noquestion?(o.length>0&&(o=i(o),Array.prototype.push.apply(r,o),o=[]),r.push(a)):o.push(a),++a;return o=i(o),Array.prototype.push.apply(r,o),r}if("yes"===T.random_order){var r="question_order_seed.text";if(t.hasOwnProperty(r))return console.log("found seed"),n(t[r]);console.log("no seed stored");var a=Math.random().toString();return o.write({"question_order_seed.text":a}),n(a)}for(var i=[],s=0;s<e.questionCount();++s)i[s]=s;return i}(r),T.questions,function(e){return function(){!function(e){var t={"saved.bool":"true"},r=l(e),a=r.attr("sindex"),i=r.attr("question-type"),s=r.is(":empty")?r.attr("save_data"):n.questionTypes[i].save(r[0]);if(null!=s){if(n.questionTypes[i].hasOwnProperty("preprocessSaveData"))return void n.questionTypes[i].preprocessSaveData(e,o,s).done(function(e,n){t[e+"."+i]=n,o.write(t)}.bind(null,a+""));t[a+"."+i]=s}else t[a+"."+i]=null;o.write(t)}(e),W.questionChanged(e)}}),e.finishQuestions(),W.init(),$()&&U(),l("#big-submit-button").makeButton().click(function(){ce(!0)}),l("#big-check-button").makeButton().click(le),p.addAllDesignInfo(),b.notifyLoaded(),"yes"===T.save_answers?function(e){function t(){if(I()){var t={timeoutCB:function(){console.log("Timer callback: submitting to server"),ie(!0,!1)},time:60*parseInt(T.countdown_time)},n="start_time.number";if(e.hasOwnProperty(n)){var r=e[n];t.starttime=r,s.init(t),!1===O&&s.start()}else s.init(t),!1===O&&A()}}e&&e.hasOwnProperty("saved.bool")&&"true"===e["saved.bool"]?(te(e),l("#question-content .content").each(function(){var t=l(this);if("true"!==t.attr("noquestion")){var r=t.attr("question-type"),a=t.attr("sindex")+"."+r;if(e.hasOwnProperty(a)){var i=e[a];if(null!=i)try{n.questionTypes[r].hasOwnProperty("preprocessLoadData")?n.questionTypes[r].preprocessLoadData(this,o,i).done(n.questionTypes[r].load):n.questionTypes[r].load(this,i)}catch(e){console.error("Error: exception loading question of type "+r+" ",e)}}}}),t(),e.hasOwnProperty("mode.quizmode")&&"check"===e["mode.quizmode"]?(X(),G(!1),W.disable()):(W.enable(),W.setLoadedAnswersState())):(t(),W.enable())}(r):W.enable(),e.postCreateInit(),i.redrawAll(),x(),setTimeout(x,250),i.schedule(x),window.BWINITIALIZED=!0}C.isPreview()&&(window.createPostMessage=function(e){"use strict";var t=!1;e&&"undefined"==typeof bwshortcode&&(window.bwshortcode="ABC123",t=!0);var n={answers:Z(!0)};return t&&delete window.bwshortcode,JSON.stringify(n)}),c.makeWidget({layout:"title_toolbar_layout",title:""===T.id||"Quiz"===T.id?e.getWidgetType():T.id}),window.BwUseManualWidgetLoadedNotification(),"right-to-left"==T.direction&&(l("body").addClass("right-to-left"),l(".question-content").css("direction","rtl")),e.preLoadInit(),window.addEventListener("message",function e(t){var n=t.data;n.hasOwnProperty("msg")&&"requestlogin"===n.msg&&(b.notifyLoaded(),window.removeEventListener("message",e))}),o.init({type:function(){return"quiz"},group:""==T.book_title?"-":T.book_title,name:T.id,id:T.uuid2,updateCallback:ue,singleKey:!1})})})},function(e,t,n){"use strict";n.r(t),n.d(t,"mergeSecureConfig",function(){return o});var r=n(22);function o(e,t){if(r.isArray(t)){if(0===t.length)return e;if(t.length!==e.length)return e;for(var n=[],a=0;a<t.length;++a)n.push(o(e[a],t[a]));return n}var i=r.cloneDeep(e);for(var s in t)s.startsWith("_")?i[s.substring(1)]=t[s]:i[s]=o(e[s],t[s]);return i}},function(e,t,n){e.exports=function(e,t,n,r,o,a,i,s){var c=e.getConfigSync(),l=i.getParameters();function d(e){return!e||0===e.length}function u(e){return e.indexOf("bookwidgets.com")>=0||e.indexOf("localhost")>=0?{"Bookwidgets-Platform":n.getPlatform()}:{}}function p(){return l.teacher_id}function f(){return l.hasOwnProperty("wv")}return{createStudentWorkSubmitter:function(e,h,g,m){var v={FLD_STUDENT_NAME:"#student",FLD_STUDENT_ACCOUNT:"#student_account",FLD_STUDENT_EMAIL:"#student_email",FLD_STUDENT_ID:"#student_id",FLD_STUDENT_CLASS_ID:"#student_class_id",FLD_TEACHER_EMAIL:"#email",FLD_YOUR_NAME:"#you",FLD_YOUR_EMAIL:"#your_email",FLD_TO_EMAIL:"#to_email"},w={};w[v.FLD_STUDENT_NAME]="student_name",w[v.FLD_STUDENT_EMAIL]="student_email",w[v.FLD_STUDENT_ID]="student_id",w[v.FLD_STUDENT_CLASS_ID]="student_class_id",w[v.FLD_TEACHER_EMAIL]="teacher_email",w[v.FLD_YOUR_NAME]="student_name",w[v.FLD_YOUR_EMAIL]="student_email",w[v.FLD_TO_EMAIL]="to_email";var b,y,C,k,T=p();v._postdata={test_name:e,uuid2:g,WA:m,book_title:h,submit_timestamp:(new Date).toISOString(),submit_date:(b=new Date,y=b.getDate(),C=b.getMonth()+1,k=b.getYear(),k<1900&&(k+=1900),(1==C?"January":2==C?"February":3==C?"March":4==C?"April":5==C?"May":6==C?"June":7==C?"July":8==C?"August":9==C?"September":10==C?"October":11==C?"November":"December")+" "+y+", "+k),tzoffset:(new Date).getTimezoneOffset()/60*-1,include_grading:!0,submitted_via_shortcode:window.bwshortcode,answers:[]},"wv"in l&&(v._postdata.wv=l.wv),v._extradata={},v._answersComposer=void 0,v._assetUploadAgenda=[],v._eventCallbacks={},v._lastServerResponse="",v._lastServerData=null,v._leftButtons=[],v._rightButtons=[],v._dialogOptions={},v._endpoint="",v._fieldSettings={},v.setCompanyInfo=function(e,t,n,r){v._postdata.company_name=e,v._postdata.company_address=t,v._postdata.company_phone=n,v._postdata.company_website=r},v.setIncludeGrading=function(e){v._postdata.include_grading=e?"yes":"no"},v.setElapsedTime=function(e){v._postdata.time=e},v.setEndpoint=function(e){v._endpoint=e},v._storeField=function(e,n){var r=v._fieldSettings[e].isVisible,o=v._fieldSettings[e].isEditable;if(r&&o){var a=w[e];t.set(a,n)}},v._setStudentInfo=function(e,n,r,o){v._postdata.student_name=e,v._postdata.student_id=n,v._postdata.student_email=r,v._postdata.student_class_id=o,t.hasStudentAccount()&&(v._postdata.student_userid=t.getStudentAccountUserId(),v._postdata.student_name=t.getStudentAccountUserName(),v._postdata.student_email=t.getStudentAccountEmail(),v._postdata.student_id=t.getStudentAccountProviderHumanId(),v._postdata.student_token=t.getStudentAccountToken());var a=l.context_id;a&&(v._postdata.context_id=a),T&&(v._postdata.teacher_id=T),l.course_id&&(v._postdata.course_id=l.course_id),v._storeField(v.FLD_STUDENT_NAME,e),v._storeField(v.FLD_STUDENT_ID,n),v._storeField(v.FLD_STUDENT_EMAIL,r),v._storeField(v.FLD_STUDENT_CLASS_ID,o)},v._setTeacherEmail=function(e){v._postdata.teacher_email=e,v._storeField(v.FLD_TEACHER_EMAIL,e)},v._setShareInfo=function(e,t,n,r){v._postdata.student_name=e,v._postdata.student_email=t,v._postdata.to_email=n,v._postdata.message=r,v._storeField(v.FLD_YOUR_NAME,e),v._storeField(v.FLD_YOUR_EMAIL,t),v._storeField(v.FLD_TO_EMAIL,n)},v._setDownloadInfo=function(e,t,n,r){v._postdata.student_name=e,v._storeField(v.FLD_YOUR_NAME,e)},v.setAnswersComposer=function(e){v._answersComposer=e},v.addExtraData=function(e){for(var t in e)v._extradata[t]=e[t]},v.scheduleAssetUpload=function(e,t,n){v._assetUploadAgenda.push({assetFetcherCB:e,assetUploadCompleteCB:t,userdata:n})},v.configureFormField=function(e,t,n,r){v._fieldSettings[e]={isVisible:t,isEditable:n,defaultValue:r}},v.configureFormField(v.FLD_STUDENT_ACCOUNT,!0===t.hasStudentAccount(),!1,t.getStudentAccountUserName()||""),v.configureFormField(v.FLD_STUDENT_NAME,!1===t.hasStudentAccount()&&"yes"==c.student_name_isVisible,"yes"==c.student_name_isEditable,c.student_name_defaultValue),v.configureFormField(v.FLD_STUDENT_EMAIL,!1===t.hasStudentAccount()&&"yes"==c.student_email_isVisible,"yes"==c.student_email_isEditable,c.student_email_defaultValue),v.configureFormField(v.FLD_STUDENT_ID,!1===t.hasStudentAccount()&&"yes"==c.student_id_isVisible,"yes"==c.student_id_isEditable,c.student_id_defaultValue);var x=d(l.student_class_id)?d(t.getStudentAccountClassName())?void 0:t.getStudentAccountClassName():l.student_class_id,_="yes"==c.student_class_id_isEditable&&!x;function S(e,t,n,o){var a,i=r(document.createElement("label"));i.attr("for",t),i.attr("id",t+"_label"),i.text(e),o.append(i),"textarea"==n?(a=r(document.createElement("textarea"))).attr("rows",5):((a=r(document.createElement("input"))).attr("type",n),a.attr("onfocus","this.value = this.value;")),a.attr("name",t),a.attr("id",t),a.attr("value",""),o.append(a)}function E(e){return e.split(",").length>1}function I(e,t){var r={content:"",ibw_platform:n.getPlatform()};for(var o in v._extradata)r[o]=v._extradata[o];void 0===v._submitPreparer&&(v._submitPreparer=function(e){e()}),v.showProgressDialog(t),setTimeout(function(){v._submitPreparer(function(){v.uploadAssets(function(){console.log("All assets uploaded, now sending answers"),v.composeAllAnswers(),r.content=JSON.stringify(v._postdata),e(r),v.trigger(v.EVT_AFTER_SEND),console.log("Submit complete")},function(){console.log("Asset upload failed, aborting"),v.closeProgressDialog(),v.trigger(v.EVT_SUBMIT_FAILED),v.trigger(v.EVT_AFTER_SEND)})},function(e){console.log("Aborted by client: "+e),v.closeProgressDialog(),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED),v.trigger(v.EVT_AFTER_SEND)})},100)}function O(){I(v.sendResults.bind(v),a("Sending, please wait..."))}function A(){var e=r(this),n=e.find("#student").val(),i=e.find("#student_id").val(),s=e.find("#student_email").val(),l=e.find("#student_class_id").val(),d=e.find("#email").val();if(!1!==t.hasStudentAccount()||""!==n){if(!T){if(!(null!=d&&""!==d||"yes"===c.teacher_email_isVisible&&"yes"===c.teacher_email_isEditable||!1!==f()))return void o.showAlert(a("This field is required:")+" "+a("Teacher Email"),a("Send Failed"));if(E(d))return void o.showAlert(a("You can't specify multiple addresses for field:")+" "+a("Teacher Email"),a("Send Failed"))}e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setStudentInfo(n,i,s,l),v._setTeacherEmail(d),O()}else o.showAlert(a("This field is required:")+" "+a("Student Name"),a("Send Failed"))}function q(){var e=r(this),t=e.find("#you").val(),n=e.find("#your_email").val(),i=e.find("#to_email").val(),s=e.find("#message").val();""!==t?""!==i?(e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setShareInfo(t,n,i,s),O()):o.showAlert(a("This field is required:")+" "+a("To Email"),a("Send Failed")):o.showAlert(a("This field is required:")+" "+a("Your Name"),a("Send Failed"))}function P(){var e=r(this),t=e.find("#you").val();""!==t?(e.dialog("close"),e.remove(),v.trigger(v.EVT_BEFORE_SEND),v._setDownloadInfo(t),I(v.generate.bind(v),a("Generating PDF, please wait..."))):o.showAlert(a("This field is required:")+" "+a("Your Name"),a("Download Failed"))}return v.configureFormField(v.FLD_STUDENT_CLASS_ID,"yes"==c.student_class_id_isVisible,_,d(x)?d(c.student_class_id_defaultValue)?"":c.student_class_id_defaultValue:x),v.configureFormField(v.FLD_TEACHER_EMAIL,"yes"==c.teacher_email_isVisible&&!T,"yes"==c.teacher_email_isEditable,l.teacher_email||c.teacher_email_defaultValue),v.configureFormField(v.FLD_YOUR_NAME,!0,!0,""),v.configureFormField(v.FLD_YOUR_EMAIL,!0,!0,""),v.configureFormField(v.FLD_TO_EMAIL,!0,!0,""),v.addButtonBeforeDefaultButtons=function(e,t){v._leftButtons.push({text:e,click:t})},v.addButtonAfterDefaultButtons=function(e,t){v._rightButtons.push({text:e,click:t})},v.addDialogOptions=function(e){for(var t in e)v._dialogOptions[t]=e[t]},v.setAsyncSubmitPreparer=function(e){v._submitPreparer=e},v.EVT_BEFORE_SHOW="beforeShow",v.EVT_BEFORE_SEND="beforeSend",v.EVT_AFTER_SEND="afterSend",v.EVT_SUBMIT_SUCCEEDED="submitSucceeded",v.EVT_SUBMIT_FAILED="submitFailed",v.on=function(e,t){v._eventCallbacks[e]?v._eventCallbacks[e].push(t):(v._eventCallbacks[e]=[],v._eventCallbacks[e].push(t))},v.trigger=function(e){if(v._eventCallbacks[e])for(var t=0;t<v._eventCallbacks[e].length;++t)v._eventCallbacks[e][t]()},v._applyFormFieldSettings=function(e){if(0!=(s=r(e)).length){var n=r(e+"_label"),o=v._fieldSettings[e].isVisible,a=v._fieldSettings[e].isEditable,i=v._fieldSettings[e].defaultValue;E(i)&&(o&&a?function(e,t){for(var n=r(e),o=r(document.createElement("select")).attr({id:n.attr("id"),name:n.attr("name")}),a=0;a<t.length;++a)r(document.createElement("option")).safeHtml(t[a]).appendTo(o);n.replaceWith(o),n.remove()}(e,function(e){for(var t=e.split(","),n=[],r=0;r<t.length;++r)n.push(t[r].trim());return n}(i)):i=i.split(",")[0]);var s=r(e);if(n=r(e+"_label"),!1===o&&(s.hide(),n.hide()),!1===a&&s.attr("disabled","true"),s.val(i),o&&a){var c=w[e];t.get(c,function(e){null!=e&&""!==e&&s.val(e)})}}},v.showSendDialog=function(e,n){t.initialized().done(function(){if(t.isCoAccount())o.showAlert(a("Submit is disabled because you're not logged in with a student account. e.g. a parent account."),a("Can't submit"));else{var c=function(){r("#student-work-submitter-dialog").remove();var e=r(document.createElement("div"));e.attr("id","student-work-submitter-dialog"),e.css("display","none");var t=r(document.createElement("div"));return t.attr("id","student-work-submitter-dialog-info"),e.append(t),S("","student_account","text",e),S(a("Student Name"),"student","text",e),S(a("Student ID"),"student_id","text",e),S(a("Student Email"),"student_email","email",e),S(a("Class ID"),"student_class_id","text",e),S(a("Teacher Email"),"email","email",e),r("body").append(e),e}(),l=!1;for(var d in v._fieldSettings)v._applyFormFieldSettings(d),l=l||v._fieldSettings[d].isVisible&&v._fieldSettings[d].isEditable&&r(d).length>0;e?(r("#student-work-submitter-dialog-info").safeHtml(e),r("#student-work-submitter-dialog-info").removeClass("hidden")):r("#student-work-submitter-dialog-info").addClass("hidden");for(var u=[],p=0;p<v._leftButtons.length;++p)u.push(v._leftButtons[p]);for(u.push({text:a("Send"),click:A}),p=0;p<v._rightButtons.length;++p)u.push(v._rightButtons[p]);var f={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:a("Send Answer"),width:"450px",buttons:u};for(var h in v._dialogOptions)f[h]=v._dialogOptions[h];c.dialog(f);var g=i.getQueryParams(window.location.search).toplevel;l||1!==u.length||!n||!s.isLTI()||g||A.call(c)}})},v.showShareDialog=function(e){console.log("showShare"),t.initialized().done(function(){var t=function(){r("#student-work-share-dialog").remove();var e=r(document.createElement("div"));e.attr("id","student-work-share-dialog"),e.css("display","none");var t=r(document.createElement("div"));return t.attr("id","student-work-share-dialog-info"),e.append(t),S(a("Your Name"),"you","text",e),S(a("Your Email"),"your_email","email",e),S(a("To Email"),"to_email","email",e),S(a("Optional Message"),"message","textarea",e),r("body").append(e),e}();for(var n in v._fieldSettings)v._applyFormFieldSettings(n);e?(r("#student-work-share-dialog-info").safeHtml(e),r("#student-work-share-dialog-info").removeClass("hidden")):r("#student-work-share-dialog-info").addClass("hidden");for(var o=[],i=0;i<v._leftButtons.length;++i)o.push(v._leftButtons[i]);for(o.push({text:a("Send"),click:q}),i=0;i<v._rightButtons.length;++i)o.push(v._rightButtons[i]);var s={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:a("Share"),width:"450px",buttons:o};for(var c in v._dialogOptions)s[c]=v._dialogOptions[c];t.dialog(s)})},v.showDownloadDialog=function(e){console.log("showDownload"),t.initialized().done(function(){var t=function(){r("#student-work-download-dialog").remove();var e=r(document.createElement("div"));e.attr("id","student-work-download-dialog"),e.css("display","none");var t=r(document.createElement("div"));return t.attr("id","student-work-download-dialog-info"),e.append(t),S(a("Your Name"),"you","text",e),r("body").append(e),e}();for(var n in v._fieldSettings)v._applyFormFieldSettings(n);e?(r("#student-work-download-dialog-info").safeHtml(e+"<br>"),r("#student-work-download-dialog-info").removeClass("hidden")):r("#student-work-download-dialog-info").addClass("hidden");for(var o=[],i=0;i<v._leftButtons.length;++i)o.push(v._leftButtons[i]);for(o.push({text:a("Generate"),click:P}),i=0;i<v._rightButtons.length;++i)o.push(v._rightButtons[i]);var s={dialogClass:"bw-student-work-submitter",modal:!0,title:a("Download as PDF"),width:"450px",buttons:o};for(var c in v._dialogOptions)s[c]=v._dialogOptions[c];t.dialog(s)})},v.showProgressDialog=function(e){(function(){var e="student-work-submitter-progress-dialog";r("#"+e).remove();var t=r(document.createElement("div"));t.attr("id",e),t.css("display","none");var n=r(document.createElement("div"));n.addClass("spinner"),t.append(n);var o=r(document.createElement("div"));return o.addClass("progress-message"),o.text(a("Uploading your answers...")),t.append(o),r("body").append(t),t})().dialog({modal:!0,dialogClass:"no-close bw-dialog",title:e})},v.updateProgressMessage=function(e){r(".progress-message").text(e)},v.closeProgressDialog=function(){r("#student-work-submitter-progress-dialog").remove()},v.uploadAssets=function(e,t){var n=v._assetUploadAgenda,r=null,o=0,i=n.length;(r=function(){if(n.length>0){var s=n.shift(),c=s.assetFetcherCB(s.userdata);++o,c?(v.updateProgressMessage(("audio/mpeg"===c.mimetype?a("Uploading audio"):a("Uploading image"))+" "+o+" / "+i),v.sendAsset(c,function(e){s.assetUploadCompleteCB(e,s.userdata),r()},function(){v._lastServerResponse=void 0,t()})):r()}else v.updateProgressMessage(a("Uploading your answers...")),e()})()},v.sendAssetAjax=function(e,t,n){var o={content:JSON.stringify({is_asset:!0,asset_data:e.data,asset_mimetype:e.mimetype})};for(var a in v._extradata)o[a]=v._extradata[a];r.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:o,success:function(e){t(e)},error:function(){n()}})},v.genRandomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},v.sendAsset=v.sendAssetAjax,v.composeAllAnswers=function(){v._postdata.answers=v._answersComposer()},v.sendAudioPacket=function(e,t,n,o,a){var i=v._endpoint+".m4a?t="+e+"&d="+t+"&p="+n,s=new Audio;r(s).on("loadedmetadata",function(){var e=Math.floor(10*r(this)[0].duration);o(e)}),r(s).on("error",function(){console.log("Audio package load failure: "+s.error.code),a("Network or server problem")}),s.src=i},v.getPacket=function(e){for(var t=0,n=e.length,r=0,o="",a="";;){var i=n-t;if(0===i)break;var s=e.substr(t,100),c=encodeURIComponent(s),l=c.length;if(r+l>1900){a=e.substr(t);break}t+=i<100?i:100,o+=c,r+=l}return{packet:o,remaining:a}},v.sendAudio=function(e,t,n,r,o){void 0===r&&(r=v.genRandomString(20)),void 0===o&&(o=1);var a,i=v.getPacket(e);""===i.remaining?(a=t,o=0):a=function(e,t,n){return function(a){0===a?v.sendAudio(e,t,n,r,o+1):n("Wrong server response")}}(i.remaining,t,n),v.sendAudioPacket(r,i.packet,o,a,n)},v.sendResultsAudio=function(e){v.sendAudio(JSON.stringify(e),function(e){switch(console.log("sendAudio success handler called"),v.closeProgressDialog(),e){case 0:console.error("Oops, server expected another packet..."),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED);break;case 1:console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED);break;case 2:console.error("Network or server error"),v._lastServerResponse="NEWUSER",v.trigger(v.EVT_SUBMIT_FAILED);break;case 3:console.error("Network or server error"),v._lastServerResponse="USERNOTACTIVE",v.trigger(v.EVT_SUBMIT_FAILED);break;case 4:console.error("Network or server error"),v._lastServerResponse="INVALIDUSER",v.trigger(v.EVT_SUBMIT_FAILED);break;case 5:console.error("Network or server error"),v._lastServerResponse="STUDENTNOTAUTHORIZED",v.trigger(v.EVT_SUBMIT_FAILED);break;default:console.error("Unexpected server return value"),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED)}},function(e){console.error("sendAudio error handler called: "+e),v.closeProgressDialog(),v._lastServerResponse=void 0,v.trigger(v.EVT_SUBMIT_FAILED)})},v.sendResultsAjax=function(e){e.accept_json_response=!0,c.hasOwnProperty("widget_language")&&""!=c.widget_language&&(e.lang=c.widget_language),r.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:e,success:function(e,t,n){console.log("Submit OK"),v.closeProgressDialog();var r=n.getResponseHeader("Content-Type");switch(v._lastServerResponse=e,v._lastServerMessage=null,v._lastServerData=null,r){case"application/json":e.hasOwnProperty("status")&&"OK"===e.status?(console.log("That's a success!"),v._lastServerData=e.data,v.trigger(v.EVT_SUBMIT_SUCCEEDED)):e.hasOwnProperty("code")?(console.log("That's a failure!",e),v._lastServerResponse=e.code,v._lastServerMessage=e.message,v.trigger(v.EVT_SUBMIT_FAILED)):(console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED));break;case"text/html":console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED);break;default:"OK"==e?(console.log("That's a success!"),v.trigger(v.EVT_SUBMIT_SUCCEEDED)):(console.log("That's a failure!"),v.trigger(v.EVT_SUBMIT_FAILED))}},error:function(e){console.error("AJAX error handler called");try{var t=JSON.parse(e.responseText);v._lastServerResponse=null,v._lastServerData=null,v._lastServerMessage=t.message}catch(e){console.error("Error msg not json"),v._lastServerResponse=void 0}v.closeProgressDialog(),v.trigger(v.EVT_SUBMIT_FAILED)}})},v.generate=function(e){r.ajax({type:"POST",headers:u(v._endpoint),url:v._endpoint,data:e,success:function(e,t,n){var i,s,c;console.log("AJAX success handler called"),v.closeProgressDialog(),"application/json"==n.getResponseHeader("Content-Type")?(console.log("That's a success!"),v._lastServerResponse=e,i=e.url,s=e.filename,c=r(document.createElement("div")).append(r(document.createElement("a")).attr({href:i,download:s}).safeHtml(a("Click here to download your PDF"))),o.showAlert(c.html(),a("PDF generated"))):(console.log("That's a failure!"),v._lastServerResponse=e,o.showAlert(a("Could not generate PDF.  Please try again later."),a("Generate PDF failed")))},error:function(){console.log("AJAX error handler called"),v.closeProgressDialog(),v._lastServerResponse=void 0,o.showAlert(a("Could not generate PDF.  Please try again later."),a("Generate PDF failed"))}})},v.sendResults="ibw-platform-ipad-ibooks-epub"==n.getPlatform()?v.sendResultsAudio:v.sendResultsAjax,v.getLastServerResponse=function(){return v._lastServerResponse},v.getLastServerMessage=function(){return v._lastServerMessage},v.getLastServerData=function(){return v._lastServerData},v.afterSubmitFailed=function(e,t){var n="",r=this.getLastServerResponse();if(r)if(n=e+"<br><br>","NEWUSER"===r)n+=a("The email address you provided has not been registered.")+"<br><br>",n+=a("To prevent abuse, results can only be sent to registered email addresses.")+" ",n+=a("Activate by clicking on the link in the email which was sent to the address provided.")+" ",n+=a("You can also register at www.bookwidgets.com.")+"<br>";else if("USERNOTACTIVE"===r)n+=a("The email address you provided has not been activated.")+"<br><br>",n+=a("To prevent abuse, results can only be sent to registered email addresses.")+" ",n+=a("Activate by clicking on the link in the email which was sent to the address provided.")+" ",n+=a("You can also register at www.bookwidgets.com.")+"<br>";else if("INVALIDUSER"===r)n+=a("Invalid user name")+"<br>";else{var i;n+=(i=this.getLastServerMessage())?i+"<br>":a("Unknown error")+"<br>"}else(i=this.getLastServerMessage())?n+=i+"<br>":n=t;o.showAlert(n,a("Send Failed"))},v},isTeacherEmailRequired:function(){return!p()&&!f()}}}(n(1),n(487).o,n(2),n(0),n(9),n(7),n(11),n(74))},function(e,t,n){var r=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n(1),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n(49).o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(114).o,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(192).o,s={},c=e.Deferred();s.initialized=function(){return c};var l=t.getParameters(),d=l.hasOwnProperty("teacher_id")?l.teacher_id:"",u=l.hasOwnProperty("school_id")?l.school_id:"";return r.getConfig().then(function(t){var n="no"!==t.save_answers;function r(e){return"student_name"==e||"student_email"==e||"student_id"==e}var l=null,p=-1;function f(r){if(c.resolve(),r==p)return console.log("Warning: setting identical storage state, ignoring"),e.when();var s=t.book_title&&""!==t.book_title?t.book_title:"_no_name_";switch(r){case o.ANONYMOUS:l=a.createInfoStorage(s,"",n);break;case o.OFFLINE:l=a.createInfoStorage(s,o.getUserId(),n);break;case o.ONLINE:l=i.createInfoStorage(s,d,u)}return p=r,e.when()}s.get=function(e,t){if(p!=o.ANONYMOUS&&o.hasProperty(e))t(o.getProperty(e));else if(n){var a=function(n){t(n[e])};r(e)?l.getCommonProperties(a):l.getGroupProperties(a)}else t(null)},s.set=function(e,t){if(p!=o.ANONYMOUS&&o.hasProperty(e))console.log("Request setting read-only property... skipping");else if(n){var a={};a[e]=t,r(e)?l.setCommonProperties(a):l.setGroupProperties(a)}},s.hasStudentAccount=function(){return p==o.OFFLINE||p==o.ONLINE},s.getStudentAccountUserId=function(){return o.getUserId()},s.getStudentAccountUserName=function(){return o.getUserName()},s.getStudentAccountEmail=function(){return o.getEmail()},s.getStudentAccountProviderId=function(){return o.getProviderId()},s.getStudentAccountProviderHumanId=function(){return o.getProviderHumanId()},s.getStudentAccountToken=function(){return o.getUserToken()},s.getStudentAccountClassName=function(){return o.getUserClassName()},s.isCoAccount=function(){return o.isCoAccount()},o.initialized().then(function(){f(o.getState()),o.registerStateChangeCallback(f)},function(){f(o.ANONYMOUS)})}),s}.bind(null,n(0),n(11));e.exports={f:r,o:r()}},function(e,t,n){var r;e.exports=(r=n(0),{show:function(){var e=r("#bwcountdown");0==e.length&&(e=r(document.createElement("div")).attr("id","bwcountdown").append(r(document.createElement("label")).attr("id","bwhours").text("00:")).append(r(document.createElement("label")).attr("id","bwminutes").text("00:")).append(r(document.createElement("label")).attr("id","bwseconds").text("00:")).prependTo("#title-toolbar")),e.show()},hide:function(){r("#bwcountdown").hide()},starttime:null,countdowntime:0,running:!1,initialized:!1,pad:function(e){return e>9?e:"0"+e},timeLeft:function(){var e;if(0==this.countdowntime&&console.log("getting time left but  no countdown time set"),null==this.starttime)console.log("getting time left but no starttime set"),e=this.countdowntime;else{var t=new Date;(e=this.countdowntime-(t.getTime()-this.starttime.getTime())/1e3)<0&&(e=0)}return parseInt(e)},elapsed:function(){return this.countdowntime-this.timeLeft()},updateDisplay:function(){var e=this.timeLeft(),t=e%60,n=parseInt(e/60%60),o=parseInt(e/3600);r("#bwcountdown #bwseconds").safeHtml(this.pad(t)),r("#bwcountdown #bwminutes").safeHtml(this.pad(n)+":"),r("#bwcountdown #bwhours").safeHtml(this.pad(o)+":"),0==o?r("#bwcountdown #bwhours").css("display","none"):r("#bwcountdown #bwhours").css("display","initial")},setStartTime:function(e){console.log("Set start time to "+e),this.starttime=new Date(e),this.updateDisplay()},getStartTime:function(e){return null==this.starttime?null:this.starttime.getTime()},isInitialized:function(){return this.initialized},reset:function(){this.starttime=null},start:function(){if(console.log("Starting countdown timer"),this.running)console.log("Error: start called twice");else{if(null==this.starttime){var e=new Date;this.setStartTime(e.getTime())}this.timerid=setInterval(this.update.bind(this),1e3),this.running=!0,this.show(),this.updateDisplay()}},init:function(e){console.log("Initializing countdown timer"),!0===this.running&&this.stop(),e.hasOwnProperty("time")&&(this.countdowntime=e.time||60),e.hasOwnProperty("timeoutCB")&&(this.callback=e.timeoutCB),e.hasOwnProperty("starttime")&&this.setStartTime(parseInt(e.starttime)),this.initialized=!0},stop:function(){this.running=!1,clearInterval(this.timerid),this.updateDisplay()},elapsedFormatted:function(){var e=this.elapsed();return this.pad(parseInt(e/60))+":"+this.pad(e%60)},update:function(){0==this.timeLeft()&&(this.stop(),null!=this.callback&&this.callback()),this.updateDisplay()}})},function(e,t,n){e.exports=function(e){var t={};function n(e,t){return"credentials/"+e+"/"+t}return t.setLoggedIn=function(t,r,o,a,i){e.setItem(n(t,"username"),r),e.setItem(n(t,"fullname"),o),e.setItem(n(t,"email"),a),e.setItem(n(t,"accesstoken"),i)},t.setLoggedOut=function(t){e.removeItem(n(t,"username")),e.removeItem(n(t,"fullname")),e.removeItem(n(t,"email")),e.removeItem(n(t,"accesstoken"))},t.getLoginData=function(t){var r=e.getItem(n(t,"username")),o=e.getItem(n(t,"fullname")),a=e.getItem(n(t,"email")),i=e.getItem(n(t,"accesstoken"));return r&&i?{username:r,fullname:o,email:a,accesstoken:i}:null},t}(n(177).o)},function(e,t,n){var r=n(22).extend,o=n(111);e.exports=function(e,t,a){var i=n(26).createLogger("ProgressLogger"),s=new e;s.startListening();return function(e){var n=void 0!==e||"ibw-platform-ipad-bookwidgets"===t.getPlatform();e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var a={};function c(e,t){a.callObjC("progress",r({cmd:e},t),function(){i.error("ProgressLogger: OK for:"+e)},function(){i.error("ProgressLogger: ERROR for:",e)})}a.resultForCallback=function(e,t){s.processCallback(e,t)},a.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},a.callObjC=function(t,n,r,i){var c=o.url(t,n),l=s.registerCallbacks(r,i),d="'"+l.ok+"'",u="'"+l.error+"'",p="ProgressLogger.resultForCallback";a.runningInIframe()&&(p="function ProgressLogger_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; ProgressLogger_callback_wrapper"),e(c+"&okCallbackId="+d+"&errorCallbackId="+u+"&callbackFunc="+p)},a.restart=function(){n&&c("restart")},a.registerScore=function(e,t,r,o,a){return n?(c("registerScore",{identifier:e,title:t,score:o,maxScore:r,primary:!0===a}),{lastval:o,update:function(n){return n!==this.lastval&&(c("updateScore",{identifier:e,title:t,score:n,maxScore:r,primary:!0===a}),this.lastval=n,!0)}}):{update:function(){return!1}}},a.registerBinary=function(e,t,n,r,o){return{update:function(){return!1}}},a.registerQuantity=function(e,t,r,o){return n?(c("registerQuantity",{identifier:e,title:t,quantity:r,primary:!0===o}),{lastval:r,update:function(n){return n!==this.lastval&&(c("updateQuantity",{identifier:e,title:t,quantity:n,primary:!0===o}),this.lastval=n,!0)}}):{update:function(){return!1}}};var l=0;return a.setProgress=function(e,t){if(n){var r=Math.max(0,Math.min(1,e/t));r!==l&&(c("setProgress",{progress:r}),l=r)}},a.registerSet=function(e,t,r,o){if(!n)return{registerAccess:function(){return!1}};var a=this;return{elements:[],accesscount:0,accessedcount:0,accessedLogger:this.registerQuantity(e+"accessed",t,0),accessesLogger:this.registerQuantity(e+"accesses",r,0),registerAccess:function(e){return this.accessesLogger.update(++this.accesscount),this.elements.hasOwnProperty(e)||(this.elements[e]=!0,this.accessedLogger.update(++this.accessedcount),a.setProgress(this.accessedcount,o)),!0}}},window.ProgressLogger=a,a}}(n(76),n(2))},function(e,t,n){e.exports=(n(1),{useManualNotify:window.BwUseManualWidgetLoadedNotification,notifyLoaded:window.BwNotifyWidgetLoaded})},,,,,,,,,function(e,t){},function(e,t,n){var r,o;e.exports=(r=n(1),o=n(502),n(0),void r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("MathJs")&&o.loadJS("js/math.min.js","head"),e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("scientific")&&o.loadJS("js/scientificcalculator_init.js","head")}))},function(e,t,n){e.exports=function(e){return{loadJS:function(t,n,r){var o=e.Deferred(),a=document.createElement("script");if(a.setAttribute("type","text/javascript"),r)for(var i in r)r.hasOwnProperty(i)&&a.setAttribute(i,r[i]);return a.setAttribute("src",t),a.onload=function(){o.resolve()},a.onerror=function(){o.reject()},void 0!==a&&document.getElementsByTagName(n)[0].appendChild(a),o}}}(n(0))}]);